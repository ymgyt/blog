<!doctype html><html lang=ja><head><meta charset=UTF-8><meta content="width=device-width,initial-scale=1" name=viewport><link href=https://blog.ymgyt.io/favicon.ico rel=icon sizes=any><link href=https://blog.ymgyt.io/icon.svg rel=icon type=image/svg+xml><link href=https://blog.ymgyt.io/apple-touch-icon.png rel=apple-touch-icon><link href=https://blog.ymgyt.io/manifest.webmanifest rel=manifest><link href=https://blog.ymgyt.io/style.css rel=stylesheet><link href=https://blog.ymgyt.io/atom.xml rel=alternate title=Atom type=application/atom+xml><script src="https://www.googletagmanager.com/gtag/js?id=G-GTB0KMLN90" async></script><script>window.dataLayer = window.dataLayer || [];
	function gtag() {dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-GTB0KMLN90');</script><title>📗 Terraform: Up and Running, 3rd Editionを読んだ感想 | Happy developing</title><meta content="Terraform: Up and Runningを読んだ感想について" name=description><meta content=summary name=twitter:card><meta content="@YAmaguchixt " name=twitter:site><meta content="📗 Terraform: Up and Running, 3rd Editionを読んだ感想" name=twitter:title><meta content="Terraform: Up and Runningを読んだ感想について" name=twitter:description><meta content=https://blog.ymgyt.io/images/emoji/green_book.png name=twitter:image><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><body><div class=world><div class=content-container><header class=blog-header-container><div class=blog-logo><a href=https://blog.ymgyt.io>Happy developing</a></div><div class=blog-nav><nav><ul><li><a href=https://blog.ymgyt.io/entry/>Entries</a><li><a href=https://blog.ymgyt.io/tags/>Tags</a><li><a href=https://blog.ymgyt.io/about/>About</a><li><a href=https://github.com/ymgyt> <img alt=Github class=icon src=https://blog.ymgyt.io/images/icon/github.svg> </a><li><a href="https://twitter.com/YAmaguchixt "> <img alt=Twitter class=icon src=https://blog.ymgyt.io/images/icon/twitter.svg> </a></ul></nav></div></header><main class=blog-main><article><header class=entry-header><h1 class=entry-title>📗 Terraform: Up and Running, 3rd Editionを読んだ感想</h1><div class=entry-meta><p class=entry-meta-item>🗓 2023-10-25<p class=entry-meta-item>🏷 <span class=tag><a href=https://blog.ymgyt.io/tags/book/>book</a></span></div></header><aside class=entry-toc><nav><ul class=entry-toc-toplevel-list><li><a href=https://blog.ymgyt.io/entry/terraform-up-and-running/#du-ndaben>読んだ本</a><li><a href=https://blog.ymgyt.io/entry/terraform-up-and-running/#matome>まとめ</a><li><a href=https://blog.ymgyt.io/entry/terraform-up-and-running/#chapter-1-why-terraform>Chapter 1 Why Terraform</a> <ul><li><a href=https://blog.ymgyt.io/entry/terraform-up-and-running/#what-is-devops>What is DevOps</a><li><a href=https://blog.ymgyt.io/entry/terraform-up-and-running/#what-is-infrastrucutre-as-code>What is Infrastrucutre as Code?</a><li><a href=https://blog.ymgyt.io/entry/terraform-up-and-running/#what-are-the-benefits-of-infrastructure-as-code>What Are the Benefits of Infrastructure as Code?</a><li><a href=https://blog.ymgyt.io/entry/terraform-up-and-running/#how-does-terraform-compare-to-other-iac-tools>How Does Terraform Compare to Other Iac Tools?</a></ul><li><a href=https://blog.ymgyt.io/entry/terraform-up-and-running/#chapter-2-getting-started-with-terraform>Chapter 2 Getting Started with Terraform</a><li><a href=https://blog.ymgyt.io/entry/terraform-up-and-running/#chapter-3-how-to-manage-terraform-state>Chapter 3 How to Manage Terraform State</a> <ul><li><a href=https://blog.ymgyt.io/entry/terraform-up-and-running/#state-file-isolation>State File Isolation</a></ul><li><a href=https://blog.ymgyt.io/entry/terraform-up-and-running/#chapter-4-how-to-create-reusable-infrastructure-with-terraform-modules>Chapter 4 How to Create Reusable Infrastructure with Terraform Modules</a><li><a href=https://blog.ymgyt.io/entry/terraform-up-and-running/#chapter-5-terraform-tips-and-tricks-loops-if-statements-deployment-and-gotchas>Chapter 5 Terraform Tips and Tricks: Loops, If-Statements, Deployment, and Gotchas</a> <ul><li><a href=https://blog.ymgyt.io/entry/terraform-up-and-running/#terraform-gotchas>Terraform Gotchas</a></ul><li><a href=https://blog.ymgyt.io/entry/terraform-up-and-running/#chapter-6-managing-secrets-with-terraform>Chapter 6 managing Secrets with Terraform</a> <ul><li><a href=https://blog.ymgyt.io/entry/terraform-up-and-running/#state-files-and-plan-files>State Files and Plan Files</a></ul><li><a href=https://blog.ymgyt.io/entry/terraform-up-and-running/#chapter-7-working-with-multiple-providers>Chapter 7 Working with Multiple Providers</a><li><a href=https://blog.ymgyt.io/entry/terraform-up-and-running/#chapter-8-production-grade-terraform-code>Chapter 8 Production-Grade Terraform Code</a><li><a href=https://blog.ymgyt.io/entry/terraform-up-and-running/#chapter-9-how-to-test-terraform-code>Chapter 9 How to Test Terraform Code</a> <ul><li><a href=https://blog.ymgyt.io/entry/terraform-up-and-running/#automated-tests>Automated Tests</a></ul><li><a href=https://blog.ymgyt.io/entry/terraform-up-and-running/#chapter-10-how-to-use-terraform-as-a-team>Chapter 10 How to Use Terraform as a Team</a></ul></nav></aside><div class=entry-content><h2 id=du-ndaben><a aria-label="Anchor link for: du-ndaben" class=zola-anchor href=#du-ndaben>読んだ本</a></h2><figure><div class=fig-images-row><img , alt src=images/terraform-book.jpeg></div></figure><p><a href=https://learning.oreilly.com/library/view/terraform-up-and/9781098116736/ rel=external>Terraform: Up and Running, 3rd Edition</a><p>会社の方が紹介されていて、おもしろそうだったので読んでみました。<br> 出版日は2022年9月で、第3版を読みました。<br> sample codeの<a href=https://github.com/brikis98/terraform-up-and-running-code rel=external>repository</a><h2 id=matome><a aria-label="Anchor link for: matome" class=zola-anchor href=#matome>まとめ</a></h2><p>非常におもしろく参考になりました。<br> AWS account作って実際にterraformでdeployするところから始まり、workspaceによるstate分割、環境ごとのstate分離、module化、multi region, multi account対応と進みます。secret管理についても環境変数経由からfileの暗号化、VaultやKMSとの連携まで具体例つきで解説があります。 また、planは通ったけどapplyで失敗した場合の説明や、Gihub ActionでのCI例ではOIDC対応されていたりと載っている具体例が非常に実践的です。<br> localでapplyうって終わりではなく、IaCの意義からはじまり、teamや会社への導入、CIからのdeployまで説明があります。<p>この本で謳われているIaCのメリットがこれまでで一番納得感ありました。<h2 id=chapter-1-why-terraform><a aria-label="Anchor link for: chapter-1-why-terraform" class=zola-anchor href=#chapter-1-why-terraform>Chapter 1 Why Terraform</a></h2><p>Terraformの使い方の話の前にDevOpsやInfrastructure as Codeといった概念や背景の説明がなされます。<p>最初の書き出しの<blockquote><p>Software isn’t done when the code is working on your computer. It’s not done when the tests pass. And it’s not done when someone gives you a “ship it” on a code review. Software isn’t done until you deliver it to the user.</blockquote><p>がほんとそうですよねえと思いました。Software isn't done until you deliver it to the userはsoftwareはユーザに届けられて初めて価値をもつというニュアンスだと思うのですが翻訳でどう訳されるのか気になります。<h3 id=what-is-devops><a aria-label="Anchor link for: what-is-devops" class=zola-anchor href=#what-is-devops>What is DevOps</a></h3><p>DevOpsとは。<br> devとopsにteamを分けて、opsがhardwareを管理する責務を追っていたけど、今はcloud使うので、opsもsoftware tool(kubernetes, terraform, docker, chef, ...)を使っているよね。devとopsを分けてはいるけど、より緊密な連携が必要になってきている。という話の流れと理解しました。<br> 自分が英語の本が好きな理由の一つに最初にはっきり定義書いてくれるというのがあります。<br> What is DevOpsというパラグラフなので、DevOps is ...という定義を期待したのですが、歯切れが悪いように思いました。<br> 自分の理解としては、DevOpsがどうであれ、要はreleaseが高頻度で安定していればいるほど、良いのでそこがぶれなければなんでも良いのかなと思っています。<h3 id=what-is-infrastrucutre-as-code><a aria-label="Anchor link for: what-is-infrastrucutre-as-code" class=zola-anchor href=#what-is-infrastrucutre-as-code>What is Infrastrucutre as Code?</a></h3><p>Terraform以外の色々なtoolの概要が紹介されます。<br> NixOSもIaCだと思うのでそのうちここに含まれてほしいです。<h3 id=what-are-the-benefits-of-infrastructure-as-code><a aria-label="Anchor link for: what-are-the-benefits-of-infrastructure-as-code" class=zola-anchor href=#what-are-the-benefits-of-infrastructure-as-code>What Are the Benefits of Infrastructure as Code?</a></h3><p>IaCのメリットはなんだと思いますか。再現性、version管理との親和性、CIでの自動化、... それだけではないです。<p><strong>Happiness</strong>です。<p>TerraformやCDKを書いて、ちゃんと動いたときに感じるあの気持ちはHappinessだったのです。<h3 id=how-does-terraform-compare-to-other-iac-tools><a aria-label="Anchor link for: how-does-terraform-compare-to-other-iac-tools" class=zola-anchor href=#how-does-terraform-compare-to-other-iac-tools>How Does Terraform Compare to Other Iac Tools?</a></h3><p>Terraformと他のtoolとの比較が行なわれます。<br> 自分の場合は、CDKとTerraformで迷うことが多いのですが、CDKについては直接の言及がなかったです。<br> もっとも、General-Purpose LanguageとDSLという観点での比較はなされていたので、この話は妥当しそうです。<br> ただ、DSLが良いかどうかって、チームや会社の技術スタックに左右される部分が大きいと思うので、一概にDSLのほうが良い悪いって判断できないと思ってしまうんですよね。<p>自分がInfra関連の技術選定で、各種toolの比較することになったとしてもここまでの比較はできないので、比較の観点の出し方がとても参考になりました。<p><del>terraform既に使っていてもっと知りたいという場合は思い切って1章は飛ばしてもいいかも</del><h2 id=chapter-2-getting-started-with-terraform><a aria-label="Anchor link for: chapter-2-getting-started-with-terraform" class=zola-anchor href=#chapter-2-getting-started-with-terraform>Chapter 2 Getting Started with Terraform</a></h2><p>本章からterraformの使い方についての説明が始まります。<br> AWSでEC2建てるところから解説してくれます。<br> terraformを使ったことがあればわかっていることかなと思っていたら<code>terraform graph</code>でdotlang出力できるの知りませんでした。<br> systemdもそうですが、依存関係のようなgraphを扱うtoolはdotlang出力するのが共通理解なんでしょうか。<p>またどこかでははまる、lifecycleの<code>create_before_destroy</code>の説明等もあります。<h2 id=chapter-3-how-to-manage-terraform-state><a aria-label="Anchor link for: chapter-3-how-to-manage-terraform-state" class=zola-anchor href=#chapter-3-how-to-manage-terraform-state>Chapter 3 How to Manage Terraform State</a></h2><p>terraformのstate管理について。<br> stateにどういった情報が保持されているかや複数人での共有に対処するためにremote backendが紹介されます。<p>stateをS3に置くためにs3 bucketを定義したいがそのためにはs3以外のところにstateを保持する必要がある問題についての対応も解説してくれています。<br> 自分は最初にlocal stateではじめてbucket定義したのち<code>terraform init -migrate-state</code>を実行したりしていました。<br> また、backendのconfigを<code>terraform init -backend-config=backend.hcl</code>のようにして別fileに切り出せるのは知らなかったです。<h3 id=state-file-isolation><a aria-label="Anchor link for: state-file-isolation" class=zola-anchor href=#state-file-isolation>State File Isolation</a></h3><p>Remote backendの導入でstate fileを共有できるようにはなったものの、そのままではproductionと開発環境の設定が同一のstate fileに保持されてしまっている。<br> 現実ではどうしてもproductionの設定を分離したくなり、そのための方法の一つとしてworkspaceが紹介されます。<br> state fileの分離という文脈でworkspaceを説明するのはわかりやすいと思いました。<p>もっともworkspaceによる分離は分離の程度としては弱く、より強い分離としてdirectoryを分ける方法が提案されます。<br> 概要としては以下のように環境とcomponentごとにterraform projectのdirectoryを切るというものです。<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=plain><span class=giallo-l><span>.</span></span>
<span class=giallo-l><span>├── production</span></span>
<span class=giallo-l><span>│  ├── services</span></span>
<span class=giallo-l><span>│  │  ├── dependencies.tf</span></span>
<span class=giallo-l><span>│  │  ├── main.tf</span></span>
<span class=giallo-l><span>│  │  ├── outputs.tf</span></span>
<span class=giallo-l><span>│  │  ├── providers.tf</span></span>
<span class=giallo-l><span>│  │  └── variables.tf</span></span>
<span class=giallo-l><span>│  ├── storage</span></span>
<span class=giallo-l><span>│  └── vpc</span></span>
<span class=giallo-l><span>└── staging</span></span>
<span class=giallo-l><span>   ├── services</span></span>
<span class=giallo-l><span>   ├── storage</span></span>
<span class=giallo-l><span>   └── vpc</span></span></code></pre><p>ただ、この方法ですとdirectoryをまたいだ依存を参照できないので、<code>terraform_remote_state</code>を使うことになります。<p>ここで紹介されていた<code>terraform console</code>でREPLできるの知りませんでした。<h2 id=chapter-4-how-to-create-reusable-infrastructure-with-terraform-modules><a aria-label="Anchor link for: chapter-4-how-to-create-reusable-infrastructure-with-terraform-modules" class=zola-anchor href=#chapter-4-how-to-create-reusable-infrastructure-with-terraform-modules>Chapter 4 How to Create Reusable Infrastructure with Terraform Modules</a></h2><p>前章で環境ごとにdirectoryを分けたので、微妙に違うが大体同じような設定を書かなければならなくなってしまった。<br> そこで、moduleを導入して、共通部分と環境ごとの差異を分離できるようにしていく。<br> moduleの作り方を実際にrefactorしながら解説してくれておりわかりやすいです。<p>moduleのはまりどころとして、相対pathの解決やinline blockでリソースを定義する点についての説明もあり、参考になりました。<p>また、stagingとproductionでmoduleを参照している際にstagingのためにmoduleを変更するとproductionにも影響してしまう。そこで、moduleを別のgit repositoryに定義して、tagでversioningする方法も説明してくれています。<h2 id=chapter-5-terraform-tips-and-tricks-loops-if-statements-deployment-and-gotchas><a aria-label="Anchor link for: chapter-5-terraform-tips-and-tricks-loops-if-statements-deployment-and-gotchas" class=zola-anchor href=#chapter-5-terraform-tips-and-tricks-loops-if-statements-deployment-and-gotchas>Chapter 5 Terraform Tips and Tricks: Loops, If-Statements, Deployment, and Gotchas</a></h2><p>まずcountを紹介して、その欠点を補うためにfor_eachという流れで解説してくれます。<br> for expressionの解説もあります。具体例が豊富で親切です。<p>またrescourceの作成をconditionalにしたり参照するparameterを切り替える例も解説されています。<br> 基本的に複数resourceの作成ではcountよりfor_eachが望ましいですが、作る作らないの制御ではcountでおこなうとsimpleにできると助言されていました。<h3 id=terraform-gotchas><a aria-label="Anchor link for: terraform-gotchas" class=zola-anchor href=#terraform-gotchas>Terraform Gotchas</a></h3><p>terraformのはまりどころについて。<br> <code>terraform plan</code>は成功したけど、<code>terraform apply</code>したらalready existsで失敗した場合の対処法等については誰もが一度は経験するところなのではないでしょうか。<p>terraformをrefactorする際にresourceの識別をrenameするのは影響が大きい。hcl側とstateの対応を更新したい場合は、<code>terraform state mv</code>が利用できるが、それに加えて下記のように<code>moved</code> block使うこともできる。<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=hcl><span class=giallo-l><span>moved</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span>  from</span><span style=color:#81a1c1> =</span><span> aws_security_group</span><span style=color:#81a1c1>.</span><span>instance</span></span>
<span class=giallo-l><span>  to</span><span style=color:#81a1c1>   =</span><span> aws_security_group</span><span style=color:#81a1c1>.</span><span>cluster_instance</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><h2 id=chapter-6-managing-secrets-with-terraform><a aria-label="Anchor link for: chapter-6-managing-secrets-with-terraform" class=zola-anchor href=#chapter-6-managing-secrets-with-terraform>Chapter 6 managing Secrets with Terraform</a></h2><p>secret managementにおいて重要なruleが2つあって、ひとつがplain textで保持しないこと。もう一つもとても参考になります。<br> 最初にterraformでsecretが必要になるのが、providerの認証で、その際にどんな方法があるかを解説してくれます。<br> さらに、CIからterraformを実行する例の具体例もあり、Circle CI, EC2, Github Actionのそのまま使えそうなコードも載っています。<br> Github ActionはOIDCを利用してくれており、github action側にcredentialを保持しなくてよい構成になっています。<p>Providerの次はresourceにどうやってsecretを渡すかについて。<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=hcl><span class=giallo-l><span>resource "aws_db_instance" "example"</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#616e88>  // ...</span></span>
<span class=giallo-l><span>  username</span><span style=color:#81a1c1> =</span><span style=color:#eceff4> "</span><span style=color:#a3be8c>???</span><span style=color:#eceff4>"</span></span>
<span class=giallo-l><span>  password</span><span style=color:#81a1c1> =</span><span style=color:#eceff4> "</span><span style=color:#a3be8c>???</span><span style=color:#eceff4>"</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p>最初は<code>var.db_username</code>のように変数にしたのち、環境変数経由で渡すことが考えられます。<br> ただ、環境変数経由での管理にも良い点と問題点があります。<br> その一つとして、version管理やterraform管理からはずれるのできちんと渡すのは呼び出し側の責任になり、ミスが介在しやすくなってしまう点にあると思います。<p>そこで次にkmsで暗号化した上でsecretをterraformのresourceとして扱う方法が紹介されます。<br> これでsecretをplain textで保持することを避けつつ、terraformの管理下で扱えるようになります。<p>が、当然この方法にもいくつか問題があります。<br> 例えば、auditであったり、rotationやrevokeさせづらい等です。<p>ということで、AWS Secret ManagerやHashiCorp Vaultが紹介されます。<h3 id=state-files-and-plan-files><a aria-label="Anchor link for: state-files-and-plan-files" class=zola-anchor href=#state-files-and-plan-files>State Files and Plan Files</a></h3><p>どうにかしてsecretをplain textでなくしてもterraformに渡したsecretはstate fileではplain textで保持されてしまうそうです。<a href=https://github.com/hashicorp/terraform/issues/516 rel=external>Storing sensitive vaules in state files</a><br> したがって、secret管理とは別に、state fileのaccess管理や暗号化は必須ということになります。<br> また、<code>terraform plan -out=plan</code>とした際にもplan fileにsecretが含まれてしまうので注意が必要です。<h2 id=chapter-7-working-with-multiple-providers><a aria-label="Anchor link for: chapter-7-working-with-multiple-providers" class=zola-anchor href=#chapter-7-working-with-multiple-providers>Chapter 7 Working with Multiple Providers</a></h2><p>本章では、これまでに作成したmoduleをAWSを例に、multi region, multi accountにdeployするにはどうするかについて説明してくれます。<p>まずproviderの概要の説明があるのですが、terraformとproviderはRPCでやり取りしているそうです。そうなると、Ruseでprovider書けるのかなと思っていたら、<a href=https://github.com/palfrey/terraform-provider-helloworld rel=external>helloworldをRustで実装された方</a>がおられました。<p>ひとつのmoduleの中で複数のAWS regionにresourceを定義したい場合にどのように複数providerを設定するかについての解説があります。 aliasを利用したmulti regionの設定についての注意点もありますが、AWSの場合、us-east-1にしか建てられないresourceもあったりするのでその際は使えそうです。<p>multi regionの次はmulti accountの説明があります。 rootではないreusable module(rootから使われるmodule)に、provider blockを書かずにmulti providerのmoduleを書くために<code>terraform.required_providers.configuration_aliases</code>を使えるのは知らなかったのでとても参考になりました。<p>その他、EKSにdeployする例もあります。<h2 id=chapter-8-production-grade-terraform-code><a aria-label="Anchor link for: chapter-8-production-grade-terraform-code" class=zola-anchor href=#chapter-8-production-grade-terraform-code>Chapter 8 Production-Grade Terraform Code</a></h2><p>筆者によると<strong>production grade</strong>なRDS等のManaged serviceを構築するのに1-2週間、self-managedなdistributedでstatefulなsystemに2-4ヶ月、entire architectureにいたっては規模次第で6-36ヶ月かかるとあります。しかもこれは楽観的な数字です。<p>では、ここでいうproduction gradeとはどういった性質を指すかというと以下の点について考慮されているということでした。<ul><li>Install<li>Configure<li>Provision<li>Deploy<li>High availability<li>Scalability<li>Performance<li>Networking<li>Security<li>Metrics<li>Logs<li>Data backup<li>Cost optimization<li>Documentation<li>Tests</ul><p>これはかかりますね..!<br> これらを達成するためのmoduleの粒度であったりのadviceもあります。<p>testableなmoduleを書くために、<code>validation</code>や<code>precondition</code>, <code>postcondition</code>を利用していこうと思います。<br> そのほか、terraformやmoduleのversioningであったり、terraform以外のtoolとの連携等、実践的な内容となっております。<h2 id=chapter-9-how-to-test-terraform-code><a aria-label="Anchor link for: chapter-9-how-to-test-terraform-code" class=zola-anchor href=#chapter-9-how-to-test-terraform-code>Chapter 9 How to Test Terraform Code</a></h2><p>infraの変更は、downtimeやdata loss, securityと怖いことが多い。かといって変更の頻度を減らしても逆効果になってしまう。<br> そこで、testを通じて変更に対する自信を持とうという話。<p>では、どうやってterraformをtestするかというと、まずは実際にdeployしてcurlなりで、検証するところからはじまっていた。<br> これができるようにmoduleにはexampleを作ることも推奨されている。<br> また、<blockquote><p>the gold standard is that each developer gets their own completely isolated sandbox environment. For example, if you’re using Terraform with AWS, the gold standard is for each developer to have their own AWS account that they can use to test anything they want</blockquote><p>とあり、開発者ごとにAWS accountを用意することもgold standardとされていました。<br> 個人でaccount作るとcostがちょっと心配と思いましたが、そこは<a href=https://github.com/rebuy-de/aws-nuke rel=external>aws-nuke</a>や<a href=https://github.com/gruntwork-io/cloud-nuke rel=external>cloud-nuke</a>のようなtoolを定期実行することで対処する方法も紹介されていました。<h3 id=automated-tests><a aria-label="Anchor link for: automated-tests" class=zola-anchor href=#automated-tests>Automated Tests</a></h3><p>unit test, integration test, end-to-end testごとにどのように書くかを解説してくれます。<br> unit testとありますが、実際にaws accountにdeployして検証codeを走らせるので実態としてはintegration testであるとされています。(外部に依存しなpure unit testはterraformではできない)<br> ただ、単位がterraformのmoduleなので、その点を強調してunit testとしていました。<br> terraformのmoduleの単位として、実際にdeployしてtestできるかを尺度にするのもありなんだなと思いました。 また、<a href=https://terratest.gruntwork.io/ rel=external>terratest</a>というtoolも紹介されていました。<p>codeの具体例がかなりしっかり載っています。<h2 id=chapter-10-how-to-use-terraform-as-a-team><a aria-label="Anchor link for: chapter-10-how-to-use-terraform-as-a-team" class=zola-anchor href=#chapter-10-how-to-use-terraform-as-a-team>Chapter 10 How to Use Terraform as a Team</a></h2><p>terraform(IaC)をteamや会社に導入するためのprocessについて。<br> infra管理のtool選定ってtool自体よりteamや会社の状況のほうが影響する気がしてます。<br> terraformに限らないですが、開発processを変えるような変更はincrementalにやることがよいと書かれています。<p>本書の最初で、Software isn’t done until you deliver it to the userとある通り、localでterraform applyするまででなく、実際にdeployするまでの話があります。<br> applicationのworkflowをterraformに適用するとどうなるかについてstepごとに解説してくれます。<br> 具体的には、localで変更して、PR作って、reviewしてCIでtestしてdeployという流れをterraformでやるとどうなるかについて見ていきます。<br> terraformとapplicationの差異はterraformでは<code>prod</code>,<code>staging</code>と環境ごとにdirectoryをきっているので、applicationのようにmain branchはstaging, release branch切ったら本番のようにできない(やりづらい)点です。<br> また、CIでのdeployではerror handlingを必ずいれる必要があり、場合によっては<code>terraform force-unlock</code>や<code>terraform state push</code>等でrecoveryが必要になるケースについても解説してくれています。<p>簡単にですが、感想を書いてみました。<br> ここまでお読みいただきありがとうございます。</div></article></main><footer class=blog-footer><p>© 2026 <a href=https://blog.ymgyt.io> ymgyt </a> | Made with <a href=https://www.getzola.org rel=noopener target=_blank>Zola</a> | <a href=https://github.com/ymgyt/blog>Repository</a> | <a href=https://blog.ymgyt.io/atom.xml target=_blank title=rss> <svg viewbox="0 0 24 24" class=icon fill=none height=24 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx=5 cy=19 r=1></circle></svg> </a></footer></div></div>