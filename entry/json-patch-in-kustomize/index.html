<!doctype html><html lang=ja><head><meta charset=UTF-8><meta content="width=device-width,initial-scale=1" name=viewport><link href=https://blog.ymgyt.io/favicon.ico rel=icon sizes=any><link href=https://blog.ymgyt.io/icon.svg rel=icon type=image/svg+xml><link href=https://blog.ymgyt.io/apple-touch-icon.png rel=apple-touch-icon><link href=https://blog.ymgyt.io/manifest.webmanifest rel=manifest><link href=https://blog.ymgyt.io/style.css rel=stylesheet><link href=https://blog.ymgyt.io/atom.xml rel=alternate title=Atom type=application/atom+xml><script src="https://www.googletagmanager.com/gtag/js?id=G-GTB0KMLN90" async></script><script>window.dataLayer = window.dataLayer || [];
	function gtag() {dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-GTB0KMLN90');</script><title>ğŸ”§ Kustomizeã§åˆ©ç”¨ã•ã‚Œã‚‹RFC6902 JSON Patchã‚’èª­ã‚“ã§ã¿ã‚‹ | Happy developing</title><meta content="Kustomizeã®patchã§ç”¨ã„ã‚‰ã‚Œã‚‹JSON Patchã«ã¤ã„ã¦RFCã‚’èª­ã‚“ã§ç†è§£ã™ã‚‹" name=description><meta content=summary name=twitter:card><meta content="@YAmaguchixt " name=twitter:site><meta content="ğŸ”§ Kustomizeã§åˆ©ç”¨ã•ã‚Œã‚‹RFC6902 JSON Patchã‚’èª­ã‚“ã§ã¿ã‚‹" name=twitter:title><meta content="Kustomizeã®patchã§ç”¨ã„ã‚‰ã‚Œã‚‹JSON Patchã«ã¤ã„ã¦RFCã‚’èª­ã‚“ã§ç†è§£ã™ã‚‹" name=twitter:description><meta content=https://blog.ymgyt.io/images/emoji/wrench.png name=twitter:image><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><body><div class=world><div class=content-container><header class=blog-header-container><div class=blog-logo><a href=https://blog.ymgyt.io>Happy developing</a></div><div class=blog-nav><nav><ul><li><a href=https://blog.ymgyt.io/entry/>Entries</a><li><a href=https://blog.ymgyt.io/tags/>Tags</a><li><a href=https://blog.ymgyt.io/about/>About</a><li><a href=https://github.com/ymgyt> <img alt=Github class=icon src=https://blog.ymgyt.io/images/icon/github.svg> </a><li><a href="https://twitter.com/YAmaguchixt "> <img alt=Twitter class=icon src=https://blog.ymgyt.io/images/icon/twitter.svg> </a></ul></nav></div></header><main class=blog-main><article><header class=entry-header><h1 class=entry-title>ğŸ”§ Kustomizeã§åˆ©ç”¨ã•ã‚Œã‚‹RFC6902 JSON Patchã‚’èª­ã‚“ã§ã¿ã‚‹</h1><div class=entry-meta><p class=entry-meta-item>ğŸ—“ 2023-07-14<p class=entry-meta-item>ğŸ· <span class=tag><a href=https://blog.ymgyt.io/tags/book/>book</a></span></div></header><aside class=entry-toc><nav><ul class=entry-toc-toplevel-list><li><a href=https://blog.ymgyt.io/entry/json-patch-in-kustomize/#patchesnoju-ti-li>patchesã®å…·ä½“ä¾‹</a><li><a href=https://blog.ymgyt.io/entry/json-patch-in-kustomize/#patchnoshi-yang>patchã®ä»•æ§˜</a><li><a href=https://blog.ymgyt.io/entry/json-patch-in-kustomize/#rfc6902-javascript-object-notation-json-patch>RFC6902 JavaScript Object Notation (JSON) Patch</a> <ul><li><a href=https://blog.ymgyt.io/entry/json-patch-in-kustomize/#document-structure>Document structure</a><li><a href=https://blog.ymgyt.io/entry/json-patch-in-kustomize/#operations>Operations</a></ul><li><a href=https://blog.ymgyt.io/entry/json-patch-in-kustomize/#matome>ã¾ã¨ã‚</a></ul></nav></aside><div class=entry-content><p>æœ¬è¨˜äº‹ã§ã¯ã€Kubernetesã®manifestã‚’ç®¡ç†ã™ã‚‹ãŸã‚ã®<a href=https://github.com/kubernetes-sigs/kustomize rel=external>kustomize</a>ã§åˆ©ç”¨ã§ãã‚‹<a href=https://kubectl.docs.kubernetes.io/references/kustomize/kustomization/patches/ rel=external><code>patches</code></a>ã«ã¤ã„ã¦ã€å‚ç…§ã•ã‚Œã¦ã„ã‚‹RFCã‚’èª­ã¿ãªãŒã‚‰ç†è§£ã™ã‚‹ã“ã¨ã‚’ç›®æŒ‡ã—ã¾ã™ã€‚<h2 id=patchesnoju-ti-li><a aria-label="Anchor link for: patchesnoju-ti-li" class=zola-anchor href=#patchesnoju-ti-li>patchesã®å…·ä½“ä¾‹</a></h2><p>ã¾ãšã€patchesã®å…·ä½“çš„ãªåˆ©ç”¨ã‚’ç¢ºèªã—ã¾ã™ã€‚<br> ä»¥ä¸‹ã®ã‚ˆã†ãª<code>Ingress</code>ã«patchã‚’å½“ã¦ãŸã„ã¨ã—ã¾ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=yaml><span class=giallo-l><span style=color:#8fbcbb>apiVersion</span><span style=color:#eceff4>:</span><span style=color:#a3be8c> networking.k8s.io/v1beta1</span></span>
<span class=giallo-l><span style=color:#8fbcbb>kind</span><span style=color:#eceff4>:</span><span style=color:#a3be8c> Ingress</span></span>
<span class=giallo-l><span style=color:#8fbcbb>metadata</span><span style=color:#eceff4>:</span></span>
<span class=giallo-l><span style=color:#8fbcbb>  name</span><span style=color:#eceff4>:</span><span style=color:#a3be8c> example</span></span>
<span class=giallo-l><span style=color:#8fbcbb>spec</span><span style=color:#eceff4>:</span></span>
<span class=giallo-l><span style=color:#8fbcbb>  rules</span><span style=color:#eceff4>:</span></span>
<span class=giallo-l><span style=color:#eceff4>  -</span><span style=color:#8fbcbb> host</span><span style=color:#eceff4>:</span><span style=color:#a3be8c> blog.ymgyt.io</span></span>
<span class=giallo-l><span style=color:#8fbcbb>    http</span><span style=color:#eceff4>:</span></span>
<span class=giallo-l><span style=color:#8fbcbb>      paths</span><span style=color:#eceff4>:</span></span>
<span class=giallo-l><span style=color:#eceff4>      -</span><span style=color:#8fbcbb> path</span><span style=color:#eceff4>:</span><span style=color:#a3be8c> /</span></span>
<span class=giallo-l><span style=color:#8fbcbb>        backend</span><span style=color:#eceff4>:</span></span>
<span class=giallo-l><span style=color:#8fbcbb>          serviceName</span><span style=color:#eceff4>:</span><span style=color:#a3be8c> service-1</span></span>
<span class=giallo-l><span style=color:#8fbcbb>          servicePort</span><span style=color:#eceff4>:</span><span style=color:#b48ead> 5001</span></span></code></pre><p><code>kustomization.yaml</code>ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=yaml><span class=giallo-l><span style=color:#8fbcbb>apiVersion</span><span style=color:#eceff4>:</span><span style=color:#a3be8c> kustomize.config.k8s.io/v1beta1</span></span>
<span class=giallo-l><span style=color:#8fbcbb>kind</span><span style=color:#eceff4>:</span><span style=color:#a3be8c> Kustomization</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#8fbcbb>resources</span><span style=color:#eceff4>:</span></span>
<span class=giallo-l><span style=color:#eceff4>-</span><span style=color:#a3be8c> ingress.yaml</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#8fbcbb>patches</span><span style=color:#eceff4>:</span></span>
<span class=giallo-l><span style=color:#eceff4>-</span><span style=color:#8fbcbb> path</span><span style=color:#eceff4>:</span><span style=color:#a3be8c> ingress_patch.yaml</span></span>
<span class=giallo-l><span style=color:#8fbcbb>  target</span><span style=color:#eceff4>:</span></span>
<span class=giallo-l><span style=color:#8fbcbb>    group</span><span style=color:#eceff4>:</span><span style=color:#a3be8c> networking.k8s.io</span></span>
<span class=giallo-l><span style=color:#8fbcbb>    version</span><span style=color:#eceff4>:</span><span style=color:#a3be8c> v1beta1</span></span>
<span class=giallo-l><span style=color:#8fbcbb>    kind</span><span style=color:#eceff4>:</span><span style=color:#a3be8c> Ingress</span></span>
<span class=giallo-l><span style=color:#8fbcbb>    name</span><span style=color:#eceff4>:</span><span style=color:#a3be8c> example</span></span></code></pre><p>é©ç”¨ã™ã‚‹patchã¯<code>ingress_patch.yaml</code>ã«å®šç¾©ã—ã¾ã™ã€‚<br> æ„å›³ã¨ã—ã¦ã¯ã€<code>/ui</code>ç”¨ã®ruleã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã§ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=yaml><span class=giallo-l><span style=color:#eceff4>-</span><span style=color:#8fbcbb> op</span><span style=color:#eceff4>:</span><span style=color:#a3be8c> add</span></span>
<span class=giallo-l><span style=color:#8fbcbb>  path</span><span style=color:#eceff4>:</span><span style=color:#a3be8c> /spec/rules/0/http/paths/-</span></span>
<span class=giallo-l><span style=color:#8fbcbb>  value</span><span style=color:#eceff4>:</span></span>
<span class=giallo-l><span style=color:#8fbcbb>    path</span><span style=color:#eceff4>: '</span><span style=color:#a3be8c>/ui</span><span style=color:#eceff4>'</span></span>
<span class=giallo-l><span style=color:#8fbcbb>    backend</span><span style=color:#eceff4>:</span></span>
<span class=giallo-l><span style=color:#8fbcbb>      serviceName</span><span style=color:#eceff4>:</span><span style=color:#a3be8c> ui</span></span>
<span class=giallo-l><span style=color:#8fbcbb>      servicePort</span><span style=color:#eceff4>:</span><span style=color:#b48ead> 5002</span></span></code></pre><p>å…¨ä½“ã¨ã—ã¦ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªæ§‹æˆã§ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=shellscript><span class=giallo-l><span style=color:#81a1c1>></span><span> exa -T </span><span style=color:#88c0d0>.</span></span>
<span class=giallo-l><span style=color:#88c0d0>.</span></span>
<span class=giallo-l><span style=color:#88c0d0>â”œâ”€â”€</span><span style=color:#a3be8c> ingress.yaml</span></span>
<span class=giallo-l><span style=color:#88c0d0>â”œâ”€â”€</span><span style=color:#a3be8c> ingress_patch.yaml</span></span>
<span class=giallo-l><span style=color:#88c0d0>â””â”€â”€</span><span style=color:#a3be8c> kustomization.yaml</span></span></code></pre><p>ã“ã“ã§ã€<code>kustomize build .</code>ã—ã¦ã¿ã‚‹ã¨<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=yaml><span class=giallo-l><span style=color:#8fbcbb>apiVersion</span><span style=color:#eceff4>:</span><span style=color:#a3be8c> networking.k8s.io/v1beta1</span></span>
<span class=giallo-l><span style=color:#8fbcbb>kind</span><span style=color:#eceff4>:</span><span style=color:#a3be8c> Ingress</span></span>
<span class=giallo-l><span style=color:#8fbcbb>metadata</span><span style=color:#eceff4>:</span></span>
<span class=giallo-l><span style=color:#8fbcbb>  name</span><span style=color:#eceff4>:</span><span style=color:#a3be8c> example</span></span>
<span class=giallo-l><span style=color:#8fbcbb>spec</span><span style=color:#eceff4>:</span></span>
<span class=giallo-l><span style=color:#8fbcbb>  rules</span><span style=color:#eceff4>:</span></span>
<span class=giallo-l><span style=color:#eceff4>  -</span><span style=color:#8fbcbb> host</span><span style=color:#eceff4>:</span><span style=color:#a3be8c> blog.ymgyt.io</span></span>
<span class=giallo-l><span style=color:#8fbcbb>    http</span><span style=color:#eceff4>:</span></span>
<span class=giallo-l><span style=color:#8fbcbb>      paths</span><span style=color:#eceff4>:</span></span>
<span class=giallo-l><span style=color:#eceff4>      -</span><span style=color:#8fbcbb> backend</span><span style=color:#eceff4>:</span></span>
<span class=giallo-l><span style=color:#8fbcbb>          serviceName</span><span style=color:#eceff4>:</span><span style=color:#a3be8c> service-1</span></span>
<span class=giallo-l><span style=color:#8fbcbb>          servicePort</span><span style=color:#eceff4>:</span><span style=color:#b48ead> 5001</span></span>
<span class=giallo-l><span style=color:#8fbcbb>        path</span><span style=color:#eceff4>:</span><span style=color:#a3be8c> /</span></span>
<span class=giallo-l><span style=color:#eceff4>      -</span><span style=color:#8fbcbb> backend</span><span style=color:#eceff4>:</span></span>
<span class=giallo-l><span style=color:#8fbcbb>          serviceName</span><span style=color:#eceff4>:</span><span style=color:#a3be8c> ui</span></span>
<span class=giallo-l><span style=color:#8fbcbb>          servicePort</span><span style=color:#eceff4>:</span><span style=color:#b48ead> 5002</span></span>
<span class=giallo-l><span style=color:#8fbcbb>        path</span><span style=color:#eceff4>:</span><span style=color:#a3be8c> /ui</span></span></code></pre><p><code>Ingress</code>ã«patchã«å®šç¾©ã—ãŸ<code>/ui</code>ã®ruleãŒè¿½åŠ ã§ãã¦ã„ã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã—ãŸã€‚<h2 id=patchnoshi-yang><a aria-label="Anchor link for: patchnoshi-yang" class=zola-anchor href=#patchnoshi-yang>patchã®ä»•æ§˜</a></h2><p>ä¸Šè¨˜ã§ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªpatchã‚’é©ç”¨ã—ã¾ã—ãŸã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=yaml><span class=giallo-l><span style=color:#eceff4>-</span><span style=color:#8fbcbb> op</span><span style=color:#eceff4>:</span><span style=color:#a3be8c> add</span></span>
<span class=giallo-l><span style=color:#8fbcbb>  path</span><span style=color:#eceff4>:</span><span style=color:#a3be8c> /spec/rules/0/http/paths/-</span></span>
<span class=giallo-l><span style=color:#8fbcbb>  value</span><span style=color:#eceff4>:</span><span style=color:#616e88> # ...</span></span></code></pre><p>ã“ã“ã‹ã‚‰ã€patchã«ã¯<code>op</code>,<code>path</code>,<code>value</code>ã‚’æŒ‡å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šãã†ãªã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚<br> ãŸã ã—ã€<code>op</code>ã«ä»–ã«ã©ã‚“ãªå€¤ãŒã‚ã‚‹ã®ã‹ã§ã‚ã£ãŸã‚Šã€<code>/spec/rules/0/http/paths/-</code>ã®<code>-</code>ã®æ„å‘³ã§ã‚ã£ãŸã‚Šã¯ã€kustomizeã®å…¬å¼docã«ã¯å®šç¾©ã•ã‚Œã¦ã„ã¾ã›ã‚“ã§ã—ãŸã€‚<p><a href=https://kubectl.docs.kubernetes.io/references/kustomize/kustomization/patches/ rel=external>Reference</a>ã«ã‚ˆã‚Šã¾ã™ã¨<blockquote><p>The patches field contains a list of patches to be applied in the order they are specified.<br> Each patch may:<br> * be either a strategic merge patch, or a JSON6902 patch<br> * be either a file, or an inline string<br> * target a single resource or multiple resources</blockquote><p>ã¨ã‚ã‚Šã€patchã¯JSON6902ã§æŒ‡å®šã™ã‚‹ã“ã¨ãŒã§ãã‚‹<br> JSON6902ã¨ã¯ã€<a href=https://kubectl.docs.kubernetes.io/references/kustomize/glossary/#patchjson6902 rel=external>patchJson6902</a>ã‚’æŒ‡ã—ã¦ãŠã‚Šã€ã“ã‚Œã¯<a href=https://datatracker.ietf.org/doc/html/rfc6902 rel=external>RFC6902</a>ã‚’å‚ç…§ã—ã¦ã„ã‚‹ã¨ã‚ã‚Šã¾ã—ãŸã€‚<p>ã¨ã„ã†ã“ã¨ã§ã€patchã‚’ã©ã†æ›¸ã‘ã°ã„ã„ã‹ã¯RFC6902(JSON Patch)ã‚’èª­ã‚“ã§ã¿ã‚Œã°ã‚ˆã•ãã†ã¨ã„ã†ã“ã¨ãŒã‚ã‹ã‚Šã¾ã—ãŸã€‚<h2 id=rfc6902-javascript-object-notation-json-patch><a aria-label="Anchor link for: rfc6902-javascript-object-notation-json-patch" class=zola-anchor href=#rfc6902-javascript-object-notation-json-patch>RFC6902 JavaScript Object Notation (JSON) Patch</a></h2><p>ã¾ãšã€<a href=https://datatracker.ietf.org/doc/html/rfc6902#section-1 rel=external>Introduction</a>ã«ã¦<blockquote><p>JSON Patch is a format (identified by the media type "application/ json-patch+json") for expressing a sequence of operations to apply to a target JSON document</blockquote><p>JSON Patchã¯JSONã«é©ç”¨ã™ã‚‹ä¸€é€£ã®operationã‚’è¡¨ç¾ã™ã‚‹ãŸã‚ã®formatã§ã‚ã‚‹ã¨ã•ã‚Œã¦ã„ã¾ã™ã€‚<p>ã¾ãŸã€<blockquote><p>This format is also potentially useful in other cases in which it is necessary to make partial updates to a JSON document or to a data structure that has similar constraints</blockquote><p>ã¨ã‚ã‚Šã€JSONã®ä¸€éƒ¨ã‚’æ›´æ–°ã—ãŸã„ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã§ä¾¿åˆ©ã¨èª¬æ˜ã•ã‚Œã¦ã„ã¾ã™ã€‚kustomizeã§ã®åˆ©ç”¨ã¯ã¾ã•ã«ã“ã®caseã®ã“ã¨ã§ã—ã‚‡ã†ã‹ã€‚<h3 id=document-structure><a aria-label="Anchor link for: document-structure" class=zola-anchor href=#document-structure>Document structure</a></h3><p><a href=https://datatracker.ietf.org/doc/html/rfc6902#section-3 rel=external>Document structure</a>ã§ã¯ã€å…·ä½“ä¾‹ã¨ã—ã¦ä¸‹è¨˜ã®jsonãŒæŒ™ã’ã‚‰ã‚Œã¦ã„ã¾ã—ãŸã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=json><span class=giallo-l><span style=color:#eceff4>[</span></span>
<span class=giallo-l><span style=color:#eceff4>   { "</span><span style=color:#8fbcbb>op</span><span style=color:#eceff4>": "</span><span style=color:#a3be8c>test</span><span style=color:#eceff4>", "</span><span style=color:#8fbcbb>path</span><span style=color:#eceff4>": "</span><span style=color:#a3be8c>/a/b/c</span><span style=color:#eceff4>", "</span><span style=color:#8fbcbb>value</span><span style=color:#eceff4>": "</span><span style=color:#a3be8c>foo</span><span style=color:#eceff4>" },</span></span>
<span class=giallo-l><span style=color:#eceff4>   { "</span><span style=color:#8fbcbb>op</span><span style=color:#eceff4>": "</span><span style=color:#a3be8c>remove</span><span style=color:#eceff4>", "</span><span style=color:#8fbcbb>path</span><span style=color:#eceff4>": "</span><span style=color:#a3be8c>/a/b/c</span><span style=color:#eceff4>" },</span></span>
<span class=giallo-l><span style=color:#eceff4>   { "</span><span style=color:#8fbcbb>op</span><span style=color:#eceff4>": "</span><span style=color:#a3be8c>add</span><span style=color:#eceff4>", "</span><span style=color:#8fbcbb>path</span><span style=color:#eceff4>": "</span><span style=color:#a3be8c>/a/b/c</span><span style=color:#eceff4>", "</span><span style=color:#8fbcbb>value</span><span style=color:#eceff4>": [ "</span><span style=color:#a3be8c>foo</span><span style=color:#eceff4>", "</span><span style=color:#a3be8c>bar</span><span style=color:#eceff4>" ] },</span></span>
<span class=giallo-l><span style=color:#eceff4>   { "</span><span style=color:#8fbcbb>op</span><span style=color:#eceff4>": "</span><span style=color:#a3be8c>replace</span><span style=color:#eceff4>", "</span><span style=color:#8fbcbb>path</span><span style=color:#eceff4>": "</span><span style=color:#a3be8c>/a/b/c</span><span style=color:#eceff4>", "</span><span style=color:#8fbcbb>value</span><span style=color:#eceff4>":</span><span style=color:#b48ead> 42</span><span style=color:#eceff4> },</span></span>
<span class=giallo-l><span style=color:#eceff4>   { "</span><span style=color:#8fbcbb>op</span><span style=color:#eceff4>": "</span><span style=color:#a3be8c>move</span><span style=color:#eceff4>", "</span><span style=color:#8fbcbb>from</span><span style=color:#eceff4>": "</span><span style=color:#a3be8c>/a/b/c</span><span style=color:#eceff4>", "</span><span style=color:#8fbcbb>path</span><span style=color:#eceff4>": "</span><span style=color:#a3be8c>/a/b/d</span><span style=color:#eceff4>" },</span></span>
<span class=giallo-l><span style=color:#eceff4>   { "</span><span style=color:#8fbcbb>op</span><span style=color:#eceff4>": "</span><span style=color:#a3be8c>copy</span><span style=color:#eceff4>", "</span><span style=color:#8fbcbb>from</span><span style=color:#eceff4>": "</span><span style=color:#a3be8c>/a/b/d</span><span style=color:#eceff4>", "</span><span style=color:#8fbcbb>path</span><span style=color:#eceff4>": "</span><span style=color:#a3be8c>/a/b/e</span><span style=color:#eceff4>" }</span></span>
<span class=giallo-l><span style=color:#eceff4>]</span></span></code></pre><p>ãã—ã¦ã€å„operationã®é©ç”¨ã«ã¤ã„ã¦ã¯<ol><li>operationã¯å®šç¾©ã•ã‚ŒãŸé †åºã«å¾“ã£ã¦ã€é©ç”¨ã•ã‚Œã‚‹<li>operationãŒé©ç”¨ã•ã‚ŒãŸçµæœã«å¯¾ã—ã¦ã€æ¬¡ã®operationãŒé©ç”¨ã•ã‚Œã‚‹<li>operationã®é©ç”¨ã¯å…¨ã¦æˆåŠŸã™ã‚‹ã‹ã€errorãŒç™ºç”Ÿã™ã‚‹ã¾ã§ç¶šã</ol><p>ã¨ã•ã‚Œã¦ã„ã¾ã—ãŸã€‚<br> è©¦ã—ã«ã€æ„å‘³ãŒãªã„ã§ã™ãŒã€addã—ãŸçµæœã‚’ç›´å¾Œã«removeã—ã¦ã¿ãŸã¨ã“ã‚æ„å›³é€šã‚Šã«ãªã‚Šã¾ã—ãŸã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=yaml><span class=giallo-l><span style=color:#eceff4>-</span><span style=color:#8fbcbb> op</span><span style=color:#eceff4>:</span><span style=color:#a3be8c> add</span></span>
<span class=giallo-l><span style=color:#8fbcbb>  path</span><span style=color:#eceff4>:</span><span style=color:#a3be8c> /spec/rules/0/http/paths/-</span></span>
<span class=giallo-l><span style=color:#8fbcbb>  value</span><span style=color:#eceff4>:</span></span>
<span class=giallo-l><span style=color:#8fbcbb>    path</span><span style=color:#eceff4>: '</span><span style=color:#a3be8c>/ui</span><span style=color:#eceff4>'</span></span>
<span class=giallo-l><span style=color:#8fbcbb>    backend</span><span style=color:#eceff4>:</span></span>
<span class=giallo-l><span style=color:#8fbcbb>      serviceName</span><span style=color:#eceff4>:</span><span style=color:#a3be8c> ui</span></span>
<span class=giallo-l><span style=color:#8fbcbb>      servicePort</span><span style=color:#eceff4>:</span><span style=color:#b48ead> 5002</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#eceff4>-</span><span style=color:#8fbcbb> op</span><span style=color:#eceff4>:</span><span style=color:#a3be8c> remove</span></span>
<span class=giallo-l><span style=color:#8fbcbb>  path</span><span style=color:#eceff4>:</span><span style=color:#a3be8c> /spec/rules/0/http/paths/1</span></span></code></pre><h3 id=operations><a aria-label="Anchor link for: operations" class=zola-anchor href=#operations>Operations</a></h3><p><a href=https://datatracker.ietf.org/doc/html/rfc6902#section-4 rel=external>Operations</a>ã«ã€å…·ä½“çš„ãªoperationã®fieldã«ã¤ã„ã¦å®šã‚ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚<blockquote><p>Operation objects MUST have exactly one "op" member, whose value indicates the operation to perform.<br> Its value MUST be one of "add", "remove", "replace", "move", "copy", or "test"; other values are errors.</blockquote><ul><li>operationã«ã¯<code>op</code> fieldãŒå¿…é ˆ<li><code>op</code>ã®å€¤ã¯<code>"add"</code>,<code>"remove"</code>,<code>"replace"</code>,<code>"move"</code>,<code>"copy"</code>,<code>"test"</code>ã®ã„ãšã‚Œã‹ã§ãã‚Œä»¥å¤–ã¯error</ul><blockquote><p>Additionally, operation objects MUST have exactly one "path" member. That member's value is a string containing a JSON-Pointer value [RFC6901] that references a location within the target document (the "target location") where the operation is performed.</blockquote><ul><li>operationã«ã¯<code>path</code> fieldãŒå¿…é ˆ<li><code>path</code> fieldã§target documentã®å¤‰æ›´é©ç”¨ç®‡æ‰€ã‚’æŒ‡å®šã™ã‚‹</ul><blockquote><p>The meanings of other operation object members are defined by operation (see the subsections below).<br> Members that are not explicitly defined for the operation in question MUST be ignored (i.e., the operation will complete as if the undefined member did not appear in the object).</blockquote><ul><li><code>op</code>ã¨<code>path</code>ä»¥å¤–ã®fieldã«ã¤ã„ã¦ã¯<code>op</code>ã®å€¤ã«ã‚ˆã‚‹<li>å®šç¾©ã•ã‚Œã¦ã„ãªã„fieldã¯ç„¡è¦–ã•ã‚Œã‚‹</ul><p>ã¨ã„ã†ã“ã¨ã§ã€æ¬¡ã«å„ç¨®<code>op</code>ã«æŒ‡å®šã§ãã‚‹å€¤ã‚’ã¿ã¦ã„ãã¾ã™ã€‚<h4 id=add><a aria-label="Anchor link for: add" class=zola-anchor href=#add>add</a></h4><p>ä¾‹:<p><code>{ "op": "add", "path": "/a/b/c", "value": [ "foo", "bar" ] }</code><p>add operationã¯pathã®æŒ‡å®šã«å¿œã˜ã¦ä»¥ä¸‹ã®3ã¤ã®åŠ¹æœã‚’åŠã¼ã—ã¾ã™ã€‚<blockquote><ul><li>If the target location specifies an array index, a new value is inserted into the array at the specified index.<li>If the target location specifies an object member that does not already exist, a new member is added to the object.<li>If the target location specifies an object member that does exist, that member's value is replaced.</ul></blockquote><ul><li>pathãŒarray indexãªã‚‰æŒ‡å®šã•ã‚ŒãŸindexã«valueã‚’insertã™ã‚‹<li>pathãŒobject memberã®å ´åˆã€å­˜åœ¨ã—ãªã„ãªã‚‰æ–°è¦ä½œæˆã€å­˜åœ¨ã™ã‚‹ãªã‚‰replace</ul><p>addã§ã™ãŒã€æ—¢å­˜ã‚’replaceã™ã‚‹ã‚“ã§ã™ã­ã€‚<br> ã¾ãŸã€è¿½åŠ ã™ã‚‹å€¤ã‚’æŒ‡å®šã™ã‚‹<code>value</code>ãŒå¿…é ˆã§ã™ã€‚ ãã—ã¦ã€<blockquote><p>The specified index MUST NOT be greater than the number of elements in the array.</blockquote><p>ã¨ã‚ã‚‹ã“ã¨ã‹ã‚‰ã€indexãŒæ—¢å­˜ã®arrayã®é•·ã•ã‚’è¶…ãˆã¦ã„ã‚‹ã¨errorã«ãªã‚Šã¾ã™ã€‚<p>ãªãŠã€<code>path: /foo/-</code>ã®ã‚ˆã†ãª<code>-</code>ã§ã™ãŒ<blockquote><p>If the "-" character is used to index the end of the array (see [RFC6901]), this has the effect of appending the value to the array.</blockquote><p>ã¨ã•ã‚Œã¦ãŠã‚Šã€arrayã®æœ€å¾Œã®è¦ç´ ã‚’æŒ‡ã›ã‚‹ã‚ˆã†ã§ã™ã€‚ä¾¿åˆ©ã§ã™ã­ã€‚ å‚ç…§ã•ã‚Œã¦ã„ã‚‹RFC6901ã®JSON Pointerå´ã§ã¯<blockquote><p>exactly the single character "-", making the new referenced value the (nonexistent) member after the last array element.</blockquote><p>ã¨èª¬æ˜ã•ã‚Œã¦ã„ã¾ã—ãŸã€‚<h4 id=remove><a aria-label="Anchor link for: remove" class=zola-anchor href=#remove>remove</a></h4><p>ä¾‹:<p><code>{ "op": "remove", "path": "/a/b/c" }</code><blockquote><p>The "remove" operation removes the value at the target location.<br> The target location MUST exist for the operation to be successful.</blockquote><p>removeã¯æŒ‡å®šã®è¦ç´ ã‚’removeã™ã‚‹ã®ã§ãã®ã¾ã¾ã§ã™ã­ã€‚<blockquote><p>If removing an element from an array, any elements above the specified index are shifted one position to the left.</blockquote><p>Arrayã®elementã‚’removeã—ãŸå ´åˆã¯ã€æ®‹ã‚Šã®è¦ç´ ãŒshiftã•ã‚Œã¾ã™ã€‚<h4 id=replace><a aria-label="Anchor link for: replace" class=zola-anchor href=#replace>replace</a></h4><p>ä¾‹:<p><code>{ "op": "replace", "path": "/a/b/c", "value": 42 }</code><blockquote><p>The "replace" operation replaces the value at the target location with a new value.<br> The operation object MUST contain a "value" member whose content specifies the replacement value.<br> The target location MUST exist for the operation to be successful.</blockquote><p>replaceã‚‚addåŒæ§˜æŒ‡å®šã®å€¤ã«ç½®ãæ›ãˆã¾ã™ã€‚<br> addã¨ã®é•ã„ã¯pathã§æŒ‡å®šã—ãŸè¦ç´ ãŒå­˜åœ¨ã—ãªã„å ´åˆã«errorã¨ãªã‚‹ç‚¹ã«ã‚ã‚Šã¾ã™ã€‚<br> replaceã¯remove + addã¨æ©Ÿèƒ½çš„ã«åŒã˜ã§ã™ã€‚<h4 id=move><a aria-label="Anchor link for: move" class=zola-anchor href=#move>move</a></h4><p>ä¾‹:<p><code>{ "op": "move", "from": "/a/b/c", "path": "/a/b/d" }</code><p>moveã¯fromã«å¯¾ã—ã¦removeã‚’è¡Œã£ãŸã®ã¡ã€removeã•ã‚ŒãŸå€¤ã‚’addã™ã‚‹å‹•ä½œã«ãªã‚Šã¾ã™ã€‚<br> è‡ªåˆ†ã¯kustomizeã§ã¯ä½¿ã£ãŸã“ã¨ãŒã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚<h4 id=copy><a aria-label="Anchor link for: copy" class=zola-anchor href=#copy>copy</a></h4><p>ä¾‹:<p><code>{ "op": "copy", "from": "/a/b/c", "path": "/a/b/e" }</code><p>copyã¯fromã§æŒ‡å®šã•ã‚ŒãŸå€¤ã‚’pathã«addã™ã‚‹å‹•ä½œã«ãªã‚Šã¾ã™ã€‚<br> ã“ã‚Œã‚‚kustomizeã§ã¯ä½¿ã£ãŸã“ã¨ãŒã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸãŒã€ä½¿ã„æ‰€ãŒã‚ã‚Šãã†ãªæ°—ã‚‚ã™ã‚‹ã€‚<h4 id=test><a aria-label="Anchor link for: test" class=zola-anchor href=#test>test</a></h4><p>ä¾‹:<p><code>{ "op": "test", "path": "/a/b/c", "value": "foo" }</code><blockquote><p>The "test" operation tests that a value at the target location is equal to a specified value.</blockquote><p>testã¯jsonã®å€¤ã‚’å¤‰æ›´ã™ã‚‹ä»–ã®operationã¨æ€§æ ¼ãŒé•ã†ã‚ˆã†ã«æ€ã‚ã‚Œã¾ã—ãŸã€‚<br> è©¦ã—ã«ã•ãã»ã©ã®patchã§ä½¿ã£ã¦ã¿ã¾ã™ã¨<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=yaml><span class=giallo-l><span style=color:#eceff4>-</span><span style=color:#8fbcbb> op</span><span style=color:#eceff4>:</span><span style=color:#a3be8c> add</span></span>
<span class=giallo-l><span style=color:#8fbcbb>  path</span><span style=color:#eceff4>:</span><span style=color:#a3be8c> /spec/rules/0/http/paths/-</span></span>
<span class=giallo-l><span style=color:#8fbcbb>  value</span><span style=color:#eceff4>:</span></span>
<span class=giallo-l><span style=color:#8fbcbb>    path</span><span style=color:#eceff4>: '</span><span style=color:#a3be8c>/ui</span><span style=color:#eceff4>'</span></span>
<span class=giallo-l><span style=color:#8fbcbb>    backend</span><span style=color:#eceff4>:</span></span>
<span class=giallo-l><span style=color:#8fbcbb>      serviceName</span><span style=color:#eceff4>:</span><span style=color:#a3be8c> ui</span></span>
<span class=giallo-l><span style=color:#8fbcbb>      servicePort</span><span style=color:#eceff4>:</span><span style=color:#b48ead> 5002</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#eceff4>-</span><span style=color:#8fbcbb> op</span><span style=color:#eceff4>:</span><span style=color:#a3be8c> test</span></span>
<span class=giallo-l><span style=color:#8fbcbb>  path</span><span style=color:#eceff4>:</span><span style=color:#a3be8c> /spec/rules/0/http/paths/1</span></span>
<span class=giallo-l><span style=color:#8fbcbb>  value</span><span style=color:#eceff4>:</span></span>
<span class=giallo-l><span style=color:#8fbcbb>    path</span><span style=color:#eceff4>: '</span><span style=color:#a3be8c>/foo</span><span style=color:#eceff4>'</span><span style=color:#616e88>   #  ğŸ‘ˆ</span></span>
<span class=giallo-l><span style=color:#8fbcbb>    backend</span><span style=color:#eceff4>:</span></span>
<span class=giallo-l><span style=color:#8fbcbb>      serviceName</span><span style=color:#eceff4>:</span><span style=color:#a3be8c> ui</span></span>
<span class=giallo-l><span style=color:#8fbcbb>      servicePort</span><span style=color:#eceff4>:</span><span style=color:#b48ead> 5002</span></span></code></pre><p>ã¨ã—ã¦ã¿ã‚‹ã¨<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=plain><span class=giallo-l><span>> kustomize build .</span></span>
<span class=giallo-l><span>`Error: testing value /spec/rules/0/http/paths/1 failed: test failed`</span></span></code></pre><p>ã¨ãªã‚Šã€kustomizeã§ã‚‚ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹ã‚ˆã†ã§ã—ãŸã€‚<h2 id=matome><a aria-label="Anchor link for: matome" class=zola-anchor href=#matome>ã¾ã¨ã‚</a></h2><ul><li>kustomization.yamlã®<code>patches</code>ã«æ›¸ã‘ã‚‹patchã®ä»•æ§˜ã¯<a href=https://datatracker.ietf.org/doc/html/rfc6902#section-4.6 rel=external>RFC6902 JSON Patch</a>ã«å®šç¾©ã•ã‚Œã¦ã„ã‚‹<li>operationã§ã¯<code>op</code>ã¨<code>path</code>ã®fieldãŒå¿…é ˆã¨ãªã‚Šã€ãã®ä»–ã®fieldã¯<code>op</code>ã®å€¤ã«ä¾ã‚‹<li><code>op</code>ã«ã¯<code>add</code>, <code>remove</code>, <code>replace</code>, <code>move</code>, <code>copy</code>, <code>test</code>ãŒåˆ©ç”¨ã§ãã‚‹</ul><p>ç°¡å˜ã«ã§ã¯ã‚ã‚Šã¾ã™ãŒã€kustomizeã®patchã®ä»•æ§˜ã‚’ç¢ºèªã§ãã¾ã—ãŸã€‚</div></article></main><footer class=blog-footer><p>Â© 2026 <a href=https://blog.ymgyt.io> ymgyt </a> | Made with <a href=https://www.getzola.org rel=noopener target=_blank>Zola</a> | <a href=https://github.com/ymgyt/blog>Repository</a> | <a href=https://blog.ymgyt.io/atom.xml target=_blank title=rss> <svg viewbox="0 0 24 24" class=icon fill=none height=24 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx=5 cy=19 r=1></circle></svg> </a></footer></div></div>