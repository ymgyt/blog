<!doctype html><html lang=ja><head><meta charset=UTF-8><meta content="width=device-width,initial-scale=1" name=viewport><link href=https://blog.ymgyt.io/favicon.ico rel=icon sizes=any><link href=https://blog.ymgyt.io/icon.svg rel=icon type=image/svg+xml><link href=https://blog.ymgyt.io/apple-touch-icon.png rel=apple-touch-icon><link href=https://blog.ymgyt.io/manifest.webmanifest rel=manifest><link href=https://blog.ymgyt.io/style.css rel=stylesheet><link href=https://blog.ymgyt.io/atom.xml rel=alternate title=Atom type=application/atom+xml><script src="https://www.googletagmanager.com/gtag/js?id=G-GTB0KMLN90" async></script><script>window.dataLayer = window.dataLayer || [];
	function gtag() {dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-GTB0KMLN90');</script><title>ğŸ“™ The Purely Functional Software Deployment Modelã‚’èª­ã‚“ã æ„Ÿæƒ³ | Happy developing</title><meta content="Dolstraå…ˆç”Ÿã®Nixã®è«–æ–‡ The Purely Functional Software Deployment Modelã‚’èª­ã‚“ã æ„Ÿæƒ³" name=description><meta content=summary name=twitter:card><meta content="@YAmaguchixt " name=twitter:site><meta content="ğŸ“™ The Purely Functional Software Deployment Modelã‚’èª­ã‚“ã æ„Ÿæƒ³" name=twitter:title><meta content="Dolstraå…ˆç”Ÿã®Nixã®è«–æ–‡ The Purely Functional Software Deployment Modelã‚’èª­ã‚“ã æ„Ÿæƒ³" name=twitter:description><meta content=https://blog.ymgyt.io/images/emoji/orange_book.png name=twitter:image><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><body><div class=world><div class=content-container><header class=blog-header-container><div class=blog-logo><a href=https://blog.ymgyt.io>Happy developing</a></div><div class=blog-nav><nav><ul><li><a href=https://blog.ymgyt.io/entry/>Entries</a><li><a href=https://blog.ymgyt.io/tags/>Tags</a><li><a href=https://blog.ymgyt.io/about/>About</a><li><a href=https://github.com/ymgyt> <img alt=Github class=icon src=https://blog.ymgyt.io/images/icon/github.svg> </a><li><a href="https://twitter.com/YAmaguchixt "> <img alt=Twitter class=icon src=https://blog.ymgyt.io/images/icon/twitter.svg> </a></ul></nav></div></header><main class=blog-main><article><header class=entry-header><h1 class=entry-title>ğŸ“™ The Purely Functional Software Deployment Modelã‚’èª­ã‚“ã æ„Ÿæƒ³</h1><div class=entry-meta><p class=entry-meta-item>ğŸ—“ 2023-11-06<p class=entry-meta-item>ğŸ· <span class=tag><a href=https://blog.ymgyt.io/tags/book/>book</a></span> <span class=tag><a href=https://blog.ymgyt.io/tags/nix/>nix</a></span></div></header><aside class=entry-toc><nav><ul class=entry-toc-toplevel-list><li><a href=https://blog.ymgyt.io/entry/the-purely-functional-software-deployment/#matome>ã¾ã¨ã‚</a><li><a href=https://blog.ymgyt.io/entry/the-purely-functional-software-deployment/#1-introduction>1 Introduction</a><li><a href=https://blog.ymgyt.io/entry/the-purely-functional-software-deployment/#2-an-overview-of-nix>2 An Overview of Nix</a> <ul><li><a href=https://blog.ymgyt.io/entry/the-purely-functional-software-deployment/#transparent-source-binary-deployment>Transparent source/binary deployment</a></ul><li><a href=https://blog.ymgyt.io/entry/the-purely-functional-software-deployment/#3-deployment-as-memory-management>3 Deployment as Memory Management</a><li><a href=https://blog.ymgyt.io/entry/the-purely-functional-software-deployment/#4-the-nix-expression-language>4 The Nix Expression Language</a><li><a href=https://blog.ymgyt.io/entry/the-purely-functional-software-deployment/#5-the-extensional-model>5 The Extensional Model</a><li><a href=https://blog.ymgyt.io/entry/the-purely-functional-software-deployment/#6-the-intensional-model>6 The Intensional Model</a><li><a href=https://blog.ymgyt.io/entry/the-purely-functional-software-deployment/#7-software-deployment>7 Software Deployment</a><li><a href=https://blog.ymgyt.io/entry/the-purely-functional-software-deployment/#8-continuous-integration-and-release-management>8 Continuous Integration and Release Management</a><li><a href=https://blog.ymgyt.io/entry/the-purely-functional-software-deployment/#9-service-deployment>9 Service Deployment</a><li><a href=https://blog.ymgyt.io/entry/the-purely-functional-software-deployment/#10-build-managment>10 Build Managment</a><li><a href=https://blog.ymgyt.io/entry/the-purely-functional-software-deployment/#11-conclusion>11 Conclusion</a></ul></nav></aside><div class=entry-content><p>æœ¬è¨˜äº‹ã§ã¯<a href=https://github.com/edolstra/edolstra.github.io/blob/49a78323f6b319da6e078b4f5f6b3112a30e8db9/pubs/phd-thesis.pdf rel=external>The Purely Functional Software Deployment Model</a>ã‚’èª­ã‚“ã æ„Ÿæƒ³ã‚’æ›¸ãã¾ã™ã€‚<br> Nixã«ã¤ã„ã¦èª¿ã¹ã¦ã„ã‚‹ã¨åº¦ã€…è¨€åŠã•ã‚Œã¦ãŠã‚Šã€Nixã‚’ã‚„ã£ã¦ã„ã‚‹äººã¯çš†ã•ã‚“èª­ã¾ã‚Œã¦ã„ã‚‹æ°—é…ã‚’æ„Ÿã˜ãŸã®ã§èª­ã‚“ã§ã¿ã‚‹ã“ã¨ã«ã—ã¾ã—ãŸã€‚<h2 id=matome><a aria-label="Anchor link for: matome" class=zola-anchor href=#matome>ã¾ã¨ã‚</a></h2><p>é›£ã—ã¦ãèª­ã‚ãªã‹ã£ãŸã¨ã“ã‚ã‚‚å¤šã€…ã‚ã£ãŸãŒã€é€šã—ã¦èª­ã‚“ã§ã¿ã¦ã‚ˆã‹ã£ãŸã€‚<br> Nixã¯deployment systemã§ã‚ã‚Šã€æ—¢å­˜ã®deploymentã«ã¯ã©ã‚“ãªå•é¡ŒãŒã‚ã‚Šã€nixã¯ã©ã®ã‚ˆã†ã«ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã—ãŸã‹ã¨ã„ã†ã®ãŒå…¨ä½“ã®æµã‚Œã§ã€ä»Šã¾ã§è§¦ã£ã¦ã„ãŸnixã®å„æ©Ÿèƒ½ã¯ã©ã‚“ãªå•é¡Œã«å¯¾å‡¦ã™ã‚‹ãŸã‚ã«ã‚ã‚‹ã®ã‹ã‚’çŸ¥ã‚ŒãŸã€‚<h2 id=1-introduction><a aria-label="Anchor link for: 1-introduction" class=zola-anchor href=#1-introduction>1 Introduction</a></h2><p>ã“ã®è«–æ–‡ã¯software deploymentã¤ã„ã¦è¿°ã¹ã¦ã„ã‚‹ã€‚<br> ã“ã“ã§ã„ã†ã€software deploymentã¨ã¯computer programã‚’ã‚ã‚‹machineã‹ã‚‰å–å¾—ã—ã¦å‹•ãã‚ˆã†ã«ã™ã‚‹ã“ã¨ã€‚<br> ã“ã‚Œã¾ã§deployã®æ‰‹æ³•ã‚„toolã¯adhocã«è¡Œã‚ã‚Œã¦ãŠã‚Šã€fundamentalãªissueã«å¯¾ã—ã¦ä½“ç³»çš„ã‹ã¤è¦å¾‹ã ã£ã¦æ‰±ã‚ã‚Œã¦ã“ãªã‹ã£ãŸã€‚<br> æœ¬ç« ã§ã¯ã¾ãšsoftware deploymentã«ã¯ã©ã†ã„ã£ãŸå•é¡ŒãŒã‚ã‚‹ã®ã‹ã«ã¤ã„ã¦è¿°ã¹ã¦ã„ã‚‹ã€‚<p>deploymentã«é–¢ã™ã‚‹å•é¡Œã¯å¤§ããã€environment issuesã¨manageability issuesã¨ã„ã†å•é¡Œã«åˆ†é¡ã§ãã‚‹ã€‚<p>Environmnet issuesã®å…·ä½“ä¾‹ã¨ã—ã¦ã¯<ul><li>systemã«ä»–ã®componentã‚„fileãŒå­˜åœ¨ã—ã¦ã„ã¦ã»ã—ã„<li>dependenciesãŒç‰¹å®šã•ã‚Œã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚‹<li>componentãŒsourceã§deployã•ã‚Œã‚‹å ´åˆã¯ã€build timeã®dependenciesãŒå¿…è¦(compilerç­‰)<li>dependenciesã¯ç‰¹å®šã®feature(flag)ã§buildã•ã‚Œã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚‹<li>runtimeã®ä¾å­˜ã‚’è¦‹ã¤ã‘ã‚‰ã‚Œã‚‹ã“ã¨(dynamic linker search path)<li>config file, user account, databaseã«ç‰¹å®šã®recordãŒã‚ã‚‹ã¨ã„ã£ãŸsoftware artifactä»¥å¤–ã®ä¾å­˜</ul><p>ãŒã‚ã‚‹ã€‚ã¾ã¨ã‚ã‚‹ã¨componentã®requirementsã‚’ç‰¹å®š(identify)ã—ã€deployå…ˆã®ç’°å¢ƒã§realiseã—ãªã‘ã‚Œã°ãªã‚‰ãªã„ã¨ã„ã†å•é¡Œã€‚<p>Manageability issueã¨ã—ã¦ã¯<ul><li>componentã®uninstallã¯å®‰å…¨ã‹<li>ã‚ã‚‹componentã®upgradeãŒä»–ã®componentã‚’å£Šã•ãªã„ã‹<li>rollbackã§ãã‚‹ã‹<li>deployæ™‚ã«æ§˜ã€…ãªè¨­å®šã‚’è¡Œãˆã‚‹ã‹</ul><p>ç­‰ãŒã‚ã‚‹ã€‚<p>1.2 The state of the artã§ã¯RPMã‹ã‚‰ã¯ã˜ã¾ã£ã¦ã€windowsã‚„mac, .NETç­‰ã§ã©ã®ã‚ˆã†ã«deployãŒãªã•ã‚Œã¦ã„ã‚‹ã‹ã®èª¬æ˜ãŒã‚ã‚‹ã€‚<br> Zero install systemã¨ã„ã†ã‚‚ã®ãŒã‚ã‚‹ã“ã¨ã‚’åˆã‚ã¦çŸ¥ã£ãŸã€‚<p>æ—¢å­˜ã®deploymentã®å•é¡Œç‚¹ã‚’æ•´ç†ã™ã‚‹ã¨ä»¥ä¸‹ã®ç‚¹ãŒæŒ™ã’ã‚‰ã‚Œã‚‹ã€‚<ul><li>dependency specificationãŒä¸æ­£ç¢ºã§æ¤œè¨¼ã•ã‚Œã¦ã„ãªã„ã€‚ä¾‹ãˆã°<code>foo</code>ã¨ã„ã†binaryãŒã‚ã‚Œã°ã‚ˆã„ã ã‘ç­‰ã€‚<li>è¤‡æ•°versionãŒå…±å­˜ã§ããªã„<li>componentãŒç›¸äº’ã«å¹²æ¸‰ã—ã¦ã—ã¾ã†<li>rollbackã§ããªã„<li>upgradeãŒatomicã§ãªã„ã€‚(systemã«ä¸å®Œå…¨ãªæ™‚é–“ãŒç”Ÿã˜ã‚‹)<li>é™çš„ã«ã™ã¹ã¦ã‚’å«ã‚“ã§ã„ã‚‹å¿…è¦ãŒã‚ã‚‹<li>sourceã‹binaryã©ã¡ã‚‰ã‹ã—ã‹ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ãªã„<li>frareworkãŒç‰¹å®šã®programmingè¨€èªã«é™å®šã•ã‚Œã¦ã„ã‚‹</ul><p>ã“ã‚Œã‚‰ã®å•é¡Œã‚’è§£æ±ºã™ã‚‹ãŸã‚ã®nixã®åŸºæœ¬çš„ãªapproachã¯central component storeã«componentã‚’åˆ†é›¢ã•ã‚ŒãŸå½¢ã§é…ç½®ã™ã‚‹ã“ã¨ã€‚<br> ãã®pathã«ã¯componentã®inputã®cryptographicãªhashãŒå«ã¾ã‚Œã‚‹ã€‚ã“ã‚Œã«ã‚ˆã‚Šå®£è¨€ã•ã‚Œã¦ã„ãªã„ä¾å­˜ã‚’ãªãã—ã€ç•°ãªã‚‹versionã‚’ä½µå­˜ã•ã›ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚<p>Nixã«ã‚ˆã‚Šä»¥ä¸‹ã®ç‚¹ãŒé”æˆã•ã‚Œã‚‹ã€‚<ul><li>componentã®åˆ†é›¢ã«ã‚ˆã‚‹ç›¸äº’ä¸å¹²æ¸‰<li>componentã¯ç‹¬ç«‹ã—ã¤ã¤ã‚‚ã€å…±æœ‰å¯èƒ½ãªã‚‚ã®ã¯å…±æœ‰ã•ã‚Œã‚‹(resourceã®æœ‰åŠ¹æ´»ç”¨)<li>upgradeã¯atomicã«ãªã•ã‚Œã€systemãŒinconsistentãªçŠ¶æ…‹ã«ãªã‚‰ãªã„<li>\( \mathcal{O}(1) \) -timeã§ã®rollback<li>åˆ©ç”¨ã•ã‚Œã¦ã„ãªã„componentã®è‡ªå‹•çš„ãªgarbage collection<li>componentã®buildæ–¹æ³•ã ã‘ã§ãªãã€compositionã‚‚è¡¨ç¾ã§ãã‚‹pureãªnix language<li>é€éçš„ãªsource/binary deployment model<li>multi-platform build</ul><p>æœ¬ç« ã§nixãŒè§£æ±ºã—ãŸã„deploymentã«ã¾ã¤ã¾ã‚‹å•é¡Œã®æ¦‚è¦ãŒã‚ã‹ã£ãŸã€‚<br> Nixã‚’å§‹ã‚ãŸéš›ã«æ›¸ã„ãŸ<a href=https://blog.ymgyt.io/entry/declarative-environment-management-with-nix/#somosomonixtoha rel=external>è¨˜äº‹</a>ã§<blockquote><p>ç¾çŠ¶ã®è‡ªåˆ†ã®ç†è§£ã§ã¯Nixã¨ã¯package manager + build systemã¨ã„ã†èªè­˜ã§ã™ã€‚</blockquote><p>ã¨æ›¸ã„ãŸã®ã§ã™ãŒã€nixã¯deployment systemã ã£ãŸã€‚<h2 id=2-an-overview-of-nix><a aria-label="Anchor link for: 2-an-overview-of-nix" class=zola-anchor href=#2-an-overview-of-nix>2 An Overview of Nix</a></h2><p>ã“ã‚Œã¾ã§ã«ã§ã¦ããŸcomponentã¨ã¯basic units of deploymentã§ã€fileã®é›†åˆã€‚<br> Nixã¯(é€šå¸¸ã§ã¯)<code>/nix/store</code>ã«componentã‚’ä¿æŒã™ã‚‹ã€‚<p>store pahtã¯<code>/nix/store/bwacc7a5c5n3qx37nz5drwcgd2lv89w6-hello-2.1.1</code> ã®ã‚ˆã†ã«hashã‚’å«ã‚€ã€‚ã“ã®hashã¯<ul><li>source<li>build script<li>build scriptã¸ã®argmentsã¨environment variables<li>build dependencies(compiler,linker, libraries,tools, shell,...)</ul><p>ã«åŸºã¥ã„ã¦ç®—å‡ºã•ã‚Œã‚‹ã€‚<br> æœ€åˆã«nixã‚’ã•ã‚ã£ãŸã¨ãã¯ã€hashãŒä½¿ã‚ã¦ã„ã‚‹ã“ã¨ã®æ„ç¾©ã‚’ç†è§£ã§ãã¦ã„ãªã‹ã£ãŸãŒã€componentã¸ã®pathã«inputã‚’ã™ã¹ã¦å«ã‚€hashã‚’åŠ ãˆã‚‹ã“ã¨ã§ã€dependencyã®æŒ‡å®šãŒå®Œå…¨ã«ãªã‚‹ã¨ã„ã†ã“ã¨ãŒç†è§£ã§ããŸã€‚<br> <code>hello</code>ã«ä¾å­˜ã—ã¦ã„ã‚‹ã¨å®£è¨€ã™ã‚‹ã ã‘ã§ã¯ã€ä¸ååˆ†ã§ã€<code>hello-2.1.1</code>ã®ã‚ˆã†ã«versionã‚’è¶³ã—ãŸã¨ã“ã‚ã§ãŸã„ã—ã¦æ”¹å–„ã—ãªã„ã€‚inputã«åŸºã¥ã„ã¦ç®—å‡ºã•ã‚ŒãŸhashã‚’åŠ ãˆã‚‹ã“ã¨ã§ã€ã‚ˆã‚Šé©åˆ‡ãª<code>hello</code>ã¸ã®ä¾å­˜ã‚’è¡¨ç¾ã§ãã‚‹ã€‚<p><a href=https://zero-to-nix.com/concepts/closures rel=external>Closures</a>ã®èª¬æ˜ã‚‚ã‚ã‚‹ã€‚closureã‚’ã‚ˆãã‚ã‹ã£ã¦ã„ãªã‹ã£ãŸã®ã§ã€ã“ã®èª¬æ˜ãŒã‚ã‚ŠãŒãŸã‹ã£ãŸã€‚<p>ä»¥ä¸‹ã®ã‚ˆã†ãªhelloã®derivationã‚’ä¾‹ã«å„è¡Œã®è§£èª¬ã‚‚ã—ã¦ãã‚Œã‚‹ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=nix><span class=giallo-l><span style=color:#eceff4>{</span><span>stdenv</span><span style=color:#81a1c1>,</span><span> fetchurl</span><span style=color:#81a1c1>,</span><span> perl</span><span style=color:#eceff4>}:</span><span style=color:#616e88> # 2</span></span>
<span class=giallo-l><span>  stdenv</span><span style=color:#81a1c1>.</span><span>mkDerivation</span><span style=color:#eceff4> {</span><span style=color:#616e88> # 3</span></span>
<span class=giallo-l><span style=color:#8fbcbb>    name</span><span style=color:#81a1c1> =</span><span style=color:#eceff4> "</span><span style=color:#a3be8c>hello-2.1.1</span><span style=color:#eceff4>"</span><span style=color:#81a1c1>;</span><span style=color:#616e88> # 4</span></span>
<span class=giallo-l><span style=color:#8fbcbb>    builder</span><span style=color:#81a1c1> =</span><span style=color:#a3be8c> ./builder.sh</span><span style=color:#81a1c1>;</span><span style=color:#616e88> # 5</span></span>
<span class=giallo-l><span style=color:#8fbcbb>    src</span><span style=color:#81a1c1> =</span><span> fetchurl</span><span style=color:#eceff4> {</span><span style=color:#616e88> # 6</span></span>
<span class=giallo-l><span style=color:#8fbcbb>      url</span><span style=color:#81a1c1> =</span><span style=color:#a3be8c> http://ftp.gnu.org/pub/gnu/hello/hello-2.1.1.tar.gz</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#8fbcbb>      md5</span><span style=color:#81a1c1> =</span><span style=color:#eceff4> "</span><span style=color:#a3be8c>70c9ccf9fac07f762c24f2df2290784d</span><span style=color:#eceff4>"</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>    inherit</span><span style=color:#8fbcbb> perl</span><span style=color:#81a1c1>;</span><span style=color:#616e88> # 7</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p>ã¾ãŸã€<code>hello</code>ã‚’å®Ÿè¡Œã™ã‚‹ã¨<code>/nix/store/bwacc7a5c5n3qx37nz5drwcgd2lv89w6-hello-2.1.1/bin/hello</code>ãŒå®Ÿè¡Œã•ã‚Œã‚‹ä»•çµ„ã¿ã¨ã—ã¦ã€user-environmentã‚„profileã®ä»•çµ„ã¿ãŒè§£èª¬ã•ã‚Œã‚‹ã€‚<br> ã“ã‚Œã«ã‚ˆã£ã¦ã€rollbackã‚„garbage collectionãŒå®Ÿç¾ã•ã‚Œã‚‹ã“ã¨ãŒã‚ã‹ã‚‹ã€‚<p>Nix expressionã‹ã‚‰componentãŒbuildã•ã‚Œã‚‹ã¾ã§ã«ã€store derivationã¨ã„ã†ä¸­é–“çµæœã‚’çµŒç”±ã™ã‚‹ã€‚nix-envã¯nix-instantiateã¨nix-store --realizeã®åˆã‚ã›æŠ€ã§ã‚ã‚‹æ—¨ãŒèª¬æ˜ã•ã‚Œã‚‹ã€‚<h3 id=transparent-source-binary-deployment><a aria-label="Anchor link for: transparent-source-binary-deployment" class=zola-anchor href=#transparent-source-binary-deployment>Transparent source/binary deployment</a></h3><p>nixã¯sourceã‹ã‚‰componentã‚’buildsã™ã‚‹ã®ã§ã€source deployment modelã¨ã„ãˆã‚‹ã€‚<br> ãŸã ã€sourceã‹ã‚‰ã®buildã«ã¯å•é¡ŒãŒã‚ã‚Šã€ä¾‹ãˆã°ã€hello componentã®å ´åˆã€ãã®ä¾å­˜ã‹ã‚‰buildã™ã‚‹ã®ã§ã€stdenv-linux,gcc, bash, gnugar,curl, ...ã¨60ä»¥ä¸Šã®derivationã‚’buildã™ã‚‹å¿…è¦ãŒã§ã¦ãã¦ã—ã¾ã†ã€‚source deploymentã¯end-userã«ã¯ä½¿ã„ã¥ã‚‰ã„ã‚‚ã®ã¨ãªã£ã¦ã—ã¾ã†ã€‚<br> ãã“ã§ã€nixã¯store pathã®derivation outputã‚’ã‚ã‚‰ã‹ã˜ã‚ã©ã“ã‹ã«uploadã—ã¦ãŠãã€buildæ™‚ã«è‡ªåˆ†ã§buildã™ã‚‹ã®ã§ã¯ãªãã€store pathã®buildçµæœã‚’å–å¾—ã™ã‚‹ã‚ˆã†ã«å‹•ä½œã™ã‚‹ã€‚ã“ã‚Œã¯buildçµæœã‚’ç½®æ›ã™ã‚‹ç‚¹ã‚’ã¨ã‚‰ãˆã¦ã€substituteã¨è¨€ã‚ã‚Œã‚‹ã€‚<p>ã“ã®ä»•çµ„ã¿ã®ãŠã‹ã’ã§ã€userã‹ã‚‰ã¿ã‚‹ã¨source deploymentãŒè‡ªå‹•ã§binary deploymentã«æœ€é©åŒ–ã•ã‚Œã‚‹ã€‚<br> Nix ã™ã”ã™ãã‚‹ã€‚<h2 id=3-deployment-as-memory-management><a aria-label="Anchor link for: 3-deployment-as-memory-management" class=zola-anchor href=#3-deployment-as-memory-management>3 Deployment as Memory Management</a></h2><p>ã¾ãš"software component"ãŒä»¥ä¸‹ã®ã‚ˆã†ã«å®šç¾©ã•ã‚Œã‚‹ã€‚<blockquote><ul><li>A sofeware component is a software artifact that is subject to automatic composition. It can require, and be required by, other components.<li>A software component is a unit of deployment.</ul></blockquote><p>deployã‚’ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èªã¨å¯¾æ¯”ã•ã›ã‚‹è©±ãŒãŠã‚‚ã—ã‚ã‹ã£ãŸã€‚ programãŒmemoryã‚’æ“ä½œã™ã‚‹ã‚ˆã†ã«deploymentã¯file systemã‚’æ“ä½œã™ã‚‹ã€‚memory addressãŒfile pathã«å¯¾å¿œã™ã‚‹ã®ã§ã€<code>/usr/bin</code>ã«<code>gcc</code>ã‚’ä»˜ä¸ã—ã¦ã€<code>/usr/bin/gcc</code>ã‚’ãˆã‚‹ã®ã¯ã€pointeræ“ä½œã«å¯¾å¿œã™ã‚‹ã€‚å­˜åœ¨ã—ãªã„componentã‚’å‚ç…§ã™ã‚‹ã®ã¯ã€dangling pointerç­‰ãªã©ã€‚<br> ã“ã®ã‚¢ãƒŠãƒ­ã‚¸ãƒ¼ã«å¾“ã†ã¨ã€assemblerã®ã‚ˆã†ãªpointerã«å¯¾ã™ã‚‹è¦å¾‹ãŒã¾ã£ãŸããªã„ã®ãŒunix styleã®deploymentã€pointer disciplineãŒã‚ã‚‹C,C++ã«ã‚ãŸã‚‹ã®ãŒã€Nixã€Javaã®ã‚ˆã†ã«å®Œå…¨ãªpointerã«å¯¾ã™ã‚‹è¦å¾‹ãŒã‚ã‚‹è¨€èªã«å¯¾å¿œã™ã‚‹deployment modelã¯ã¾ã ãªã„ã€‚ã¨ã„ã†ã“ã¨ã«ãªã‚‹ã€‚<br> æ—¢å­˜ã®file pathã‚’è‡ªç”±ã«æ‰±ã†deploymentã¯assemblerã®ã‚ˆã†ã«ãªã‚“ã§ã‚‚ã§ãã‚‹ã¨è€ƒãˆã‚‹ç™ºæƒ³ãŒãªã‹ã£ãŸã€‚<p>ã©ã†ã—ã¦ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èªã®è©±ãŒã§ã¦ãã‚‹ã‹ã¨ã„ã†ã¨ã€stackã‚’èµ°æŸ»ã—ã¦ã€pointerã«è¦‹ãˆã‚‹ã‚‚ã®(å®Ÿéš›ã¯integerã‹ã‚‚ã—ã‚Œãªã„)ãŒã‚ã‚Œã°ã€pointerã¨ã¿ãªã—ã¦garbage collectionæ™‚ã«åˆ©ç”¨ã™ã‚‹æ‰‹æ³•ã‚’deploymentã«ã‚‚å¿œç”¨ã™ã‚‹ãŸã‚ã€‚å…·ä½“çš„ã«ã¯ã€fileã®contentã‚’èµ°æŸ»ã—ã¦ã€file pathã£ã½ãè¦‹ãˆã‚‹ã‚‚ã®ãŒã‚ã‚Œã°ã€ãã®fileã¯file pathã¸ä¾å­˜ã—ã¦ã„ã‚‹ã¨ã¿ãªã—ã¦ã€deploymentã«ãŠã‘ã‚‹ä¾å­˜graphã‚’ä½œã‚‹ã€‚<p>fileã®ä¸­èº«ã‚’è‡ªåŠ›ã§èµ°æŸ»ã—ã¦ä¾å­˜ã‚’åˆ¤åˆ¥ã§ãã‚‹ãŸã‚ã«ã¯ã€file pathãŒåˆ¤åˆ¥ã§ãã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚<code>/foo</code>ã‚’ã¿ãŸã¨ãã«ãã‚ŒãŒfile pathã‹ã©ã†ã‹ã¯ã‚ã‚„ã—ã„ã€‚nixã¯store pathãŒ<code>/nix/store/bwacc2gn3...-hello-2.1.1</code>ã«ãªã£ã¦ã„ã‚‹ã®ã§ã€å®Œå…¨ã§ã¯ãªã„ãŒã€file pathãŒåˆ¤åˆ¥ã—ã‚„ã™ã„ã€‚<br> ãŸã ã€source codeä¸Šã§<code>["nix", "store", "bwacc2gn3...-hello-2.1.1"]</code>ã®ã‚ˆã†ã«elementã®é…åˆ—ã§ä¿æŒã•ã‚Œã¦ã„ãŸã‚‰è¦‹é€ƒã—ã¦ã—ã¾ã†ã®ã§ã€scanã®å¯¾è±¡ã¯hashéƒ¨åˆ†ã®ã¿ã¨ã™ã‚‹ã‚ˆã†ã ã£ãŸã€‚ãã®ä»–ã€æ–‡å­—ã‚³ãƒ¼ãƒ‰ã§ã‚ã£ãŸã‚Šåœ§ç¸®ã•ã‚Œã¦ã„ãŸã‚Šã¨ã„ã‚ã„ã‚è€ƒãˆã‚‰ã‚Œã‚‹ãŒã€å®Ÿç”¨ä¸Šå•é¡Œã«ãªã£ã¦ã„ãªã„ã‚‰ã—ã„ã€‚<p>store pathã«hashã‚’ã„ã‚Œã‚‹ã“ã¨ã§ã€ãã®hashãŒsourceã‚„binaryã«å«ã¾ã‚Œã¦ã„ãŸã‚‰ä¾å­˜ã—ã¦ã„ã‚‹ã¨ã¿ãªã™ã¨ã„ã†ç™ºæƒ³ã¯ã™ã”ã„ã€‚<h2 id=4-the-nix-expression-language><a aria-label="Anchor link for: 4-the-nix-expression-language" class=zola-anchor href=#4-the-nix-expression-language>4 The Nix Expression Language</a></h2><p>Nix languageã®untypedã§ã€purely functionalã§ã€lazyãªæ€§è³ªãŒcomponentã¨compositionã‚’è¡¨ç¾ã™ã‚‹ã®ã«é©ã—ã¦ã„ã‚‹ã¨ã„ã†ç¨‹åº¦ã®ç†è§£ã€‚<p>4.3.4ã®Evaluation rulesã§<p>$$ SELECT: \frac{e \overset{*}{\mapsto} \lbrace as \rbrace \land \langle n = \acute{e} \rangle \in as }{e.n \mapsto \acute{e} } $$<p>ã®ã‚ˆã†ãªè¨˜æ³•ãŒã§ã¦ãã‚‹ã®ã§ã™ãŒã€ã“ã‚Œã®èª­ã¿æ–¹ãŒã‚ã‹ã£ã¦ã„ãªã„ã€‚WASMã®specã‚’èª­ã‚“ã§ã„ã‚‹éš›ã«ã‚‚ç™»å ´ã—ã¦èª­ã‚ãªã‹ã£ãŸã®ã§ç†è§£ã—ãŸã„.. (ã”å­˜çŸ¥ã®æ–¹ãŠã‚‰ã‚Œã¾ã—ãŸã‚‰æ•™ãˆã¦ã„ãŸã ã‘ã‚‹ã¨éå¸¸ã«ã‚ã‚ŠãŒãŸã„ã§ã™)<h2 id=5-the-extensional-model><a aria-label="Anchor link for: 5-the-extensional-model" class=zola-anchor href=#5-the-extensional-model>5 The Extensional Model</a></h2><p>Nixã«ã¯extensional modelã¨intensional modelã¨ã„ã†2ã¤ã®model(variant)ãŒã‚ã‚‹ã€‚æœ¬ç« ã§ã¯extensional modelã«ã¤ã„ã¦ã€‚<br> extensionalã¨ã„ã†ã®ã¯ã€componentã®ä¸­èº«ãŒå®Ÿéš›ã«ã¯ç•°ãªã£ã¦ã‚‚å¤–å½¢çš„ãªæŒ¯ã‚‹èˆã„ãŒåŒã˜ãªã‚‰åŒã˜ã¨ã¿ãªã™ã¨ã„ã†ãƒ‹ãƒ¥ã‚¢ãƒ³ã‚¹ã¨ç†è§£ã—ãŸã€‚ä¾‹ãˆã°ã€linkerãŒæŒ¿å…¥ã—ãŸtimestampã¯ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®å‹•ä½œã«ã¯å½±éŸ¿ã‚’ä¸ãˆãªã„ã®ã§ã€å®Ÿéš›ã«ã¯buildã™ã‚‹ãŸã³ã«æˆæœç‰©ã¯ã‹ã‚ã‚‹ãŒã€åŒä¸€(interchangeable)ã¨ã¿ãªã™ã¨ã„ã†è€ƒãˆ(å‰æ)<br> è£ã‚’ã‹ãˆã™ã¨nixã¯åŒã˜inputã§ã‚ã£ã¦ã‚‚binaryãƒ¬ãƒ™ãƒ«ã§ã®åŒä¸€ã®outputã¾ã§ã¯è¦æ±‚ã—ã¦ã„ãªã„ã¨ã„ã†ã“ã¨ã ã£ãŸã‚“ã§ã™ã­ã€‚<p>ã“ã‚Œã¾ã§ã«è¿°ã¹ã¦ããŸã€cryptographic hash, nix store, nix-instantiate(store derivation), nix-store --realize, substittutes, garbage collectionã®è©³ç´°ãŒè§£èª¬ã•ã‚Œã‚‹ã€‚<p>substituteã‚„garbage collectionã«ã¤ã„ã¦ã‚ˆãã‚ã‹ã£ã¦ã„ãªã‹ã£ãŸã®ã§ã€æ¦‚è¦ã ã‘ã§ã‚‚çŸ¥ã‚Œã¦ã‚ˆã‹ã£ãŸã€‚(è©³ç´°ã¯ç†è§£ãŒåŠã‚“ã ã‹ã‚ã‚„ã—ã„)<h2 id=6-the-intensional-model><a aria-label="Anchor link for: 6-the-intensional-model" class=zola-anchor href=#6-the-intensional-model>6 The Intensional Model</a></h2><p>å‰ç« ã®extensional modelã®å•é¡Œã¯ã€<code>/nix/store/a7wcgd..hello-3.1.2</code>ã®ã‚ˆã†ãªpathã¯ãã®directoryã®å®Ÿéš›ã®contentã«åŸºã¥ã„ã¦ã„ã‚‹ã¨ã¯é™ã‚‰ãªã„ã¨ã„ã†ç‚¹ã«ã‚ã£ãŸã€‚ãªã®ã§ã€ä¿¡é ¼ã§ããªã„userã®nix storeã‚’shareã§ããªã‹ã£ãŸã‚Šã€substituteã™ã‚‹éš›ã«ã‚‚"ä¿¡é ¼"ã™ã‚‹ã—ã‹ãªã‹ã£ãŸã€‚ã€‚<br> Intensional modelã¯equalityã‚’å¤–éƒ¨ã‹ã‚‰ã®æŒ¯ã‚‹èˆã„ã§ã¯ãªãã€å†…éƒ¨ã®contentã«åŸºã¥ã„ã¦åˆ¤å®šã™ã‚‹ã¨ã„ã†è€ƒãˆã€‚<p>6.8ã§ã¯Nixã§buildã—ãŸã‚Šinstallã§ãã‚‹ãŸã‚ã®componentã«å¯¾ã™ã‚‹å‰æãŒè¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹ã€‚<h2 id=7-software-deployment><a aria-label="Anchor link for: 7-software-deployment" class=zola-anchor href=#7-software-deployment>7 Software Deployment</a></h2><p>Nix packageã«ã¤ã„ã¦èª¬æ˜ãŒã‚ã‚‹ã€‚nix packageã¯componentã®sourceã‚„binaryã‚’å«ã‚“ã§ãŠã‚‰ãšã€fetchã—ã¦ã€buildã™ã‚‹expressionã ã‘ã‚’å«ã‚“ã§ã„ã‚‹ã€‚<br> ã¾ãŸã€static compositions are good(late static compositions are better)ã¨ã„ã†åŸå‰‡ãŒè¿°ã¹ã‚‰ã‚Œã¦ã„ã‚‹ã€‚<br> static compositionã‚’ç”¨ã„ã‚‹ã¨ã€å‹•çš„linkã‚’ä½¿ã£ã¦ã€libraryã®patchã‚’é©ç”¨ã™ã‚‹ã¨ã„ã£ãŸã“ã¨ã¯ã§ããªããªã‚‹ãŒ<blockquote><p>To deploy a new version of some shared component, it is neccessary to redeploy Nix expressions of all installed components that depend on it. This is expensive, but I feel that it is a worthwhile tradeoff against correctness.</blockquote><p>ã¨è¿°ã¹ã‚‰ã‚Œã¦ãŠã‚Šã€è‡ªåˆ†ã‚‚ãã†æ€ã£ãŸã€‚<p>nixã‚’åˆ©ç”¨ã—ã¦ã„ã‚‹ã¨ã€xxxWrapperã¨ã„ã†ã‚‚ã®ã‚’æ™‚ã€…ã¿ã‹ã‘ãŸãŒã€ã‚ˆãã‚ã‹ã£ãŸã„ãªã‹ã£ãŸã€‚fifefoxã®pluginã‚’ä¾‹ã«wrapperã®æ©Ÿèƒ½ãŒèª¬æ˜ã•ã‚Œã¦ãŠã‚Šã€ã‚ã‹ã‚Šã‚„ã™ã‹ã£ãŸã€‚ (pluginç­‰ã®componentã‚’ç’°å¢ƒå¤‰æ•°ã§è¨­å®šã™ã‚‹scriptã‚’1æšã‹ã¾ã›ã‚‹ã¨ã„ã†ç†è§£ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€pluginã®å¤‰æ›´ãŒrebuildã‚’ä¼´ã‚ãšã«è¡Œãˆã‚‹)<h2 id=8-continuous-integration-and-release-management><a aria-label="Anchor link for: 8-continuous-integration-and-release-management" class=zola-anchor href=#8-continuous-integration-and-release-management>8 Continuous Integration and Release Management</a></h2><p>CIç’°å¢ƒã«nixãŒé©ã—ã¦ã„ã‚‹ã¨ã„ã†è©±ã€‚<br> CIã§ã¯é©å®œã€ä¾å­˜ã—ã¦ã„ã‚‹componentã‚’installã™ã‚‹å¿…è¦ãŒã‚ã‚‹ãŒã€nixãŒé¢å€’ã‚’ã¿ã¦ãã‚Œã‚‹ã€‚<br> è‡ªåˆ†ã¯ã¾ã nixã‚’Github actionsç­‰ã§ã†ã¾ãåˆ©ç”¨ã§ãã¦ã„ãªã„ãŒã€nixã§ã®ç’°å¢ƒæ§‹ç¯‰ãŒé­…åŠ›çš„ãªã®ã¯CIã§ã‚‚é€éçš„ã«åˆ©ç”¨ã§ãã‚‹ã‹ã‚‰ã¨æ€ã£ã¦ã„ãŸã¨ã“ã‚ã‚‚ã‚ã£ãŸã®ã§ã€actionsã§åˆ©ç”¨ã—ã¦ã„ããŸã„ã€‚<h2 id=9-service-deployment><a aria-label="Anchor link for: 9-service-deployment" class=zola-anchor href=#9-service-deployment>9 Service Deployment</a></h2><p>Nixã§ã€webserver, application server ,databaseã®ã‚ˆã†ã«è¤‡æ•°processã§æ©Ÿèƒ½ãŒå®Ÿç¾ã•ã‚Œã‚‹serviceã‚’ã©ã®ã‚ˆã†ã«è¨˜è¿°ã§ãã‚‹ã‹ã«ã¤ã„ã¦ã€‚<br> ComponentãŒtestç’°å¢ƒã§å‹•ã„ãŸã“ã¨ã¯productionç’°å¢ƒã§å‹•ãã“ã¨ã‚’ä¿è¨¼ã—ãªã„ã€‚ãªãœãªã‚‰ã€testç’°å¢ƒã§ã¯æ˜ç¤ºçš„ã«å®£è¨€ã•ã‚Œã¦ã„ãªã„dependencyãŒæä¾›ã•ã‚Œã¦ã„ã‚‹ã‹ã‚‚ã—ã‚Œãªã„ã‹ã‚‰ã€‚nixãªã‚‰componentã‚’composeã™ã‚‹ã‚„ã‚Šæ–¹ã§serviceã‚’è¨˜è¿°ã§ãã‚‹ã®ã§ã€ã“ã†ã„ã£ãŸå•é¡ŒãŒèµ·ããªã„ã€‚<p>Serviceã¨ã„ã†ç¨‹ã§ã‚‚ãªã„ãŒã€å®Ÿéš›ã«<a href=https://github.com/ymgyt/mynix/blob/9af899f3f23b07ba2fe0161cddc92097e29a7499/homeserver/modules/opentelemetry-collector/default.nix rel=external>raspiã§opentelemetry-collectorã‚’å‹•ã‹ã™è¨­å®š</a>ã‚’nixã§æ›¸ã„ãŸéš›ã«ã€user account, secret, opentelemetry-collector binary, config file, systemd serviceã‚’è¨˜è¿°ã§ããŸã®ã§ã€nixã§serviceã‚‚è¡¨ç¾ã§ãã‚‹ã¨ã„ã†ã®ã¯èª¬å¾—åŠ›ã‚ã‚‹ã¨æ€ã£ãŸã€‚<h2 id=10-build-managment><a aria-label="Anchor link for: 10-build-managment" class=zola-anchor href=#10-build-managment>10 Build Managment</a></h2><p>Nixã‚’makeã®ã‚ˆã†ã«low level build managementã¨ã—ã¦ä½¿ãˆã‚‹ã‹ã«ã¤ã„ã¦ã€‚<br> å®Ÿéš›ã«Cã‚’buildã—ã¦ã„ãå…·ä½“ä¾‹ãŒè¼‰ã£ã¦ã„ã‚‹ã€‚<h2 id=11-conclusion><a aria-label="Anchor link for: 11-conclusion" class=zola-anchor href=#11-conclusion>11 Conclusion</a></h2><p>deployã®æ­£ã—ã•ã‚’å‘ä¸Šã•ã›ã‚‹ã¨ã„ã†ç›®çš„ã¯ã“ã®è«–æ–‡ã§ã®äºŒã¤ã®ideaã§é”æˆã•ã‚ŒãŸã€‚<p>ä¸€ã¤ã¯ã€nix store pathã«cryptographc hashã‚’ç”¨ã„ã‚‹ã“ã¨ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€isolation, è¤‡æ•°versionã®å…±å­˜(automatic support for variability)ã€runtime dependenciesã®æ¤œçŸ¥ãŒå¯èƒ½ã¨ãªã£ãŸã€‚ã“ã®æ–¹æ³•ã¯ã€deploymentã®å•é¡Œã«å¯¾ã—ã¦ã€file systemã¨ã„ã†æœ€ã‚‚fundamentalãªlevelã§å¯¾å‡¦ã—ã¦ã„ã‚‹ã€‚<p>äºŒã¤ç›®ãŒã€purely functional deployment modelã€‚ã“ã‚Œã¯ã€componentãŒbuildã•ã‚ŒãŸã‚ã¨ã¯å¤‰åŒ–ã›ãšã€build processãŒå®£è¨€ã•ã‚ŒãŸinputã«ã®ã¿ä¾å­˜ã™ã‚‹ã¨ã„ã†ã‚‚ã®ã€‚hashã®ä»•çµ„ã¿ã¨åˆã‚ã•ã‚Šã€deployment actionã®ç›¸äº’å¹²æ¸‰ã‚’é˜²æ­¢ã—ã€componentã‚„compositionã®identificationã‚’å¯èƒ½ã«ã—ã€deploymentã«äºˆæ¸¬å¯èƒ½ã§æ±ºå®šçš„ãªsemanticsã‚’ã‚‚ãŸã‚‰ã™ã€‚<p>Nix languageã®usabilityã«ã¤ã„ã¦ã¯ã€nix langã®çµŒé¨“è€…ã¯haskellç­‰ã®functional languageã®çµŒé¨“ã‚’ã‚‚ã¤ã®ã§ã€ã¾ã çµè«–ã¥ã‘ã‚‰ã‚Œãªã„ã¨ã„ã†è¨˜è¿°ãŒã‚ã‚Šã€ã‚„ã£ã±ã‚Šãã†ãªã‚“ã ã¨ãªã£ãŸã€‚</div></article></main><footer class=blog-footer><p>Â© 2026 <a href=https://blog.ymgyt.io> ymgyt </a> | Made with <a href=https://www.getzola.org rel=noopener target=_blank>Zola</a> | <a href=https://github.com/ymgyt/blog>Repository</a> | <a href=https://blog.ymgyt.io/atom.xml target=_blank title=rss> <svg viewbox="0 0 24 24" class=icon fill=none height=24 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx=5 cy=19 r=1></circle></svg> </a></footer></div></div>