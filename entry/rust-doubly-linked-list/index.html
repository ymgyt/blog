<!doctype html><html lang=ja><head><meta charset=UTF-8><meta content="width=device-width,initial-scale=1" name=viewport><link href=https://blog.ymgyt.io/favicon.ico rel=icon sizes=any><link href=https://blog.ymgyt.io/icon.svg rel=icon type=image/svg+xml><link href=https://blog.ymgyt.io/apple-touch-icon.png rel=apple-touch-icon><link href=https://blog.ymgyt.io/manifest.webmanifest rel=manifest><link href=https://blog.ymgyt.io/style.css rel=stylesheet><link href=https://blog.ymgyt.io/atom.xml rel=alternate title=Atom type=application/atom+xml><script src="https://www.googletagmanager.com/gtag/js?id=G-GTB0KMLN90" async></script><script>window.dataLayer = window.dataLayer || [];
	function gtag() {dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-GTB0KMLN90');</script><title>ğŸ”— Rustã§doubly linked list | Happy developing</title><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><body><div class=world><div class=content-container><header class=blog-header-container><div class=blog-logo><a href=https://blog.ymgyt.io>Happy developing</a></div><div class=blog-nav><nav><ul><li><a href=https://blog.ymgyt.io/entry/>Entries</a><li><a href=https://blog.ymgyt.io/tags/>Tags</a><li><a href=https://blog.ymgyt.io/about/>About</a><li><a href=https://github.com/ymgyt> <img alt=Github class=icon src=https://blog.ymgyt.io/images/icon/github.svg> </a><li><a href="https://twitter.com/YAmaguchixt "> <img alt=Twitter class=icon src=https://blog.ymgyt.io/images/icon/twitter.svg> </a></ul></nav></div></header><main class=blog-main><article><header class=entry-header><h1 class=entry-title>ğŸ”— Rustã§doubly linked list</h1><div class=entry-meta><p class=entry-meta-item>ğŸ—“ 2019-08-17<p class=entry-meta-item>ğŸ· <span class=tag><a href=https://blog.ymgyt.io/tags/rust/>rust</a></span></div></header><aside class=entry-toc><nav><ul class=entry-toc-toplevel-list><li><a href=https://blog.ymgyt.io/entry/rust-doubly-linked-list/#can-kao>å‚è€ƒ</a></ul></nav></aside><div class=entry-content><p>Rustã§doubly linked listã‚’æ›¸ã„ã¦ã¿ã¾ã—ãŸã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>use</span><span> std</span><span style=color:#81a1c1>::</span><span>cell</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>RefCell</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>use</span><span> std</span><span style=color:#81a1c1>::</span><span>fmt</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>use</span><span> std</span><span style=color:#81a1c1>::</span><span>rc</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Rc</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>type</span><span style=color:#8fbcbb> Link</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>T</span><span style=color:#eceff4>></span><span style=color:#81a1c1> =</span><span style=color:#8fbcbb> Rc</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>RefCell</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Node</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>T</span><span style=color:#eceff4>>>>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#5e81ac>#[derive(</span><span style=color:#8fbcbb>Debug</span><span style=color:#5e81ac>)]</span></span>
<span class=giallo-l><span style=color:#81a1c1>struct</span><span style=color:#8fbcbb> Node</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>T</span><span style=color:#eceff4>> {</span></span>
<span class=giallo-l><span>    value</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> T</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>    prev</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Option</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Link</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>T</span><span style=color:#eceff4>>>,</span></span>
<span class=giallo-l><span>    next</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Option</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Link</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>T</span><span style=color:#eceff4>>>,</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>impl</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>T</span><span style=color:#eceff4>></span><span style=color:#8fbcbb> Node</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>T</span><span style=color:#eceff4>> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    fn</span><span style=color:#88c0d0> new</span><span style=color:#eceff4>(</span><span>value</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> T</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> Rc</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>RefCell</span><span style=color:#eceff4>&lt;</span><span style=color:#81a1c1>Self</span><span style=color:#eceff4>>> {</span></span>
<span class=giallo-l><span style=color:#8fbcbb>        Rc</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>new</span><span style=color:#eceff4>(</span><span>RefCell</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>new</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>Self</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span>            value</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>            prev</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> None</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>            next</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> None</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#eceff4>        }))</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#5e81ac>#[derive(</span><span style=color:#8fbcbb>Default</span><span style=color:#5e81ac>)]</span></span>
<span class=giallo-l><span style=color:#81a1c1>pub struct</span><span style=color:#8fbcbb> LinkedList</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>T</span><span style=color:#eceff4>> {</span></span>
<span class=giallo-l><span>    head</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Option</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Link</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>T</span><span style=color:#eceff4>>>,</span></span>
<span class=giallo-l><span>    tail</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Option</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Link</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>T</span><span style=color:#eceff4>>>,</span></span>
<span class=giallo-l><span>    length</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> usize</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>impl</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>T</span><span style=color:#eceff4>></span><span style=color:#8fbcbb> LinkedList</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>T</span><span style=color:#eceff4>> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    pub fn</span><span style=color:#88c0d0> new</span><span style=color:#eceff4>()</span><span style=color:#81a1c1> -> Self</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>        Self</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span>            head</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> None</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>            tail</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> None</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>            length</span><span style=color:#81a1c1>:</span><span style=color:#b48ead> 0</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#eceff4>        }</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>    pub fn</span><span style=color:#88c0d0> len</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&self</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> usize</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>        self.</span><span>length</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>    pub fn</span><span style=color:#88c0d0> append</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&mut self</span><span style=color:#eceff4>,</span><span> v</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> T</span><span style=color:#eceff4>) {</span></span>
<span class=giallo-l><span style=color:#81a1c1>        let</span><span> node</span><span style=color:#81a1c1> =</span><span style=color:#8fbcbb> Node</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>new</span><span style=color:#eceff4>(</span><span>v</span><span style=color:#eceff4>);</span></span>
<span class=giallo-l><span style=color:#81a1c1>        match self.</span><span>tail</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>take</span><span style=color:#eceff4>() {</span></span>
<span class=giallo-l><span style=color:#8fbcbb>            Some</span><span style=color:#eceff4>(</span><span>old_tail</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> =></span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span>                old_tail</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>borrow_mut</span><span style=color:#eceff4>()</span><span style=color:#81a1c1>.</span><span>next </span><span style=color:#81a1c1>=</span><span style=color:#8fbcbb> Some</span><span style=color:#eceff4>(</span><span style=color:#8fbcbb>Rc</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>clone</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&</span><span>node</span><span style=color:#eceff4>));</span></span>
<span class=giallo-l><span>                node</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>borrow_mut</span><span style=color:#eceff4>()</span><span style=color:#81a1c1>.</span><span>prev </span><span style=color:#81a1c1>=</span><span style=color:#8fbcbb> Some</span><span style=color:#eceff4>(</span><span>old_tail</span><span style=color:#eceff4>);</span></span>
<span class=giallo-l><span style=color:#eceff4>            }</span></span>
<span class=giallo-l><span style=color:#8fbcbb>            None</span><span style=color:#81a1c1> =></span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#616e88>                // first element</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>                debug_assert_eq!</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>self.</span><span style=color:#88c0d0>len</span><span style=color:#eceff4>(),</span><span style=color:#b48ead> 0</span><span style=color:#eceff4>);</span></span>
<span class=giallo-l><span style=color:#81a1c1>                self.</span><span>head </span><span style=color:#81a1c1>=</span><span style=color:#8fbcbb> Some</span><span style=color:#eceff4>(</span><span style=color:#8fbcbb>Rc</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>clone</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&</span><span>node</span><span style=color:#eceff4>));</span></span>
<span class=giallo-l><span style=color:#eceff4>            }</span></span>
<span class=giallo-l><span style=color:#eceff4>        }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>        self.</span><span>tail </span><span style=color:#81a1c1>=</span><span style=color:#8fbcbb> Some</span><span style=color:#eceff4>(</span><span>node</span><span style=color:#eceff4>);</span></span>
<span class=giallo-l><span style=color:#81a1c1>        self.</span><span>length </span><span style=color:#81a1c1>+=</span><span style=color:#b48ead> 1</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>    pub fn</span><span style=color:#88c0d0> pop</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&mut self</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> Option</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>T</span><span style=color:#eceff4>> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>        match self.</span><span>tail</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>take</span><span style=color:#eceff4>() {</span></span>
<span class=giallo-l><span style=color:#8fbcbb>            Some</span><span style=color:#eceff4>(</span><span>tail</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> =></span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>                if let</span><span style=color:#8fbcbb> Some</span><span style=color:#eceff4>(</span><span>prev</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> =</span><span> tail</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>borrow_mut</span><span style=color:#eceff4>()</span><span style=color:#81a1c1>.</span><span>prev</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>take</span><span style=color:#eceff4>() {</span></span>
<span class=giallo-l><span>                    prev</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>borrow_mut</span><span style=color:#eceff4>()</span><span style=color:#81a1c1>.</span><span>next </span><span style=color:#81a1c1>=</span><span style=color:#8fbcbb> None</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>                    self.</span><span>tail </span><span style=color:#81a1c1>=</span><span style=color:#8fbcbb> Some</span><span style=color:#eceff4>(</span><span>prev</span><span style=color:#eceff4>);</span></span>
<span class=giallo-l><span style=color:#eceff4>                }</span><span style=color:#81a1c1> else</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#616e88>                    // we take last element</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>                    debug_assert_eq!</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>self.</span><span style=color:#88c0d0>len</span><span style=color:#eceff4>(),</span><span style=color:#b48ead> 1</span><span style=color:#eceff4>);</span></span>
<span class=giallo-l><span style=color:#81a1c1>                    self.</span><span>head </span><span style=color:#81a1c1>=</span><span style=color:#8fbcbb> None</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#eceff4>                }</span></span>
<span class=giallo-l><span style=color:#81a1c1>                self.</span><span>length </span><span style=color:#81a1c1>-=</span><span style=color:#b48ead> 1</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>                let</span><span> v</span><span style=color:#81a1c1> =</span><span style=color:#8fbcbb> Rc</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>try_unwrap</span><span style=color:#eceff4>(</span><span>tail</span><span style=color:#eceff4>)</span><span style=color:#616e88> // Rc&lt;RefCell&lt;Node&lt;T>> -> RefCell&lt;Node&lt;T>></span></span>
<span class=giallo-l><span style=color:#81a1c1>                    .</span><span style=color:#88c0d0>ok</span><span style=color:#eceff4>()</span><span style=color:#616e88> // Result&lt;RefCell&lt;Node&lt;T>>, Rc&lt;RefCell&lt;Node&lt;T>>>> -> Option&lt;RefCell&lt;Node&lt;T>>></span></span>
<span class=giallo-l><span style=color:#81a1c1>                    .</span><span style=color:#88c0d0>expect</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>Failed to Rc::try_unwrap tail node</span><span style=color:#eceff4>")</span><span style=color:#616e88> // RefCell&lt;Node&lt;T>></span></span>
<span class=giallo-l><span style=color:#81a1c1>                    .</span><span style=color:#88c0d0>into_inner</span><span style=color:#eceff4>()</span><span style=color:#616e88> // RefCell&lt;Node&lt;T>> -> Node&lt;T></span></span>
<span class=giallo-l><span style=color:#81a1c1>                    .</span><span>value</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#8fbcbb>                Some</span><span style=color:#eceff4>(</span><span>v</span><span style=color:#eceff4>)</span></span>
<span class=giallo-l><span style=color:#eceff4>            }</span></span>
<span class=giallo-l><span style=color:#8fbcbb>            None</span><span style=color:#81a1c1> =></span><span style=color:#8fbcbb> None</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#eceff4>        }</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>    pub fn</span><span style=color:#88c0d0> iter</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&self</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> Iter</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>T</span><span style=color:#eceff4>> {</span></span>
<span class=giallo-l><span style=color:#8fbcbb>        Iter</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span>            current</span><span style=color:#81a1c1>: if self.</span><span style=color:#88c0d0>len</span><span style=color:#eceff4>()</span><span style=color:#81a1c1> ==</span><span style=color:#b48ead> 0</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#8fbcbb>                None</span></span>
<span class=giallo-l><span style=color:#eceff4>            }</span><span style=color:#81a1c1> else</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#8fbcbb>                Some</span><span style=color:#eceff4>(</span><span style=color:#8fbcbb>Rc</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>clone</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&self.</span><span>head</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>as_ref</span><span style=color:#eceff4>()</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>unwrap</span><span style=color:#eceff4>()))</span></span>
<span class=giallo-l><span style=color:#eceff4>            },</span></span>
<span class=giallo-l><span style=color:#eceff4>        }</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span>
<span class=giallo-l></span></code></pre><p>å‚ç…§ã‚’ç›¸äº’ã«ä¿æŒã—ãŸã„å ´åˆã€<code>Rc&lt;RefCell&lt;T>></code>ã§Wrapã—ã¦ã‚„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ Goãªã‚‰pointerã‚’ç›¸äº’ã®fieldã«ä»£å…¥ã™ã‚Œã°ã‚ˆã„ã ã‘ãªã®ã§ã™ãŒã€Rustã®å ´åˆã€<code>Rc</code>ã§å‚ç…§ã®æ‰€æœ‰è€…ãŒè¤‡æ•°ã„ã‚‹ã“ã¨ã‚’ã€<code>RefCell</code>ã§ã€å‚ç…§å…ˆã‹ã‚‰ã§ã‚‚å€¤ãŒå¤‰æ›´ ã§ãã‚‹ã“ã¨ã‚’è¡¨ç¾ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ å‹ã‚’ã¿ã‚‹ã ã‘ã§ã€ã“ã®å€¤ã¯è¤‡æ•°ç®‡æ‰€ã§ä¿æŒã•ã‚Œã¦ã„ã¦ã€ã•ã‚‰ã«å¤‰æ›´ã•ã‚Œã‚‹ã†ã‚‹ã“ã¨ã¾ã§ã‚ã‹ã‚Šã¾ã™ã­ã€‚ ã¾ãŸã€<code>Rc::clone()</code>ã¯<code>node.clone()</code>ã®ã‚ˆã†ã«methodå‘¼ã³å‡ºã—ã§ã¯ãªãã€<code>Rc::clone(&node)</code>ã®ã‚ˆã†ã«æ˜ç¤ºçš„ã«ã€reference countedã®cloneã§ã‚ã‚‹ã“ã¨ãŒã‚ã‹ã‚‹ã‚ˆã†ã«å‘¼ã¶ã®ãŒæ…£ç¿’ã ãã†ã§ã™ã€‚(<code>node.clone()</code>ã¨ã‚ã‚‹ã¨ã€é‡ãŸã„å‡¦ç†ã‹ã‚‚ã—ã‚Œãªã„ã¨æ€ã£ã¦ã—ã¾ã†ã‹ã‚‰ã§ã—ã‚‡ã†ã‹ã€‚)<p><code>Rc&lt;RefCell&lt;T>></code>ã®<code>T</code>ã®fieldã®æ‰€æœ‰æ¨©ã‚’å¥ªãŠã†ã¨ã™ã‚‹ã¨å¤§å¤‰ã§ã€<code>Rc::try_unwrap()</code>ã—ã¦ã€<code>RefCell&lt;T></code>ã«å¤‰æ›ã—ã¦ã•ã‚‰ã«<code>RefCell::into_inner()</code> ã§ã€Tå‹ã«ã‚‚ã©ã—ã¦ã‚„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚<p>ç¶šã„ã¦ã€<code>fmt::Debug</code>ã‚’å®Ÿè£…ã—ã¾ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>impl</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>T</span><span style=color:#81a1c1>:</span><span> fmt</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Display</span><span style=color:#81a1c1> +</span><span style=color:#8fbcbb> Clone</span><span style=color:#eceff4>></span><span> fmt</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Debug</span><span style=color:#81a1c1> for</span><span style=color:#8fbcbb> LinkedList</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>T</span><span style=color:#eceff4>> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    fn</span><span style=color:#88c0d0> fmt</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&self</span><span style=color:#eceff4>,</span><span> f</span><span style=color:#81a1c1>: &mut</span><span> fmt</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Formatter</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> Result</span><span style=color:#eceff4>&lt;(),</span><span> fmt</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Error</span><span style=color:#eceff4>> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>        let</span><span> iter</span><span style=color:#81a1c1> = self.</span><span style=color:#88c0d0>iter</span><span style=color:#eceff4>();</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>        write!</span><span style=color:#eceff4>(</span><span>f</span><span style=color:#eceff4>, "</span><span style=color:#a3be8c>{{ head</span><span style=color:#eceff4>")</span><span style=color:#81a1c1>?</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>        for</span><span> v</span><span style=color:#81a1c1> in</span><span> iter</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>            write!</span><span style=color:#eceff4>(</span><span>f</span><span style=color:#eceff4>, "</span><span style=color:#a3be8c> -> </span><span style=color:#ebcb8b>{}</span><span style=color:#eceff4>",</span><span> v</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>?</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#eceff4>        }</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>        write!</span><span style=color:#eceff4>(</span><span>f</span><span style=color:#eceff4>, "</span><span style=color:#a3be8c> }}</span><span style=color:#eceff4>")</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p>ã“ã®å®Ÿè£…ãŒãªã„ã¨ã€<code>println!("{:?}", list);</code> ã¨ã—ãŸã¨ãã«ã€<code>Node</code>åŒå£«ãŒç›¸äº’å‚ç…§ã—ã¦ã„ã‚‹ã®ã§ã€å¾ªç’°å‚ç…§ã—ã¦ã—ã¾ã„ã€stackoverflowã—ã¦ã—ã¾ã„ã¾ã™ã€‚ ã“ã‚Œã‚’å›é¿ã™ã‚‹ã«ã¯ã€ã©ã¡ã‹ã‚‰ã®å‚ç…§ã‚’<code>rc::Weak</code>ã«ã—ã¦ã‚‚ã‚ˆã„ã¨æ€ã£ãŸã®ã§ã™ãŒã€prevå´ã‚’ç„¡è¦–ã™ã‚‹ã“ã¨ã«ã—ã¾ã—ãŸã€‚<p>æœ€å¾Œã«iteratorã‚’å®Ÿè£…ã—ã¾ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>impl</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>T</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Clone</span><span style=color:#eceff4>></span><span style=color:#8fbcbb> IntoIterator</span><span style=color:#81a1c1> for</span><span style=color:#8fbcbb> LinkedList</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>T</span><span style=color:#eceff4>> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    type</span><span style=color:#8fbcbb> Item</span><span style=color:#81a1c1> =</span><span style=color:#8fbcbb> T</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>    type</span><span style=color:#8fbcbb> IntoIter</span><span style=color:#81a1c1> =</span><span style=color:#8fbcbb> Iter</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>T</span><span style=color:#eceff4>>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>    fn</span><span style=color:#88c0d0> into_iter</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>self</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -> Self::</span><span style=color:#8fbcbb>IntoIter</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>        self.</span><span style=color:#88c0d0>iter</span><span style=color:#eceff4>()</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>pub struct</span><span style=color:#8fbcbb> Iter</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>T</span><span style=color:#eceff4>> {</span></span>
<span class=giallo-l><span>    current</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Option</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Link</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>T</span><span style=color:#eceff4>>>,</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>impl</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>T</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Clone</span><span style=color:#eceff4>></span><span style=color:#8fbcbb> Iterator</span><span style=color:#81a1c1> for</span><span style=color:#8fbcbb> Iter</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>T</span><span style=color:#eceff4>> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    type</span><span style=color:#8fbcbb> Item</span><span style=color:#81a1c1> =</span><span style=color:#8fbcbb> T</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>    fn</span><span style=color:#88c0d0> next</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&mut self</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> Option</span><span style=color:#eceff4>&lt;</span><span style=color:#81a1c1>Self::</span><span style=color:#8fbcbb>Item</span><span style=color:#eceff4>> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>        match self.</span><span>current</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>take</span><span style=color:#eceff4>() {</span></span>
<span class=giallo-l><span style=color:#8fbcbb>            None</span><span style=color:#81a1c1> =></span><span style=color:#8fbcbb> None</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#8fbcbb>            Some</span><span style=color:#eceff4>(</span><span>curr</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> =></span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>                let</span><span> curr</span><span style=color:#81a1c1> =</span><span> curr</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>borrow</span><span style=color:#eceff4>();</span></span>
<span class=giallo-l><span style=color:#81a1c1>                let</span><span> v</span><span style=color:#81a1c1> =</span><span> curr</span><span style=color:#81a1c1>.</span><span>value</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>clone</span><span style=color:#eceff4>();</span></span>
<span class=giallo-l><span style=color:#81a1c1>                match</span><span> curr</span><span style=color:#81a1c1>.</span><span>next </span><span style=color:#eceff4>{</span></span>
<span class=giallo-l><span style=color:#8fbcbb>                    None</span><span style=color:#81a1c1> =></span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>                        self.</span><span>current </span><span style=color:#81a1c1>=</span><span style=color:#8fbcbb> None</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#eceff4>                    }</span></span>
<span class=giallo-l><span style=color:#8fbcbb>                    Some</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>ref</span><span> next</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> =></span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>                        self.</span><span>current </span><span style=color:#81a1c1>=</span><span style=color:#8fbcbb> Some</span><span style=color:#eceff4>(</span><span style=color:#8fbcbb>Rc</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>clone</span><span style=color:#eceff4>(</span><span>next</span><span style=color:#eceff4>));</span></span>
<span class=giallo-l><span style=color:#eceff4>                    }</span></span>
<span class=giallo-l><span style=color:#eceff4>                }</span></span>
<span class=giallo-l><span style=color:#8fbcbb>                Some</span><span style=color:#eceff4>(</span><span>v</span><span style=color:#eceff4>)</span></span>
<span class=giallo-l><span style=color:#eceff4>            }</span></span>
<span class=giallo-l><span style=color:#eceff4>        }</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>impl</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>T</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Clone</span><span style=color:#eceff4>></span><span style=color:#8fbcbb> DoubleEndedIterator</span><span style=color:#81a1c1> for</span><span style=color:#8fbcbb> Iter</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>T</span><span style=color:#eceff4>> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    fn</span><span style=color:#88c0d0> next_back</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&mut self</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> Option</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>T</span><span style=color:#eceff4>> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>        match self.</span><span>current</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>take</span><span style=color:#eceff4>() {</span></span>
<span class=giallo-l><span style=color:#8fbcbb>            None</span><span style=color:#81a1c1> =></span><span style=color:#8fbcbb> None</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#8fbcbb>            Some</span><span style=color:#eceff4>(</span><span>curr</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> =></span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>                let</span><span> curr</span><span style=color:#81a1c1> =</span><span> curr</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>borrow</span><span style=color:#eceff4>();</span></span>
<span class=giallo-l><span style=color:#81a1c1>                match</span><span> curr</span><span style=color:#81a1c1>.</span><span>prev </span><span style=color:#eceff4>{</span></span>
<span class=giallo-l><span style=color:#8fbcbb>                    None</span><span style=color:#81a1c1> =></span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>                        self.</span><span>current </span><span style=color:#81a1c1>=</span><span style=color:#8fbcbb> None</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#8fbcbb>                        None</span></span>
<span class=giallo-l><span style=color:#eceff4>                    }</span></span>
<span class=giallo-l><span style=color:#8fbcbb>                    Some</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>ref</span><span> prev</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> =></span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>                        self.</span><span>current </span><span style=color:#81a1c1>=</span><span style=color:#8fbcbb> Some</span><span style=color:#eceff4>(</span><span style=color:#8fbcbb>Rc</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>clone</span><span style=color:#eceff4>(</span><span>prev</span><span style=color:#eceff4>));</span></span>
<span class=giallo-l><span style=color:#8fbcbb>                        Some</span><span style=color:#eceff4>(</span><span>prev</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>borrow</span><span style=color:#eceff4>()</span><span style=color:#81a1c1>.</span><span>value</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>clone</span><span style=color:#eceff4>())</span></span>
<span class=giallo-l><span style=color:#eceff4>                    }</span></span>
<span class=giallo-l><span style=color:#eceff4>                }</span></span>
<span class=giallo-l><span style=color:#eceff4>            }</span></span>
<span class=giallo-l><span style=color:#eceff4>        }</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p><code>T</code>ã«ã¯<code>Clone</code> boundã‚’è¨­ã‘ã¦æ¥½ã‚’ã—ã¾ã—ãŸã€‚<code>DoubleEndedIterator</code>ã‚’å®Ÿè£…ã™ã‚‹ã¨<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#5e81ac>    #[test]</span></span>
<span class=giallo-l><span style=color:#81a1c1>    fn</span><span style=color:#88c0d0> reverse</span><span style=color:#eceff4>() {</span></span>
<span class=giallo-l><span style=color:#81a1c1>        let mut</span><span> list</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> LinkedList</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>i32</span><span style=color:#eceff4>></span><span style=color:#81a1c1> =</span><span style=color:#8fbcbb> LinkedList</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>new</span><span style=color:#eceff4>();</span></span>
<span class=giallo-l><span style=color:#eceff4>        (</span><span style=color:#b48ead>0</span><span style=color:#81a1c1>..</span><span style=color:#b48ead>10</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>for_each</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>|</span><span>n</span><span style=color:#81a1c1>|</span><span> list</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>append</span><span style=color:#eceff4>(</span><span>n</span><span style=color:#eceff4>));</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>        let mut</span><span> iter</span><span style=color:#81a1c1> =</span><span> list</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>iter</span><span style=color:#eceff4>();</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>        assert_eq!</span><span style=color:#eceff4>(</span><span>iter</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>next</span><span style=color:#eceff4>(),</span><span style=color:#8fbcbb> Some</span><span style=color:#eceff4>(</span><span style=color:#b48ead>0</span><span style=color:#eceff4>));</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>        assert_eq!</span><span style=color:#eceff4>(</span><span>iter</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>next</span><span style=color:#eceff4>(),</span><span style=color:#8fbcbb> Some</span><span style=color:#eceff4>(</span><span style=color:#b48ead>1</span><span style=color:#eceff4>));</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>        assert_eq!</span><span style=color:#eceff4>(</span><span>iter</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>next</span><span style=color:#eceff4>(),</span><span style=color:#8fbcbb> Some</span><span style=color:#eceff4>(</span><span style=color:#b48ead>2</span><span style=color:#eceff4>));</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>        assert_eq!</span><span style=color:#eceff4>(</span><span>iter</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>next</span><span style=color:#eceff4>(),</span><span style=color:#8fbcbb> Some</span><span style=color:#eceff4>(</span><span style=color:#b48ead>3</span><span style=color:#eceff4>));</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>        assert_eq!</span><span style=color:#eceff4>(</span><span>iter</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>next_back</span><span style=color:#eceff4>(),</span><span style=color:#8fbcbb> Some</span><span style=color:#eceff4>(</span><span style=color:#b48ead>3</span><span style=color:#eceff4>));</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>        assert_eq!</span><span style=color:#eceff4>(</span><span>iter</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>next_back</span><span style=color:#eceff4>(),</span><span style=color:#8fbcbb> Some</span><span style=color:#eceff4>(</span><span style=color:#b48ead>2</span><span style=color:#eceff4>));</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>        assert_eq!</span><span style=color:#eceff4>(</span><span>iter</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>next_back</span><span style=color:#eceff4>(),</span><span style=color:#8fbcbb> Some</span><span style=color:#eceff4>(</span><span style=color:#b48ead>1</span><span style=color:#eceff4>));</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>        assert_eq!</span><span style=color:#eceff4>(</span><span>iter</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>next_back</span><span style=color:#eceff4>(),</span><span style=color:#8fbcbb> Some</span><span style=color:#eceff4>(</span><span style=color:#b48ead>0</span><span style=color:#eceff4>));</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>        assert_eq!</span><span style=color:#eceff4>(</span><span>iter</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>next_back</span><span style=color:#eceff4>(),</span><span style=color:#8fbcbb> None</span><span style=color:#eceff4>);</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span></code></pre><p>ã“ã®ã‚ˆã†ã«ã€æˆ»ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚ <a href=https://github.com/ymgyt/dsa/blob/master/src/list/linked_list.rs rel=external>sourceã¯ã“ã¡ã‚‰</a><h2 id=can-kao><a aria-label="Anchor link for: can-kao" class=zola-anchor href=#can-kao>å‚è€ƒ</a></h2><ul><li><a href=https://www.amazon.co.jp/dp/178899552X rel=external>Hands-On Data Structures and Algorithms with Rust</a></ul></div></article></main><footer class=blog-footer><p>Â© 2026 <a href=https://blog.ymgyt.io> ymgyt </a> | Made with <a href=https://www.getzola.org rel=noopener target=_blank>Zola</a> | <a href=https://github.com/ymgyt/blog>Repository</a> | <a href=https://blog.ymgyt.io/atom.xml target=_blank title=rss> <svg viewbox="0 0 24 24" class=icon fill=none height=24 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx=5 cy=19 r=1></circle></svg> </a></footer></div></div>