<!doctype html><html lang=ja><head><meta charset=UTF-8><meta content="width=device-width,initial-scale=1" name=viewport><link href=https://blog.ymgyt.io/favicon.ico rel=icon sizes=any><link href=https://blog.ymgyt.io/icon.svg rel=icon type=image/svg+xml><link href=https://blog.ymgyt.io/apple-touch-icon.png rel=apple-touch-icon><link href=https://blog.ymgyt.io/manifest.webmanifest rel=manifest><link href=https://blog.ymgyt.io/style.css rel=stylesheet><link href=https://blog.ymgyt.io/atom.xml rel=alternate title=Atom type=application/atom+xml><script src="https://www.googletagmanager.com/gtag/js?id=G-GTB0KMLN90" async></script><script>window.dataLayer = window.dataLayer || [];
	function gtag() {dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-GTB0KMLN90');</script><title>ğŸ“— Linux Service Management Made Easy with systemdã‚’èª­ã‚“ã æ„Ÿæƒ³ | Happy developing</title><meta content="Linux Service Management Made Easy with systemdæœ¬ã®æ¦‚è¦ã ã£ãŸã‚Šè‰¯ã‹ã£ãŸã¨ã“ã‚ã«ã¤ã„ã¦" name=description><meta content=summary name=twitter:card><meta content="@YAmaguchixt " name=twitter:site><meta content="ğŸ“— Linux Service Management Made Easy with systemdã‚’èª­ã‚“ã æ„Ÿæƒ³" name=twitter:title><meta content="Linux Service Management Made Easy with systemdæœ¬ã®æ¦‚è¦ã ã£ãŸã‚Šè‰¯ã‹ã£ãŸã¨ã“ã‚ã«ã¤ã„ã¦" name=twitter:description><meta content=https://blog.ymgyt.io/images/emoji/green_book.png name=twitter:image><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><body><div class=world><div class=content-container><header class=blog-header-container><div class=blog-logo><a href=https://blog.ymgyt.io>Happy developing</a></div><div class=blog-nav><nav><ul><li><a href=https://blog.ymgyt.io/entry/>Entries</a><li><a href=https://blog.ymgyt.io/tags/>Tags</a><li><a href=https://blog.ymgyt.io/about/>About</a><li><a href=https://github.com/ymgyt> <img alt=Github class=icon src=https://blog.ymgyt.io/images/icon/github.svg> </a><li><a href="https://twitter.com/YAmaguchixt "> <img alt=Twitter class=icon src=https://blog.ymgyt.io/images/icon/twitter.svg> </a></ul></nav></div></header><main class=blog-main><article><header class=entry-header><h1 class=entry-title>ğŸ“— Linux Service Management Made Easy with systemdã‚’èª­ã‚“ã æ„Ÿæƒ³</h1><div class=entry-meta><p class=entry-meta-item>ğŸ—“ 2023-10-15<p class=entry-meta-item>ğŸ· <span class=tag><a href=https://blog.ymgyt.io/tags/book/>book</a></span> <span class=tag><a href=https://blog.ymgyt.io/tags/linux/>linux</a></span></div></header><aside class=entry-toc><nav><ul class=entry-toc-toplevel-list><li><a href=https://blog.ymgyt.io/entry/linux-service-management-made-easy-with-systemd/#du-ndaben>èª­ã‚“ã æœ¬</a><li><a href=https://blog.ymgyt.io/entry/linux-service-management-made-easy-with-systemd/#chapter-1-understanding-the-need-for-systemd>Chapter 1 Understanding the Need for systemd</a><li><a href=https://blog.ymgyt.io/entry/linux-service-management-made-easy-with-systemd/#chapter-2-understanding-systemd-directories-and-files>Chapter 2 Understanding systemd Directories and Files</a><li><a href=https://blog.ymgyt.io/entry/linux-service-management-made-easy-with-systemd/#chapter-3-understanding-service-path-and-socket-units>Chapter 3 Understanding Service, Path, and Socket Units</a><li><a href=https://blog.ymgyt.io/entry/linux-service-management-made-easy-with-systemd/#chapter-4-controlling-systemd-services>Chapter 4 Controlling systemd Services</a><li><a href=https://blog.ymgyt.io/entry/linux-service-management-made-easy-with-systemd/#chapter-5-creating-and-editing-services>Chapter 5 Creating and Editing Services</a><li><a href=https://blog.ymgyt.io/entry/linux-service-management-made-easy-with-systemd/#chapter-6-understanding-systemd-targets>Chapter 6 Understanding systemd Targets</a><li><a href=https://blog.ymgyt.io/entry/linux-service-management-made-easy-with-systemd/#chapter-7-understanding-systemd-timers>Chapter 7 Understanding systemd Timers</a><li><a href=https://blog.ymgyt.io/entry/linux-service-management-made-easy-with-systemd/#chapter-8-understanding-the-systemd-boot-process>Chapter 8 Understanding the systemd Boot Process</a><li><a href=https://blog.ymgyt.io/entry/linux-service-management-made-easy-with-systemd/#chapter-9-setting-system-parameters>Chapter 9 Setting System Parameters</a><li><a href=https://blog.ymgyt.io/entry/linux-service-management-made-easy-with-systemd/#chapter-10-understanding-shutdown-and-reboot-commands>Chapter 10 Understanding Shutdown and Reboot Commands</a><li><a href=https://blog.ymgyt.io/entry/linux-service-management-made-easy-with-systemd/#chapter-11-understanding-cgroups-version-1>Chapter 11 Understanding cgroups Version 1</a><li><a href=https://blog.ymgyt.io/entry/linux-service-management-made-easy-with-systemd/#chapter-12-controlling-resource-usage-with-cgroups-version-1>Chapter 12 Controlling Resource Usage with cgroups Version 1</a><li><a href=https://blog.ymgyt.io/entry/linux-service-management-made-easy-with-systemd/#chapter-13-understanding-cgroup-version-2>Chapter 13 Understanding cgroup Version 2</a><li><a href=https://blog.ymgyt.io/entry/linux-service-management-made-easy-with-systemd/#chapter-14-using-journald>Chapter 14 Using journald</a><li><a href=https://blog.ymgyt.io/entry/linux-service-management-made-easy-with-systemd/#chapter-15-using-systemd-networkd-and-systemd-resolved>Chapter 15 Using systemd-networkd and systemd-resolved</a><li><a href=https://blog.ymgyt.io/entry/linux-service-management-made-easy-with-systemd/#chapter-16-understanding-timekeeping-with-systemd>Chapter 16 Understanding Timekeeping with systemd</a><li><a href=https://blog.ymgyt.io/entry/linux-service-management-made-easy-with-systemd/#chapter-17-understanding-systemd-and-bootloaders>Chapter 17 Understanding systemd and Bootloaders</a><li><a href=https://blog.ymgyt.io/entry/linux-service-management-made-easy-with-systemd/#chapter-18-understanding-systemd-logind>Chapter 18 Understanding systemd-logind</a><li><a href=https://blog.ymgyt.io/entry/linux-service-management-made-easy-with-systemd/#matome>ã¾ã¨ã‚</a></ul></nav></aside><div class=entry-content><h2 id=du-ndaben><a aria-label="Anchor link for: du-ndaben" class=zola-anchor href=#du-ndaben>èª­ã‚“ã æœ¬</a></h2><figure><div class=fig-images-row><img , alt src=images/systemd-book.jpg></div></figure><p><a href=https://learning.oreilly.com/library/view/linux-service-management/9781801811644/ rel=external>Linux Service Management Made Easy with systemd</a><p>systemdã«ã¤ã„ã¦èª¬æ˜ã—ã¦ãã‚Œã¦ã„ã‚‹æœ¬ã€ãªã„ã‹ãªã¨æ€ã£ã¦ã„ãŸã‚‰è¦‹ã¤ã‘ãŸã®ã§èª­ã‚“ã§ã¿ã¾ã—ãŸã€‚ã€€ã€€<h2 id=chapter-1-understanding-the-need-for-systemd><a aria-label="Anchor link for: chapter-1-understanding-the-need-for-systemd" class=zola-anchor href=#chapter-1-understanding-the-need-for-systemd>Chapter 1 Understanding the Need for systemd</a></h2><p>SysV Initã‚„upstartã®æ­´å²ã«ã¤ã„ã¦ã€‚<br> ç‰¹ã«SysVã®å•é¡Œç‚¹ã¨ã—ã¦ã¯<ul><li>serviceã®èµ·å‹•å‡¦ç†ãŒsequentialã§ã‚ã‚‹ã“ã¨ã‹ã‚‰èµ·å‹•æ™‚é–“ãŒé•·ããªã£ã¦ã—ã¾ã†ã“ã¨<li>serviceã®åˆ¶å¾¡ãŒbashã®scriptã§è¡Œãªã‚ã‚Œã‚‹ã®ã§è¤‡é›‘</ul><p>bashã®scriptã«ã—ã¦ã‚‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=shellscript><span class=giallo-l><span style=color:#81a1c1>case</span><span style=color:#eceff4> "</span><span>$ARG</span><span style=color:#eceff4>"</span><span style=color:#81a1c1> in</span></span>
<span class=giallo-l><span style=color:#ebcb8b>  start</span><span style=color:#81a1c1>)</span></span>
<span class=giallo-l><span style=color:#88c0d0>    start</span></span>
<span class=giallo-l><span style=color:#81a1c1>    ;;</span></span>
<span class=giallo-l><span style=color:#ebcb8b>  status</span><span style=color:#81a1c1>)</span></span>
<span class=giallo-l><span style=color:#88c0d0>    status</span></span>
<span class=giallo-l><span style=color:#81a1c1>    ;;</span></span>
<span class=giallo-l><span style=color:#616e88>  # ...</span></span>
<span class=giallo-l><span style=color:#81a1c1>esac</span></span></code></pre><p>ã®ã‚ˆã†ã«ãã‚Œãã‚Œã®scriptã§å®Ÿè£…ã—ã¦ã„ã‚‹ã®ã§statusã®å‡ºåŠ›ã«ãªã«ã‹æ±ºã¾ã£ãŸformatãŒã‚ã‚‹ã‚ã‘ã§ã¯ãªã‹ã£ãŸã€‚<p>systemdã®åˆ©ç‚¹ã®ä¸€ã¤ã¨ã—ã¦ã€linux distributionsé–“ã§ã®çµ±ä¸€æ€§ã«ã‚‚è¨€åŠã•ã‚Œã¦ã„ãŸã€‚ç”¨ã¯distroã«é™ã‚‰ãšåŒã˜systemdã®commandã ã‘è¦šãˆã‚Œã°ã‚ˆããªã‚‹ã€‚<br> ã¾ãŸã€processã‚’killã™ã‚‹éš›ã‚‚systemdãŒå¯¾è±¡processã®child processã‚‚è€ƒæ…®ã—ã¦ãã‚Œã‚‹ã®ã§zombieã‚’æ°—ã«ã—ãªãã¦ã‚ˆã„ã€‚<p>securityã¨ã„ã†è¦³ç‚¹ã‹ã‚‰ã‚‚ã€accessã§ãã‚‹directoryã‚’åˆ¶é™ã§ããŸã‚Šã€namespaces, cgroups, capabilitiesã¨ã„ã£ãŸæ©Ÿèƒ½ã‚’åˆ©ç”¨ã§ãã‚‹ã‚ˆã†ã«è¨­è¨ˆã•ã‚Œã¦ã„ã‚‹ã€‚<p>systemdæœ€é«˜..!ã¨ãŠã‚‚ã„ãã‚„ã€systemdã®æ¡ç”¨ã«ã¯è­°è«–ã‚‚ã‚ã£ãŸã€‚<br> ãã®ã²ã¨ã¤ã«systemdã¯å¤šãã‚’è¡Œã„ã™ãã¦ãŠã‚Šã€unixã®conceptã§ã‚ã‚‹ä¸€ã¤ã®ã“ã¨ã‚’ã†ã¾ãã‚„ã‚‹ã«åã—ã¦ã„ã‚‹ã¨ã„ã†ã‚‚ã®ãŒã‚ã£ãŸã€‚<br> ã“ã®ç‚¹ã«ã¤ã„ã¦ã¯ã€ç¢ºã‹ã«init systemã‚’è¶…ãˆã¦ã€networkã‚„bootloader, logging, loginã¾ã§systemdã¯è¡Œãªã£ã¦ã„ã‚‹ãŒã€ã“ã‚Œã‚‰ã¯optionalã§ã‚ã‚‹ã¨åè«–ã•ã‚Œã¦ã„ãŸã€‚<p>systemdã«é–¢ã—ã¦ã¯ã„ã‚ã„ã‚ã¨è­°è«–ã‚‚ã‚ã‚‹ã—ã€å«Œã„ãªäººã‚‚ã„ã‚‹ãŒã€ä¸»è¦ãªdistributionã§ã¯çµå±€æ¡ç”¨ã•ã‚Œã¦ã„ã‚‹ã‚ˆã­ã¨ã„ã†æ„Ÿã˜ã§çµã°ã‚Œã¦ã„ã¾ã—ãŸã€‚<p>ã¨ã„ã£ãŸã‚ˆã†ã«systemdãŒè§£æ±ºã—ã‚ˆã†ã¨ã—ãŸèª²é¡Œã§ã‚ã£ãŸã‚Šã€ç¾åœ¨ã®çŠ¶æ³ãŒæ•´ç†ã•ã‚Œã¦ãŠã‚Šã“ã†ã„ã£ãŸæƒ…å ±ã¯è‡ªåˆ†ã®ã‚ˆã†ãªlinuxå¼±è€…ã«ã¯ã¨ã¦ã‚‚ã‚ã‚ŠãŒãŸã„ã§ã™ã€‚<h2 id=chapter-2-understanding-systemd-directories-and-files><a aria-label="Anchor link for: chapter-2-understanding-systemd-directories-and-files" class=zola-anchor href=#chapter-2-understanding-systemd-directories-and-files>Chapter 2 Understanding systemd Directories and Files</a></h2><p>systemdã«ã‚ˆã£ã¦interfaceã¯çµ±ä¸€ã•ã‚ŒãŸãŒã€distributionsã«ã‚ˆã£ã¦æœ‰åŠ¹ã«ã—ã¦ã„ã‚‹componentã¯é•ã†ã®ã§ãã“ã§å·®ãŒç”Ÿã˜ã‚‹ã€‚<br> ã¨ã„ã†ã‚ã‘ã§è¨­å®šfileã‚’ç¢ºèªã—ã¦ã¿ã‚‹ã€‚<br> NixOSã®<code>/etc/systemd/system.conf</code>ã‚’ç¢ºèªã—ã¦ã¿ãŸã¨ã“ã‚ä»¥ä¸‹ã®å†…å®¹ã ã£ãŸ<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=plain><span class=giallo-l><span>[Manager]</span></span>
<span class=giallo-l><span>ManagerEnvironment=LOCALE_ARCHIVE='/run/current-system/sw/lib/locale/locale-archive' PATH='/nix/store/jq4cqqgggw3x4rl67ib0zs8mbgczhqqg-e2fsprogs-1.47.0-bin/bin:/nix/store/p27k6zns5rrv80326zkv88yfmfw1zb9v-dosfstools-4.2/bin:/nix/store/ixjl0rdryakqci8rf70i6zh0h9qg3c43-util-linux-minimal-2.39.2-bin/bin' TZDIR='/etc/zoneinfo'</span></span>
<span class=giallo-l><span>DefaultCPUAccounting=yes</span></span>
<span class=giallo-l><span>DefaultIOAccounting=yes</span></span>
<span class=giallo-l><span>DefaultBlockIOAccounting=yes</span></span>
<span class=giallo-l><span>DefaultIPAccounting=yes</span></span>
<span class=giallo-l><span>DefaultLimitCORE=infinity</span></span></code></pre><p>ã“ã®è¨­å®šå€¤ã®æ„å‘³ã«ã¤ã„ã¦ã¯<code>man systemd-system.conf</code>ã§èª¿ã¹ã‚‰ã‚Œã‚‹ã€‚<br> <code>ManagerEnvironment</code>ã¯manager processã«setã•ã‚Œã‚‹ç’°å¢ƒå¤‰æ•°ã¨ã®ã“ã¨ã ã£ãŸã€‚ nixã‚‰ã—ãã€<code>PATH</code>ã‚’nix storeã«ã‚€ã‘ã¦ã„ã¦ã€globalã‚’ã¿ãªã„ã¨ã„ã†æ„æ€ã‚’æ„Ÿã˜ã‚‰ã‚Œã‚‹ã€‚<p>ã“ã“ã§systemdã«ãŠã‘ã‚‹unit fileã®æ¦‚è¦ãŒèª¬æ˜ã•ã‚Œã‚‹ã€‚ defaultã§ã¯<code>/lib/systemd/system/</code>é…ä¸‹ã«æ ¼ç´ã•ã‚Œã¦ãŠã‚Šã€å¤‰æ›´ã‚„è¿½åŠ ã—ãŸã„å ´åˆã¯<code>/etc/systemd/system/</code>ã‚’åˆ©ç”¨ã™ã‚‹ã€‚<p>ã“ã‚Œã¯ã©ã†ã—ã¦ã‹ã¨ã„ã†ã¨<code>man systemd.unit</code>ã«æ›¸ã„ã¦ã‚ã‚‹ã‹ã‚‰ã€‚<br> ã“ã®æœ¬ã®ç´ æ™´ã‚‰ã—ã„ç‚¹ã¯æ¦‚è¦ã‚’èª¬æ˜ã—ãŸã®ã¡ã€è©³ã—ã„ã“ã¨ã«ã¤ã„ã¦ã¯èª­ã‚€ã¹ã<code>man systed.*</code>ã‚’æ•™ãˆã¦ãã‚Œã‚‹ã¨ã“ã‚ã ã£ãŸã€‚<br> ç‰¹ã«ã€è¨­å®šfileä¸­ã§ã‚ã‹ã‚‰ãªã„é …ç›®ã¯<code>man systed.directives</code>ã‚’èª¿ã¹ã‚‹ã¨ãã‚ŒãŒã©ã®manã«è¼‰ã£ã¦ã„ã‚‹ã‹æ•™ãˆã¦ãã‚Œã‚‹ã¨ã„ã†ã‚¢ãƒ‰ãƒã‚¤ã‚¹ãŒéå¸¸ã«ã‚ã‚ŠãŒãŸã‹ã£ãŸã€‚<p>ä¾‹ãˆã°ã€serviceã«è¨­å®šã™ã‚‹ç’°å¢ƒå¤‰æ•°ã‚’fileã§æŒ‡å®šã™ã‚‹<code>EnvironmentFile</code>ã«ã¤ã„ã¦ã¯<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=shellscript><span class=giallo-l><span style=color:#88c0d0>man</span><span style=color:#a3be8c> systemd.directives</span><span style=color:#81a1c1> |</span><span style=color:#88c0d0> grep</span><span style=color:#eceff4> '</span><span style=color:#a3be8c>EnvironmentFile=</span><span style=color:#eceff4>'</span><span style=color:#a3be8c> -A</span><span style=color:#b48ead> 2</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span> EnvironmentFile</span><span style=color:#81a1c1>=</span></span>
<span class=giallo-l><span style=color:#88c0d0>           systemd.exec(5</span><span>)</span></span></code></pre><p>ã¨è¡¨ç¤ºã•ã‚Œã€<code>man systemd.exec</code>ã‚’ã¿ã‚Œã°ã‚ˆã„ã“ã¨ãŒã‚ã‹ã‚‹ã€‚<br> ã¾ãŸã€unit fileãŒã©ã®directoryã‹ã‚‰å–å¾—ã•ã‚Œã‚‹ã‹ã¯ã€<code>systemd-analyze unit-paths</code>ã§è¡¨ç¤ºã§ãã‚‹ã“ã¨ã‚‚ã‚ã‹ã£ãŸã€‚<br> stackoverflowã®systemdé–¢é€£ã®å›ç­”ã§ã¯ã“ã®manã®èª¬æ˜ã¨åŒã˜ã“ã¨ãŒèª¬æ˜ã•ã‚Œã¦ã„ãŸå ´åˆãŒçµæ§‹å¤šãã€èª¿ã¹æ–¹ã‚’æ•™ãˆã¦ãã‚Œã‚‹ã®ãŒä¸€ç•ªåŠ©ã‹ã‚‹ã€‚<p>unit fileã¯ä»¥ä¸‹ã®typeã‚’ã‚‚ã£ã¦ã„ã‚‹ã€‚<br> é€†ã«ã„ã†ã¨unit fileã¨ã¯ã“ã‚Œã‚‰ã®è¨­å®šã‚’æŠ½è±¡åŒ–ã—ãŸã‚‚ã®ã¨ã‚‚ã„ãˆã‚‹ã¨æ€ã£ãŸã€‚<ul><li>service<li>socket<li>slice<li>mount<li>target<li>timer<li>path<li>swap</ul><p>systemã§ã©ã‚“ãªunitãŒå‹•ã„ã¦ã„ã‚‹ã‹ã¯<code>systemctl list-units</code>ã§èª¿ã¹ã‚‰ã‚Œã‚‹ã€‚<br> <code>-t</code>ã§typeã‚’æŒ‡å®šã§ããŸã‚Šã€<code>--all</code>ã§æœ‰åŠ¹ã«ã•ã‚Œã¦ã„ãªã„ã‚‚ã®ã‚‚è¡¨ç¤ºã§ãã‚‹<br> ä»–ã«ã‚‚ã„ã‚ã„ã‚ãªä½¿ã„æ–¹ãŒã‚ã‚Šã€ã¨ã¦ã‚‚å‚è€ƒã«ãªã£ãŸã€‚<br> è©³ã—ãã¯<code>systemctl -h</code>ã¨<code>man systemctl</code><h2 id=chapter-3-understanding-service-path-and-socket-units><a aria-label="Anchor link for: chapter-3-understanding-service-path-and-socket-units" class=zola-anchor href=#chapter-3-understanding-service-path-and-socket-units>Chapter 3 Understanding Service, Path, and Socket Units</a></h2><p>Service unitã¯SysVã®init scriptã®å½¹å‰²ã‚’æœãŸã™ã€‚ã¤ã¾ã‚Šdaemonã‚’åˆ¶å¾¡ã™ã‚‹ã€‚<br> è¨­å®šã§ã‚ã‹ã‚‰ãªã„é …ç›®ã¯<code>man systemd.directives</code>ã§èª¿ã¹ã‚‰ã‚Œã‚‹ã€‚<br> <code>[Unit]</code>ã«ã¤ã„ã¦ã¯ã€<code>man systemd.unit</code>ã€<code>[Service]</code>ã«ã¤ã„ã¦ã¯<code>man systemd.service</code>ã§èª¿ã¹ã‚‰ã‚Œã‚‹ã€‚ã¾ãŸã€å®Ÿè¡Œæ™‚ã«å…±é€šã™ã‚‹è©±ã¯<code>man systemd.exec</code>ã«ã‚‚èª¬æ˜ãŒã‚ã‚‹ã€‚<p>httpdã‚„sshd serviceã®å…·ä½“ä¾‹ã‚’ã¿ãªãŒã‚‰ã©ã‚“ãªé …ç›®ãŒã‚ã‚‹ã®ã‹ã®æ¦‚è¦ã‚’èª¬æ˜ã—ã¦ãã‚Œã‚‹ã€‚æœ€åˆã‹ã‚‰manã‚’ã¿ã‚‹ã®ã¯å¤§å¤‰ãªã®ã§ã€èª¬æ˜ãŒã‚ã£ãŸç®‡æ‰€ã®manã‚ãŸã‚Šã‹ã‚‰èª­ã‚“ã§ã„ãã®ãŒè‡ªåˆ†ã«ã¯ã‚ˆã‹ã£ãŸã€‚<p>ã¾ãŸã€<code>systemd-timesyncd</code>ã§ã¯capabilitiesã®è¨­å®šãŒãªã•ã‚Œã¦ãŠã‚Šã€ãã‚Œã«ã¤ã„ã¦ã‚‚èª¬æ˜ãŒã‚ã£ãŸã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=ini><span class=giallo-l><span style=color:#616e88># ...</span></span>
<span class=giallo-l><span style=color:#eceff4>[</span><span>Service</span><span style=color:#eceff4>]</span></span>
<span class=giallo-l><span style=color:#81a1c1>AmbientCapabilities</span><span style=color:#eceff4>=</span><span>CAP_SYS_TIME</span></span>
<span class=giallo-l><span style=color:#81a1c1>CapabilityBoundingSet</span><span style=color:#eceff4>=</span><span>CAP_SYS_TIME</span></span>
<span class=giallo-l><span style=color:#81a1c1>ExecStart</span><span style=color:#eceff4>=</span><span>!!/nix/store/qyxcg96wg1a21sj0sgbaxcapqc1vyq65-systemd-253.6/lib/systemd/systemd-timesyncd</span></span>
<span class=giallo-l><span style=color:#616e88># ...</span></span>
<span class=giallo-l><span style=color:#81a1c1>User</span><span style=color:#eceff4>=</span><span>systemd-timesync</span></span></code></pre><p>è‡ªåˆ†ã§serviceã‚’å®šç¾©ã™ã‚‹éš›ã¯ã€root userã‚’åˆ©ç”¨ã›ãšã«capabilitiesã‚’ã‚»ãƒƒãƒˆã§ãã‚‹ã‚ˆã†ã«ã—ã¦ã„ããŸã„ã€‚<br> (<code>ExecStart=!!</code>ã®<code>!!</code>ã«ã¤ã„ã¦ã¯<code>man systemd.service</code>ã«èª¬æ˜ãŒã‚ã£ãŸ)<p>socket unitã«ã¤ã„ã¦ã‚‚èª¬æ˜ãŒã‚ã‚‹ã€‚<br> ãŒã€ã„ã¾ã„ã¡ä½¿ã„ã©ã“ã‚ãŒã‚ã‹ã£ã¦ã„ãªã„ã€‚<p>path unitã¯ã€æŒ‡å®šã®file pathã®å¤‰æ›´ã‚’ç›£è¦–ã—ã¦ã€å¤‰æ›´ãŒã‚ã£ãŸå ´åˆã«æŒ‡å®šã®serviceã‚’èµ·å‹•ã—ã¦ãã‚Œã‚‹ã‚‚ã®ã¨ã®ã“ã¨ã§ã™ã€‚<br> ã“ã‚Œã‚‚ã„ã¾ã„ã¡ä½¿ã„ã©ã“ã‚ãŒã‚ã‹ã£ã¦ã„ãªã„ã§ã™ã€‚<h2 id=chapter-4-controlling-systemd-services><a aria-label="Anchor link for: chapter-4-controlling-systemd-services" class=zola-anchor href=#chapter-4-controlling-systemd-services>Chapter 4 Controlling systemd Services</a></h2><p><code>systemctl</code>ã®ä½¿ã„æ–¹ã«ã¤ã„ã¦ã®è§£èª¬ãŒã‚ã‚Šã¾ã™ã€‚<br> serviceã‚’serverèµ·å‹•æ™‚ã«èµ·å‹•ã™ã‚‹<code>systemctl enable</code>ã‚’å®Ÿè¡Œã—ãŸéš›ã«ã€<code>/etc/systemd/system/multi-user.target.wants/</code>é…ä¸‹ã«symlinkãŒä½œæˆã•ã‚Œã‚‹ã¨ã„ã£ãŸç‚¹ã‚‚è§£èª¬ã•ã‚Œã¾ã™ã€‚<h2 id=chapter-5-creating-and-editing-services><a aria-label="Anchor link for: chapter-5-creating-and-editing-services" class=zola-anchor href=#chapter-5-creating-and-editing-services>Chapter 5 Creating and Editing Services</a></h2><p>æœ¬ç« ã§ã¯serviceã‚’ã¤ãã‚‹éç¨‹ã®è§£èª¬ãŒã‚ã‚Šã¾ã™ã€‚<br> <code>systemctl edit [--full]</code>ã§æ—¢å­˜ã‚’ç›´æ¥ç·¨é›†ã™ã‚‹ã“ã¨ã‚‚ã§ãã‚‹ã¿ãŸã„ã§ã™ã€‚<p><code>systemd-analyze security opentelemetry-collector</code>ã®ã‚ˆã†ã«å®Ÿè¡Œã™ã‚‹ã¨serviceã®è¨­å®šã®securityçš„ãªè©•ä¾¡ã‚’è¡¨ç¤ºã—ã¦ãã‚Œã¾ã™ã€‚<br> è©¦ã—ã«å®Ÿè¡Œã—ã¦ã¿ãŸã¨ã“ã‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=plain><span class=giallo-l><span>systemd-analyze security opentelemetry-collector</span></span>
<span class=giallo-l><span>  NAME                                                        DESCRIPTION                                                             EXPOSURE</span></span>
<span class=giallo-l><span>âœ— RemoveIPC=                                                  Service user may leave SysV IPC objects around                               0.1</span></span>
<span class=giallo-l><span>âœ— RootDirectory=/RootImage=                                   Service runs within the host's root directory                                0.1</span></span>
<span class=giallo-l><span>âœ“ User=/DynamicUser=                                          Service runs under a static non-root user identity</span></span>
<span class=giallo-l><span>âœ— CapabilityBoundingSet=~CAP_SYS_TIME                         Service processes may change the system clock                                0.2</span></span>
<span class=giallo-l><span>âœ“ NoNewPrivileges=                                            Service processes cannot acquire new privileges</span></span>
<span class=giallo-l><span>âœ“ AmbientCapabilities=                                        Service process does not receive ambient capabilities</span></span>
<span class=giallo-l><span># ...</span></span></code></pre><p>ä¸Šè¨˜ã®ã‚ˆã†ãªå‡ºåŠ›ã‚’å¾—ã¾ã—ãŸã€‚<br> è¨­å®šfileã®æ”¹å–„ã®ä½™åœ°ãŒã‚ã‚Šãã†ã§ã™ã€‚<p>ã¾ãŸã€podmanã‚’ä½¿ã£ã¦æ–°ã—ã„serviceã‚’ä½œã‚‹ä¾‹ã‚‚è§£èª¬ã•ã‚Œã¦ã„ã¾ã™ã€‚<br> kubernetesã®ã‚ˆã†ãªcontainer orchestrationä½¿ã†ã»ã©ã§ã‚‚ãªã„å ´åˆã¯systemdã®serviceã‹ã‚‰containerèµ·å‹•ã™ã‚‹ã§ã„ã„ã‹ã‚‚ã¨æ€ã£ã¦ã—ã¾ã„ã¾ã—ãŸã€‚<h2 id=chapter-6-understanding-systemd-targets><a aria-label="Anchor link for: chapter-6-understanding-systemd-targets" class=zola-anchor href=#chapter-6-understanding-systemd-targets>Chapter 6 Understanding systemd Targets</a></h2><p>targetã«ã¤ã„ã¦ã€‚<br> targetã¨ã¯ãªã«ã‹ã¨ã„ã†ã¨<blockquote><p>In systemd, a target is a unit that groups together other systemd units for a particular purpose. The units that a target can group together include services, paths, mount points, sockets, and even other targets.</blockquote><p><a href="https://learning.oreilly.com/library/view/linux-service-management/9781801811644/B17491_06_Final_NM_ePub.xhtml#:-:text=In%20systemd%2C%20a,even%20other%20targets." rel=external>link</a><p>ã¨ã„ã†ã“ã¨ã§ã€ä»–ã®serviceã‚„pathã¨ã„ã£ãŸunitã‚’ã¾ã¨ã‚ã‚‹å½¹å‰²ã‚’æœãŸã™ã®ãŒtargetã¨ã„ã†ã“ã¨ã§ã™ã€‚<p><code>systemctl list-units -t target</code>ã§ç¢ºèªã§ãã¾ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=shellscript><span class=giallo-l><span style=color:#88c0d0> systemctl</span><span style=color:#a3be8c> list-units -t target</span></span>
<span class=giallo-l><span style=color:#88c0d0>  UNIT</span><span style=color:#a3be8c>                      LOAD   ACTIVE SUB    DESCRIPTION</span></span>
<span class=giallo-l><span style=color:#88c0d0>  basic.target</span><span style=color:#a3be8c>              loaded active active Basic System</span></span>
<span class=giallo-l><span style=color:#88c0d0>  cryptsetup.target</span><span style=color:#a3be8c>         loaded active active Local Encrypted Volumes</span></span>
<span class=giallo-l><span style=color:#88c0d0>  getty.target</span><span style=color:#a3be8c>              loaded active active Login Prompts</span></span>
<span class=giallo-l><span style=color:#88c0d0>  local-fs-pre.target</span><span style=color:#a3be8c>       loaded active active Preparation for Local File Systems</span></span>
<span class=giallo-l><span style=color:#88c0d0>  local-fs.target</span><span style=color:#a3be8c>           loaded active active Local File Systems</span></span>
<span class=giallo-l><span style=color:#88c0d0>  machines.target</span><span style=color:#a3be8c>           loaded active active Containers</span></span>
<span class=giallo-l><span style=color:#88c0d0>  multi-user.target</span><span style=color:#a3be8c>         loaded active active Multi-User System</span></span>
<span class=giallo-l><span style=color:#616e88>  # ...</span></span></code></pre><p><code>strings systemd | grep '\.target'</code>ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã§ã„ãã¤ã‹ã®targetã¯systemdã®sourceã«ç›´æ¥å®šç¾©ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚‚ã‚ã‹ã‚Šã¾ã—ãŸã€‚<br> ãŸã ã€æ‰‹å…ƒã®NixOSã§å®Ÿè¡Œã—ã¦ã¿ãŸã¨ã“ã‚ã€æœ¬æ–‡ã‚ˆã‚Šå‡ºåŠ›ã•ã‚Œã‚‹targetãŒå°‘ãªã‹ã£ãŸã§ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=shellscript><span class=giallo-l><span style=color:#88c0d0> strings</span><span style=color:#a3be8c>  /nix/store/410cjrblagp3kbzlfwn6qxxn5m663jg5-systemd-253.3/lib/systemd/systemd</span><span style=color:#81a1c1> |</span><span style=color:#88c0d0>rg</span><span style=color:#eceff4> '</span><span style=color:#a3be8c>\.target</span><span style=color:#eceff4>'</span></span>
<span class=giallo-l><span style=color:#88c0d0>initrd.target</span></span>
<span class=giallo-l><span style=color:#88c0d0>default.target</span></span>
<span class=giallo-l><span style=color:#88c0d0>rescue.target</span><span style=color:#a3be8c> masked</span></span>
<span class=giallo-l><span style=color:#88c0d0>Failed</span><span style=color:#a3be8c> to load rescue.target</span></span>
<span class=giallo-l><span style=color:#88c0d0>Falling</span><span style=color:#a3be8c> back to default.target.</span></span>
<span class=giallo-l><span style=color:#88c0d0>Falling</span><span style=color:#a3be8c> back to rescue.target.</span></span></code></pre><p><code>man systemd.special</code>ã«systemdã«ç‰¹åˆ¥æ‰±ã„ã•ã‚Œã‚‹targetã®èª¬æ˜ã‚‚ã‚ã‚Šã¾ã™ã€‚<p>ã¾ãŸã€SysV initã®runlevelã¨systemd targetã®æ¯”è¼ƒã‚‚å‚è€ƒã«ãªã‚Šã¾ã—ãŸã€‚<p>targeté–“ã®ä¾å­˜é–¢ä¿‚ã®visualizeã«ã¯<br> <code>systemd-analyze dot default.target | dot -Tsvg out> /tmp/target.svg</code><br> ãŒä¾¿åˆ©ã§ã—ãŸã€‚<h2 id=chapter-7-understanding-systemd-timers><a aria-label="Anchor link for: chapter-7-understanding-systemd-timers" class=zola-anchor href=#chapter-7-understanding-systemd-timers>Chapter 7 Understanding systemd Timers</a></h2><p>systemd timerã‚’ä½¿ã†ã“ã¨ã§cronã®ã‚ˆã†ãªschedulingå‡¦ç†ãŒã§ãã‚‹ã€‚<p>NixOSä¸Šã§æœ‰åŠ¹ãªtimerã‚’ç¢ºèªã—ãŸã¨ã“ã‚ã€logrotationã¨tmpfileã®cleanå‡¦ç†ãŒèµ·å‹•ã—ã¦ã„ãŸã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=shellscript><span class=giallo-l><span style=color:#88c0d0>$</span><span style=color:#a3be8c> systemctl list-units -t timer</span></span>
<span class=giallo-l><span style=color:#88c0d0>  UNIT</span><span style=color:#a3be8c>                         LOAD   ACTIVE SUB     DESCRIPTION</span></span>
<span class=giallo-l><span style=color:#88c0d0>  logrotate.timer</span><span style=color:#a3be8c>              loaded active waiting logrotate.timer</span></span>
<span class=giallo-l><span style=color:#88c0d0>  systemd-tmpfiles-clean.timer</span><span style=color:#a3be8c> loaded active waiting Daily Cleanup of Temporary Directories</span></span></code></pre><p>systemdã§timerã‚’åˆ©ç”¨ã—ã¦å‡¦ç†ã‚’schedulingã™ã‚‹ã«ã¯ã€ã¾ãštimer unitã‚’ä½œæˆã—ã¦ãã“ã‹ã‚‰service unitã‚’èµ·å‹•ã™ã‚‹ã¨ã„ã†æ§‹æˆã«ã™ã‚‹ã‚‰ã—ã„ã€‚<p>ã¨ã„ã†ã“ã¨ã§ã€logroate.timerã‚’ç¢ºèªã—ã¦ã¿ã‚‹ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=ini><span class=giallo-l><span>$ systemctl cat logrotate.timer</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#616e88># /etc/systemd/system/logrotate.timer</span></span>
<span class=giallo-l><span style=color:#eceff4>[</span><span>Unit</span><span style=color:#eceff4>]</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#eceff4>[</span><span>Timer</span><span style=color:#eceff4>]</span></span>
<span class=giallo-l><span style=color:#81a1c1>OnCalendar</span><span style=color:#eceff4>=</span><span>hourly</span></span></code></pre><p>èµ·å‹•ã™ã‚‹å‡¦ç†ãŒæŒ‡å®šã•ã‚Œã¦ã„ãªã„ãŒã€<code>man systemd.timer</code>ã«ã‚ˆã‚‹ã¨<blockquote><p>For each timer file, a matching unit file must exist, describing the unit to activate when the timer elapses. By default, a service by the same name as the timer (except for the suffix) is activated. Example: a timer file foo.timer activates a matching service foo.service.</blockquote><p>ã¨ã„ã†ã“ã¨ã§ã€<code>logrotate.timer</code>ã¯<code>logrotate.service</code>ã‚’èµ·å‹•ã™ã‚‹ã‚ˆã†ã ã£ãŸã€‚<p><code>OnCalendar=hourly</code>ã¨æŒ‡å®šã—ãŸå ´åˆã€å…·ä½“çš„ã«ã„ã¤å®Ÿè¡Œã•ã‚Œã‚‹ã‹ã¯<code>man systemd.time</code>ã®<code>CALENDAR EVENTS</code>ã«èª¬æ˜ãŒã‚ã‚Šã€<code>hourly â†’ *-*-* *:00:00</code>ã¨è§£é‡ˆã•ã‚Œã‚‹ã‚ˆã†ã ã£ãŸã€‚<p><code>AccuracySec=1h</code>ã®ã‚ˆã†ã«ã©ã®ç¨‹åº¦schedulingã•ã‚ŒãŸæ™‚é–“ã«å¯¾ã—ã¦ç²¾åº¦ã‚’è¦æ±‚ã™ã‚‹ã‹ã‚‚æŒ‡å®šã§ãã‚‹ã€‚manã«ã‚ˆã‚‹ã¨æ¶ˆè²»é›»åŠ›ã‚’æœ€é©åŒ–ã™ã‚‹ãŸã‚ã«ã§ãã‚‹ã ã‘å¤§ãã„å€¤ã‚’è¨­å®šã—ã¦ãŠãã®ãŒæœ›ã¾ã—ã„ã‚‰ã—ã„ã€‚<p>ã¾ãŸã€<code>Persistent=true</code>ã§schedulingã•ã‚ŒãŸæœŸé–“ã«é›»æºãŒoffã ã£ãŸå ´åˆã€èµ·å‹•æ™‚ã«å®Ÿè¡Œã™ã‚‹ã‹ã‚‚åˆ¶å¾¡ã§ããã†ã ã£ãŸã€‚<p><code>Nice=</code>,<code>IOSchedulingClass=</code>,<code>SchedulingPriority</code>ç­‰ã§ã€å®Ÿè¡Œã™ã‚‹serviceã®å„ªå…ˆåº¦ã‚‚æŒ‡å®šã§ããã†ã ã£ãŸã®ã§ã€è¨­å®šã™ã‚‹éš›ã¯èª¿ã¹ã¦ãŠããŸã„ã€‚<h2 id=chapter-8-understanding-the-systemd-boot-process><a aria-label="Anchor link for: chapter-8-understanding-the-systemd-boot-process" class=zola-anchor href=#chapter-8-understanding-the-systemd-boot-process>Chapter 8 Understanding the systemd Boot Process</a></h2><p>systemdã®bootæ™‚ã®æŒ™å‹•ã«ã¤ã„ã¦ã€‚<br> <code>default.target</code>ãŒèµ·å‹•ã®å¯¾è±¡ã¨ãªã‚Šã€ãã®ä¾å­˜é–¢ä¿‚ãŒè§£æ±ºã•ã‚Œã¦ã„ãã€‚ <code>default.target</code>ã¯å¤§æŠµã€<code>graphical.target</code>ã‹<code>multi-user.target</code>ã¸ã®symlinkã«ãªã£ã¦ã„ã‚‹ã€‚<br> <code>man systemd.special</code>ã‚„<code>man bootup</code>ã«ã‚‚è§£èª¬ãŒã‚ã‚‹ã€‚<p><code>man bootup</code>ã®ã“ã®å›³ãŒã‚ã‹ã‚Šã‚„ã™ã‹ã£ãŸã€‚ã€€<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=plain><span class=giallo-l><span>                                       cryptsetup-pre.target veritysetup-pre.target                                                             |</span></span>
<span class=giallo-l><span>           (various low-level                                v</span></span>
<span class=giallo-l><span>            API VFS mounts:             (various cryptsetup/veritysetup devices...)</span></span>
<span class=giallo-l><span>            mqueue, configfs,                                |    |</span></span>
<span class=giallo-l><span>            debugfs, ...)                                    v    |</span></span>
<span class=giallo-l><span>            |                                  cryptsetup.target  |</span></span>
<span class=giallo-l><span>            |  (various swap                                 |    |    remote-fs-pre.target</span></span>
<span class=giallo-l><span>            |   devices...)                                  |    |     |        |</span></span>
<span class=giallo-l><span>            |    |                                           |    |     |        v</span></span>
<span class=giallo-l><span>            |    v                       local-fs-pre.target |    |     |  (network file systems)</span></span>
<span class=giallo-l><span>            |  swap.target                       |           |    v     v                 |</span></span>
<span class=giallo-l><span>            |    |                               v           |  remote-cryptsetup.target  |</span></span>
<span class=giallo-l><span>            |    |  (various low-level  (various mounts and  |  remote-veritysetup.target |</span></span>
<span class=giallo-l><span>            |    |   services: udevd,    fsck services...)   |             |              |</span></span>
<span class=giallo-l><span>            |    |   tmpfiles, random            |           |             |    remote-fs.target</span></span>
<span class=giallo-l><span>            |    |   seed, sysctl, ...)          v           |             |              |</span></span>
<span class=giallo-l><span>            |    |      |                 local-fs.target    |             | _____________/</span></span>
<span class=giallo-l><span>            |    |      |                        |           |             |/</span></span>
<span class=giallo-l><span>            \____|______|_______________   ______|___________/             |</span></span>
<span class=giallo-l><span>                                        \ /                                |</span></span>
<span class=giallo-l><span>                                         v                                 |</span></span>
<span class=giallo-l><span>                                  sysinit.target                           |</span></span>
<span class=giallo-l><span>                                         |                                 |</span></span>
<span class=giallo-l><span>                  ______________________/|\_____________________           |</span></span>
<span class=giallo-l><span>                 /              |        |      |               \          |</span></span>
<span class=giallo-l><span>                 |              |        |      |               |          |</span></span>
<span class=giallo-l><span>                 v              v        |      v               |          |</span></span>
<span class=giallo-l><span>            (various       (various      |  (various            |          |</span></span>
<span class=giallo-l><span>             timers...)      paths...)   |   sockets...)        |          |</span></span>
<span class=giallo-l><span>                 |              |        |      |               |          |</span></span>
<span class=giallo-l><span>                 v              v        |      v               |          |</span></span>
<span class=giallo-l><span>           timers.target  paths.target   |  sockets.target      |          |</span></span>
<span class=giallo-l><span>                 |              |        |      |               v          |</span></span>
<span class=giallo-l><span>                 v              \_______ | _____/         rescue.service   |</span></span>
<span class=giallo-l><span>                                        \|/                     |          |</span></span>
<span class=giallo-l><span>                                         v                      v          |</span></span>
<span class=giallo-l><span>                                     basic.target         rescue.target    |</span></span>
<span class=giallo-l><span>                                         |                                 |</span></span>
<span class=giallo-l><span>                                 ________v____________________             |</span></span>
<span class=giallo-l><span>                                /              |              \            |</span></span>
<span class=giallo-l><span>                                |              |              |            |</span></span>
<span class=giallo-l><span>                                v              v              v            |</span></span>
<span class=giallo-l><span>                            display-    (various system   (various system  |</span></span>
<span class=giallo-l><span>                        manager.service     services        services)      |</span></span>
<span class=giallo-l><span>                                |         required for        |            |</span></span>
<span class=giallo-l><span>                                |        graphical UIs)       v            v</span></span>
<span class=giallo-l><span>                                |              |            multi-user.target</span></span>
<span class=giallo-l><span>           emergency.service    |              |              |</span></span>
<span class=giallo-l><span>                   |            \_____________ | _____________/</span></span>
<span class=giallo-l><span>                   v                          \|/</span></span>
<span class=giallo-l><span>           emergency.target                    v</span></span>
<span class=giallo-l><span>                                       graphical.target</span></span></code></pre><p>ã“ã“ã§ã‚‚<code>systemd-analyze</code>ãŒç™»å ´ã™ã‚‹ã€‚<br> å¼•æ•°ã‚’ã¤ã‘ãªã„ã¨<code>systemd-analyze time</code>ãŒå®Ÿè¡Œã•ã‚Œèµ·å‹•æ™‚ã®å®Ÿè¡Œæ™‚é–“ã‚’å‡ºåŠ›ã—ã¦ãã‚Œã‚‹ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=shellscript><span class=giallo-l><span style=color:#616e88># æ‰‹å…ƒã®laptop</span></span>
<span class=giallo-l><span style=color:#81a1c1>></span><span> systemd-analyze</span></span>
<span class=giallo-l><span style=color:#88c0d0>Startup</span><span style=color:#a3be8c> finished in 5.128s</span><span> (firmware) + 5.824s (</span><span style=color:#88c0d0>loader</span><span>) + 2.590s (</span><span style=color:#88c0d0>kernel</span><span>) + 7.575s (</span><span style=color:#88c0d0>userspace</span><span>) = 21.118s</span></span>
<span class=giallo-l><span style=color:#88c0d0>graphical.target</span><span style=color:#a3be8c> reached after 7.551s in userspace.</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#616e88># raspi</span></span>
<span class=giallo-l><span style=color:#88c0d0>$</span><span style=color:#a3be8c> systemd-analyze</span></span>
<span class=giallo-l><span style=color:#88c0d0>Startup</span><span style=color:#a3be8c> finished in 5.496s</span><span> (kernel) + 33.766s (</span><span style=color:#88c0d0>userspace</span><span>) = 39.263s</span></span>
<span class=giallo-l><span style=color:#88c0d0>multi-user.target</span><span style=color:#a3be8c> reached after 33.766s in userspace.</span></span></code></pre><p>ã•ã‚‰ã«<code>systemd-analyze blame</code>ã§ä½•ã«æ™‚é–“ã‚’è¦ã—ã¦ã„ã‚‹ã‹ã‚‚ã‚ã‹ã‚‹ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=shellscript><span class=giallo-l><span style=color:#88c0d0>$</span><span style=color:#a3be8c> systemd-analyze blame</span></span>
<span class=giallo-l><span style=color:#88c0d0>30.169s</span><span style=color:#a3be8c> dhcpcd.service</span></span>
<span class=giallo-l><span style=color:#88c0d0> 1.646s</span><span style=color:#a3be8c> mount-pstore.service</span></span>
<span class=giallo-l><span style=color:#88c0d0> 1.220s</span><span style=color:#a3be8c> firewall.service</span></span>
<span class=giallo-l><span style=color:#616e88> # ...</span></span></code></pre><p>æ‰‹å…ƒã®raspiã®å ´åˆã€dhcpé–¢é€£ã§æ™‚é–“ãŒã‹ã‹ã£ã¦ã„ã‚‹ã‚ˆã†ã ã£ãŸã€‚<br> <code>systemd-analyze critical-chain</code>ã¨ã„ã†ã®ã‚‚ã‚ã‚Šã€å®Ÿè¡Œã—ã¦ã¿ãŸã¨ã“ã‚ä»¥ä¸‹ã®å‡ºåŠ›ã‚’ãˆãŸã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=shellscript><span class=giallo-l><span style=color:#88c0d0>systemd-analyze</span><span style=color:#a3be8c> critical-chain</span></span>
<span class=giallo-l><span style=color:#88c0d0>The</span><span style=color:#a3be8c> time when unit became active or started is printed after the</span><span style=color:#eceff4> "</span><span style=color:#a3be8c>@</span><span style=color:#eceff4>"</span><span style=color:#a3be8c> character.</span></span>
<span class=giallo-l><span style=color:#88c0d0>The</span><span style=color:#a3be8c> time the unit took to start is printed after the</span><span style=color:#eceff4> "</span><span style=color:#a3be8c>+</span><span style=color:#eceff4>"</span><span style=color:#a3be8c> character.</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#88c0d0>multi-user.target</span><span style=color:#a3be8c> @33.766s</span></span>
<span class=giallo-l><span style=color:#88c0d0>â””â”€network-online.target</span><span style=color:#a3be8c> @33.765s</span></span>
<span class=giallo-l><span style=color:#88c0d0>  â””â”€network.target</span><span style=color:#a3be8c> @3.106s</span></span>
<span class=giallo-l><span style=color:#88c0d0>    â””â”€network-pre.target</span><span style=color:#a3be8c> @2.822s</span></span>
<span class=giallo-l><span style=color:#88c0d0>      â””â”€firewall.service</span><span style=color:#a3be8c> @964ms +1.220s</span></span>
<span class=giallo-l><span style=color:#88c0d0>        â””â”€systemd-journald.socket</span><span style=color:#a3be8c> @764ms</span></span>
<span class=giallo-l><span style=color:#88c0d0>          â””â”€system.slice</span><span style=color:#a3be8c> @726ms</span></span>
<span class=giallo-l><span style=color:#88c0d0>            â””â”€-.slice</span><span style=color:#a3be8c> @726ms</span></span></code></pre><p><code>blame</code>ã ã¨dhcpãŒé…ãã†ã ã£ãŸãŒã€ãã†ã„ã†ã‚ã‘ã§ã‚‚ãªã„ã®ã ã‚ã†ã‹ã€‚manã‚’ã‚‚ã†å°‘ã—èª­ã‚“ã§è¦‹æ–¹ã‚’ç†è§£ã—ãŸã„ã€‚<p>ã¾ãŸã€systemd generatorã®è§£èª¬ã‚‚ã‚ã‚Šã¾ã—ãŸã€‚<h2 id=chapter-9-setting-system-parameters><a aria-label="Anchor link for: chapter-9-setting-system-parameters" class=zola-anchor href=#chapter-9-setting-system-parameters>Chapter 9 Setting System Parameters</a></h2><p>systemã®è¨­å®šã«ã¾ã¤ã‚ã‚‹è©±ã€‚<br> ä»¥ä¸‹ã®è§£èª¬ãŒã‚ã‚Šã¾ã™ã€‚<ul><li>localeã‚’åˆ¶å¾¡ã§ãã‚‹<code>localectl</code><li>timezoneé–¢é€£ã®<code>timedatectl</code><li>hostnameé–¢é€£ã®<code>hostnamectl</code></ul><p>ã“ã®æ‰‹ã®è©±ã‚‚linuxå¼±è€…ã®è‡ªåˆ†ã«ã¯éå¸¸ã«ã‚ã‚ŠãŒãŸã„ã§ã™ã€‚<h2 id=chapter-10-understanding-shutdown-and-reboot-commands><a aria-label="Anchor link for: chapter-10-understanding-shutdown-and-reboot-commands" class=zola-anchor href=#chapter-10-understanding-shutdown-and-reboot-commands>Chapter 10 Understanding Shutdown and Reboot Commands</a></h2><p>systemdã®shutdownã¯<code>systemctl poweroff</code>ã§å®Ÿè¡Œã§ãã‚‹ã€‚<br> <code>man systemctl</code>ã®poweroffã®èª¬æ˜ã«ã‚ˆã‚‹ã¨ã“ã®commandã¯<code>systemctl start poweroff.target --job-mode=replace-irreversibly --no-block</code>ã¨ã»ã¼åŒã˜ã‚‰ã—ã„ã€‚<p>rebootã¯<code>systemctl reboot</code>ã€‚ã“ã¡ã‚‰ã‚‚åŒæ§˜ã«å®Ÿéš›ã«ã¯reboot.targetã®èµ·å‹•ã«ãªã£ã¦ã„ã‚‹ã€‚<p>ã¾ãŸã€<code>shutdown</code>ã‚³ãƒãƒ³ãƒ‰ã‚‚systemctlã¸ã®symlinkã«ãªã£ã¦ã„ã‚‹ã“ã¨ãŒã‚ã‹ã£ãŸã€‚ãŸã ã€<code>systemctl now</code>ã‚’å®Ÿè¡Œã—ã¦ã‚‚shutdownãŒå®Ÿè¡Œã•ã‚Œã‚‹ã‚ã‘ã§ã¯ãªã„ã®ã§ã€ãŠãã‚‰ãsystemctlå´ã§ã€è‡ªèº«ã®å®Ÿè¡Œcommandã‚’å–å¾—ã—ã¦ã€shutdownã¨ã—ã¦æŒ¯ã‚‹èˆã†ã‚ˆã†ãªå‡¦ç†ãŒã‚ã‚‹ã®ã§ã¯ã¨æ€ã‚ã‚Œã‚‹ã€‚<p>systemdã®targetã®ä»•çµ„ã¿ã‚’åˆ©ç”¨ã—ã¦ã€çµ‚äº†æ™‚ã«å®Ÿè¡Œã—ãŸã„å‡¦ç†ã‚’å®šç¾©ã™ã‚‹ä¾‹ã‚‚ã®ã£ã¦ã„ã‚‹ã€‚<h2 id=chapter-11-understanding-cgroups-version-1><a aria-label="Anchor link for: chapter-11-understanding-cgroups-version-1" class=zola-anchor href=#chapter-11-understanding-cgroups-version-1>Chapter 11 Understanding cgroups Version 1</a></h2><p>systemdã¨cgroupã«ã¤ã„ã¦ã€‚ cgroupã®æ­´å²ã«ã¤ã„ã¦ã‚‚èª¬æ˜ã—ã¦ãã‚Œã¾ã™ã€‚ åŸ·ç­†æ™‚ç‚¹(2021)ã§ã¯Fedora, Arch, Debian, Ubuntu 21.10ãŒcgroup v2ã‚’åˆ©ç”¨ã—ã¦ã„ã‚‹ãã†ã§ã™ã€‚<p>cgroupã‚’ç”¨ã„ã‚‹ã“ã¨ã§systemç®¡ç†è€…ã¯ä¾‹ãˆã°ä»¥ä¸‹ã®ã“ã¨ãŒã§ãã‚‹ã€‚<ul><li>resourceã®ä½¿ç”¨ã‚’userã‚„processå˜ä½ã§è¡Œãˆã‚‹<li>multi-tenantã®ã‚ˆã†ãªã‚·ã‚¹ãƒ†ãƒ ã«ãŠã„ã¦billingã®ãŸã‚ã®æ­£ç¢ºãªresourceã®åˆ©ç”¨é‡ã‚’è¿½è·¡ã§ãã‚‹<li>å®Ÿè¡Œä¸­ã®processã‚’éš”é›¢ã§ãã‚‹<li>processã‚’åŒã˜CPUã§å®Ÿè¡Œã™ã‚‹ã“ã¨ã§performanceã‚’å‘ä¸Š</ul><p><code>systemd-cgls</code>ã§systemã§å®Ÿè¡Œä¸­ã®cgroupã‚’è¡¨ç¤ºã§ãã‚‹ã€‚<h2 id=chapter-12-controlling-resource-usage-with-cgroups-version-1><a aria-label="Anchor link for: chapter-12-controlling-resource-usage-with-cgroups-version-1" class=zola-anchor href=#chapter-12-controlling-resource-usage-with-cgroups-version-1>Chapter 12 Controlling Resource Usage with cgroups Version 1</a></h2><p>æœ¬ç« ã§ã¯å®Ÿéš›ã«cgroupã®controllerã‚’åˆ©ç”¨ã—ã¦ã€cpuã‚„memoryå‰²å½“ã‚’å¤‰ãˆã¦ã¿ã‚‹ä¾‹ãŒè§£èª¬ã•ã‚Œã¾ã™ã€‚<h2 id=chapter-13-understanding-cgroup-version-2><a aria-label="Anchor link for: chapter-13-understanding-cgroup-version-2" class=zola-anchor href=#chapter-13-understanding-cgroup-version-2>Chapter 13 Understanding cgroup Version 2</a></h2><p>æœ¬ç« ã§ã¯cgroup Version 2ã«ã¤ã„ã¦æ‰±ã„ã¾ã™ã€‚<br> ã¡ãªã¿ã«cgroup<strong>s</strong> Version 1ã¨cgroup Version 2ã¯æ„å›³çš„ãªå¤‰æ›´ã®ã‚ˆã†ã§ã™ã€‚<br> cgroupé›£ã—ã„ã€‚<h2 id=chapter-14-using-journald><a aria-label="Anchor link for: chapter-14-using-journald" class=zola-anchor href=#chapter-14-using-journald>Chapter 14 Using journald</a></h2><p>æœ¬ç« ã§ã¯journald,journalctlã®èª¬æ˜ã‚’ã—ã¦ãã‚Œã¾ã™ã€‚<br> journaldã¨rsyslogã®æ¯”è¼ƒã®è©±ã¯å‹‰å¼·ã«ãªã‚Šã¾ã—ãŸã€‚æœ¬æ›¸åŸ·ç­†æ™‚ç‚¹(2021)ã§ã¯ã€journaldã«å®Œå…¨ç§»è¡Œã—ãŸdistroã¯ãªã„ãã†ã§ã€journaldã¨rsyslogãŒä¸¦è¡Œç¨¼åƒã—ã¦ã„ã‚‹ã®ãŒå®Ÿæƒ…ã®ã‚ˆã†ã§ã—ãŸã€‚<p><code>journalctl --disk-usage</code>ã§logã®diskä½¿ç”¨é‡ã¿ã‚ŒãŸã‚Šã™ã‚‹ã®ã‚‚çŸ¥ã‚‰ãªã‹ã£ãŸã®ã§ã€<code>man journald.conf</code>ã¨<code>man journalctl</code>ã‚’èª­ã¾ãªã„ã¨ã ã‚ã ãªã¨æ€ã„ã¾ã—ãŸã€‚<p><code>journalctl --flush</code>ã—ã¦ã€<code>journalctl --rotate --vacuum-time=5d</code>ã®ã‚ˆã†ã«ã—ã¦logã‚’rotateã•ã‚Œã‚‹æ–¹æ³•ç­‰ã«ã¤ã„ã¦ã‚‚è§£èª¬ã•ã‚Œã¦ã„ã¾ã™ã€‚ <code>journalctl</code>ã«ã¤ã„ã¦ã‚‚ã„ã‚ã„ã‚ãªä½¿ã„æ–¹ã®å…·ä½“ä¾‹ãŒã®ã£ã¦ã„ã‚‹ã®ã§ã€ä¸€åº¦èª­ã‚“ã å¾Œmanèª­ã‚€ã¨ã ã„ã¶ä½¿ã„æ–¹ãŒã‚ã‹ã‚Šãã†ã§ã™ã€‚<p>è‡ªåˆ†ã¯ã‚‚ã£ã±ã‚‰ã€<code>journalctl -u opentelemetry-collector -f</code>ã®ã‚ˆã†ãªæ„Ÿã˜ã§serviceã”ã¨ã®logã®è¦‹æ–¹ãŒã‚ã‹ã£ãŸã ã‘ã§å¤§å¤‰åŠ©ã‹ã‚Šã¾ã—ãŸã€‚<br> logãŒã©ã“ã«å‡ºåŠ›ã•ã‚Œã‚‹ã®ã‹ã‚’ãã«ã—ãªãã¦ã„ã„ã®ãŒè‰¯ã„ã§ã™ã­ã€‚<h2 id=chapter-15-using-systemd-networkd-and-systemd-resolved><a aria-label="Anchor link for: chapter-15-using-systemd-networkd-and-systemd-resolved" class=zola-anchor href=#chapter-15-using-systemd-networkd-and-systemd-resolved>Chapter 15 Using systemd-networkd and systemd-resolved</a></h2><p>networkdã¨resolvedã®æ¦‚è¦ã«ã¤ã„ã¦ã€‚<br> ubuntuã®netplanã®èª¬æ˜ã‚„networkctl, resolvectlã®ä½¿ã„æ–¹ã®èª¬æ˜ã‚‚ã‚ã‚Šã¾ã™ã€‚<h2 id=chapter-16-understanding-timekeeping-with-systemd><a aria-label="Anchor link for: chapter-16-understanding-timekeeping-with-systemd" class=zola-anchor href=#chapter-16-understanding-timekeeping-with-systemd>Chapter 16 Understanding Timekeeping with systemd</a></h2><p>Network Time Protocol(NTP)ã«ã¤ã„ã¦ã€‚<br> systemd-timesyncdã ã‘ã§ãªãã€ntpdã‚„chronyã«ã¤ã„ã¦ã®æ¦‚è¦ã®èª¬æ˜ã‚‚ã‚ã‚Šã¾ã™ã€‚<p>NixOSã ã¨<code>/etc/systemd/timesyncd.conf</code>ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«è¨­å®šã•ã‚Œã¦ã„ã¾ã—ãŸã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=ini><span class=giallo-l><span style=color:#eceff4>[</span><span>Time</span><span style=color:#eceff4>]</span></span>
<span class=giallo-l><span style=color:#81a1c1>NTP</span><span style=color:#eceff4>=</span><span>0.nixos.pool.ntp.org 1.nixos.pool.ntp.org 2.nixos.pool.ntp.org 3.nixos.pool.ntp.org</span></span></code></pre><h2 id=chapter-17-understanding-systemd-and-bootloaders><a aria-label="Anchor link for: chapter-17-understanding-systemd-and-bootloaders" class=zola-anchor href=#chapter-17-understanding-systemd-and-bootloaders>Chapter 17 Understanding systemd and Bootloaders</a></h2><p>systemd-bootã«ã¤ã„ã¦ã€‚systemd-boot<strong>d</strong>ã§ã¯ãªã„ã€‚<br> systemd-bootã®è©±ã«å…¥ã‚‹å‰ã«GRUB2ã«ã¤ã„ã¦ã®è§£èª¬ã‚‚ã‚ã‚Šã‚ã‚ŠãŒãŸã„ã€‚<h2 id=chapter-18-understanding-systemd-logind><a aria-label="Anchor link for: chapter-18-understanding-systemd-logind" class=zola-anchor href=#chapter-18-understanding-systemd-logind>Chapter 18 Understanding systemd-logind</a></h2><p>systemdãŒloginã¾ã§ç®¡ç†ã™ã‚‹ã®ã¯cgroupã¨é–¢é€£ã™ã‚‹ã‹ã‚‰ã¨ã„ã†è©±ã€‚<br> loginctlã‚„polkitã®èª¬æ˜ã‚‚ã‚ã‚Šã¾ã™ã€‚<h2 id=matome><a aria-label="Anchor link for: matome" class=zola-anchor href=#matome>ã¾ã¨ã‚</a></h2><p>ç°¡å˜ã«ã§ã™ãŒæ„Ÿæƒ³ã‚’æ›¸ã„ã¦ã¿ã¾ã—ãŸã€‚<br> å½“åˆã¯Raspberry Piã§NixOSã‚’å‹•ã‹ã™éš›ã«ã€<a href="https://search.nixos.org/options?channel=23.05&from=0&size=50&sort=relevance&type=packages&query=systemd.services" rel=external>systemd.services</a>ã®è¨­å®šã‚’ç†è§£ã—ãŸã„ã¨æ€ã„èª­ã‚“ã ã®ã§ã™ãŒã€servicesä»¥å¤–ã«ã‚‚ã„ã‚ã„ã‚ãªè§£èª¬ãŒã‚ã£ãŸã®ã§éå¸¸ã«å‚è€ƒã«ãªã‚Šã¾ã—ãŸã€‚<p>systemctlã‚„journalctlã ã‘ã§ãªãã€systemd-analyze,localectl,timedatactl,loginctl,networkctlç­‰ã‚‚ä½¿ãˆã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ããŸã„ã§ã™ã€‚<br> è‡ªåˆ†ã®ç†è§£ãŒè‡³ã‚‰ãªã„ç®‡æ‰€ã‚‚å¤šã‹ã£ãŸã§ã™ãŒã€ã²ã¨ã¾ãšsystemdé–¢é€£ã‚ã‹ã‚‰ãªã„ã“ã¨ãŒã‚ã‚Œã°ã¾ãšã¯manèª­ã‚“ã§ã¿ã‚ˆã†ã¨ã„ã†å¿ƒæŒã¡ã«ãªã‚ŒãŸã®ãŒã‚ˆã‹ã£ãŸã§ã™ã€‚<p><del>ã¡ãªã¿ã«ç­†è€…ã¯èª­è€…ã®å¿ƒã‚’èª­ã‚€èƒ½åŠ›ã‚’ã‚‚ã£ã¦ã„ã‚‹ã®ã§æ³¨æ„ã—ã¦ãã ã•ã„ã€‚</del></div></article></main><footer class=blog-footer><p>Â© 2026 <a href=https://blog.ymgyt.io> ymgyt </a> | Made with <a href=https://www.getzola.org rel=noopener target=_blank>Zola</a> | <a href=https://github.com/ymgyt/blog>Repository</a> | <a href=https://blog.ymgyt.io/atom.xml target=_blank title=rss> <svg viewbox="0 0 24 24" class=icon fill=none height=24 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx=5 cy=19 r=1></circle></svg> </a></footer></div></div>