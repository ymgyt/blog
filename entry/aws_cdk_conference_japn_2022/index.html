<!doctype html><html lang=ja><head><meta charset=UTF-8><meta content="width=device-width,initial-scale=1" name=viewport><link href=https://blog.ymgyt.io/favicon.ico rel=icon sizes=any><link href=https://blog.ymgyt.io/icon.svg rel=icon type=image/svg+xml><link href=https://blog.ymgyt.io/apple-touch-icon.png rel=apple-touch-icon><link href=https://blog.ymgyt.io/manifest.webmanifest rel=manifest><link href=https://blog.ymgyt.io/style.css rel=stylesheet><link href=https://blog.ymgyt.io/atom.xml rel=alternate title=Atom type=application/atom+xml><script src="https://www.googletagmanager.com/gtag/js?id=G-GTB0KMLN90" async></script><script>window.dataLayer = window.dataLayer || [];
	function gtag() {dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-GTB0KMLN90');</script><title>🦈 AWS CDK Conference Japan 2022の感想 | Happy developing</title><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><body><div class=world><div class=content-container><header class=blog-header-container><div class=blog-logo><a href=https://blog.ymgyt.io>Happy developing</a></div><div class=blog-nav><nav><ul><li><a href=https://blog.ymgyt.io/entry/>Entries</a><li><a href=https://blog.ymgyt.io/tags/>Tags</a><li><a href=https://blog.ymgyt.io/about/>About</a><li><a href=https://github.com/ymgyt> <img alt=Github class=icon src=https://blog.ymgyt.io/images/icon/github.svg> </a><li><a href="https://twitter.com/YAmaguchixt "> <img alt=Twitter class=icon src=https://blog.ymgyt.io/images/icon/twitter.svg> </a></ul></nav></div></header><main class=blog-main><article><header class=entry-header><h1 class=entry-title>🦈 AWS CDK Conference Japan 2022の感想</h1><div class=entry-meta><p class=entry-meta-item>🗓 2022-05-22<p class=entry-meta-item>🏷 <span class=tag><a href=https://blog.ymgyt.io/tags/event/>event</a></span></div></header><aside class=entry-toc><nav><ul class=entry-toc-toplevel-list><li><a href=https://blog.ymgyt.io/entry/aws_cdk_conference_japn_2022/#keynote-what-is-cdk-v2>Keynote: What is CDK v2?</a> <ul><li><a href=https://blog.ymgyt.io/entry/aws_cdk_conference_japn_2022/#cdk-v1tov2nozhu-nawei-i>CDK v1とv2の主な違い</a><li><a href=https://blog.ymgyt.io/entry/aws_cdk_conference_japn_2022/#deploymadenoliu-re>Deployまでの流れ</a><li><a href=https://blog.ymgyt.io/entry/aws_cdk_conference_japn_2022/#parametaniguan-surucloudformationtonochai-yi>パラメータに関するCloudformationとの差異</a><li><a href=https://blog.ymgyt.io/entry/aws_cdk_conference_japn_2022/#construct-levels>Construct Levels</a></ul><li><a href=https://blog.ymgyt.io/entry/aws_cdk_conference_japn_2022/#3nian-mu-nocdkwozhen-rifan-tute>3年目のCDKを振り返って</a> <ul><li><a href=https://blog.ymgyt.io/entry/aws_cdk_conference_japn_2022/#chu-xue-zhe-nicdkwoosusumesuruli-you>初学者にCDKをオススメする理由</a><li><a href=https://blog.ymgyt.io/entry/aws_cdk_conference_japn_2022/#koremadenoyun-yong-niokerucheng-gong-toshi-bai>これまでの運用における成功と失敗</a></ul><li><a href=https://blog.ymgyt.io/entry/aws_cdk_conference_japn_2022/#cdkdedepuroixian-woliang-chan-sitarihuan-jing-gotonochai-wodounikamai-metarisitahua>CDKでデプロイ先を量産したり環境ごとの差をどうにか埋めたりした話</a> <ul><li><a href=https://blog.ymgyt.io/entry/aws_cdk_conference_japn_2022/#ben-fan-mosutezingumozuo-ritai>本番もステージングも作りたい</a></ul><li><a href=https://blog.ymgyt.io/entry/aws_cdk_conference_japn_2022/#cdknokodonodu-mifang-tokontoribiyusiyon>CDKのコードの読み方とコントリビューション</a> <ul><li><a href=https://blog.ymgyt.io/entry/aws_cdk_conference_japn_2022/#cdknoyu-bei-zhi-shi>CDKの予備知識</a><li><a href=https://blog.ymgyt.io/entry/aws_cdk_conference_japn_2022/#cdknokodonozhong>CDKのコードの中</a><li><a href=https://blog.ymgyt.io/entry/aws_cdk_conference_japn_2022/#kontoribiyutonixiang-kete>コントリビュートに向けて</a><li><a href=https://blog.ymgyt.io/entry/aws_cdk_conference_japn_2022/#cdknobing-lie-deploysapoto>CDKの並列Deployサポート</a><li><a href=https://blog.ymgyt.io/entry/aws_cdk_conference_japn_2022/#terraformnoyounaji-cun-risosunoimport>Terraformのような既存リソースのimport</a></ul><li><a href=https://blog.ymgyt.io/entry/aws_cdk_conference_japn_2022/#aws-cdkwoli-yong-site-next-js-stripedegou-zhu-sitahurusutatukusaasapurikesiyonwodepuroi-guan-li-suru>AWS CDKを利用して、Next.js/Stripeで構築したフルスタックSaaSアプリケーションをデプロイ・管理する</a><li><a href=https://blog.ymgyt.io/entry/aws_cdk_conference_japn_2022/#baseline-environment-on-aws-blea-kai-fa-niatatutejian-tao-sitakoto>Baseline Environment on AWS (BLEA) 開発にあたって検討したこと</a> <ul><li><a href=https://blog.ymgyt.io/entry/aws_cdk_conference_japn_2022/#cdk-deploy-noren-zheng-qing-bao-wochi-titakunai>cdk deploy の認証情報を持ちたくない</a><li><a href=https://blog.ymgyt.io/entry/aws_cdk_conference_japn_2022/#parametawoqie-riti-eteshi-uniha>パラメータを切り替えて使うには</a><li><a href=https://blog.ymgyt.io/entry/aws_cdk_conference_japn_2022/#parametanituitearekore>パラメータについてあれこれ</a><li><a href=https://blog.ymgyt.io/entry/aws_cdk_conference_japn_2022/#paipurainwodoudezainsuruka>パイプラインをどうデザインするか</a><li><a href=https://blog.ymgyt.io/entry/aws_cdk_conference_japn_2022/#fu-shu-nocdkpuroziekutowodouguan-li-suruka>複数のCDKプロジェクトをどう管理するか</a><li><a href=https://blog.ymgyt.io/entry/aws_cdk_conference_japn_2022/#sonota-nojian-tao>その他の検討</a></ul><li><a href=https://blog.ymgyt.io/entry/aws_cdk_conference_japn_2022/#aws-cdk-to-aws-sam-shi-hazhong-liang-si-yi-xu-nirokarudekai-fa-simasenka>AWS CDK と AWS SAM 実は仲良し！一緒にローカルで開発しませんか</a> <ul><li><a href=https://blog.ymgyt.io/entry/aws_cdk_conference_japn_2022/#sam>SAM</a></ul><li><a href=https://blog.ymgyt.io/entry/aws_cdk_conference_japn_2022/#soredemoan-haaws-cdkgazuo-rurisosuniwu-li-ming-wofu-ketai-cdknobesutopurakuteisuhaben-dang-nibesutonanoka>それでも俺はAWS CDKが作るリソースに物理名を付けたい〜CDKのベストプラクティスは本当にベストなのか〜</a> <ul><li><a href=https://blog.ymgyt.io/entry/aws_cdk_conference_japn_2022/#wen-ti-ti-qi-aws-cdknobesutopurakuteisudeharisosunozi-dong-ming-fu-kegatui-jiang-saretemasukedo-zi-dong-ming-fu-kenorisosuxin-kunaidesuka>問題提起: AWS CDKのベストプラクティスではリソースの自動名付けが推奨されてますけど、自動名付けのリソース辛くないですか??</a><li><a href=https://blog.ymgyt.io/entry/aws_cdk_conference_japn_2022/#aws-cdknobesutopurakuteisutoha>AWS CDKのベストプラクティスとは</a><li><a href=https://blog.ymgyt.io/entry/aws_cdk_conference_japn_2022/#zi-dong-desheng-cheng-sarerurisosuming-woshi-yong-si-wu-li-de-naming-qian-woshi-yong-sinai>自動で生成されるリソース名を使用し、物理的な名前を使用しない</a><li><a href=https://blog.ymgyt.io/entry/aws_cdk_conference_japn_2022/#jie-ju-risosuming-hadousubekika>結局リソース名はどうすべきか</a></ul><li><a href=https://blog.ymgyt.io/entry/aws_cdk_conference_japn_2022/#cdkhuannipeng-gu-cdk-for-terraformtoiuxuan-ze-zhi>CDKファンに捧ぐ! CDK for Terraformという選択肢</a> <ul><li><a href=https://blog.ymgyt.io/entry/aws_cdk_conference_japn_2022/#cloud-development-kit-for-terraform>Cloud Development Kit for Terraform</a><li><a href=https://blog.ymgyt.io/entry/aws_cdk_conference_japn_2022/#hcl-or-cdk>HCL or CDK ?</a></ul><li><a href=https://blog.ymgyt.io/entry/aws_cdk_conference_japn_2022/#aws-solutions-constructsdele-sitesisutemuzuo-ritaiyo>AWS Solutions Constructsで楽してシステム作りたいよ〜！</a> <ul><li><a href=https://blog.ymgyt.io/entry/aws_cdk_conference_japn_2022/#aws-solutions-constructstoha>AWS Solutions Constructsとは</a><li><a href=https://blog.ymgyt.io/entry/aws_cdk_conference_japn_2022/#tesuto>テスト</a></ul><li><a href=https://blog.ymgyt.io/entry/aws_cdk_conference_japn_2022/#quan-awsakauntoxquan-cdkapuride-legacytenpuretowomigrationsitahua>全AWSアカウント×全CDKアプリで LegacyテンプレートをMigrationした話</a><li><a href=https://blog.ymgyt.io/entry/aws_cdk_conference_japn_2022/#anticdkdatutawatasiga-cdk-dekiru-tosi-tutatokoro>アンチCDKだったわたしが「CDK、できる・・」と思ったところ</a><li><a href=https://blog.ymgyt.io/entry/aws_cdk_conference_japn_2022/#aws-outposts-shang-norisosuwo-cdk-suru>AWS Outposts 上のリソースを CDK する</a> <ul><li><a href=https://blog.ymgyt.io/entry/aws_cdk_conference_japn_2022/#aws-outpoststoha>AWS Outpostsとは</a><li><a href=https://blog.ymgyt.io/entry/aws_cdk_conference_japn_2022/#kasutamurisosu>カスタムリソース</a></ul><li><a href=https://blog.ymgyt.io/entry/aws_cdk_conference_japn_2022/#matome>まとめ</a></ul></nav></aside><div class=entry-content><figure><div class=fig-images-row><img , alt src=images/aws_cdk_conference_japan_2022.png></div></figure><p>2022/4/9に行われた<a href="https://www.youtube.com/watch?v=O2JXUyOBjt8" rel=external>AWS CDK Conference Japan 2022の動画</a>を見たので感想を書きます。<h2 id=keynote-what-is-cdk-v2><a aria-label="Anchor link for: keynote-what-is-cdk-v2" class=zola-anchor href=#keynote-what-is-cdk-v2><a href="https://www.youtube.com/watch?v=O2JXUyOBjt8&t=2693s" rel=external>Keynote: What is CDK v2?</a></a></h2><p>Speaker<sup class=footnote-reference><a href=#speaker>1</a></sup> : 亀田治伸 (アマゾンウェブサービスジャパン) さん<h3 id=cdk-v1tov2nozhu-nawei-i><a aria-label="Anchor link for: cdk-v1tov2nozhu-nawei-i" class=zola-anchor href=#cdk-v1tov2nozhu-nawei-i>CDK v1とv2の主な違い</a></h3><p>CDK v1<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=json><span class=giallo-l><span style=color:#eceff4>"</span><span style=color:#a3be8c>dependencies</span><span style=color:#eceff4>"</span><span>: </span><span style=color:#eceff4>{</span></span>
<span class=giallo-l><span style=color:#eceff4>  "</span><span style=color:#8fbcbb>@aws-cdk/core</span><span style=color:#eceff4>": "</span><span style=color:#a3be8c>1.127.0</span><span style=color:#eceff4>",</span></span>
<span class=giallo-l><span style=color:#eceff4>  "</span><span style=color:#8fbcbb>@aws-cdk/aws-apigateway</span><span style=color:#eceff4>": "</span><span style=color:#a3be8c>1.127.0</span><span style=color:#eceff4>",</span></span>
<span class=giallo-l><span style=color:#eceff4>  "</span><span style=color:#8fbcbb>@aws-cdk/aws-autoscaling</span><span style=color:#eceff4>": "</span><span style=color:#a3be8c>1.127.0</span><span style=color:#eceff4>",</span></span>
<span class=giallo-l><span style=color:#eceff4>  "</span><span style=color:#8fbcbb>@aws-cdk/aws-dynamodb</span><span style=color:#eceff4>": "</span><span style=color:#a3be8c>1.127.0</span><span style=color:#eceff4>",</span></span>
<span class=giallo-l><span style=color:#eceff4>  "</span><span style=color:#8fbcbb>@aws-cdk/aws-cloudwatch</span><span style=color:#eceff4>": "</span><span style=color:#a3be8c>1.127.0</span><span style=color:#eceff4>",</span></span>
<span class=giallo-l><span style=color:#eceff4>  "</span><span style=color:#8fbcbb>@aws-cdk/aws-cloudwatch-actions</span><span style=color:#eceff4>": "</span><span style=color:#a3be8c>1.127.0</span><span style=color:#eceff4>",</span></span>
<span class=giallo-l><span style=color:#eceff4>  "</span><span style=color:#8fbcbb>@aws-cdk/aws-eks</span><span style=color:#eceff4>": "</span><span style=color:#a3be8c>1.127.0</span><span style=color:#eceff4>",</span></span>
<span class=giallo-l><span style=color:#eceff4>  "</span><span style=color:#8fbcbb>@aws-cdk/aws-events</span><span style=color:#eceff4>": "</span><span style=color:#a3be8c>1.127.0</span><span style=color:#eceff4>",</span></span>
<span class=giallo-l><span style=color:#eceff4>  "</span><span style=color:#8fbcbb>@aws-cdk/aws-events-targets</span><span style=color:#eceff4>": "</span><span style=color:#a3be8c>1.127.0</span><span style=color:#eceff4>",</span></span>
<span class=giallo-l><span style=color:#eceff4>  "</span><span style=color:#8fbcbb>@aws-cdk/aws-ec2</span><span style=color:#eceff4>": "</span><span style=color:#a3be8c>1.127.0</span><span style=color:#eceff4>",</span></span>
<span class=giallo-l><span style=color:#eceff4>  "</span><span style=color:#8fbcbb>@aws-cdk/aws-ecs</span><span style=color:#eceff4>": "</span><span style=color:#a3be8c>1.127.0</span><span style=color:#eceff4>",</span></span>
<span class=giallo-l><span style=color:#eceff4>  "</span><span style=color:#8fbcbb>@aws-cdk/aws-iot</span><span style=color:#eceff4>": "</span><span style=color:#a3be8c>1.127.0</span><span style=color:#eceff4>",</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=javascript><span class=giallo-l><span style=color:#81a1c1>import</span><span style=color:#eceff4> {</span><span style=color:#8fbcbb> App</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> Stack</span><span style=color:#eceff4> }</span><span style=color:#81a1c1> from</span><span style=color:#eceff4> "</span><span style=color:#a3be8c>@aws-cdk/core</span><span style=color:#eceff4>"</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>import * as</span><span style=color:#8fbcbb> s3</span><span style=color:#81a1c1> from</span><span style=color:#eceff4> "</span><span style=color:#a3be8c>@aws-cdk/aws-s3</span><span style=color:#eceff4>"</span><span style=color:#81a1c1>;</span></span></code></pre><ul><li>各AWS Serviceごとにlibraryとして独立している。<li>各libraryがそれぞれ依存関係を持つもので、あるlibraryの更新に破壊的変更があると苦労する場面があった<li>非安定板(alpha,beta版)も含まれる場合がある</ul><p>CDK v2<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=json><span class=giallo-l><span style=color:#eceff4>"</span><span style=color:#a3be8c>dependencies</span><span style=color:#eceff4>"</span><span>: </span><span style=color:#eceff4>{</span></span>
<span class=giallo-l><span style=color:#eceff4>  "</span><span style=color:#8fbcbb>aws-cdk-lib</span><span style=color:#eceff4>": "</span><span style=color:#a3be8c>2.0.0</span><span style=color:#eceff4>",</span></span>
<span class=giallo-l><span style=color:#eceff4>  "</span><span style=color:#8fbcbb>constructs</span><span style=color:#eceff4>": "</span><span style=color:#a3be8c>^10.0.0</span><span style=color:#eceff4>",</span></span>
<span class=giallo-l><span style=color:#eceff4>  "</span><span style=color:#8fbcbb>@aws-cdk/aws-iot-alpha</span><span style=color:#eceff4>": "</span><span style=color:#a3be8c>2.0.0-alpha.0</span><span style=color:#eceff4>"</span><span> </span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=javascript><span class=giallo-l><span style=color:#81a1c1>import</span><span style=color:#eceff4> {</span><span style=color:#8fbcbb> App</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> Stack</span><span style=color:#eceff4> }</span><span style=color:#81a1c1> from</span><span style=color:#eceff4> "</span><span style=color:#a3be8c>aws-cdk-lib</span><span style=color:#eceff4>"</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>import * as</span><span style=color:#8fbcbb> s3</span><span style=color:#81a1c1> from</span><span style=color:#eceff4> "</span><span style=color:#a3be8c>aws-cdk-lib/aws-s3</span><span style=color:#eceff4>"</span><span style=color:#81a1c1>;</span></span></code></pre><ul><li>安定板が<code>aws-cdk-lib</code>に集約された <ul><li>全てのserviceがサポートされている訳ではない(app runner, kinesis data firehose,...)</ul><li>安定板でないものは<code>aws-cdk/aws-iot-alpha</code>のように別libraryになっている</ul><p>ネット上のCDKに関する記事等でv1について書かれているものも多かったので最初にCDKについて調べた時戸惑いました。<code>@aws-cdk/xxx</code>はv1のlibで<code>@aws-cdk/xxx-alpha</code>はv2のlibのところがわかりづらかったです。<h3 id=deploymadenoliu-re><a aria-label="Anchor link for: deploymadenoliu-re" class=zola-anchor href=#deploymadenoliu-re>Deployまでの流れ</a></h3><pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=shellscript><span class=giallo-l><span style=color:#88c0d0>cdk</span><span style=color:#a3be8c> init</span></span>
<span class=giallo-l><span style=color:#88c0d0>cdk</span><span style=color:#a3be8c> synth</span></span>
<span class=giallo-l><span style=color:#88c0d0>cdk</span><span style=color:#a3be8c> diff</span></span>
<span class=giallo-l><span style=color:#88c0d0>cdk</span><span style=color:#a3be8c> deploy</span></span></code></pre><h3 id=parametaniguan-surucloudformationtonochai-yi><a aria-label="Anchor link for: parametaniguan-surucloudformationtonochai-yi" class=zola-anchor href=#parametaniguan-surucloudformationtonochai-yi>パラメータに関するCloudformationとの差異</a></h3><ul><li>Cloudformationにはparameterを持たせることができる。stack作成の際に入力が必要 <ul><li>一つのtemplateから複数のstackを生成できる</ul><li>CDKはtemplate作成段階でparameterを処理する <ul><li>1stack 1template</ul></ul><p>CDKを運用するに当たって、StackやAppでどこまで変数化して作るかについてまだいまいち基準を設けられていないです。<h3 id=construct-levels><a aria-label="Anchor link for: construct-levels" class=zola-anchor href=#construct-levels>Construct Levels</a></h3><p>Construct L3+,L2,L1の区別について<ul><li>L3+: 複数のリソースを操作する。L2からの派生。ECS with ALB等。<li>L2: 標準。Cfnの全てのパラメータは操作できない<li>L1: Cfnパラメータと1:1マッピング</ul><p>基本(最初)はL2から利用する。L2が提供するAPIでは要件を満たせない場合はL1を使う。<br> L1を利用するとCDKの利点である高い抽象度でのリソース操作が犠牲になるので、まずはL2を使う。<br> L3は複数のL2リソースの再利用の単位。<h2 id=3nian-mu-nocdkwozhen-rifan-tute><a aria-label="Anchor link for: 3nian-mu-nocdkwozhen-rifan-tute" class=zola-anchor href=#3nian-mu-nocdkwozhen-rifan-tute><a href="https://www.youtube.com/watch?v=O2JXUyOBjt8&t=5151s" rel=external>3年目のCDKを振り返って</a></a></h2><p>Speaker: 吉川幸弘 さん<h3 id=chu-xue-zhe-nicdkwoosusumesuruli-you><a aria-label="Anchor link for: chu-xue-zhe-nicdkwoosusumesuruli-you" class=zola-anchor href=#chu-xue-zhe-nicdkwoosusumesuruli-you>初学者にCDKをオススメする理由</a></h3><ul><li>Cloudformationに比べてdocが親切</ul><p>個人的にはProductionで運用するに当たってAWSリソースの設定できるpropertyは全て理解したいと考えているので、CDKのdocだけでは完結しない印象を持っております。<ul><li>静的型チェックが効くこと</ul><p>yaml/jsonでは許容されない値や存在しないproperty,誤ったデータ型も書けてしまう。<p>これは本当にその通りだと思います。enumとか本当にありがたいです。<br> ただし、全てチェックできる訳ではないのでどうしてもStack作成が失敗するケースには何度か遭遇しました。 L2が提供されていないApp Runnerを定義する際にL1 constructだとほとんどstring型で定義されて恩恵が十分に受けられないこともありました。<ul><li>editorのサポートが受けられる</ul><p>plugin利用すれば何かしらの支援は受けられますが、やはりtypescriptになっていることによる恩恵は多いと思います。formatやlint等ecosystemもそのまま利用できますし。<h3 id=koremadenoyun-yong-niokerucheng-gong-toshi-bai><a aria-label="Anchor link for: koremadenoyun-yong-niokerucheng-gong-toshi-bai" class=zola-anchor href=#koremadenoyun-yong-niokerucheng-gong-toshi-bai>これまでの運用における成功と失敗</a></h3><ul><li>プロジェクトに関わるリソースを可能な限りCDKで管理したこと</ul><p>Excelによる管理を避けられたことがプロジェクトとメンバーを守ることに繋がったと表現されておりとても共感しました。<ul><li>スキルアップできる環境づくり</ul><p>CDKが複数言語で記述できる点が利点に。<br> 実際チームでCDK運用するに当たって、どの範囲まで言語一致させるかは考えたことがなかったです。<br> moduleのecosystemをそのまま利用できるのがCDKの最大のメリットの一つだと考えているので、これを生かすにはできるだけ言語が統一されているのが望ましいのではとは思っております。<ul><li>初期にスナップショットテストを入れていなかったこと</ul><p>CDKのversion upに伴い、defaultの値が変わったことで影響を受けた。<br> この辺りはいい感じにdefault値設定してくれることのデメリットなんでしょうか。<br> 個人的には全property明示的に宣言したい派。<h2 id=cdkdedepuroixian-woliang-chan-sitarihuan-jing-gotonochai-wodounikamai-metarisitahua><a aria-label="Anchor link for: cdkdedepuroixian-woliang-chan-sitarihuan-jing-gotonochai-wodounikamai-metarisitahua" class=zola-anchor href=#cdkdedepuroixian-woliang-chan-sitarihuan-jing-gotonochai-wodounikamai-metarisitahua><a href="https://www.youtube.com/watch?v=O2JXUyOBjt8&t=6859s" rel=external>CDKでデプロイ先を量産したり環境ごとの差をどうにか埋めたりした話</a></a></h2><p>Speaker: 稲葉太一(inbaa) さん<h3 id=ben-fan-mosutezingumozuo-ritai><a aria-label="Anchor link for: ben-fan-mosutezingumozuo-ritai" class=zola-anchor href=#ben-fan-mosutezingumozuo-ritai>本番もステージングも作りたい</a></h3><ul><li><code>--context</code>で値を渡せる</ul><p>cdk.json<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=json><span class=giallo-l><span style=color:#eceff4>{</span></span>
<span class=giallo-l><span style=color:#eceff4>    "</span><span style=color:#8fbcbb>context</span><span style=color:#eceff4>": {</span></span>
<span class=giallo-l><span style=color:#eceff4>        "</span><span style=color:#8fbcbb>production</span><span style=color:#eceff4>": {</span></span>
<span class=giallo-l><span style=color:#eceff4>            "</span><span style=color:#8fbcbb>fqdn</span><span style=color:#eceff4>": "</span><span style=color:#a3be8c>hoge.example.com</span><span style=color:#eceff4>"</span></span>
<span class=giallo-l><span style=color:#eceff4>        },</span></span>
<span class=giallo-l><span style=color:#eceff4>        "</span><span style=color:#8fbcbb>staging</span><span style=color:#eceff4>": {</span></span>
<span class=giallo-l><span style=color:#eceff4>            "</span><span style=color:#8fbcbb>fqdn</span><span style=color:#eceff4>": "</span><span style=color:#a3be8c>stg.hoge.example.dev</span><span style=color:#eceff4>"</span></span>
<span class=giallo-l><span style=color:#eceff4>        }</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=shellscript><span class=giallo-l><span style=color:#88c0d0>npx</span><span style=color:#a3be8c> cdk deploy --all --context stage=staging</span></span></code></pre><pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=typescript><span class=giallo-l><span style=color:#81a1c1>const</span><span> stage</span><span style=color:#81a1c1> =</span><span> app</span><span style=color:#eceff4>.</span><span>node</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>tryGetContext</span><span>(</span><span style=color:#eceff4>'</span><span style=color:#a3be8c>stage</span><span style=color:#eceff4>'</span><span>)</span><span style=color:#616e88> // staging</span></span>
<span class=giallo-l><span style=color:#81a1c1>const</span><span> context</span><span style=color:#81a1c1> =</span><span> app</span><span style=color:#eceff4>.</span><span>node</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>tryGetContext</span><span>(stage)</span><span style=color:#616e88> // {fqdn: "stg.hoge.example.dev"}</span></span></code></pre><p>のようにして環境ごとに異なる設定値を実行時に渡せるようにされていました。<br> これは非常に参考になります。<br> さらに発表では環境ごとの差分を扱う<code>Context</code>classを定義した例に触れられており真似してみようと思いました。<h2 id=cdknokodonodu-mifang-tokontoribiyusiyon><a aria-label="Anchor link for: cdknokodonodu-mifang-tokontoribiyusiyon" class=zola-anchor href=#cdknokodonodu-mifang-tokontoribiyusiyon><a href="https://www.youtube.com/watch?v=O2JXUyOBjt8&t=9212s" rel=external>CDKのコードの読み方とコントリビューション</a></a></h2><p>Speaker: 山本達也(Classmethod) さん<p>aws-iotのL2 Constructを実装されたお話。<h3 id=cdknoyu-bei-zhi-shi><a aria-label="Anchor link for: cdknoyu-bei-zhi-shi" class=zola-anchor href=#cdknoyu-bei-zhi-shi>CDKの予備知識</a></h3><ul><li>CDKはtypescriptのコードから<a href=https://github.com/aws/jsii rel=external>jsii</a>で他言語とDocを生成している<li>L1はCloudformationの定義から生成している</ul><h3 id=cdknokodonozhong><a aria-label="Anchor link for: cdknokodonozhong" class=zola-anchor href=#cdknokodonozhong>CDKのコードの中</a></h3><p>概要としてはL2はL1をwrapする実装になっている。<h3 id=kontoribiyutonixiang-kete><a aria-label="Anchor link for: kontoribiyutonixiang-kete" class=zola-anchor href=#kontoribiyutonixiang-kete>コントリビュートに向けて</a></h3><ul><li>Unit Testを書く<li>Integ Testを書く<li>READMEを書く<li>PRを作る<li>CIを通す</ul><p>詳細はブログに書かれてるとのことでした。(ブログ見つけられておらず)<h3 id=cdknobing-lie-deploysapoto><a aria-label="Anchor link for: cdknobing-lie-deploysapoto" class=zola-anchor href=#cdknobing-lie-deploysapoto>CDKの並列Deployサポート</a></h3><ul><li><code>cdk deploy</code>にconcurrent deploymentがサポートされる(かも)</ul><h3 id=terraformnoyounaji-cun-risosunoimport><a aria-label="Anchor link for: terraformnoyounaji-cun-risosunoimport" class=zola-anchor href=#terraformnoyounaji-cun-risosunoimport>Terraformのような既存リソースのimport</a></h3><ul><li><code>cdk import</code>がmergeされた</ul><h2 id=aws-cdkwoli-yong-site-next-js-stripedegou-zhu-sitahurusutatukusaasapurikesiyonwodepuroi-guan-li-suru><a aria-label="Anchor link for: aws-cdkwoli-yong-site-next-js-stripedegou-zhu-sitahurusutatukusaasapurikesiyonwodepuroi-guan-li-suru" class=zola-anchor href=#aws-cdkwoli-yong-site-next-js-stripedegou-zhu-sitahurusutatukusaasapurikesiyonwodepuroi-guan-li-suru><a href="https://www.youtube.com/watch?v=O2JXUyOBjt8&t=10685s" rel=external>AWS CDKを利用して、Next.js/Stripeで構築したフルスタックSaaSアプリケーションをデプロイ・管理する</a></a></h2><p>Speaker: 岡本秀高(Stripe) さん<p>Next.jsについては自分が<a href=https://nextjs.org/learn/foundations/about-nextjs rel=external>tutorial</a>しかやったことがなく理解できていないので割愛。<br> AmplifyでIAMの設定がつらいという話は共感しました。<h2 id=baseline-environment-on-aws-blea-kai-fa-niatatutejian-tao-sitakoto><a aria-label="Anchor link for: baseline-environment-on-aws-blea-kai-fa-niatatutejian-tao-sitakoto" class=zola-anchor href=#baseline-environment-on-aws-blea-kai-fa-niatatutejian-tao-sitakoto><a href="https://www.youtube.com/watch?v=O2JXUyOBjt8&t=12400s" rel=external>Baseline Environment on AWS (BLEA) 開発にあたって検討したこと</a></a></h2><p>Speaker: 大村幸敬(AWS) さん<p><a href=https://github.com/aws-samples/baseline-environment-on-aws rel=external>BLEA</a>でブレアと読むらしいです。<br> <a href=https://github.com/aws-samples/baseline-environment-on-aws/blob/main/README_ja.md rel=external>README_ja</a>によりますと<blockquote><p>Baseline Environment on AWS(BLEA) は 単独の AWS アカウントまたは ControlTower で管理されたマルチアカウント環境で、セキュアなベースラインを確立するための リファレンス CDK テンプレート群です。</blockquote><p><a href=https://github.com/aws-samples/baseline-environment-on-aws/tree/main/usecases/ rel=external>usecases</a>を見てみますと、CDKのサンプル実装が載っておりました。 問題意識として、長期運用を見据えた引き継ぎのしやすさ、ブラックボックスにしない点を重視されているそうです。自分は開発と運用に携わることが多いので、運用者目線なのは大変ありがたいです。<p>typescriptやjsのecosystem(npm,lint)に馴染みのない方にも触れてもらうために開発環境をまずはVSCodeに絞ってサポートしているそうです。BLEAについてはあらためてブログ書こうと思います。<h3 id=cdk-deploy-noren-zheng-qing-bao-wochi-titakunai><a aria-label="Anchor link for: cdk-deploy-noren-zheng-qing-bao-wochi-titakunai" class=zola-anchor href=#cdk-deploy-noren-zheng-qing-bao-wochi-titakunai>cdk deploy の認証情報を持ちたくない</a></h3><p>localで<code>cdk deploy</code>を実行する場合にlocalにdeployに必要な権限を持つAWS Credentialが必要になるが、これを避けるにはAWS SSOを利用できるというお話。<p>設定方法は<ol><li><code>~/.aws/config</code>にssoログイン用プロファイルを設定<li><code>aws sso login</code>コマンドを実行して認証<li>cdkコマンドを実行</ol><p>aws ssoコマンドを初めて知りました、この機能はcdkに限らずとても重要な機能だと思いました。<br> 開発用のマシンにaws credentialを持たなくてよくなるのは嬉しいです。<h3 id=parametawoqie-riti-eteshi-uniha><a aria-label="Anchor link for: parametawoqie-riti-eteshi-uniha" class=zola-anchor href=#parametawoqie-riti-eteshi-uniha>パラメータを切り替えて使うには</a></h3><p>prod/stagingといった環境の切り替え方法について、BLEAでの解決策。<ol><li><code>cdk.json</code>のcontextに設定値グループを保持</ol><pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=json><span class=giallo-l><span style=color:#eceff4>{</span></span>
<span class=giallo-l><span style=color:#eceff4>  "</span><span style=color:#8fbcbb>context</span><span style=color:#eceff4>": {</span></span>
<span class=giallo-l><span style=color:#eceff4>    "</span><span style=color:#8fbcbb>dev</span><span style=color:#eceff4>": {</span></span>
<span class=giallo-l><span style=color:#eceff4>      "</span><span style=color:#8fbcbb>key1</span><span style=color:#eceff4>": "</span><span style=color:#a3be8c>value1</span><span style=color:#eceff4>"</span></span>
<span class=giallo-l><span style=color:#eceff4>    },</span></span>
<span class=giallo-l><span style=color:#eceff4>    "</span><span style=color:#8fbcbb>prod</span><span style=color:#eceff4>": {</span></span>
<span class=giallo-l><span style=color:#eceff4>      "</span><span style=color:#8fbcbb>key1</span><span style=color:#eceff4>": "</span><span style=color:#a3be8c>value1</span><span style=color:#eceff4>"</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l><span style=color:#eceff4>  }</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><ol start=2><li><code>--context</code>optionでグループを指定<br> <code>cdk deploy --context environment=prod</code><li>CDKコードでパラメータを取得して利用</ol><pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=typescript><span class=giallo-l><span style=color:#81a1c1>const</span><span> envKey</span><span style=color:#81a1c1> =</span><span> app</span><span style=color:#eceff4>.</span><span>node</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>tryGetContext</span><span>(</span><span style=color:#eceff4>'</span><span style=color:#a3be8c>environment</span><span style=color:#eceff4>'</span><span>)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>const</span><span> valArray</span><span style=color:#81a1c1> =</span><span> app</span><span style=color:#eceff4>.</span><span>node</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>tryGetContext</span><span>(envKey)</span><span style=color:#81a1c1>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>const</span><span> value1</span><span style=color:#81a1c1> =</span><span> valArray[</span><span style=color:#eceff4>'</span><span style=color:#a3be8c>key1</span><span style=color:#eceff4>'</span><span>]</span><span style=color:#81a1c1>;</span></span></code></pre><p>この方法がシンプルでわかりやすいと思うので自分のこの方法にならっていこうかと思います。<h4 id=parametacha-ru-bleadenokao-efang><a aria-label="Anchor link for: parametacha-ru-bleadenokao-efang" class=zola-anchor href=#parametacha-ru-bleadenokao-efang>パラメータ挿入: BLEAでの考え方</a></h4><ul><li>Cloudformationのparametersは使わないことが推奨。CDKのcontextと環境変数を利用する<li>環境変数はprofileで指定したアカウントとリージョンの取得に使う<li>context(cdk.json)にdeploy先を限定したい場合環境(aws account idとregion)を設定しておく <ul><li>指定がない場合は環境変数を利用<li><code>--profile</code>で渡されたaccountとregionと一致しない場合はエラーにする</ul></ul><pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=json><span class=giallo-l><span style=color:#eceff4>{</span></span>
<span class=giallo-l><span style=color:#eceff4>  "</span><span style=color:#8fbcbb>context</span><span style=color:#eceff4>": {</span></span>
<span class=giallo-l><span style=color:#eceff4>    "</span><span style=color:#8fbcbb>stage</span><span style=color:#eceff4>": {</span></span>
<span class=giallo-l><span style=color:#eceff4>      "</span><span style=color:#8fbcbb>env</span><span style=color:#eceff4>": {</span></span>
<span class=giallo-l><span style=color:#eceff4>        "</span><span style=color:#8fbcbb>account</span><span style=color:#eceff4>": "</span><span style=color:#a3be8c>111111111111</span><span style=color:#eceff4>",</span></span>
<span class=giallo-l><span style=color:#eceff4>        "</span><span style=color:#8fbcbb>region</span><span style=color:#eceff4>": "</span><span style=color:#a3be8c>ap-northeast-1</span><span style=color:#eceff4>"</span></span>
<span class=giallo-l><span style=color:#eceff4>      }</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l><span style=color:#eceff4>  }</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><h3 id=parametanituitearekore><a aria-label="Anchor link for: parametanituitearekore" class=zola-anchor href=#parametanituitearekore>パラメータについてあれこれ</a></h3><ul><li>そもそもインフラを定義するコードには複雑な条件分岐がない方が良いのでは <ul><li>開発環境の通知はしない等</ul><li>環境差分をパラメータで表現するのではなく環境ごとにStackを定義する方法もありうる <ul><li>複雑度私大なところがあるがdiffで管理する方法もあり</ul><li>public repoで管理する場合、<code>.gitignore</code>したい情報(社内のIPとか)をどう管理するか。BLEAで直面。 <ul><li>ベストプラクティスからは逸脱するが、<code>cdk.context.json</code>をignoreして手元で管理する方法を取っていた。<li>他の選択肢としては、<code>${HOME}/.cdk.json</code>, SSM ParameterStore,S3,...<li>これが良いという答えはまだない</ul><li>そもそもcontext使うか <ul><li>jsonなのでそのままでは型チェックができない<li>CDKのdefault libraryとしては提供されていないので独自で実装するしかない</ul></ul><p>CDKでパラメータと環境差分をどう管理するかは自分も悩んでおりました。この辺りはある程度おすすめの方法は確立されつつも、自分達のチームにあう形を選ぶ必要があるということがわかりました。(なんでもそうですが)<h3 id=paipurainwodoudezainsuruka><a aria-label="Anchor link for: paipurainwodoudezainsuruka" class=zola-anchor href=#paipurainwodoudezainsuruka>パイプラインをどうデザインするか</a></h3><ul><li>CDK Pipelineの実装例を公開している<li>とりうる選択肢が多いので決定版が出にくい <ul><li>Stackのどんなテストをどこで行うか<li>Ownerは誰か。運用チームがいるか、チームがどこまで管理するか。<li><code>cdk deploy</code>をどこで実行するか <ul><li>local, CI(Github Actions), pipeline account, target account</ul><li>CI(<code>npm run test</code>)をどこで実行するのか</ul></ul><p>この辺りは皆様がどういった方法でやられているのか是非知りたいです。<h3 id=fu-shu-nocdkpuroziekutowodouguan-li-suruka><a aria-label="Anchor link for: fu-shu-nocdkpuroziekutowodouguan-li-suruka" class=zola-anchor href=#fu-shu-nocdkpuroziekutowodouguan-li-suruka>複数のCDKプロジェクトをどう管理するか</a></h3><ul><li>多くのCDK toolkitはroot直下に1 projectがあることを想定している<li>BLEAではusecase directoryを切って、複数projectを管理している<li>BLEAではパッケージ管理はnpm workspacesを利用<li>アプリコードとインフラコードをどう分離するかという話もあるが、今回は割愛。</ul><p>今回は触れられていないのですが、アプリコードとインフラコードをどう分離するかはまさに悩んだ点でした。CDKのドキュメントの書きぶりではappとinfraを同じように管理できることがメリットとして説明されていたと思うのですが、CIのトリガーやら権限管理の観点からリポジトリ分けたりしていました。<h3 id=sonota-nojian-tao><a aria-label="Anchor link for: sonota-nojian-tao" class=zola-anchor href=#sonota-nojian-tao>その他の検討</a></h3><ul><li>SecurityGroup,IAM Policyの循環参照<li>snapshot test以外に何をテストするか<li>ALBが勝手にSGを管理するのをやめさせたい<li>Route53とACMはCDKで管理した方がいいのか<li>CloudFrontとWAFはus-east-1で設定しないと</ul><p>全部気になる話題でCDK運用の旅ははじまったばかり感。<p>実装見てみて参考にしたいと思います。<h2 id=aws-cdk-to-aws-sam-shi-hazhong-liang-si-yi-xu-nirokarudekai-fa-simasenka><a aria-label="Anchor link for: aws-cdk-to-aws-sam-shi-hazhong-liang-si-yi-xu-nirokarudekai-fa-simasenka" class=zola-anchor href=#aws-cdk-to-aws-sam-shi-hazhong-liang-si-yi-xu-nirokarudekai-fa-simasenka><a href="https://www.youtube.com/watch?v=O2JXUyOBjt8&t=14895s" rel=external>AWS CDK と AWS SAM 実は仲良し！一緒にローカルで開発しませんか</a></a></h2><p>Speaker: 藤原麻希(ゆめみ) さん<h3 id=sam><a aria-label="Anchor link for: sam" class=zola-anchor href=#sam>SAM</a></h3><ul><li>cdk synthで生成されたCloudformationのyamlをSAMから読める。</ul><p>SAM使ったことなく、使う予定もない今のところないです。CDKができた今使われなくなるのではと思ったりしました。<br> 個人的にはlambdaのtestはlambdaのレイヤーをできるだけ薄くして、普通のアプリケーションと同じunit/integration test書きたい派です。<h2 id=soredemoan-haaws-cdkgazuo-rurisosuniwu-li-ming-wofu-ketai-cdknobesutopurakuteisuhaben-dang-nibesutonanoka><a aria-label="Anchor link for: soredemoan-haaws-cdkgazuo-rurisosuniwu-li-ming-wofu-ketai-cdknobesutopurakuteisuhaben-dang-nibesutonanoka" class=zola-anchor href=#soredemoan-haaws-cdkgazuo-rurisosuniwu-li-ming-wofu-ketai-cdknobesutopurakuteisuhaben-dang-nibesutonanoka><a href="https://www.youtube.com/watch?v=O2JXUyOBjt8&t=16000s" rel=external>それでも俺はAWS CDKが作るリソースに物理名を付けたい〜CDKのベストプラクティスは本当にベストなのか〜</a></a></h2><p>Speaker: 佐藤智樹(Classmethod) さん<h3 id=wen-ti-ti-qi-aws-cdknobesutopurakuteisudeharisosunozi-dong-ming-fu-kegatui-jiang-saretemasukedo-zi-dong-ming-fu-kenorisosuxin-kunaidesuka><a aria-label="Anchor link for: wen-ti-ti-qi-aws-cdknobesutopurakuteisudeharisosunozi-dong-ming-fu-kegatui-jiang-saretemasukedo-zi-dong-ming-fu-kenorisosuxin-kunaidesuka" class=zola-anchor href=#wen-ti-ti-qi-aws-cdknobesutopurakuteisudeharisosunozi-dong-ming-fu-kegatui-jiang-saretemasukedo-zi-dong-ming-fu-kenorisosuxin-kunaidesuka>問題提起: AWS CDKのベストプラクティスではリソースの自動名付けが推奨されてますけど、自動名付けのリソース辛くないですか??</a></h3><p>これは最初にCDK触った時に思いました! が、IaCでリソース管理するとそういうものかと思ってました。(ベストプラクティスであっても疑う姿勢に欠けておりました..)<p>ソフトウェアアーキテクチャの基礎より<blockquote><p>アーキテクトには過去の時代から残されている前提や公理を疑うという重要な責任がある</blockquote><p>という引用が紹介されておりました。ソフトウェアアーキテクチャの基礎はまだ読めていないのですが、MUST READな本のようなので読みたいです。<h3 id=aws-cdknobesutopurakuteisutoha><a aria-label="Anchor link for: aws-cdknobesutopurakuteisutoha" class=zola-anchor href=#aws-cdknobesutopurakuteisutoha>AWS CDKのベストプラクティスとは</a></h3><p><a href=https://aws.amazon.com/blogs/devops/best-practices-for-developing-cloud-applications-with-aws-cdk/ rel=external>Best practices for developing cloud applications with AWS CDK</a>というCDKのベストプラクティスについて書かれた公式のblogがある。<h3 id=zi-dong-desheng-cheng-sarerurisosuming-woshi-yong-si-wu-li-de-naming-qian-woshi-yong-sinai><a aria-label="Anchor link for: zi-dong-desheng-cheng-sarerurisosuming-woshi-yong-si-wu-li-de-naming-qian-woshi-yong-sinai" class=zola-anchor href=#zi-dong-desheng-cheng-sarerurisosuming-woshi-yong-si-wu-li-de-naming-qian-woshi-yong-sinai>自動で生成されるリソース名を使用し、物理的な名前を使用しない</a></h3><ul><li><p>物理名を使う場合のデメリット</p> <ul><li>インフラの一部を複数デプロイすることができない <ul><li>-> 命名規則は実装に依存する、似ている名前のリソースが複数ある場合関連がわからず逆に不便では<li>-> リソース名の衝突は命名規則で回避可能<li>-> Stack名が違ってもConstructのidが同じだと重複するリソースが一部存在する</ul><li>リソースに破壊的変更が伴う場合、再作成に失敗する <ul><li>-> 危険性に気づけて失敗した方が良いのでは</ul><li><code>RemovalPolicy.RETAIN</code>を指定した場合、スタック削除後の再デプロイで失敗する</ul><li><p>再デプロイ時に前回実行したリソース名が重複しない -> 以前のリソースが残るのでこまめに削除しないと大量のリソースが残り、どれがみたいものか、削除して良いものかが分かりづらくなる</p><li><p>自動名付けで生成されたリソースはhash値を含むのでサブリソースまで含めると認知的負荷が高い。(調査が大変)</p></ul><p>リソースにhash値が含まれたリソースが複数あると認知的負荷が高いのは自分も経験がありました。hash値の最初と最後の数文字だけ覚えて頑張るみたいな感じになってました。<h3 id=jie-ju-risosuming-hadousubekika><a aria-label="Anchor link for: jie-ju-risosuming-hadousubekika" class=zola-anchor href=#jie-ju-risosuming-hadousubekika>結局リソース名はどうすべきか</a></h3><ul><li>開発/調査/運用などでよく確認するリソース名は固定する <ul><li>ECS,Lambdaなどのコンピューティングサービス<li>DynamoDBやS3などのストレージ<li>ダッシュボード名やアラート名</ul><li>上記以外のサービスはできるだけ固定しない</ul><h2 id=cdkhuannipeng-gu-cdk-for-terraformtoiuxuan-ze-zhi><a aria-label="Anchor link for: cdkhuannipeng-gu-cdk-for-terraformtoiuxuan-ze-zhi" class=zola-anchor href=#cdkhuannipeng-gu-cdk-for-terraformtoiuxuan-ze-zhi><a href="https://www.youtube.com/watch?v=O2JXUyOBjt8&t=17464s" rel=external>CDKファンに捧ぐ! CDK for Terraformという選択肢</a></a></h2><p>Speaker: 草間一人 @jacopen (Hashicorp) さん<p>自分は最初にCDKを知った時にTerraformでいいのではと思っておりました。<br> Mitchell hashimoto先生のコードでGoを勉強したのでHashicorp自体好きでした。<br> CDKいいかもと思った理由としては<ul><li>テストが書ける<li>HCLでもloopやifの制御、listやhash(dict)といったデータ構造を使うところが増えてきてyaml以上、プログラミング未満の表現力に若干疑問を持っていた</ul><h3 id=cloud-development-kit-for-terraform><a aria-label="Anchor link for: cloud-development-kit-for-terraform" class=zola-anchor href=#cloud-development-kit-for-terraform>Cloud Development Kit for Terraform</a></h3><p>略してCDKTF。CDKの成果物をTerraformが利用できるjsonに変換する。<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=shellscript><span class=giallo-l><span style=color:#88c0d0>cdktf</span><span style=color:#a3be8c> init --template=typescript --local</span></span>
<span class=giallo-l><span style=color:#88c0d0>cdktf</span><span style=color:#a3be8c> deploy</span></span>
<span class=giallo-l><span style=color:#88c0d0>cdktf</span><span style=color:#a3be8c> destroy</span></span></code></pre><p>のようにCDKを書きつつ、適用をterraformで実行することができる。<br> <code>cdktf init</code>の<code>--local</code>を省略すると、terraform cloudと連携してlocalにstateファイルを持たなくても良くなることもできるそうです。<p>また、内部的には<code>cdktf.out/stacks/{stack}/cdk.tf.json</code>が生成されておりこのファイルから直接terraformを実行することもできるそうです。terraform cloud上のstateも更新されます。<p>terraform cloudを初めて知ったのですが、CDもできそうで試してみたくなりました。<br> cdktfだとgcpのリソースも同じ書き方ができるのもすごいです。<h3 id=hcl-or-cdk><a aria-label="Anchor link for: hcl-or-cdk" class=zola-anchor href=#hcl-or-cdk>HCL or CDK ?</a></h3><ul><li>HCL自体がそれなりの柔軟性と表現力を持つため、YAML->CDKと比べるとHCK->CDKには劇的なメリットはないかも<li>terraformのmoduleとしてパーツ化するか、Constructsでパーツ化するか悩ましい<li>CDKで自在な表現力を得るか、HCLの適度な制限の中で書いて品質を保つか</ul><p>この点に関してはメンバーや組織構成に依るところが多いと思うので一概にはいえませんが、CDK(typescript)で書く派です。そもそもts読めないとフロントのコード読めないので、web開発に関わっている自分はCDKができたことでtsは必修と考えるようになりました。<br> 他のspeakerの方もおっしゃられていましたが、CDKにおいては高度な型定義は使わずに愚直にリソース宣言を上から書いていくようなコードになると思うので特に問題ないと思っています。<p><a href=https://www.hashicorp.com/blog/cdk-for-terraform-in-production-learning-from-pocket rel=external>Mozillaのプロジェクトで本番利用された話</a>の紹介もありました。<h2 id=aws-solutions-constructsdele-sitesisutemuzuo-ritaiyo><a aria-label="Anchor link for: aws-solutions-constructsdele-sitesisutemuzuo-ritaiyo" class=zola-anchor href=#aws-solutions-constructsdele-sitesisutemuzuo-ritaiyo><a href="https://www.youtube.com/watch?v=O2JXUyOBjt8&t=19302s" rel=external>AWS Solutions Constructsで楽してシステム作りたいよ〜！</a></a></h2><p>Speaker: 渡邉洋平(NTTテクノクロス) さん<h3 id=aws-solutions-constructstoha><a aria-label="Anchor link for: aws-solutions-constructstoha" class=zola-anchor href=#aws-solutions-constructstoha>AWS Solutions Constructsとは</a></h3><p>https://docs.aws.amazon.com/solutions/latest/constructs/welcome.html<blockquote><p>AWS Solutions Constructs (Constructs) is an open-source extension of the AWS Cloud Development Kit (CDK) that provides multi-service, well-architected patterns for quickly defining solutions in code to create predictable and repeatable infrastructure.</blockquote><p>ということで、L3 Constructsに対応するものとのことです。(v2にも対応)<br> 発表時点では54個のConstructが提供されており、サーバレス構成の頻出パターンのサポートが厚いそうです。<br> <code>@aws-solutions-constructs</code>はv1のようにserviceごとにmoduleが別れていました。まだ、<code>aws-cdk-lib</code>のlatestとはversionが違います。<p>CDKがL1,L2と抽象化してくれているのでより抽象度の高いL3ライブライ使ってこそメリットを最大限享受できると学べました。<h3 id=tesuto><a aria-label="Anchor link for: tesuto" class=zola-anchor href=#tesuto>テスト</a></h3><p>solutions constructsで生成したリソースのテストについて。<br> 方針としては、時間の関係で<code>@aws-cdk/assertions</code>は使わずに生成したCloudformation templateの設定値を確認する。<p>テスト用Toolとしては<ul><li>Security Hub Standard <ul><li>最も活発なFSDBを利用</ul><li>OSS(Linter)</ul><h2 id=quan-awsakauntoxquan-cdkapuride-legacytenpuretowomigrationsitahua><a aria-label="Anchor link for: quan-awsakauntoxquan-cdkapuride-legacytenpuretowomigrationsitahua" class=zola-anchor href=#quan-awsakauntoxquan-cdkapuride-legacytenpuretowomigrationsitahua><a href="https://www.youtube.com/watch?v=O2JXUyOBjt8&t=20789s" rel=external>全AWSアカウント×全CDKアプリで LegacyテンプレートをMigrationした話</a></a></h2><p>Speaker: 大越雄太／小笠原寛明(justInCase Technologies) さん<p>なんとjustInCaseさんでは、2019/6にすでにcdk v0.33をKotlinから動かされていたそうです。<br> KotlinでCDKを書くためにAWS-CDK-Kotlin-DSLを独自開発されたのはすごいです。<p>v1からv2への移行においてcdk bootstrapにまつわるtemplateの影響でdeployが失敗するようになってしまった事例について。この辺りはわかっていなかったのですが今のチームではv1->v2への移行を行っているので参考になります。<br> <a href=https://dev.classmethod.jp/articles/cdk-bootstrap-modern-template/ rel=external>CDK BootstrapのMdern templateで何が変わるのか</a>を読んでみようと思っております。<p><a href=https://team-blog-hub.justincase-tech.com/ rel=external>justInCaseさんの技術ブログ</a><h2 id=anticdkdatutawatasiga-cdk-dekiru-tosi-tutatokoro><a aria-label="Anchor link for: anticdkdatutawatasiga-cdk-dekiru-tosi-tutatokoro" class=zola-anchor href=#anticdkdatutawatasiga-cdk-dekiru-tosi-tutatokoro><a href="https://www.youtube.com/watch?v=O2JXUyOBjt8&t=21915s" rel=external>アンチCDKだったわたしが「CDK、できる・・」と思ったところ</a></a></h2><p>Speaker: 岡智也(Accenture) さん<p>歳をとると新しいものに対して否定的になりがちということからお話しされておりました。<blockquote><p>は? CDK? CFnとTerraformあるし</blockquote><p>これなんかは自分も全く同じ感想でした。あとAWSとGCPの管理が異なる技術スタックになることもネガティブ要因でした。 <a href=https://www.oreilly.com/library/view/aws-cookbook/9781492092599/ rel=external>AWS Cookbook</a>は知らなかったのでぜひ読んでみようと思いました。著者はAWSの中の人だそうです!<h2 id=aws-outposts-shang-norisosuwo-cdk-suru><a aria-label="Anchor link for: aws-outposts-shang-norisosuwo-cdk-suru" class=zola-anchor href=#aws-outposts-shang-norisosuwo-cdk-suru><a href="https://www.youtube.com/watch?v=O2JXUyOBjt8&t=23293s" rel=external>AWS Outposts 上のリソースを CDK する</a></a></h2><p>Speaker: 福田優真(NTT Communications イノベーションセンター) さん<h3 id=aws-outpoststoha><a aria-label="Anchor link for: aws-outpoststoha" class=zola-anchor href=#aws-outpoststoha>AWS Outpostsとは</a></h3><p>AWS Outpostsとは、AWSの出すハイブリッドクラウド製品。<br> ハイブリッドクラウドとは<ul><li>オンプレミスにクラウドサービスを導入するためのソリューション<li>Azure/GCP/AWS 各社が展開中 <ul><li>Azure Stack Hub/HCI<li>GCP Anthos/Distributed Cloud</ul><li>データをPublicな場所に流さなくてもクラウドサービスを利用できるようになる</ul><p>ユースケースとしては<ul><li>低レイテンシーなコンピューティング<li>ローカルなデータ処理<li>データレジデンしー<li>オンプレミス環境のモダナイズ</ul><p>AWS Outposts上のリソースをCDKで管理されたお話しでした。AWSとオンプレ環境をどう管理していくかは興味があるところなので試してみたいと思いました。<h3 id=kasutamurisosu><a aria-label="Anchor link for: kasutamurisosu" class=zola-anchor href=#kasutamurisosu>カスタムリソース</a></h3><ul><li>Cloudformationが対応していないリソースを管理する仕組み<li>作成/更新/削除のライフサイクルをLambdaで管理<li>CDKでやる場合はprovider frameworkというAWSが提供するフレームワークに則ってLambdaを用意するだけ　</ul><p>Outpostsで対応できない処理はカスタムリソースを駆使して対応されたそうです。<h2 id=matome><a aria-label="Anchor link for: matome" class=zola-anchor href=#matome>まとめ</a></h2><ul><li>BLEAやcdktfを知れてよかった<li>問題意識は結構皆さん同じなんだなと思った<li>AWS Cookbookを読む</ul><div class=footnote-definition id=speaker><sup class=footnote-definition-label>1</sup><p>speakerの表記はyoutubeのdescriptionに準拠しています。</div></div></article></main><footer class=blog-footer><p>© 2026 <a href=https://blog.ymgyt.io> ymgyt </a> | Made with <a href=https://www.getzola.org rel=noopener target=_blank>Zola</a> | <a href=https://github.com/ymgyt/blog>Repository</a> | <a href=https://blog.ymgyt.io/atom.xml target=_blank title=rss> <svg viewbox="0 0 24 24" class=icon fill=none height=24 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx=5 cy=19 r=1></circle></svg> </a></footer></div></div>