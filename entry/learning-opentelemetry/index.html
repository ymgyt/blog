<!doctype html><html lang=ja><head><meta charset=UTF-8><meta content="width=device-width,initial-scale=1" name=viewport><link href=https://blog.ymgyt.io/favicon.ico rel=icon sizes=any><link href=https://blog.ymgyt.io/icon.svg rel=icon type=image/svg+xml><link href=https://blog.ymgyt.io/apple-touch-icon.png rel=apple-touch-icon><link href=https://blog.ymgyt.io/manifest.webmanifest rel=manifest><link href=https://blog.ymgyt.io/style.css rel=stylesheet><link href=https://blog.ymgyt.io/atom.xml rel=alternate title=Atom type=application/atom+xml><script src="https://www.googletagmanager.com/gtag/js?id=G-GTB0KMLN90" async></script><script>window.dataLayer = window.dataLayer || [];
	function gtag() {dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-GTB0KMLN90');</script><title>ğŸ“— Learning OpenTelemetryã‚’èª­ã‚“ã æ„Ÿæƒ³ | Happy developing</title><meta content="Observability is a commitment" name=description><meta content=summary name=twitter:card><meta content="@YAmaguchixt " name=twitter:site><meta content="ğŸ“— Learning OpenTelemetryã‚’èª­ã‚“ã æ„Ÿæƒ³" name=twitter:title><meta content="Observability is a commitment" name=twitter:description><meta content=https://blog.ymgyt.io/images/emoji/green_book.png name=twitter:image><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><body><div class=world><div class=content-container><header class=blog-header-container><div class=blog-logo><a href=https://blog.ymgyt.io>Happy developing</a></div><div class=blog-nav><nav><ul><li><a href=https://blog.ymgyt.io/entry/>Entries</a><li><a href=https://blog.ymgyt.io/tags/>Tags</a><li><a href=https://blog.ymgyt.io/about/>About</a><li><a href=https://github.com/ymgyt> <img alt=Github class=icon src=https://blog.ymgyt.io/images/icon/github.svg> </a><li><a href="https://twitter.com/YAmaguchixt "> <img alt=Twitter class=icon src=https://blog.ymgyt.io/images/icon/twitter.svg> </a></ul></nav></div></header><main class=blog-main><article><header class=entry-header><h1 class=entry-title>ğŸ“— Learning OpenTelemetryã‚’èª­ã‚“ã æ„Ÿæƒ³</h1><div class=entry-meta><p class=entry-meta-item>ğŸ—“ 2024-03-29<p class=entry-meta-item>ğŸ· <span class=tag><a href=https://blog.ymgyt.io/tags/book/>book</a></span> <span class=tag><a href=https://blog.ymgyt.io/tags/opentelemetry/>opentelemetry</a></span></div></header><aside class=entry-toc><nav><ul class=entry-toc-toplevel-list><li><a href=https://blog.ymgyt.io/entry/learning-opentelemetry/#du-ndaben>èª­ã‚“ã æœ¬</a><li><a href=https://blog.ymgyt.io/entry/learning-opentelemetry/#matome>ã¾ã¨ã‚</a><li><a href=https://blog.ymgyt.io/entry/learning-opentelemetry/#chapter-1-the-state-of-modern-observability>Chapter 1 The State of Modern Observability</a><li><a href=https://blog.ymgyt.io/entry/learning-opentelemetry/#chapter-2-why-use-opentelemetry>Chapter 2 Why Use OpenTelemetry</a><li><a href=https://blog.ymgyt.io/entry/learning-opentelemetry/#chapter-3-opentelemetry-overview>Chapter 3 OpenTelemetry Overview</a><li><a href=https://blog.ymgyt.io/entry/learning-opentelemetry/#chapter-4-the-opentelemetry-architecture>Chapter 4 The OpenTelemetry Architecture</a><li><a href=https://blog.ymgyt.io/entry/learning-opentelemetry/#chapter-5-instrumenting-applications>Chapter 5 Instrumenting Applications</a><li><a href=https://blog.ymgyt.io/entry/learning-opentelemetry/#chapter-6-instrumenting-libraries>Chapter 6 Instrumenting Libraries</a><li><a href=https://blog.ymgyt.io/entry/learning-opentelemetry/#chapter-7-observing-infrastructure>Chapter 7 Observing Infrastructure</a><li><a href=https://blog.ymgyt.io/entry/learning-opentelemetry/#chapter-8-designing-telemetry-pipelines>Chapter 8 Designing Telemetry Pipelines</a><li><a href=https://blog.ymgyt.io/entry/learning-opentelemetry/#chapter-9-rolling-out-observability>Chapter 9 Rolling Out Observability</a><li><a href=https://blog.ymgyt.io/entry/learning-opentelemetry/#appendix-a-the-opentelemetry-project>Appendix A The OpenTelemetry Project</a><li><a href=https://blog.ymgyt.io/entry/learning-opentelemetry/#appendix-b-further-resources>Appendix B Further Resources</a></ul></nav></aside><div class=entry-content><h2 id=du-ndaben><a aria-label="Anchor link for: du-ndaben" class=zola-anchor href=#du-ndaben>èª­ã‚“ã æœ¬</a></h2><a href=https://learning.oreilly.com/library/view/learning-opentelemetry/9781098147174/> <figure><div class=fig-images-row><img , alt src=images/otelbook.jpeg></div><figcaption>Learning OpenTelemetry</figcaption></figure> </a><p>è‘—è€…: Ted Young, Austin Parker<p>OpenTelemetryã‚’å°å…¥ã—ã‚ˆã†ã¨ã—ã¦ã„ãŸã¨ã“ã‚ã€ã¡ã‚‡ã†ã©ã‚ªãƒ©ã‚¤ãƒªãƒ¼ã‹ã‚‰æœ¬ãŒå‡ºãŸã®ã§èª­ã‚“ã§ã¿ã¾ã—ãŸã€‚<br> æœ¬è¨˜äº‹ã§ã¯æœ¬æ›¸ã‚’èª­ã‚“ã æ„Ÿæƒ³ã«ã¤ã„ã¦æ›¸ãã¾ã™ã€‚<h2 id=matome><a aria-label="Anchor link for: matome" class=zola-anchor href=#matome>ã¾ã¨ã‚</a></h2><p>OpenTelemetryã®å…¨ä½“åƒã‚’æ´ã‚€ã†ãˆã§ã¨ã¦ã‚‚å‚è€ƒã«ãªã‚Šã¾ã—ãŸã€‚<br> æœ€åˆã«OpenTelemetryã®docã‚’èª­ã‚“ã ã¨ãã¯ã€signalã‚„apiã¨sdkã®é–¢ä¿‚ãŒã‚ã‹ã‚Šã¥ã‚‰ã‹ã£ãŸã®ã§ã€ã‚‚ã£ã¨æ—©ãã“ã®æœ¬ã‚’èª­ã¿ãŸã‹ã£ãŸã§ã™ã€‚<h2 id=chapter-1-the-state-of-modern-observability><a aria-label="Anchor link for: chapter-1-the-state-of-modern-observability" class=zola-anchor href=#chapter-1-the-state-of-modern-observability>Chapter 1 The State of Modern Observability</a></h2><p>ç¾åœ¨ã®observabilityã‚’å–ã‚Šå·»ãçŠ¶æ³ã«ã¤ã„ã¦ã‹ã‚‰å§‹ã¾ã‚Šã¾ã™ã€‚<p>ç¾ä»£ã®softwareã§ã¯end user experienceãŒéå¸¸ã«é‡è¦–ã•ã‚Œã¦ã„ã‚‹(ECã§ã¯loadã«2secã‹ã‹ã‚‹ã¨userãŒé›¢è„±ã™ã‚‹ã‚‰ã—ã„)ã€‚ä¸€æ–¹ã§é–‹ç™ºè€…ã«ã¯uptime requirementsã‚‚èª²ã•ã‚Œã¦ã„ã‚‹ã€‚ãã®ãŸã‚ã€issueã®ç´ æ—©ã„ç‰¹å®šãŒå¿…è¦ã§ã€ãã‚Œã«ã¯dataã€ã—ã‹ã‚‚ãŸã ã®dataã§ã¯ãªãæ•´ç†ã•ã‚Œåˆ†æã®ç”¨ã«ä¾›ã•ã‚Œã‚‹çŠ¶æ…‹ã«ãªã£ã¦ã„ã‚‹dataãŒå¿…è¦ã€‚<br> OpenTelemtryã¯ã“ã‚Œã‚‰ã®å•é¡Œã‚’logs,metrics,tracesã‚’coherentãªunifed graph of informationã«ã‹ãˆã‚‹ã“ã¨ã§è§£æ±ºã™ã‚‹ã€‚ã€€ã€€<p>ç”¨èªã®èª¬æ˜ã¨ã—ã¦<ul><li>telemetry: describes what your system is doing<li>signalã¯particular form of telemetry <ul><li>signalã¯instrumentationã¨transmission systemã®2ã¤ã‹ã‚‰ãªã‚‹ <ul><li>instrumentationã¯telemetry dataã‚’emitã™ã‚‹code<li>transmission systemã¯dataã‚’networkè¶Šã—ã«analysis toolã«é€ã‚‹</ul></ul><li>ã“ã®telemetryã‚’emitã™ã‚‹systemã¨analyzeã™ã‚‹systemã‚’åˆ†é›¢ã™ã‚‹ã“ã¨ãŒé‡è¦<li>telemetry + analysis = observability</ul><p>ã®èª¬æ˜ã¯ã‚ã‹ã‚Šã‚„ã™ã‹ã£ãŸã§ã™ã€‚<p>Logs,Metrics,TracesãŒ3æœ¬æŸ±ã¨å‘¼ã°ã‚Œã‚‹ã®ã¯æ­´å²çš„ã«ãã®é †ç•ªã§systemã«è¿½åŠ ã•ã‚ŒãŸã‹ã‚‰ã§ã‚ã£ã¦<blockquote><p>The three pillars are a great way to describe how we currently practice observabilityâ€”but theyâ€™re actually a terrible way to design a telemetry system!</blockquote><p>ã¨ã¯ã£ãã‚Šã€terrible wayã¨ã•ã‚Œã¦ã„ãŸã®ãŒæ„å¤–ã§ã—ãŸã€‚<br> "three pillars"ã¨å‘¼ã¶ã¨ãªã«ã‹ã‚ˆã„architectureã«èã“ãˆã‚‹ã®ã§ã€"three browser tabs of observability"ã¨å‘¼ã¶è©±ã¯ãŠã‚‚ã—ã‚ã„ã§ã™ã€‚<p>å¤§åˆ‡ãªã®ã¯data streamã®correlationsã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãªã®ã§<blockquote><p>three pillars are acutually a bad design!</blockquote><p>ã¨ã„ã†ã“ã¨ã§OpenTelemetryãŒå¿…è¦ã¨ãªã‚Šã¾ã™ã€‚<br> ã¾ãŸã€ã“ã®æœ¬ã¯OpenTelemetryã®å…¬å¼documentã«ä»£ã‚ã‚‹ã“ã¨ã¯æ„å›³ã—ã¦ãŠã‚‰ãšphilosophyã¨designã®èª¬æ˜ã‚’æ„å›³ã—ã¦ã„ã‚‹ã¨ã‚ã‚Šã¾ã—ãŸã€‚<h2 id=chapter-2-why-use-opentelemetry><a aria-label="Anchor link for: chapter-2-why-use-opentelemetry" class=zola-anchor href=#chapter-2-why-use-opentelemetry>Chapter 2 Why Use OpenTelemetry</a></h2><p>Production debuggingã®3ã¤ã®èª²é¡Œã‹ã‚‰ã¯ã˜ã‚ã¦ãªãœOpenTelemetryã‚’ä½¿ã†ã®ã‹ãŒèª¬æ˜ã•ã‚Œã¾ã™ã€‚ã¾ãŸã€ã“ã‚Œã‚‰ã®èª²é¡Œã¯high-quality, standard-based, consistent telemetry dataã®æ¬ å¦‚ã‹ã‚‰ç”Ÿã˜ã‚‹ã¨ã—ã¦ã€Hard and Soft Context, Telemetry Layering, Semantic Telemetryã¨ã„ã†è€ƒãˆæ–¹ãŒç´¹ä»‹ã•ã‚Œã¾ã™ã€‚<h2 id=chapter-3-opentelemetry-overview><a aria-label="Anchor link for: chapter-3-opentelemetry-overview" class=zola-anchor href=#chapter-3-opentelemetry-overview>Chapter 3 OpenTelemetry Overview</a></h2><p>OpenTelemetryã§æ‰±ã‚ã‚Œã‚‹ã€Traces, Metrics, Logs, Context, Attributes/Resources, Semantic Conventions, OTLP, Telemetry Schemasç­‰ã®æ¦‚è¦ãŒèª¬æ˜ã•ã‚Œã¾ã™ã€‚<p>Semanti conventionsã«é–¢ã—ã¦ã€ã‚ã‚‹prometheusã®maintainerã®æ–¹ãŒ<blockquote><p>these semantic conventions are the most valuable thing Iâ€™ve seen in a while.</blockquote><p>ã¨è©±ã•ã‚ŒãŸã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰ãŒå°è±¡çš„ã§ã—ãŸã€‚<br> å€‹äººçš„ã«ã¯prodã¨ã‹stagingã®keyã‚’<code>deployment.environment</code>ã¨ã—ãŸã‚Šã€userã®idã‚’<code>enduser.id</code>ã¨æ±ºã‚ãŸã“ã¨ã¯ã„ã‚ã„ã‚ãªtoolã§åˆ©ç”¨ã§ããã†ã ãªã¨æ€ã£ã¦ã„ã¾ã™ã€‚<p>ã¾ãŸã€<blockquote><p>you can write a semantic conventions library yourself that includes attributes and values that are specific to your technology stack or services.</blockquote><p>ã¨ã—ã¦å…¬å¼ã®conventionsä»¥å¤–ã«ã‚‚ãƒãƒ¼ãƒ ã‚„çµ„ç¹”ã§ã‚‚conventionsã‚’ä½œã£ã¦ã„ãã®ã¯ã‚ˆã„è€ƒãˆã ãªã¨æ€ã„ã¾ã—ãŸã€‚(ãªã‚“ã‚‰ã‹ã®æ–¹æ³•ã§å„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èªã¸ã®ç”Ÿæˆã®ä»•çµ„ã¿ã¯å¿…è¦ãã†ã§ã™ãŒ)<p><a href=https://openslo.com/ rel=external>OpenSLO</a>ã‚„<a href=https://openfeature.dev/ rel=external>OpenFeature</a>ã¸ã®è¨€åŠã‚‚ã‚ã‚Šã¾ã—ãŸã€‚<h2 id=chapter-4-the-opentelemetry-architecture><a aria-label="Anchor link for: chapter-4-the-opentelemetry-architecture" class=zola-anchor href=#chapter-4-the-opentelemetry-architecture>Chapter 4 The OpenTelemetry Architecture</a></h2><p>OpenTelemetryã®å„ç¨®componentã®æ¦‚è¦ã®èª¬æ˜ã¨å®Ÿéš›ã®demoã®ç´¹ä»‹ãŒã‚ã‚Šã¾ã™ã€‚<blockquote><p>What OpenTelemetry does not include is almost as critical as what it does include. Long-term storage, analysis, GUIs, and other frontend components are not included and never will be.</blockquote><p>(OpenTelemetryãŒæ‰±ã‚ãªã„ã‚‚ã®ã¯æ‰±ã£ã¦ã„ã‚‹ã‚‚ã®ã¨åŒã˜ãã‚‰ã„é‡è¦ã§ã™ã€‚æ°¸ç¶šåŒ–ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã€åˆ†æç”¨ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ç­‰ã¯å«ã¾ã‚Œã¦ãŠã‚‰ãšã€ã“ã‚Œã‹ã‚‰ã‚‚å«ã¾ã‚Œãªã„ã§ã—ã‚‡ã†)<p>ã¨ã„ã†æ„Ÿã˜ã§ã€OpenTelemetryã ã‘ã§ã¯ã€å®Ÿéš›ã®é‹ç”¨ãŒå®Œçµã—ãªã„ç‚¹ãŒå¼·èª¿ã•ã‚Œã¦ã„ã¾ã™ã€‚<br> ã“ã“ã‚’vendorã‚„OSSã«ã¾ã‹ã›ã‚‹ã¨ã„ã†ã¨ã“ã‚ãŒopentelemetryæ™®åŠã®éµãªã®ã‹ãªã¨ã‹æ€ã£ã¦ã„ã¾ã™ã€‚(vendorã‚„ossãŒå”åŠ›ã—ã¦ãã‚Œã‚‹(ã›ã–ã‚‹ã‚’å¾—ãªã„))<p>æœ€å¾Œã«"The new model of observability tools"ã¨ã„ã†å°†æ¥åƒãŒè¼‰ã£ã¦ã„ã‚‹ã®ã§ã™ãŒãã“ã«ã‚ã‚‹ã€universal query apiãŒã¯ã‚„ãå®Ÿç”¨åŒ–ã•ã‚Œã¦ã»ã—ã„ã¨æ€ã£ã¦ã„ã¾ã™ã€‚<br> æœ¬æ›¸ã§ã¯ç´¹ä»‹ã•ã‚Œã¦ã„ã¾ã›ã‚“ã§ã—ãŸãŒã€<a href=https://www.cncf.io/blog/2023/08/03/streamlining-observability-the-journey-towards-query-language-standardization/ rel=external>query language standardization</a>ãŒæ°—ã«ãªã£ã¦ã„ã¾ã™ã€‚<h2 id=chapter-5-instrumenting-applications><a aria-label="Anchor link for: chapter-5-instrumenting-applications" class=zola-anchor href=#chapter-5-instrumenting-applications>Chapter 5 Instrumenting Applications</a></h2><p>Applicationã¸ã®è¨ˆè£…ã«ã¤ã„ã¦ã€‚<br> OpenTelemetryã«ãŠã‘ã‚‹SDKã¨APIã®è²¬å‹™ã®é•ã„ç­‰ã®èª¬æ˜ãŒã‚ã‚Šã¾ã™ã€‚<br> è‡ªå‹•è¨ˆè£…ã«å¯¾å¿œã—ã¦ã„ã‚‹è¨€èªã¨ã—ã¦ã€Javaã‚„Node.js, pythonãŒæŒ™ã’ã‚‰ã‚Œã¦ã„ã¾ã™ãŒã€GoãŒeBPFã‚’åˆ©ç”¨ã—ã¦å¯¾å¿œã—ã¦ã„ã‚‹ã®ãŒã™ã”ã„ã§ã™ã€‚Rustã«ã¯ç¾çŠ¶ã€è‡ªå‹•è¨ˆè£…ã¯ãªãã€å¯¾å¿œã™ã‚‹ã«ã¯GoåŒæ§˜ã€eBPFã‚’ä½¿ã†ã‚‚ã®ã«ãªã‚‹ã®ã§ã—ã‚‡ã†ã‹ã€‚ <a href=https://github.com/open-telemetry/opentelemetry-rust/issues/801 rel=external>issue</a>ã¯ã‚ã‚‹ã®ã§ã™ãŒã€ã‚ã¾ã‚Šç››ã‚Šä¸ŠãŒã£ã¦ã„ãªã„ã§ã™ã€‚<p>Traces,metrics,logsãã‚Œãã‚Œã®component(providerã‚„processor)ã®æ¦‚è¦ã®èª¬æ˜ã‚‚ã‚ã‚Šã¾ã™ã€‚<br> è‡ªåˆ†ã¯æœ€åˆã“ã®ã‚ãŸã‚Šã®èª¬æ˜ã‚’docã§èª­ã‚“ã§ã‚‚ãƒ”ãƒ³ã¨ã“ãªã‹ã£ãŸã®ã§ã™ãŒã€rustã®sdkã®å®Ÿè£…ã‚’ã¿ã¦ã¿ã‚‹ã¨ã€ä»•æ§˜é€šã‚Šã®å‹ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã¦ã€å…·ä½“çš„ãªã‚¤ãƒ¡ãƒ¼ã‚¸ãŒã‚ãã¾ã—ãŸã€‚ä¸€åº¦componentã®æ¦‚è¦ãŒã‚ã‹ã‚‹ã¨ã€åˆ¥ã®è¨€èªã§ã‚‚åŸºæœ¬çš„ã«ã¯åŒæ§˜ã®å‹ãŒã„ã‚‹ã¯ãšãªã®ã§ç†è§£ã‚‚é€²ã‚€ã¨æ€ã„ã¾ã™ã€‚(Metricsã®exporté »åº¦ã®è¨­å®šã¯PeriodicMetricsReaderãŒè¨­å®šã™ã‚‹ç­‰)<br> ãã®ä»–ã€è¨­å®šã«é–¢ã™ã‚‹Best practicesã‚‚ç´¹ä»‹ã•ã‚Œã¦ã„ã¾ã™ã€‚<br> Service resourceã¨ã—ã¦ã€<code>service.name</code>,<code>service.namespace</code>,<code>service.version</code>ã‚’è¨­å®šã—ã¦ãŠãã“ã¨ã®é‡è¦æ€§ãŒå¼·èª¿ã•ã‚Œã¦ã„ã¾ã™ã€‚ã“ã‚Œã‚‰ã¯åŸºæœ¬çš„ã«applicationã®buildæ™‚ã«ã‚ã‹ã‚‹ã¨æ€ã†ã®ã§ã€ä»˜ä¸ã™ã‚‹ã®ã¯ç‰¹ã«å•é¡Œãªã„ã®ã§ã™ãŒ<code>service.instance.id</code>ã¯runtimeæ™‚ã«ã—ã‹ã‚ã‹ã‚‰ãšã€ã—ã‹ã‚‚applicationè‡ªèº«ã‹ã‚‰ã ã¨(å¤–éƒ¨ã«å•ã„åˆã‚ã›ãªã„ã¨)ã‚ã‹ã‚‰ãªã„ã¨æ€ã†ã®ã§collectorå´ã§ä»˜ä¸ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã¨æ€ã£ã¦ã„ã¾ã™ã€‚<br> Grafana cloudã«exportã—ãŸéš›ã¯ã€<code>service.instance.id</code>ãŒloki,prometheusã®<code>instance</code> labelã«å¯¾å¿œã™ã‚‹<a href=https://grafana.com/docs/grafana-cloud/monitor-applications/application-observability/setup/resource-attributes/ rel=external>ä»•æ§˜</a>ã ã£ãŸã‚Šã§ã€å‰æã«ã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒã‚ã£ãŸã®ã§æ°—ã‚’ã¤ã‘ãŸã„ã§ã™ã€‚<p>ã¾ãŸã€RUM(Real User Monitoring)ã«ã¤ã„ã¦ã¯ç°¡å˜ã«under active developmentã¨ç´¹ä»‹ã•ã‚Œã¦ã„ã¾ã™ã€‚<br> ã“ã“ãŒæƒã‚ãªã„ã¨analysis toolä»¥å¤–ã®vendor agnosticãŒé”æˆã§ããªã„ã¨æ€ã£ã¦ã„ã‚‹ã®ã§æœŸå¾…ã—ãŸã„ã§ã™ã€‚<h2 id=chapter-6-instrumenting-libraries><a aria-label="Anchor link for: chapter-6-instrumenting-libraries" class=zola-anchor href=#chapter-6-instrumenting-libraries>Chapter 6 Instrumenting Libraries</a></h2><p>Libraryã¸ã®è¨ˆè£…ã«ã¤ã„ã¦ã€‚<br> LibraryãŒç›´æ¥opentelemetryã§è¨ˆè£…ã•ã‚Œã‚‹ã“ã¨ã®é‡è¦æ€§ãŒèª¬ã‹ã‚Œã¾ã™ã€‚hookç­‰ã‚’ç”¨æ„ã—ã¦ã€opentelemetryã‚’pluginçš„ã«å·®ã—è¾¼ã‚€ã®ã§ã¯ã©ã†ã—ã¦ãƒ€ãƒ¡ã‹ã®èª¬æ˜ãŒãªã‚‹ã»ã©ã§ã—ãŸã€‚<br> OpenTelemetryãŒanalysis toolã«ã¯è¸ã¿è¾¼ã¾ãšã€telemetryã®ç”Ÿæˆã¨ä¼æ’­ã¾ã§ã‚’ã‚¹ã‚³ãƒ¼ãƒ—ã¨ã—ã¦ã„ã‚‹ã“ã¨ã§ã€å¾—ã‚‰ã‚Œã‚‹vendorä¸­ç«‹æ€§ã®ãƒ¡ãƒªãƒƒãƒˆã¯libraryã®maintainerãŒè‡ªåˆ†ã‹ã‚‰è¨ˆè£…ã—ã¦ãã‚Œã‚‹ã“ã¨ã«ã‚ã‚‹ã®ã‹ãªã¨è€ƒãˆã¦ã„ã¾ã™ã€‚<blockquote><p>As a library maintainer, you have a relationship and a responsibility to your users.</blockquote><p>ã“ã“ã‚’èª­ã‚“ã§ã„ã¦ã€libraryã®public apiãŒå¤‰ã‚ã£ãŸã‚‰åŸºæœ¬çš„ã«ã¯semverã®major versionã‚’ä¸Šã’ã‚‹å¿…è¦ãŒã‚ã‚‹ã¨æ€ã„ã¾ã™ãŒã€libararyãŒç”Ÿæˆã™ã‚‹metricsã®åå‰ã‚„å‹(counterãŒhistrogramç­‰)ãŒå¤‰ã‚ã£ãŸå ´åˆã€ã©ã†ã„ã†æ‰±ã„ã«ãªã‚‹ã®ã‹ãªã¨æ€ã„ã¾ã—ãŸã€‚(applicationã®compileã¯å¤±æ•—ã—ãªã„ã§ã™ãŒã€userã®analysys toolã‚„alertã¯å£Šã‚Œã‚‹ã¨æ€ã†ã®ã§)<p>ã¾ãŸã€applicationãŒä¾å­˜ã—ã¦ã„ã‚‹library A,BãŒotel v1ã¨v2ã§ä¸€ç·’ã«ä½¿ãˆãªã„ã¨ã„ã†ã“ã¨ãŒèµ·ããªã„ã‚ˆã†ã«opentelemetryã«v2ã¯æ¥ãªã„ã¨ã„ã†è©±ã‚‚ç´¹ä»‹ã•ã‚Œã¾ã™ã€‚<h2 id=chapter-7-observing-infrastructure><a aria-label="Anchor link for: chapter-7-observing-infrastructure" class=zola-anchor href=#chapter-7-observing-infrastructure>Chapter 7 Observing Infrastructure</a></h2><p>Cloud provider(AWS,GCP, Azure,..)ã‚„platform(kubernetes,FaaS,CI/CD service)ã§opentelemetryã‚’ã©ã†æ´»ç”¨ã—ã¦ã„ãã‹ã«é–¢ã—ã¦è¿°ã¹ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚<br> OpenTelemetry Collectorã«é–¢ã—ã¦ã¯<a href=https://opentelemetry.io/docs/collector/custom-collector/ rel=external>builder</a>ã‚’ä½¿ã„ã¾ã—ã‚‡ã†ã§ã‚ã£ãŸã‚Šã€collectorè‡ªä¿¡ã®metricsã‚’å–å¾—ã™ã‚‹ã“ã¨ãŒã‚¢ãƒ‰ãƒã‚¤ã‚¹ã•ã‚Œã¦ã„ã¾ã™ã€‚<p>Kubernetesã«é–¢ã—ã¦ã¯collectorã®receiverã§æƒ…å ±ã‚’å–å¾—ã—ã‚ˆã†ã¨ã™ã‚‹ã¨<a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/receiver/k8sclusterreceiver rel=external>k8sclusterreiver</a>,<a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/receiver/k8seventsreceiver rel=external>k8seventreceiver</a>, <a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/receiver/k8sobjectsreceiver rel=external>k8sobjectreceiver</a>, <a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/receiver/kubeletstatsreceiver rel=external>kubeletstatsreceiver</a>ç­‰ãŒã‚ã£ã¦ã€ã†ã¾ã„ã“ã¨ä½¿ã„åˆ†ã‘ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ å°†æ¥çš„ã«ã¯1ã¤ã®receiverã«çµ±åˆã•ã‚Œã‚‹ã“ã¨ã‚’æœŸå¾…ã™ã‚‹ã¨ã‚ã£ãŸã®ã§ã€ãã†ãªã‚Œã°ã„ã„ãªã¨æ€ã„ã¾ã—ãŸã€‚<p>Traceã«<a href=https://opentelemetry.io/docs/concepts/signals/traces/#span-links rel=external>span links</a>ã¨ã„ã†fieldãŒã‚ã‚Šã„ã¾ã„ã¡ä½¿ã„æ‰€ãŒã‚ã‹ã£ã¦ã„ãªã‹ã£ãŸã®ã§ã™ãŒã€queueã‚’ä»‹ã—ãŸéåŒæœŸå‡¦ç†ã§ã®åˆ©ç”¨ä¾‹ãŒç´¹ä»‹ã•ã‚Œã¦ãŠã‚Šå‚è€ƒã«ãªã‚Šã¾ã—ãŸã€‚<h2 id=chapter-8-designing-telemetry-pipelines><a aria-label="Anchor link for: chapter-8-designing-telemetry-pipelines" class=zola-anchor href=#chapter-8-designing-telemetry-pipelines>Chapter 8 Designing Telemetry Pipelines</a></h2><p>Telemetry pipelineã€å…·ä½“çš„ã«ã¯opentelemetry collectorã«é–¢ã™ã‚‹è©±ã€‚<br> collectorãŒãªã„å ´åˆã®æ§‹æˆã‹ã‚‰å§‹ã¾ã‚Šã€applicationã¨åŒä¸€hostã§collectorã‚’å‹•ã‹ã™å ´åˆ, LoadBalanderè¶Šã—ã«è¤‡æ•°ã®collectorã‚’ç”¨æ„ã™ã‚‹æ§‹æˆç­‰ã®èª¬æ˜ãŒã‚ã‚Šã¾ã™ã€‚<br> Collectorã®æ©Ÿèƒ½ãŒä¸è¦ãªã‚‰å¿…ãšã—ã‚‚ä½¿ã†å¿…è¦ã¯ãªã„ã¨å‰ç½®ãã—ã¤ã¤ã‚‚ã€filteringã‚„samplingã€hostã‚„kubernetesã®æƒ…å ±å–å¾—ç­‰ã€collectorã‚’åˆ©ç”¨ã™ã‚‹ãƒ¡ãƒªãƒƒãƒˆãŒèª¬æ˜ã•ã‚Œã¾ã™ã€‚<br> <a href=https://github.com/open-telemetry/opamp-spec/blob/main/specification.md rel=external>Open Agent Management Protocol(OpAMP)</a>ã¨ã„ã†protocolã‚‚ç´¹ä»‹ã•ã‚Œã¦ãŠã‚Šã€å°†æ¥çš„ã«ã¯collectorã®è¨­å®šãŒã‚ˆã‚Šå®¹æ˜“ã«ãªã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚<br> å¤§è¦æ¨¡ã«ãªã‚‹ã¨ã€traceã‚„metricsã”ã¨ã«å°‚ç”¨ã®collector poolã‚’åˆ†ã‘ã‚‹æ§‹æˆã‚‚ç´¹ä»‹ã•ã‚Œã¦ã„ã¾ã—ãŸã€‚ã¾ã stableã«é”ã—ã¦ã„ãªã„ã‚‚ã®ã®ã€OTLPä»¥å¤–ã«ã‚‚<a href=https://github.com/open-telemetry/otel-arrow rel=external>Otel Arrow</a>ã¨ã„ã†protocolãŒã‚ã‚‹ã®ã¯çŸ¥ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚<p>Collectorã®æ§‹æˆã«ç¶šãã€filteringã‚„samplingã®è©±ã‚‚ã‚ã‚Šã¾ã™ã€‚<br> ç§ã¯samplingç‰¹ã«ã€head-basedã¨tail-basedã‚’ã©ã†ã—ã‚ˆã†ã‹è¿·ã£ã¦ã„ãŸã®ã§ã€æœ¬ç« ã®èª¬æ˜ã¯éå¸¸ã«å‚è€ƒã«ãªã‚Šã¾ã—ãŸã€‚<br> æ„å¤–ã ã£ãŸã®ã¯<blockquote><p>We donâ€™t suggest using head-based sampling in OpenTelemetry, since you could miss out on important traces.</blockquote><p>ã¨æ€ã£ãŸã‚ˆã‚Šã¯ã£ãã‚Šã€head-based samplingã‚’å‹§ã‚ãªã„ã¨æ›¸ã„ã¦ã‚ã£ãŸã“ã¨ã§ã™ã€‚ã¾ãŸ<blockquote><p>If sampling your logs sounds like a bad idea, why would you want to sample your traces?</blockquote><p>(logã‚’samplingã—ãªã„ã®ã«ã€ã©ã†ã—ã¦traceã‚’samplingã—ã‚ˆã†ã¨ã™ã‚‹ã®ã‹)<p>ã“ã‚Œã¯ç¢ºã‹ã«ãã®ã¨ãŠã‚Šã‹ã‚‚ã¨æ€ã‚ã•ã‚Œã¾ã—ãŸã€‚<p>ãã®ä»–ã€OTTLã‚„Connector,backpressure, kubernetes operatorç­‰ã€collectorã®å„ç¨®æ©Ÿèƒ½ãŒç´¹ä»‹ã•ã‚Œã¦ã„ã‚‹ã®ã§ã€æœ¬ç« ã‚’èª­ã‚“ã§ãŠãã¨collectorã®å…¨ä½“æ„ŸãŒã¤ã‹ã‚ã¦è‰¯ã„ã¨æ€ã„ã¾ã—ãŸã€‚<h2 id=chapter-9-rolling-out-observability><a aria-label="Anchor link for: chapter-9-rolling-out-observability" class=zola-anchor href=#chapter-9-rolling-out-observability>Chapter 9 Rolling Out Observability</a></h2><blockquote><p>Telemetry is not observability</blockquote><p>ã¨ã„ã†ã“ã¨ã§æœ€çµ‚ç« ã¯ã€çµ„ç¹”ã«ãŠã‘ã‚‹å®Ÿè·µã«ã¤ã„ã¦ã§ã™ã€‚<blockquote><p>Observability is a commitment to building teams, organizations, and software systems in ways that allow you to interpret, analyze, and question their results so you can build better teams, organizations, and software systems.</blockquote><p>ã“ã®observabilityã®å®šç¾©ãŒä¸€ç•ªå¥½ãã§ã™ã€‚<br> ã©ã†ã—ã¦ã‚‚ä¸€äººã§ã§ãã‚‹ã“ã¨ã§ã¯ãªãã€çµ„ç¹”çš„ãªé–¢ä¸ãŒå¿…è¦ã«ãªã‚‹ã®ã§ã€ã©ã†ã‚„ã£ã¦ã†ã¾ãé€²ã‚ã‚‹ã‹ã«ã¤ã„ã¦ã®èª¬æ˜ãŒã‚ã‚Šã¾ã™ã€‚<br> è¨ˆè£…ã‚’æœ€åˆã«æ·±ãã‚„ã‚‹ã‹ã€åºƒãæµ…ãã¯ã˜ã‚ã‚‹ã‹ã§ã‚ã£ãŸã‚Šã€codeã‚’å¤‰æ›´ã™ã‚‹ã‹ã€collectorå´ã§ãŒã‚“ã°ã‚‹ã‹ã§ã‚ã£ãŸã‚Šã€ä¸­å¤®ã®ä¸»å°ã™ã‚‹ãƒãƒ¼ãƒ ã‚’ä½œã£ãŸã‚Šç­‰ã®è©±ãŒã®ã£ã¦ã„ã¾ã—ãŸã€‚<p>Traceã‚„metricsã‚’testã§æ´»ç”¨ã—ã‚ˆã†ã¨ã„ã†è©±ã‚‚è¼‰ã£ã¦ãŠã‚Šã€æ™‚ã€…ãã†ã„ã†è¨˜äº‹ã‚‚ã¿ã‹ã‘ã‚‹ã®ã§æ³¨ç›®ã—ã¦ã„ããŸã„ã§ã™ã€‚<br> æœ€å¾Œã«OpenTelemetry Rollout ChecklistãŒè¼‰ã£ã¦ãŠã‚Šå‚è€ƒã«ãªã‚Šã¾ã™ã€‚<br> Is management involved?ã®ã‚ˆã†ãªãƒã‚§ãƒƒã‚¯é …ç›®ãŒã‚ã‚Šã¾ã™ã€‚<h2 id=appendix-a-the-opentelemetry-project><a aria-label="Anchor link for: appendix-a-the-opentelemetry-project" class=zola-anchor href=#appendix-a-the-opentelemetry-project>Appendix A The OpenTelemetry Project</a></h2><p>SIGã§ã‚ã£ãŸã‚Šã€Specificationã§ã‚ã£ãŸã‚Šã€OpenTelemetryã¨ã„ã†projectãŒã©ã®ã‚ˆã†ã«é‹å–¶ã•ã‚Œã¦ã„ã‚‹ã‹ã®èª¬æ˜ãŒã‚ã‚Šã¾ã™ã€‚<h2 id=appendix-b-further-resources><a aria-label="Anchor link for: appendix-b-further-resources" class=zola-anchor href=#appendix-b-further-resources>Appendix B Further Resources</a></h2><p>OpenTelemetryé–¢é€£ã®Websiteã®ãƒªãƒ³ã‚¯ã¨é–¢é€£æ›¸ç±ã®ç´¹ä»‹ãŒã‚ã‚Šã¾ã™ã€‚</div></article></main><footer class=blog-footer><p>Â© 2026 <a href=https://blog.ymgyt.io> ymgyt </a> | Made with <a href=https://www.getzola.org rel=noopener target=_blank>Zola</a> | <a href=https://github.com/ymgyt/blog>Repository</a> | <a href=https://blog.ymgyt.io/atom.xml target=_blank title=rss> <svg viewbox="0 0 24 24" class=icon fill=none height=24 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx=5 cy=19 r=1></circle></svg> </a></footer></div></div>