<!doctype html><html lang=ja><head><meta charset=UTF-8><meta content="width=device-width,initial-scale=1" name=viewport><link href=https://blog.ymgyt.io/favicon.ico rel=icon sizes=any><link href=https://blog.ymgyt.io/icon.svg rel=icon type=image/svg+xml><link href=https://blog.ymgyt.io/apple-touch-icon.png rel=apple-touch-icon><link href=https://blog.ymgyt.io/manifest.webmanifest rel=manifest><link href=https://blog.ymgyt.io/style.css rel=stylesheet><link href=https://blog.ymgyt.io/atom.xml rel=alternate title=Atom type=application/atom+xml><script src="https://www.googletagmanager.com/gtag/js?id=G-GTB0KMLN90" async></script><script>window.dataLayer = window.dataLayer || [];
	function gtag() {dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-GTB0KMLN90');</script><title>ğŸ¦€  Rustã§GitHub GraphQL APIã‚’ä½¿ã£ã¦issueä¸€è¦§ã‚’å–å¾—ã™ã‚‹ | Happy developing</title><meta content=graphql-clientã‚’ä½¿ã£ã¦rustã‹ã‚‰graphqlã‚’åˆ©ç”¨ã™ã‚‹æ–¹æ³•ã«ã¤ã„ã¦ name=description><meta content=summary name=twitter:card><meta content="@YAmaguchixt " name=twitter:site><meta content="ğŸ¦€  Rustã§GitHub GraphQL APIã‚’ä½¿ã£ã¦issueä¸€è¦§ã‚’å–å¾—ã™ã‚‹" name=twitter:title><meta content=graphql-clientã‚’ä½¿ã£ã¦rustã‹ã‚‰graphqlã‚’åˆ©ç”¨ã™ã‚‹æ–¹æ³•ã«ã¤ã„ã¦ name=twitter:description><meta content=https://blog.ymgyt.io/images/emoji/crab.png name=twitter:image><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><body><div class=world><div class=content-container><header class=blog-header-container><div class=blog-logo><a href=https://blog.ymgyt.io>Happy developing</a></div><div class=blog-nav><nav><ul><li><a href=https://blog.ymgyt.io/entry/>Entries</a><li><a href=https://blog.ymgyt.io/tags/>Tags</a><li><a href=https://blog.ymgyt.io/about/>About</a><li><a href=https://github.com/ymgyt> <img alt=Github class=icon src=https://blog.ymgyt.io/images/icon/github.svg> </a><li><a href="https://twitter.com/YAmaguchixt "> <img alt=Twitter class=icon src=https://blog.ymgyt.io/images/icon/twitter.svg> </a></ul></nav></div></header><main class=blog-main><article><header class=entry-header><h1 class=entry-title>ğŸ¦€ Rustã§GitHub GraphQL APIã‚’ä½¿ã£ã¦issueä¸€è¦§ã‚’å–å¾—ã™ã‚‹</h1><div class=entry-meta><p class=entry-meta-item>ğŸ—“ 2023-03-20<p class=entry-meta-item>ğŸ· <span class=tag><a href=https://blog.ymgyt.io/tags/rust/>rust</a></span></div></header><aside class=entry-toc><nav><ul class=entry-toc-toplevel-list><li><a href=https://blog.ymgyt.io/entry/fetch-issues-using-github-graphql-api-in-rust/#zhun-bei>æº–å‚™</a><li><a href=https://blog.ymgyt.io/entry/fetch-issues-using-github-graphql-api-in-rust/#graphql-clientnoli-yong-fang-fa>graphql-clientã®åˆ©ç”¨æ–¹æ³•</a> <ul><li><a href=https://blog.ymgyt.io/entry/fetch-issues-using-github-graphql-api-in-rust/#schemanoqu-de>Schemaã®å–å¾—</a><li><a href=https://blog.ymgyt.io/entry/fetch-issues-using-github-graphql-api-in-rust/#querynozuo-cheng>Queryã®ä½œæˆ</a><li><a href=https://blog.ymgyt.io/entry/fetch-issues-using-github-graphql-api-in-rust/#rustnoxing-sheng-cheng>Rustã®å‹ç”Ÿæˆ</a><li><a href=https://blog.ymgyt.io/entry/fetch-issues-using-github-graphql-api-in-rust/#requestnoshi-xing>Requestã®å®Ÿè¡Œ</a><li><a href=https://blog.ymgyt.io/entry/fetch-issues-using-github-graphql-api-in-rust/#issueyi-lan-noqu-de>Issueä¸€è¦§ã®å–å¾—</a></ul><li><a href=https://blog.ymgyt.io/entry/fetch-issues-using-github-graphql-api-in-rust/#matome>ã¾ã¨ã‚</a></ul></nav></aside><div class=entry-content><p>ã“ã®è¨˜äº‹ã§ã¯<a href=https://github.com/graphql-rust/graphql-client rel=external>graphql-client</a>ã‚’ä½¿ã£ã¦Rustã‹ã‚‰<a href=https://docs.github.com/en/graphql rel=external>GitHub GraphQL API</a>ã‚’åˆ©ç”¨ã™ã‚‹æ–¹æ³•ã«ã¤ã„ã¦æ›¸ãã¾ã™ã€‚<br> å®Ÿéš›ã«ä½œæˆã—ãŸcliã¯<a href=https://github.com/ymgyt/gh-report-gen rel=external>ã“ã¡ã‚‰ã€‚</a><h2 id=zhun-bei><a aria-label="Anchor link for: zhun-bei" class=zola-anchor href=#zhun-bei>æº–å‚™</a></h2><p>GraphQL APIã‚’åˆ©ç”¨ã™ã‚‹ãŸã‚ã«Github Personal access tokens (PAT)ãŒå¿…è¦ã§ã™ã€‚<br> æœ¬è¨˜äº‹ã§ã¯Userã®issueä¸€è¦§ã‚’å–å¾—ã™ã‚‹ã®ã§Scopeã¯repoãŒå¿…è¦ã¨ãªã‚Šã¾ã™ã€‚<br> 2023/03/20ç¾åœ¨ã€fine-grained personal access tokenã¯GraphQL APIã§ã¯ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚<blockquote><p>The GraphQL API does not support authentication with fine-grained personal access tokens.</blockquote><p>ä»¥ä¸‹ã§ã¯ã€ä½œæˆã—ãŸPATãŒç’°å¢ƒå¤‰æ•°ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’å‰æã«ã—ã¦ã„ã¾ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=shellscript><span class=giallo-l><span style=color:#81a1c1>export</span><span> GH_PAT</span><span style=color:#81a1c1>=</span><span style=color:#eceff4>$(</span><span style=color:#88c0d0>cat</span><span style=color:#a3be8c> ./github_pat</span><span style=color:#eceff4>)</span></span></code></pre><h2 id=graphql-clientnoli-yong-fang-fa><a aria-label="Anchor link for: graphql-clientnoli-yong-fang-fa" class=zola-anchor href=#graphql-clientnoli-yong-fang-fa>graphql-clientã®åˆ©ç”¨æ–¹æ³•</a></h2><h3 id=schemanoqu-de><a aria-label="Anchor link for: schemanoqu-de" class=zola-anchor href=#schemanoqu-de>Schemaã®å–å¾—</a></h3><p>ã¾ãšGraphQL APIã®schemaã‚’å–å¾—ã—ã¾ã™ã€‚<br> graphql-clientã¯cliã‚‚æä¾›ã—ã¦ãã‚Œã¦ãŠã‚Šã€<code>cargo install graphq_client</code>ã§installã§ãã¾ã™ã€‚<br> schemaã®å–å¾—æ–¹æ³•ã¯ãªã‚“ã§ã‚‚ã‚ˆã„ã®ã§ã™ãŒã€ä¸Šè¨˜ã®cliã‚’ä½¿ã†å ´åˆã¯ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=shellscript><span class=giallo-l><span style=color:#88c0d0>graphql-client</span><span style=color:#a3be8c> introspect-schema https://api.github.com/graphql</span><span style=color:#ebcb8b> \</span></span>
<span class=giallo-l><span style=color:#a3be8c>    --header</span><span style=color:#eceff4> "</span><span style=color:#a3be8c>Authorization: bearer </span><span style=color:#81a1c1>${</span><span>GH_PAT</span><span style=color:#81a1c1>}</span><span style=color:#eceff4>"</span><span style=color:#ebcb8b> \</span></span>
<span class=giallo-l><span style=color:#a3be8c>    --header</span><span style=color:#eceff4> "</span><span style=color:#a3be8c>user-agent: rust-graphql-client</span><span style=color:#eceff4>"</span><span style=color:#81a1c1> ></span><span style=color:#a3be8c> ./schema.json</span></span></code></pre><h3 id=querynozuo-cheng><a aria-label="Anchor link for: querynozuo-cheng" class=zola-anchor href=#querynozuo-cheng>Queryã®ä½œæˆ</a></h3><p>æ¬¡ã«Rustã‹ã‚‰å®Ÿè¡Œã—ãŸã„queryã‚’æ›¸ãã¾ã™ã€‚<br> ã¾ãšsimpleã«PATã‚’ä½œæˆã—ãŸuserã‚’å–å¾—ã™ã‚‹queryã‚’æ›¸ã„ã¦ã¿ã¾ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=graphql><span class=giallo-l><span style=color:#81a1c1>query</span><span style=color:#88c0d0> Authenticate</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span>  viewer</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span>    login</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#eceff4>  }</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p><code>viewer</code> queryã®<a href=https://docs.github.com/en/graphql/reference/queries#viewer rel=external>doc</a>ã‚’å‚ç…§ã™ã‚‹ã¨The username used to loginã¨ã—ã¦<code>login</code>ãŒå–å¾—ã§ãã‚‹ã¨ã‚ã‹ã‚‹ã®ã§ãã‚Œã‚’å–å¾—ã—ã¾ã™ã€‚<h3 id=rustnoxing-sheng-cheng><a aria-label="Anchor link for: rustnoxing-sheng-cheng" class=zola-anchor href=#rustnoxing-sheng-cheng>Rustã®å‹ç”Ÿæˆ</a></h3><p>Schemaã¨queryãŒæƒã£ãŸã®ã§ã€graphql-clientã‚’åˆ©ç”¨ã—ã¦ã€request/responseå‹ã‚’ç”Ÿæˆã—ã¾ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>use</span><span> graphql_client</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>GraphQLQuery</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#5e81ac>#[derive(</span><span style=color:#8fbcbb>GraphQLQuery</span><span style=color:#5e81ac>)]</span></span>
<span class=giallo-l><span style=color:#5e81ac>#[graphql(</span></span>
<span class=giallo-l><span style=color:#5e81ac>    schema_path = "</span><span style=color:#a3be8c>src/github/gql/schema.json</span><span style=color:#5e81ac>",</span></span>
<span class=giallo-l><span style=color:#5e81ac>    query_path = "</span><span style=color:#a3be8c>src/github/gql/query.graphql</span><span style=color:#5e81ac>",</span></span>
<span class=giallo-l><span style=color:#5e81ac>    variables_derives = "</span><span style=color:#a3be8c>Debug</span><span style=color:#5e81ac>",</span></span>
<span class=giallo-l><span style=color:#5e81ac>    response_derives = "</span><span style=color:#a3be8c>Debug</span><span style=color:#5e81ac>"</span></span>
<span class=giallo-l><span style=color:#5e81ac>)]</span></span>
<span class=giallo-l><span style=color:#81a1c1>pub struct</span><span style=color:#8fbcbb> Authenticate</span><span style=color:#eceff4>;</span></span></code></pre><p><code>src/github/gql/query.rs</code>ã«ä¸Šè¨˜ã®ã‚ˆã†ã«å®šç¾©ã—ã¾ã™ã€‚<br> <code>schema_path</code>ã¨<code>query_path</code>ã«ã¯ã•ãã»ã©æº–å‚™ã—ãŸã€schema fileã¨query fileã®pathã‚’è¨˜è¼‰ã—ã¾ã™ã€‚project root(Cargo.toml)ã‹ã‚‰ã®ç›¸å¯¾pathã§ã™ã€‚ <code>Authenticate</code> structãŒ<code>query Authenticate</code>ã¨ä¸€è‡´ã•ã›ã¾ã™ã€‚ã“ã‚Œã¯graphql-clientå´ã®ç´„æŸäº‹ã§ã™ã€‚<br> <code>#[derive(GraphQLQuery)]</code>ã‚’å®šç¾©ã™ã‚‹ã¨<code>Authenticate</code>ã«methodãŒç”Ÿæˆã•ã‚Œã€<code>authenticate</code> moduleãŒä½œæˆã•ã‚Œã€queryã«å¯¾å¿œã™ã‚‹å‹ãŒç”Ÿæˆã•ã‚Œã¾ã™ã€‚<br> <code>{variables,response}_derives</code>ã¯ç”Ÿæˆã•ã‚Œã‚‹å‹ã«å®šç¾©ã—ãŸã„deriveã®æŒ‡å®šã§ã™ã€‚ä»Šå›ã¯<code>Debug</code>ã‚’ç”Ÿã‚„ã—ã¦ã„ã¾ã™ã€‚<h3 id=requestnoshi-xing><a aria-label="Anchor link for: requestnoshi-xing" class=zola-anchor href=#requestnoshi-xing>Requestã®å®Ÿè¡Œ</a></h3><p>ã“ã‚Œã§æº–å‚™ãŒæƒã£ãŸã®ã§å®Ÿéš›ã«requestã‚’å®Ÿè¡Œã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚<br> ã¾ãšã¯ã€<code>GithubClient</code>ã‚’å®šç¾©ã—ã¾ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>use</span><span> reqwest</span><span style=color:#81a1c1>::</span><span>header</span><span style=color:#81a1c1>::</span><span style=color:#eceff4>{</span><span style=color:#81a1c1>self</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> HeaderMap</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> HeaderValue</span><span style=color:#eceff4>};</span></span>
<span class=giallo-l><span style=color:#81a1c1>use crate::</span><span>github</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Pat</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>pub struct</span><span style=color:#8fbcbb> GithubClient</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span>    inner</span><span style=color:#81a1c1>:</span><span> reqwest</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Client</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>impl</span><span style=color:#8fbcbb> GithubClient</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    const</span><span> ENDPOINT</span><span style=color:#81a1c1>: &</span><span style=color:#8fbcbb>str</span><span style=color:#81a1c1> =</span><span style=color:#eceff4> "</span><span style=color:#a3be8c>https://api.github.com/graphql</span><span style=color:#eceff4>";</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#616e88>    /// Construct GithubClient.</span></span>
<span class=giallo-l><span style=color:#81a1c1>    pub fn</span><span style=color:#88c0d0> new</span><span style=color:#eceff4>(</span><span>pat</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Option</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Pat</span><span style=color:#eceff4>>)</span><span style=color:#81a1c1> -></span><span> anyhow</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Result</span><span style=color:#eceff4>&lt;</span><span style=color:#81a1c1>Self</span><span style=color:#eceff4>> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>        let</span><span> user_agent</span><span style=color:#81a1c1> =</span><span style=color:#88c0d0;font-weight:700> concat!</span><span style=color:#eceff4>(</span><span style=color:#88c0d0;font-weight:700>env!</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>CARGO_PKG_NAME</span><span style=color:#eceff4>"), "</span><span style=color:#a3be8c>/</span><span style=color:#eceff4>",</span><span style=color:#88c0d0;font-weight:700> env!</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>CARGO_PKG_VERSION</span><span style=color:#eceff4>"),);</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>        let mut</span><span> headers</span><span style=color:#81a1c1> =</span><span style=color:#8fbcbb> HeaderMap</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>new</span><span style=color:#eceff4>();</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>        if let</span><span style=color:#8fbcbb> Some</span><span style=color:#eceff4>(</span><span>pat</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> =</span><span> pat</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>            let mut</span><span> token</span><span style=color:#81a1c1> =</span><span style=color:#8fbcbb> HeaderValue</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>try_from</span><span style=color:#eceff4>(</span><span style=color:#88c0d0;font-weight:700>format!</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>bearer </span><span style=color:#ebcb8b>{}</span><span style=color:#eceff4>",</span><span> pat</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>into_inner</span><span style=color:#eceff4>()))</span><span style=color:#81a1c1>?</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span>            token</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>set_sensitive</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>true</span><span style=color:#eceff4>);</span></span>
<span class=giallo-l><span>            headers</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>insert</span><span style=color:#eceff4>(</span><span>header</span><span style=color:#81a1c1>::</span><span>AUTHORIZATION</span><span style=color:#eceff4>,</span><span> token</span><span style=color:#eceff4>);</span></span>
<span class=giallo-l><span style=color:#eceff4>        }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>        let</span><span> inner</span><span style=color:#81a1c1> =</span><span> reqwest</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>ClientBuilder</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>new</span><span style=color:#eceff4>()</span></span>
<span class=giallo-l><span style=color:#81a1c1>            .</span><span style=color:#88c0d0>user_agent</span><span style=color:#eceff4>(</span><span>user_agent</span><span style=color:#eceff4>)</span></span>
<span class=giallo-l><span style=color:#81a1c1>            .</span><span style=color:#88c0d0>default_headers</span><span style=color:#eceff4>(</span><span>headers</span><span style=color:#eceff4>)</span></span>
<span class=giallo-l><span style=color:#81a1c1>            .</span><span style=color:#88c0d0>timeout</span><span style=color:#eceff4>(</span><span>Duration</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>from_secs</span><span style=color:#eceff4>(</span><span style=color:#b48ead>10</span><span style=color:#eceff4>))</span></span>
<span class=giallo-l><span style=color:#81a1c1>            .</span><span style=color:#88c0d0>connect_timeout</span><span style=color:#eceff4>(</span><span>Duration</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>from_secs</span><span style=color:#eceff4>(</span><span style=color:#b48ead>10</span><span style=color:#eceff4>))</span></span>
<span class=giallo-l><span style=color:#81a1c1>            .</span><span style=color:#88c0d0>build</span><span style=color:#eceff4>()</span><span style=color:#81a1c1>?</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#8fbcbb>        Ok</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>Self</span><span style=color:#eceff4> {</span><span> inner</span><span style=color:#eceff4> })</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p>http clientã«ã¯<code>reqwest</code>ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚<br> PATã¯<code>authorization</code> headerã«è¨­å®šã—ã¾ã™ã€‚<br> Apiã®endpointã¯<code>https://api.github.com/graphql</code>ã§ã™ã€‚<p>Authenticate queryã‚’å®Ÿè¡Œã™ã‚‹å‡¦ç†ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«å®šç¾©ã—ã¾ã—ãŸã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>use crate::</span><span>github</span><span style=color:#81a1c1>::</span><span>gql</span><span style=color:#81a1c1>::</span><span>query</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>impl</span><span style=color:#8fbcbb> GithubClient</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#616e88>  /// Authenticated by current pat token, return github user name.</span></span>
<span class=giallo-l><span style=color:#81a1c1>    pub async fn</span><span style=color:#88c0d0> authenticate</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&self</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span> anyhow</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Result</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>String</span><span style=color:#eceff4>> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>        let</span><span> variables</span><span style=color:#81a1c1> =</span><span> query</span><span style=color:#81a1c1>::</span><span>authenticate</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Variables</span><span style=color:#eceff4> {};</span></span>
<span class=giallo-l><span style=color:#81a1c1>        let</span><span> req</span><span style=color:#81a1c1> =</span><span> query</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Authenticate</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>build_query</span><span style=color:#eceff4>(</span><span>variables</span><span style=color:#eceff4>);</span></span>
<span class=giallo-l><span style=color:#81a1c1>        let</span><span> res</span><span style=color:#81a1c1>:</span><span> query</span><span style=color:#81a1c1>::</span><span>authenticate</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>ResponseData</span><span style=color:#81a1c1> = self.</span><span style=color:#88c0d0>request</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&</span><span>req</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>.await?</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#8fbcbb>        Ok</span><span style=color:#eceff4>(</span><span>res</span><span style=color:#81a1c1>.</span><span>viewer</span><span style=color:#81a1c1>.</span><span>login</span><span style=color:#eceff4>)</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p>ä»Šå›åˆ©ç”¨ã™ã‚‹Authenticate queryã«ã¯å¼•æ•°ãŒãªã„ã®ã§ã€ç©ºã®<code>query::authenticate::Variables</code>ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚<br> ã“ã‚Œã¯ç”Ÿæˆã•ã‚ŒãŸå‹ãªã®ã§ã€queryã‚’æ›´æ–°ã™ã‚‹ã¨fieldãŒè‡ªå‹•ã§è¿½åŠ ã•ã‚Œã¾ã™ã€‚<br> æ¬¡ã«ã€<code>query::Authenciate</code>ã«ç”Ÿæˆã•ã‚ŒãŸ<code>build_query()</code>ã‚’åˆ©ç”¨ã—ã¦requestã‚’ç”Ÿæˆã—ã¾ã™ã€‚<br> å¾Œã¯ã“ã®requestã‚’jsonã§encodeã™ã‚‹ã ã‘ã§ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>use</span><span> graphql_client</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Response</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>impl</span><span style=color:#8fbcbb> GithubClient</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#5e81ac>  #[tracing::instrument(</span></span>
<span class=giallo-l><span style=color:#5e81ac>        level = tracing::</span><span style=color:#8fbcbb>Level</span><span style=color:#5e81ac>::</span><span style=color:#8fbcbb>TRACE</span><span style=color:#5e81ac>,</span></span>
<span class=giallo-l><span style=color:#5e81ac>        skip(self),</span></span>
<span class=giallo-l><span style=color:#5e81ac>        ret,</span></span>
<span class=giallo-l><span style=color:#5e81ac>    )]</span></span>
<span class=giallo-l><span style=color:#81a1c1>    async fn</span><span style=color:#88c0d0> request</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Body</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> ResponseData</span><span style=color:#eceff4>>(</span><span style=color:#81a1c1>&self</span><span style=color:#eceff4>,</span><span> body</span><span style=color:#81a1c1>: &</span><span style=color:#8fbcbb>Body</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span> anyhow</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Result</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>ResponseData</span><span style=color:#eceff4>></span></span>
<span class=giallo-l><span style=color:#81a1c1>    where</span></span>
<span class=giallo-l><span style=color:#8fbcbb>        Body</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Serialize</span><span style=color:#81a1c1> + ?</span><span style=color:#8fbcbb>Sized</span><span style=color:#81a1c1> +</span><span style=color:#8fbcbb> Debug</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#8fbcbb>        ResponseData</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> DeserializeOwned</span><span style=color:#81a1c1> +</span><span style=color:#8fbcbb> Debug</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#eceff4>    {</span></span>
<span class=giallo-l><span style=color:#81a1c1>        let</span><span> res</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Response</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>ResponseData</span><span style=color:#eceff4>></span><span style=color:#81a1c1> = self</span></span>
<span class=giallo-l><span style=color:#81a1c1>            .</span><span>inner</span></span>
<span class=giallo-l><span style=color:#81a1c1>            .</span><span style=color:#88c0d0>post</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>Self::</span><span>ENDPOINT</span><span style=color:#eceff4>)</span></span>
<span class=giallo-l><span style=color:#81a1c1>            .</span><span style=color:#88c0d0>json</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&</span><span>body</span><span style=color:#eceff4>)</span></span>
<span class=giallo-l><span style=color:#81a1c1>            .</span><span style=color:#88c0d0>send</span><span style=color:#eceff4>()</span></span>
<span class=giallo-l><span style=color:#81a1c1>            .await?</span></span>
<span class=giallo-l><span style=color:#81a1c1>            .</span><span style=color:#88c0d0>error_for_status</span><span style=color:#eceff4>()</span><span style=color:#81a1c1>?</span></span>
<span class=giallo-l><span style=color:#81a1c1>            .</span><span style=color:#88c0d0>json</span><span style=color:#eceff4>()</span></span>
<span class=giallo-l><span style=color:#81a1c1>            .await?</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>        match</span><span style=color:#eceff4> (</span><span>res</span><span style=color:#81a1c1>.</span><span>data</span><span style=color:#eceff4>,</span><span> res</span><span style=color:#81a1c1>.</span><span>errors</span><span style=color:#eceff4>) {</span></span>
<span class=giallo-l><span style=color:#eceff4>            (</span><span>_</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> Some</span><span style=color:#eceff4>(</span><span>errs</span><span style=color:#eceff4>))</span><span style=color:#81a1c1> if !</span><span>errs</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>is_empty</span><span style=color:#eceff4>()</span><span style=color:#81a1c1> =></span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>                for</span><span> err</span><span style=color:#81a1c1> in</span><span> errs</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>                    error!</span><span style=color:#eceff4>("</span><span style=color:#ebcb8b>{</span><span style=color:#a3be8c>err:?</span><span style=color:#ebcb8b>}</span><span style=color:#eceff4>");</span></span>
<span class=giallo-l><span style=color:#eceff4>                }</span></span>
<span class=giallo-l><span style=color:#8fbcbb>                Err</span><span style=color:#eceff4>(</span><span>anyhow</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0;font-weight:700>anyhow!</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>failed to request github api</span><span style=color:#eceff4>"))</span></span>
<span class=giallo-l><span style=color:#eceff4>            }</span></span>
<span class=giallo-l><span style=color:#eceff4>            (</span><span style=color:#8fbcbb>Some</span><span style=color:#eceff4>(</span><span>data</span><span style=color:#eceff4>),</span><span> _</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> =></span><span style=color:#8fbcbb> Ok</span><span style=color:#eceff4>(</span><span>data</span><span style=color:#eceff4>),</span></span>
<span class=giallo-l><span>            _</span><span style=color:#81a1c1> =></span><span style=color:#8fbcbb> Err</span><span style=color:#eceff4>(</span><span>anyhow</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0;font-weight:700>anyhow!</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>unexpected response</span><span style=color:#eceff4>",)),</span></span>
<span class=giallo-l><span style=color:#eceff4>        }</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p>requestã®å…±é€šå‡¦ç†ã§ã™ã€‚<br> <code>graphql_client::Response</code>ã¯graphqlã®responseã‚’è¡¨ã—ã¦ãŠã‚Šã€ä»¥ä¸‹ã®ã‚ˆã†ã«å®šç¾©ã•ã‚Œã¦ã„ã¾ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>pub struct</span><span style=color:#8fbcbb> Response</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Data</span><span style=color:#eceff4>> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    pub</span><span> data</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Option</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Data</span><span style=color:#eceff4>>,</span></span>
<span class=giallo-l><span style=color:#81a1c1>    pub</span><span> errors</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Option</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Vec</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Error</span><span style=color:#eceff4>>>,</span></span>
<span class=giallo-l><span style=color:#81a1c1>    pub</span><span> extensions</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Option</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>HashMap</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>String</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> Value</span><span style=color:#eceff4>>>,</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p><code>ResponseData</code>ã¯queryã”ã¨ã®responseã§ã€queryã«å¿œã˜ã¦ç”Ÿæˆã•ã‚Œã¾ã™ã€‚<br> ä»Šå›ã®queryã¯<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=graphql><span class=giallo-l><span style=color:#81a1c1>query</span><span style=color:#88c0d0> Authenticate</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span>  viewer</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span>    login</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#eceff4>  }</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p>ã®ã‚ˆã†ã«å®šç¾©ã—ãŸã®ã§ã€<code>res.viewer.login</code>ã®ã‚ˆã†ã«accessã§ãã¾ã™ã€‚ç›´æ„Ÿçš„ã§ã™ã­ã€‚<h3 id=issueyi-lan-noqu-de><a aria-label="Anchor link for: issueyi-lan-noqu-de" class=zola-anchor href=#issueyi-lan-noqu-de>Issueä¸€è¦§ã®å–å¾—</a></h3><p>requestã®å‡¦ç†ã®æµã‚ŒãŒã‚ã‹ã£ãŸã®ã§ã€issueä¸€è¦§ã‚’å–å¾—ã—ã¦ã¿ã¾ã™ã€‚ queryã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«å®šç¾©ã—ã¾ã—ãŸã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=graphql><span class=giallo-l><span style=color:#81a1c1>query</span><span style=color:#88c0d0> Issues</span><span>(</span></span>
<span class=giallo-l><span>  $user</span><span style=color:#eceff4>:</span><span style=color:#8fbcbb> String</span><span style=color:#81a1c1>!</span><span style=color:#eceff4>,</span><span> </span></span>
<span class=giallo-l><span>  $since</span><span style=color:#eceff4>:</span><span style=color:#8fbcbb> DateTime</span><span style=color:#81a1c1>!</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>  $after</span><span style=color:#eceff4>:</span><span style=color:#8fbcbb> String</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>  $first</span><span style=color:#eceff4>:</span><span style=color:#8fbcbb> Int</span><span style=color:#eceff4> =</span><span style=color:#b48ead> 20</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>)</span><span style=color:#eceff4>{</span></span>
<span class=giallo-l><span>  viewer</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span>    login</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>    issues(</span></span>
<span class=giallo-l><span>      filterBy</span><span style=color:#eceff4>:</span><span> {</span><span style=color:#a3be8c> assignee</span><span style=color:#eceff4>:</span><span> $user</span><span style=color:#a3be8c> since</span><span style=color:#eceff4>:</span><span> $since }</span><span style=color:#eceff4>,</span><span> </span></span>
<span class=giallo-l><span>      orderBy</span><span style=color:#eceff4>:</span><span> {</span><span style=color:#a3be8c> direction</span><span style=color:#eceff4>:</span><span style=color:#ebcb8b> ASC</span><span>,</span><span style=color:#a3be8c> field</span><span style=color:#eceff4>:</span><span style=color:#ebcb8b> CREATED_AT</span><span> }</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>      first</span><span style=color:#eceff4>:</span><span> $first</span><span style=color:#eceff4>,</span><span> </span></span>
<span class=giallo-l><span>      after</span><span style=color:#eceff4>:</span><span> $after</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>    )</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span>      totalCount</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>      pageInfo</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span>        endCursor</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>        hasNextPage</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#eceff4>      },</span></span>
<span class=giallo-l><span>      nodes</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span>        assignees(first</span><span style=color:#eceff4>:</span><span style=color:#b48ead> 10</span><span>)</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span>          nodes</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span>            login</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#eceff4>          },</span></span>
<span class=giallo-l><span style=color:#eceff4>        },</span></span>
<span class=giallo-l><span>        closed</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>        closedAt</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>        createdAt</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>        updatedAt</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>        number</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>        repository</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span>          name</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>          owner</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span>            __typename</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>            login</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#eceff4>          },</span></span>
<span class=giallo-l><span style=color:#eceff4>        },</span></span>
<span class=giallo-l><span>        state</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>        title</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>        url</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>        labels(orderBy</span><span style=color:#eceff4>:</span><span> {</span><span style=color:#a3be8c> direction</span><span style=color:#eceff4>:</span><span style=color:#ebcb8b>ASC</span><span>,</span><span style=color:#a3be8c> field</span><span style=color:#eceff4>:</span><span style=color:#ebcb8b> NAME</span><span> }</span><span style=color:#eceff4>,</span><span> first</span><span style=color:#eceff4>:</span><span style=color:#b48ead> 10</span><span>)</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span>          nodes</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span>            name</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#eceff4>          },</span></span>
<span class=giallo-l><span style=color:#eceff4>        },</span></span>
<span class=giallo-l><span>        trackedIssuesCount</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#a3be8c>        trackedClosedIssuesCount</span><span style=color:#eceff4>:</span><span> trackedIssuesCount(states</span><span style=color:#eceff4>:</span><span> [</span><span style=color:#ebcb8b>CLOSED</span><span>])</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#eceff4>      }</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l><span style=color:#eceff4>  }</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p><code>viewer.issues</code>ã®argument<code>filterBy</code>ã«<code>assignee</code>ã§å…ˆç¨‹å–å¾—ã—ãŸ<code>viewer.login</code>ã‚’æŒ‡å®šã—ã¾ã™ã€‚ã¾ãŸã€<code>since</code>ã‚’æŒ‡å®šã™ã‚‹ã¨æŒ‡å®šã•ã‚ŒãŸæ™‚ç‚¹ä»¥é™ã«ä½œæˆ/æ›´æ–°ã•ã‚ŒãŸissueã®ã¿ãŒå¯¾è±¡ã¨ãªã‚Šã¾ã™ã€‚<br> <code>Issues</code> queryã®å¼•æ•°<code>$since</code>ã§æŒ‡å®šã—ãŸ<code>DateTime!</code>ã¯GitHub schemaã§å®šç¾©ã•ã‚ŒãŸå‹ã§ã™ã€‚<br> ã“ã®queryã‚’Rustã‹ã‚‰ä½¿ã†ã«ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«å®šç¾©ã—ã¾ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>use</span><span> graphql_client</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>GraphQLQuery</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>use crate::</span><span>github</span><span style=color:#81a1c1>::</span><span>gql</span><span style=color:#81a1c1>::</span><span>scaler</span><span style=color:#81a1c1>::*</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#5e81ac>#[derive(</span><span style=color:#8fbcbb>GraphQLQuery</span><span style=color:#5e81ac>)]</span></span>
<span class=giallo-l><span style=color:#5e81ac>#[graphql(</span></span>
<span class=giallo-l><span style=color:#5e81ac>    schema_path = "</span><span style=color:#a3be8c>src/github/gql/schema.json</span><span style=color:#5e81ac>",</span></span>
<span class=giallo-l><span style=color:#5e81ac>    query_path = "</span><span style=color:#a3be8c>src/github/gql/query.graphql</span><span style=color:#5e81ac>",</span></span>
<span class=giallo-l><span style=color:#5e81ac>    variables_derives = "</span><span style=color:#a3be8c>Debug</span><span style=color:#5e81ac>",</span></span>
<span class=giallo-l><span style=color:#5e81ac>    response_derives = "</span><span style=color:#a3be8c>Debug</span><span style=color:#5e81ac>"</span></span>
<span class=giallo-l><span style=color:#5e81ac>)]</span></span>
<span class=giallo-l><span style=color:#81a1c1>pub struct</span><span style=color:#8fbcbb> Issues</span><span style=color:#eceff4>;</span></span></code></pre><p><code>use crate::github::gql::scaler::*;</code>ã«ç€ç›®ã—ã¦ãã ã•ã„ã€‚ã“ã‚Œã¯graphql-clientãŒscalerå‹ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ãŸã‚ã®ä»•çµ„ã¿ã§ã€<code>#[derive(GraphQLQuery)]</code>ã‚’æ›¸ã„ãŸscopeã§ã€<code>DateTime</code>å‹ã‚’è§£æ±ºã™ã‚‹ãŸã‚ã«è¿½åŠ ã—ã¦ã„ã¾ã™ã€‚<p><code>src/github/gql/mod.rs</code>ã«ä»¥ä¸‹ã®ã‚ˆã†ã«scaler moduleã‚’å®šç¾©ã—ã¾ã—ãŸã€‚(åˆ¥fileã«ã—ã¦ã‚‚ã„ã„ã§ã™)<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>pub</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>super</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> mod</span><span> scaler</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    use</span><span> serde</span><span style=color:#81a1c1>::</span><span style=color:#eceff4>{</span><span style=color:#8fbcbb>Deserialize</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> Serialize</span><span style=color:#eceff4>};</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#5e81ac>    #[allow(clippy::upper_case_acronyms)]</span></span>
<span class=giallo-l><span style=color:#81a1c1>    pub type</span><span style=color:#8fbcbb> URI</span><span style=color:#81a1c1> =</span><span style=color:#8fbcbb> String</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#5e81ac>    #[derive(</span><span style=color:#8fbcbb>Serialize</span><span style=color:#5e81ac>,</span><span style=color:#8fbcbb> Deserialize</span><span style=color:#5e81ac>,</span><span style=color:#8fbcbb> Debug</span><span style=color:#5e81ac>)]</span></span>
<span class=giallo-l><span style=color:#81a1c1>    pub struct</span><span style=color:#8fbcbb> DateTime</span><span style=color:#eceff4>(</span><span style=color:#8fbcbb>String</span><span style=color:#eceff4>);</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>    impl</span><span style=color:#8fbcbb> From</span><span style=color:#eceff4>&lt;</span><span style=color:#81a1c1>&</span><span>chrono</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>DateTime</span><span style=color:#eceff4>&lt;</span><span>chrono</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Utc</span><span style=color:#eceff4>>></span><span style=color:#81a1c1> for</span><span style=color:#8fbcbb> DateTime</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>        fn</span><span style=color:#88c0d0> from</span><span style=color:#eceff4>(</span><span>value</span><span style=color:#81a1c1>: &</span><span>chrono</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>DateTime</span><span style=color:#eceff4>&lt;</span><span>chrono</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Utc</span><span style=color:#eceff4>>)</span><span style=color:#81a1c1> -> Self</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#88c0d0>            DateTime</span><span style=color:#eceff4>(</span><span>value</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>to_rfc3339</span><span style=color:#eceff4>())</span></span>
<span class=giallo-l><span style=color:#eceff4>        }</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>    impl</span><span style=color:#8fbcbb> TryFrom</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>DateTime</span><span style=color:#eceff4>></span><span style=color:#81a1c1> for</span><span> chrono</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>DateTime</span><span style=color:#eceff4>&lt;</span><span>chrono</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Utc</span><span style=color:#eceff4>> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>        type</span><span style=color:#8fbcbb> Error</span><span style=color:#81a1c1> =</span><span> chrono</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>ParseError</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>        fn</span><span style=color:#88c0d0> try_from</span><span style=color:#eceff4>(</span><span>value</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> DateTime</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> Result</span><span style=color:#eceff4>&lt;</span><span style=color:#81a1c1>Self</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> Self::</span><span style=color:#8fbcbb>Error</span><span style=color:#eceff4>> {</span></span>
<span class=giallo-l><span>            chrono</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>DateTime</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>parse_from_rfc3339</span><span style=color:#eceff4>(</span><span>value</span><span style=color:#81a1c1>.</span><span style=color:#b48ead>0</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>as_str</span><span style=color:#eceff4>())</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>map</span><span style=color:#eceff4>(</span><span>Into</span><span style=color:#81a1c1>::</span><span>into</span><span style=color:#eceff4>)</span></span>
<span class=giallo-l><span style=color:#eceff4>        }</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p><code>URI</code>å‹ã¯ã€responseã«<code>URI</code> scaler typeãŒæŒ‡å®šã•ã‚Œã¦ã„ã‚‹ãŸã‚å¿…è¦ã«ãªã‚Šã¾ã™ã€‚<br> ã“ã®ã‚ˆã†ã«schemaå´ã§å®šç¾©ã•ã‚ŒãŸcustom scalerã«å¯¾å¿œã™ã‚‹å‹ã‚’Rustã§å®šç¾©ãªã„ã—useã—ã¦ä½¿ã†ã“ã¨ãŒã§ãã¾ã™ã€‚<br> GitHubã®å ´åˆã€<code>DateTime</code>å‹ã¯RFC3339 formatã§ã‚ã‚‹ã¨ã®ã“ã¨ã ã£ãŸã®ã§ã€<code>chrono</code>ã‚’åˆ©ç”¨ã—ã¦parseã—ã¦ã„ã¾ã™ã€‚<br> <code>URI</code>ã‚‚<code>String</code>ã§ãªãã€<code>http::Url</code>å‹ç­‰ã‚’åˆ©ç”¨ã—ã¦ã‚‚ã‚ˆã„ã¨æ€ã„ã¾ã™ã€‚<p>ã“ã®<code>Issues</code> queryã‚’Rustã‹ã‚‰åˆ©ç”¨ã™ã‚‹å‡¦ç†ãŒä»¥ä¸‹ã§ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>use</span><span> chrono</span><span style=color:#81a1c1>::</span><span style=color:#eceff4>{</span><span style=color:#8fbcbb>DateTime</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> Utc</span><span style=color:#eceff4>};</span></span>
<span class=giallo-l><span style=color:#81a1c1>use crate::</span><span>github</span><span style=color:#81a1c1>::</span><span>gql</span><span style=color:#81a1c1>::</span><span>query</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>impl</span><span style=color:#8fbcbb> GithubClient</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    pub async fn</span><span style=color:#88c0d0> query_issues</span><span style=color:#eceff4>(</span></span>
<span class=giallo-l><span style=color:#81a1c1>        &self</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>        gh_user</span><span style=color:#81a1c1>: impl</span><span style=color:#8fbcbb> Into</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>String</span><span style=color:#eceff4>>,</span></span>
<span class=giallo-l><span>        since</span><span style=color:#81a1c1>: &</span><span style=color:#8fbcbb>DateTime</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Utc</span><span style=color:#eceff4>>,</span></span>
<span class=giallo-l><span>        cursor</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Option</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>String</span><span style=color:#eceff4>>,</span></span>
<span class=giallo-l><span style=color:#eceff4>    )</span><span style=color:#81a1c1> -></span><span> anyhow</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Result</span><span style=color:#eceff4>&lt;</span><span>query</span><span style=color:#81a1c1>::</span><span>issues</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>ResponseData</span><span style=color:#eceff4>> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>        let</span><span> variables</span><span style=color:#81a1c1> =</span><span> query</span><span style=color:#81a1c1>::</span><span>issues</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Variables</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span>            user</span><span style=color:#81a1c1>:</span><span> gh_user</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>into</span><span style=color:#eceff4>(),</span></span>
<span class=giallo-l><span>            since</span><span style=color:#81a1c1>:</span><span> since</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>into</span><span style=color:#eceff4>(),</span></span>
<span class=giallo-l><span>            after</span><span style=color:#81a1c1>:</span><span> cursor</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>            first</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Some</span><span style=color:#eceff4>(</span><span style=color:#b48ead>100</span><span style=color:#eceff4>),</span></span>
<span class=giallo-l><span style=color:#eceff4>        };</span></span>
<span class=giallo-l><span style=color:#81a1c1>        let</span><span> req</span><span style=color:#81a1c1> =</span><span> query</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Issues</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>build_query</span><span style=color:#eceff4>(</span><span>variables</span><span style=color:#eceff4>);</span></span>
<span class=giallo-l><span style=color:#81a1c1>        let</span><span> res</span><span style=color:#81a1c1>:</span><span> query</span><span style=color:#81a1c1>::</span><span>issues</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>ResponseData</span><span style=color:#81a1c1> = self.</span><span style=color:#88c0d0>request</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&</span><span>req</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>.await?</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#8fbcbb>        Ok</span><span style=color:#eceff4>(</span><span>res</span><span style=color:#eceff4>)</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p>ä»Šå›ã®queryã§ã¯inputãŒã‚ã‚‹ã®ã§ã€å¯¾å¿œã™ã‚‹fieldãŒ<code>query::issues::Variables</code>ã«ç”Ÿæˆã•ã‚Œã¦ã„ã¾ã™ã€‚<br> queryå´ã®optionalã¯<code>Option</code>ã§è¡¨ç¾ã•ã‚Œã¦ã„ã¾ã™ã€‚<br> ä»Šå›ã®toolã§ã¯å…¨ä»¶å–å¾—ã—ãŸã„ã®ã§ã€ä»¥ä¸‹ã®å‡¦ç†ã‚’è¿½åŠ ã—ã¾ã—ãŸã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>impl</span><span style=color:#8fbcbb> GithubClient</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    pub async fn</span><span style=color:#88c0d0> query_issues_all</span><span style=color:#eceff4>(</span></span>
<span class=giallo-l><span style=color:#81a1c1>        &self</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>        gh_user</span><span style=color:#81a1c1>: impl</span><span style=color:#8fbcbb> Into</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>String</span><span style=color:#eceff4>>,</span></span>
<span class=giallo-l><span>        since</span><span style=color:#81a1c1>: &</span><span style=color:#8fbcbb>DateTime</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Utc</span><span style=color:#eceff4>>,</span></span>
<span class=giallo-l><span style=color:#eceff4>    )</span><span style=color:#81a1c1> -></span><span> anyhow</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Result</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Vec</span><span style=color:#eceff4>&lt;</span><span>query</span><span style=color:#81a1c1>::</span><span>issues</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>IssuesViewerIssuesNodes</span><span style=color:#eceff4>>> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>        let</span><span> gh_user</span><span style=color:#81a1c1> =</span><span> gh_user</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>into</span><span style=color:#eceff4>();</span></span>
<span class=giallo-l><span style=color:#81a1c1>        let</span><span> since</span><span style=color:#81a1c1> =</span><span> since</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>        let mut</span><span> cursor</span><span style=color:#81a1c1> =</span><span style=color:#8fbcbb> None</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>        let mut</span><span> issues</span><span style=color:#81a1c1> =</span><span style=color:#8fbcbb> Vec</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>new</span><span style=color:#eceff4>();</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>        loop</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>            let</span><span> res</span><span style=color:#81a1c1> = self.</span><span style=color:#88c0d0>query_issues</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&</span><span>gh_user</span><span style=color:#eceff4>,</span><span> since</span><span style=color:#eceff4>,</span><span> cursor</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>.await?</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>            if let</span><span style=color:#8fbcbb> Some</span><span style=color:#eceff4>(</span><span>new_issues</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> =</span><span> res</span><span style=color:#81a1c1>.</span><span>viewer</span><span style=color:#81a1c1>.</span><span>issues</span><span style=color:#81a1c1>.</span><span>nodes </span><span style=color:#eceff4>{</span></span>
<span class=giallo-l><span>                issues</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>extend</span><span style=color:#eceff4>(</span><span>new_issues</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>into_iter</span><span style=color:#eceff4>()</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>flatten</span><span style=color:#eceff4>());</span></span>
<span class=giallo-l><span style=color:#eceff4>            }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>            if !</span><span>res</span><span style=color:#81a1c1>.</span><span>viewer</span><span style=color:#81a1c1>.</span><span>issues</span><span style=color:#81a1c1>.</span><span>page_info</span><span style=color:#81a1c1>.</span><span>has_next_page </span><span style=color:#eceff4>{</span></span>
<span class=giallo-l><span style=color:#81a1c1>                break</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#eceff4>            }</span></span>
<span class=giallo-l><span>            cursor</span><span style=color:#81a1c1> =</span><span> res</span><span style=color:#81a1c1>.</span><span>viewer</span><span style=color:#81a1c1>.</span><span>issues</span><span style=color:#81a1c1>.</span><span>page_info</span><span style=color:#81a1c1>.</span><span>end_cursor</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#eceff4>        }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#8fbcbb>        Ok</span><span style=color:#eceff4>(</span><span>issues</span><span style=color:#eceff4>)</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><h2 id=matome><a aria-label="Anchor link for: matome" class=zola-anchor href=#matome>ã¾ã¨ã‚</a></h2><p>ç°¡å˜ã§ã¯ã‚ã‚Šã¾ã™ãŒã€Rustã‹ã‚‰graphql-clientã‚’åˆ©ç”¨ã—ã¦GraphQL APIã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚<br> queryã¯ç´ ã®GraphQLã‚’æ›¸ã„ã¦çµæœã«å¯¾å¿œã™ã‚‹å‹ã‚’Rustå´ã«ç”Ÿæˆã™ã‚‹ã¨ã„ã†å½¢ãŒä½¿ã„ã‚„ã™ã„ã¨æ€ã„ã¾ã—ãŸã€‚<br> ä»Šå›ã®codeã¯<code>gh-report-gen</code>ã¨ã„ã†toolã‚’ä½œæˆã™ã‚‹éš›ã«æ›¸ãã¾ã—ãŸã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=shellscript><span class=giallo-l><span style=color:#88c0d0>cargo</span><span style=color:#a3be8c> install gh-report-gen</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#88c0d0>gh-report-gen</span><span style=color:#a3be8c> --include myorg/</span><span style=color:#81a1c1>*</span><span style=color:#a3be8c> --exclude myorg/foo --since</span><span style=color:#eceff4> "</span><span style=color:#a3be8c>2023-03-01T00:00:00+09:00</span><span style=color:#eceff4>"</span><span>  </span></span></code></pre><p>ã®ã‚ˆã†ã«åˆ©ç”¨ã§ãã‚‹ã®ã§ã€æœ€è¿‘ã‚„ã£ãŸissueã‚’ä¸€è¦§ã«ã—ã¦markdownã«ã—ãŸã„ã¿ãŸã„ãªãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã§ã‚ˆã‹ã£ãŸã‚‰ä½¿ã£ã¦ãã ã•ã„ã€‚</div></article></main><footer class=blog-footer><p>Â© 2026 <a href=https://blog.ymgyt.io> ymgyt </a> | Made with <a href=https://www.getzola.org rel=noopener target=_blank>Zola</a> | <a href=https://github.com/ymgyt/blog>Repository</a> | <a href=https://blog.ymgyt.io/atom.xml target=_blank title=rss> <svg viewbox="0 0 24 24" class=icon fill=none height=24 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx=5 cy=19 r=1></circle></svg> </a></footer></div></div>