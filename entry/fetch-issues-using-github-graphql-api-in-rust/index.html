<!doctype html><html lang=ja><head><meta charset=UTF-8><meta content="width=device-width,initial-scale=1" name=viewport><link href=https://blog.ymgyt.io/favicon.ico rel=icon sizes=any><link href=https://blog.ymgyt.io/icon.svg rel=icon type=image/svg+xml><link href=https://blog.ymgyt.io/apple-touch-icon.png rel=apple-touch-icon><link href=https://blog.ymgyt.io/manifest.webmanifest rel=manifest><link href=https://blog.ymgyt.io/style.css rel=stylesheet><link href=https://blog.ymgyt.io/atom.xml rel=alternate title=Atom type=application/atom+xml><script src="https://www.googletagmanager.com/gtag/js?id=G-GTB0KMLN90" async></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[];gtag(`js`,new Date());gtag(`config`,`G-GTB0KMLN90`)</script><title>🦀  RustでGitHub GraphQL APIを使ってissue一覧を取得する | Happy developing</title><meta content=graphql-clientを使ってrustからgraphqlを利用する方法について name=description><meta content=summary name=twitter:card><meta content="@YAmaguchixt " name=twitter:site><meta content="🦀  RustでGitHub GraphQL APIを使ってissue一覧を取得する" name=twitter:title><meta content=graphql-clientを使ってrustからgraphqlを利用する方法について name=twitter:description><meta content=https://blog.ymgyt.io/images/emoji/crab.png name=twitter:image><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><body><div class=world><div class=content-container><header class=blog-header-container><div class=blog-logo><a href=https://blog.ymgyt.io>Happy developing</a></div><div class=blog-nav><nav><ul><li><a href=https://blog.ymgyt.io/entry/>Entries</a><li><a href=https://blog.ymgyt.io/tags/>Tags</a><li><a href=https://blog.ymgyt.io/about/>About</a><li><a href=https://github.com/ymgyt> <img alt=Github class=icon src=https://blog.ymgyt.io/images/icon/github.svg> </a><li><a href="https://twitter.com/YAmaguchixt "> <img alt=Twitter class=icon src=https://blog.ymgyt.io/images/icon/twitter.svg> </a></ul></nav></div></header><main class=blog-main><article><header class=entry-header><h1 class=entry-title>🦀 RustでGitHub GraphQL APIを使ってissue一覧を取得する</h1><div class=entry-meta><p class=entry-meta-item>🗓 2023-03-20<p class=entry-meta-item>🏷 <span class=tag><a href=https://blog.ymgyt.io/tags/rust/>rust</a></span></div></header><aside class=entry-toc><nav><ul class=entry-toc-toplevel-list><li><a href=https://blog.ymgyt.io/entry/fetch-issues-using-github-graphql-api-in-rust/#zhun-bei>準備</a><li><a href=https://blog.ymgyt.io/entry/fetch-issues-using-github-graphql-api-in-rust/#graphql-clientnoli-yong-fang-fa>graphql-clientの利用方法</a> <ul><li><a href=https://blog.ymgyt.io/entry/fetch-issues-using-github-graphql-api-in-rust/#schemanoqu-de>Schemaの取得</a><li><a href=https://blog.ymgyt.io/entry/fetch-issues-using-github-graphql-api-in-rust/#querynozuo-cheng>Queryの作成</a><li><a href=https://blog.ymgyt.io/entry/fetch-issues-using-github-graphql-api-in-rust/#rustnoxing-sheng-cheng>Rustの型生成</a><li><a href=https://blog.ymgyt.io/entry/fetch-issues-using-github-graphql-api-in-rust/#requestnoshi-xing>Requestの実行</a><li><a href=https://blog.ymgyt.io/entry/fetch-issues-using-github-graphql-api-in-rust/#issueyi-lan-noqu-de>Issue一覧の取得</a></ul><li><a href=https://blog.ymgyt.io/entry/fetch-issues-using-github-graphql-api-in-rust/#matome>まとめ</a></ul></nav></aside><div class=entry-content><p>この記事では<a href=https://github.com/graphql-rust/graphql-client>graphql-client</a>を使ってRustから<a href=https://docs.github.com/en/graphql>GitHub GraphQL API</a>を利用する方法について書きます。<br> 実際に作成したcliは<a href=https://github.com/ymgyt/gh-report-gen>こちら。</a><h2 id=zhun-bei><a aria-label="Anchor link for: zhun-bei" class=zola-anchor href=#zhun-bei>準備</a></h2><p>GraphQL APIを利用するためにGithub Personal access tokens (PAT)が必要です。<br> 本記事ではUserのissue一覧を取得するのでScopeはrepoが必要となります。<br> 2023/03/20現在、fine-grained personal access tokenはGraphQL APIではサポートされていません。<blockquote><p>The GraphQL API does not support authentication with fine-grained personal access tokens.</blockquote><p>以下では、作成したPATが環境変数に設定されていることを前提にしています。<pre class="language-sh z-code" data-lang=sh><code class=language-sh data-lang=sh><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-storage z-modifier z-shell">export</span> <span class="z-variable z-other z-readwrite z-assignment z-shell">GH_PAT</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-meta z-group z-expansion z-command z-parens z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">cat</span></span><span class="z-meta z-function-call z-arguments z-shell"> ./github_pat</span><span class="z-punctuation z-section z-parens z-end z-shell">)</span></span></span></span>
</span></code></pre><h2 id=graphql-clientnoli-yong-fang-fa><a aria-label="Anchor link for: graphql-clientnoli-yong-fang-fa" class=zola-anchor href=#graphql-clientnoli-yong-fang-fa>graphql-clientの利用方法</a></h2><h3 id=schemanoqu-de><a aria-label="Anchor link for: schemanoqu-de" class=zola-anchor href=#schemanoqu-de>Schemaの取得</a></h3><p>まずGraphQL APIのschemaを取得します。<br> graphql-clientはcliも提供してくれており、<code>cargo install graphq_client</code>でinstallできます。<br> schemaの取得方法はなんでもよいのですが、上記のcliを使う場合は以下のコマンドを実行します。<pre class="language-sh z-code" data-lang=sh><code class=language-sh data-lang=sh><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">graphql-client</span></span><span class="z-meta z-function-call z-arguments z-shell"> introspect-schema https://api.github.com/graphql <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">    --</span>header</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>Authorization: bearer <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-expansion z-parameter z-begin z-shell">{</span></span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-variable z-other z-readwrite z-shell">GH_PAT</span></span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-section z-expansion z-parameter z-end z-shell">}</span></span><span class="z-punctuation z-definition z-string z-end z-shell">"</span></span> <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">    --</span>header</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>user-agent: rust-graphql-client<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span> <span class="z-keyword z-operator z-assignment z-redirection z-shell">></span> ./schema.json</span>
</span></code></pre><h3 id=querynozuo-cheng><a aria-label="Anchor link for: querynozuo-cheng" class=zola-anchor href=#querynozuo-cheng>Queryの作成</a></h3><p>次にRustから実行したいqueryを書きます。<br> まずsimpleにPATを作成したuserを取得するqueryを書いてみます。<pre class="language-graphql z-code" data-lang=graphql><code class=language-graphql data-lang=graphql><span class="z-source z-graphql"><span class="z-keyword z-declaration z-query z-graphql">query</span> <span class="z-entity z-name z-query z-graphql">Authenticate</span> <span class="z-meta z-block z-graphql"><span class="z-punctuation z-section z-block z-begin z-graphql">{</span>
</span></span><span class="z-source z-graphql"><span class="z-meta z-block z-graphql">  <span class="z-entity z-name z-field z-graphql">viewer</span> <span class="z-meta z-block z-graphql"><span class="z-punctuation z-section z-block z-begin z-graphql">{</span>
</span></span></span><span class="z-source z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql">    <span class="z-entity z-name z-field z-graphql">login</span><span class="z-punctuation z-separator z-sequence z-graphql">,</span>
</span></span></span><span class="z-source z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql">  <span class="z-punctuation z-section z-block z-end z-graphql">}</span></span>
</span></span><span class="z-source z-graphql"><span class="z-meta z-block z-graphql"><span class="z-punctuation z-section z-block z-end z-graphql">}</span></span>
</span></code></pre><p><code>viewer</code> queryの<a href=https://docs.github.com/en/graphql/reference/queries#viewer>doc</a>を参照するとThe username used to loginとして<code>login</code>が取得できるとわかるのでそれを取得します。<h3 id=rustnoxing-sheng-cheng><a aria-label="Anchor link for: rustnoxing-sheng-cheng" class=zola-anchor href=#rustnoxing-sheng-cheng>Rustの型生成</a></h3><p>Schemaとqueryが揃ったので、graphql-clientを利用して、request/response型を生成します。<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust"><span class="z-keyword z-other z-rust">use</span> <span class="z-meta z-path z-rust">graphql_client<span class="z-punctuation z-accessor z-rust">::</span></span>GraphQLQuery<span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-meta z-annotation z-rust"><span class="z-punctuation z-definition z-annotation z-rust">#</span><span class="z-punctuation z-section z-group z-begin z-rust">[</span><span class="z-variable z-annotation z-rust">derive</span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust">GraphQLQuery</span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-punctuation z-section z-group z-end z-rust">]</span></span>
</span><span class="z-source z-rust"><span class="z-meta z-annotation z-rust"><span class="z-punctuation z-definition z-annotation z-rust">#</span><span class="z-punctuation z-section z-group z-begin z-rust">[</span><span class="z-variable z-annotation z-rust">graphql</span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust">
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-annotation z-rust"><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust">    schema_path <span class="z-keyword z-operator z-rust">=</span> <span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">"</span>src/github/gql/schema.json<span class="z-punctuation z-definition z-string z-end z-rust">"</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-annotation z-rust"><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust">    query_path <span class="z-keyword z-operator z-rust">=</span> <span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">"</span>src/github/gql/query.graphql<span class="z-punctuation z-definition z-string z-end z-rust">"</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-annotation z-rust"><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust">    variables_derives <span class="z-keyword z-operator z-rust">=</span> <span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">"</span>Debug<span class="z-punctuation z-definition z-string z-end z-rust">"</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-annotation z-rust"><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust">    response_derives <span class="z-keyword z-operator z-rust">=</span> <span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">"</span>Debug<span class="z-punctuation z-definition z-string z-end z-rust">"</span></span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-annotation z-rust"><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"></span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-punctuation z-section z-group z-end z-rust">]</span></span>
</span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-storage z-modifier z-rust">pub</span> <span class="z-storage z-type z-struct z-rust">struct</span> </span><span class="z-meta z-struct z-rust"><span class="z-entity z-name z-struct z-rust">Authenticate</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></code></pre><p><code>src/github/gql/query.rs</code>に上記のように定義します。<br> <code>schema_path</code>と<code>query_path</code>にはさきほど準備した、schema fileとquery fileのpathを記載します。project root(Cargo.toml)からの相対pathです。 <code>Authenticate</code> structが<code>query Authenticate</code>と一致させます。これはgraphql-client側の約束事です。<br> <code>#[derive(GraphQLQuery)]</code>を定義すると<code>Authenticate</code>にmethodが生成され、<code>authenticate</code> moduleが作成され、queryに対応する型が生成されます。<br> <code>{variables,response}_derives</code>は生成される型に定義したいderiveの指定です。今回は<code>Debug</code>を生やしています。<h3 id=requestnoshi-xing><a aria-label="Anchor link for: requestnoshi-xing" class=zola-anchor href=#requestnoshi-xing>Requestの実行</a></h3><p>これで準備が揃ったので実際にrequestを実行していきましょう。<br> まずは、<code>GithubClient</code>を定義します。<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust"><span class="z-keyword z-other z-rust">use</span> <span class="z-meta z-path z-rust">reqwest<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-path z-rust">header<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span><span class="z-variable z-language z-rust">self</span><span class="z-punctuation z-separator z-rust">,</span> HeaderMap<span class="z-punctuation z-separator z-rust">,</span> HeaderValue</span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust"><span class="z-keyword z-other z-rust">use</span> <span class="z-keyword z-other z-rust">crate</span><span class="z-meta z-path z-rust"><span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-path z-rust">github<span class="z-punctuation z-accessor z-rust">::</span></span>Pat<span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-storage z-modifier z-rust">pub</span> <span class="z-storage z-type z-struct z-rust">struct</span> </span><span class="z-meta z-struct z-rust"><span class="z-entity z-name z-struct z-rust">GithubClient</span> </span><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust">    <span class="z-variable z-other z-member z-rust">inner</span><span class="z-punctuation z-separator z-type z-rust">:</span> <span class="z-meta z-path z-rust">reqwest<span class="z-punctuation z-accessor z-rust">::</span></span>Client,
</span></span></span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-storage z-type z-impl z-rust">impl</span> </span><span class="z-meta z-impl z-rust"><span class="z-entity z-name z-impl z-rust">GithubClient</span> </span><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust">    <span class="z-storage z-type z-rust">const</span> <span class="z-constant z-other z-rust">ENDPOINT</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-keyword z-operator z-bitwise z-rust">&</span><span class="z-storage z-type z-rust">str</span> <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">"</span>https://api.github.com/graphql<span class="z-punctuation z-definition z-string z-end z-rust">"</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust">
</span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust">    <span class="z-comment z-line z-documentation z-rust"><span class="z-punctuation z-definition z-comment z-rust">///</span> Construct GithubClient.
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust">    <span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-modifier z-rust">pub</span> <span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">new</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span><span class="z-variable z-parameter z-rust">pat</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-generic z-rust"><span class="z-support z-type z-rust">Option</span><span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>Pat<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust"> <span class="z-meta z-function z-return-type z-rust"><span class="z-punctuation z-separator z-rust">-></span> <span class="z-meta z-path z-rust">anyhow<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-generic z-rust"><span class="z-support z-type z-rust">Result</span><span class="z-punctuation z-definition z-generic z-begin z-rust"><</span><span class="z-storage z-type z-rust">Self</span><span class="z-punctuation z-definition z-generic z-end z-rust">></span></span></span> </span><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        <span class="z-storage z-type z-rust">let</span> user_agent <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-support z-macro z-rust">concat!</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-support z-macro z-rust">env!</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">"</span>CARGO_PKG_NAME<span class="z-punctuation z-definition z-string z-end z-rust">"</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-separator z-rust">,</span> <span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">"</span>/<span class="z-punctuation z-definition z-string z-end z-rust">"</span></span><span class="z-punctuation z-separator z-rust">,</span> <span class="z-support z-macro z-rust">env!</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">"</span>CARGO_PKG_VERSION<span class="z-punctuation z-definition z-string z-end z-rust">"</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-separator z-rust">,</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        <span class="z-storage z-type z-rust">let</span> <span class="z-storage z-modifier z-rust">mut</span> headers <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-meta z-path z-rust">HeaderMap<span class="z-punctuation z-accessor z-rust">::</span></span>new<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        <span class="z-keyword z-control z-rust">if</span> <span class="z-storage z-type z-rust">let</span> <span class="z-support z-type z-rust">Some</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>pat</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span> <span class="z-keyword z-operator z-assignment z-rust">=</span> pat <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">            <span class="z-storage z-type z-rust">let</span> <span class="z-storage z-modifier z-rust">mut</span> token <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-meta z-path z-rust">HeaderValue<span class="z-punctuation z-accessor z-rust">::</span></span>try_from<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-support z-macro z-rust">format!</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">"</span>bearer <span class="z-constant z-other z-placeholder z-rust">{}</span><span class="z-punctuation z-definition z-string z-end z-rust">"</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-separator z-rust">,</span> pat<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">into_inner</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-keyword z-operator z-rust">?</span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">            token<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">set_sensitive</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-constant z-language z-rust">true</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">            headers<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">insert</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-meta z-path z-rust">header<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-constant z-other z-rust">AUTHORIZATION</span><span class="z-punctuation z-separator z-rust">,</span> token</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">        </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        <span class="z-storage z-type z-rust">let</span> inner <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-meta z-path z-rust">reqwest<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-path z-rust">ClientBuilder<span class="z-punctuation z-accessor z-rust">::</span></span>new<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">            <span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">user_agent</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>user_agent</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">            <span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">default_headers</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>headers</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">            <span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">timeout</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-meta z-path z-rust">Duration<span class="z-punctuation z-accessor z-rust">::</span></span>from_secs<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-constant z-numeric z-integer z-decimal z-rust">10</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">            <span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">connect_timeout</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-meta z-path z-rust">Duration<span class="z-punctuation z-accessor z-rust">::</span></span>from_secs<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-constant z-numeric z-integer z-decimal z-rust">10</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">            <span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">build</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-keyword z-operator z-rust">?</span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        <span class="z-support z-type z-rust">Ok</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-storage z-type z-rust">Self</span> <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span> inner </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></code></pre><p>http clientには<code>reqwest</code>を利用します。<br> PATは<code>authorization</code> headerに設定します。<br> Apiのendpointは<code>https://api.github.com/graphql</code>です。<p>Authenticate queryを実行する処理は以下のように定義しました。<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust"><span class="z-keyword z-other z-rust">use</span> <span class="z-keyword z-other z-rust">crate</span><span class="z-meta z-path z-rust"><span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-path z-rust">github<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-path z-rust">gql<span class="z-punctuation z-accessor z-rust">::</span></span>query<span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-storage z-type z-impl z-rust">impl</span> </span><span class="z-meta z-impl z-rust"><span class="z-entity z-name z-impl z-rust">GithubClient</span> </span><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust">  <span class="z-comment z-line z-documentation z-rust"><span class="z-punctuation z-definition z-comment z-rust">///</span> Authenticated by current pat token, return github user name.
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust">    <span class="z-storage z-modifier z-rust">pub</span> async <span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">authenticate</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span><span class="z-keyword z-operator z-rust">&</span><span class="z-variable z-parameter z-rust">self</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust"> <span class="z-meta z-function z-return-type z-rust"><span class="z-punctuation z-separator z-rust">-></span> <span class="z-meta z-path z-rust">anyhow<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-generic z-rust"><span class="z-support z-type z-rust">Result</span><span class="z-punctuation z-definition z-generic z-begin z-rust"><</span><span class="z-support z-type z-rust">String</span><span class="z-punctuation z-definition z-generic z-end z-rust">></span></span></span> </span><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        <span class="z-storage z-type z-rust">let</span> variables <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-meta z-path z-rust">query<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-path z-rust">authenticate<span class="z-punctuation z-accessor z-rust">::</span></span>Variables <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        <span class="z-storage z-type z-rust">let</span> req <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-meta z-path z-rust">query<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-path z-rust">Authenticate<span class="z-punctuation z-accessor z-rust">::</span></span>build_query<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>variables</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        <span class="z-storage z-type z-rust">let</span> res<span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-path z-rust">query<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-path z-rust">authenticate<span class="z-punctuation z-accessor z-rust">::</span></span>ResponseData <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-variable z-language z-rust">self</span><span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">request</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-keyword z-operator z-bitwise z-rust">&</span>req</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-accessor z-dot z-rust">.</span>await<span class="z-keyword z-operator z-rust">?</span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        <span class="z-support z-type z-rust">Ok</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>res<span class="z-punctuation z-accessor z-dot z-rust">.</span>viewer<span class="z-punctuation z-accessor z-dot z-rust">.</span>login</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></code></pre><p>今回利用するAuthenticate queryには引数がないので、空の<code>query::authenticate::Variables</code>を利用します。<br> これは生成された型なので、queryを更新するとfieldが自動で追加されます。<br> 次に、<code>query::Authenciate</code>に生成された<code>build_query()</code>を利用してrequestを生成します。<br> 後はこのrequestをjsonでencodeするだけです。<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust"><span class="z-keyword z-other z-rust">use</span> <span class="z-meta z-path z-rust">graphql_client<span class="z-punctuation z-accessor z-rust">::</span></span>Response<span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-storage z-type z-impl z-rust">impl</span> </span><span class="z-meta z-impl z-rust"><span class="z-entity z-name z-impl z-rust">GithubClient</span> </span><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust">
</span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust">  <span class="z-meta z-annotation z-rust"><span class="z-punctuation z-definition z-annotation z-rust">#</span><span class="z-punctuation z-section z-group z-begin z-rust">[</span><span class="z-variable z-annotation z-rust">tracing</span>::<span class="z-variable z-annotation z-rust">instrument</span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust">
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-annotation z-rust"><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust">        level <span class="z-keyword z-operator z-rust">=</span> tracing::Level::TRACE<span class="z-punctuation z-separator z-rust">,</span>
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-annotation z-rust"><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust">        <span class="z-meta z-function-call z-rust"><span class="z-variable z-function z-rust">skip</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span></span><span class="z-meta z-function-call z-rust">self</span><span class="z-meta z-function-call z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-annotation z-rust"><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust">        ret<span class="z-punctuation z-separator z-rust">,</span>
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-annotation z-rust"><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust">    </span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-punctuation z-section z-group z-end z-rust">]</span></span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust">    async <span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">request</span></span><span class="z-meta z-generic z-rust"><span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>Body, ResponseData<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span><span class="z-keyword z-operator z-rust">&</span><span class="z-variable z-parameter z-rust">self</span>, <span class="z-variable z-parameter z-rust">body</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-keyword z-operator z-rust">&</span>Body</span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust"> <span class="z-meta z-function z-return-type z-rust"><span class="z-punctuation z-separator z-rust">-></span> <span class="z-meta z-path z-rust">anyhow<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-generic z-rust"><span class="z-support z-type z-rust">Result</span><span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>ResponseData<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-function z-return-type z-rust">    </span></span><span class="z-meta z-function z-rust"><span class="z-keyword z-other z-rust">where</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust">        Body<span class="z-punctuation z-separator z-rust">:</span> Serialize + ?Sized + Debug,
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust">        ResponseData<span class="z-punctuation z-separator z-rust">:</span> DeserializeOwned + Debug,
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust">    </span><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        <span class="z-storage z-type z-rust">let</span> res<span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-generic z-rust">Response<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>ResponseData<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span> <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-variable z-language z-rust">self</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">            <span class="z-punctuation z-accessor z-dot z-rust">.</span>inner
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">            <span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">post</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-storage z-type z-rust">Self</span><span class="z-meta z-path z-rust"><span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-constant z-other z-rust">ENDPOINT</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">            <span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">json</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-keyword z-operator z-bitwise z-rust">&</span>body</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">            <span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">send</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">            <span class="z-punctuation z-accessor z-dot z-rust">.</span>await<span class="z-keyword z-operator z-rust">?</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">            <span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">error_for_status</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-keyword z-operator z-rust">?</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">            <span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">json</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">            <span class="z-punctuation z-accessor z-dot z-rust">.</span>await<span class="z-keyword z-operator z-rust">?</span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        <span class="z-keyword z-control z-rust">match</span> <span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>res<span class="z-punctuation z-accessor z-dot z-rust">.</span>data<span class="z-punctuation z-separator z-rust">,</span> res<span class="z-punctuation z-accessor z-dot z-rust">.</span>errors</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span> <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">            <span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-keyword z-operator z-rust">_</span><span class="z-punctuation z-separator z-rust">,</span> <span class="z-support z-type z-rust">Some</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>errs</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span> <span class="z-keyword z-control z-rust">if</span> <span class="z-keyword z-operator z-logical z-rust">!</span>errs<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">is_empty</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span> <span class="z-keyword z-operator z-rust">=></span> <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">                <span class="z-keyword z-control z-rust">for</span> err <span class="z-keyword z-operator z-rust">in</span> errs <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">                    <span class="z-support z-macro z-rust">error!</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">"</span>{err:?}<span class="z-punctuation z-definition z-string z-end z-rust">"</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">                </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span>
</span></span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">                <span class="z-support z-type z-rust">Err</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-meta z-path z-rust">anyhow<span class="z-punctuation z-accessor z-rust">::</span></span>anyhow<span class="z-keyword z-operator z-logical z-rust">!</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">"</span>failed to request github api<span class="z-punctuation z-definition z-string z-end z-rust">"</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
</span></span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">            </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span>
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">            <span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-support z-type z-rust">Some</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>data</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-separator z-rust">,</span> <span class="z-keyword z-operator z-rust">_</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span> <span class="z-keyword z-operator z-rust">=></span> <span class="z-support z-type z-rust">Ok</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>data</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">            <span class="z-keyword z-operator z-rust">_</span> <span class="z-keyword z-operator z-rust">=></span> <span class="z-support z-type z-rust">Err</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-meta z-path z-rust">anyhow<span class="z-punctuation z-accessor z-rust">::</span></span>anyhow<span class="z-keyword z-operator z-logical z-rust">!</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">"</span>unexpected response<span class="z-punctuation z-definition z-string z-end z-rust">"</span></span><span class="z-punctuation z-separator z-rust">,</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">        </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></code></pre><p>requestの共通処理です。<br> <code>graphql_client::Response</code>はgraphqlのresponseを表しており、以下のように定義されています。<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-storage z-modifier z-rust">pub</span> <span class="z-storage z-type z-struct z-rust">struct</span> </span><span class="z-meta z-struct z-rust"><span class="z-meta z-generic z-rust"><span class="z-entity z-name z-struct z-rust">Response</span><span class="z-meta z-generic z-rust"><span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>Data<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span></span></span><span class="z-meta z-struct z-rust"> </span><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust">    <span class="z-storage z-modifier z-rust">pub</span> <span class="z-variable z-other z-member z-rust">data</span><span class="z-punctuation z-separator z-type z-rust">:</span> <span class="z-meta z-generic z-rust"><span class="z-support z-type z-rust">Option</span><span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>Data<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span>,
</span></span></span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust">    <span class="z-storage z-modifier z-rust">pub</span> <span class="z-variable z-other z-member z-rust">errors</span><span class="z-punctuation z-separator z-type z-rust">:</span> <span class="z-meta z-generic z-rust"><span class="z-support z-type z-rust">Option</span><span class="z-punctuation z-definition z-generic z-begin z-rust"><</span><span class="z-meta z-generic z-rust"><span class="z-support z-type z-rust">Vec</span><span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>Error<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span><span class="z-punctuation z-definition z-generic z-end z-rust">></span></span>,
</span></span></span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust">    <span class="z-storage z-modifier z-rust">pub</span> <span class="z-variable z-other z-member z-rust">extensions</span><span class="z-punctuation z-separator z-type z-rust">:</span> <span class="z-meta z-generic z-rust"><span class="z-support z-type z-rust">Option</span><span class="z-punctuation z-definition z-generic z-begin z-rust"><</span><span class="z-meta z-generic z-rust">HashMap<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span><span class="z-support z-type z-rust">String</span>, Value<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span><span class="z-punctuation z-definition z-generic z-end z-rust">></span></span>,
</span></span></span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></code></pre><p><code>ResponseData</code>はqueryごとのresponseで、queryに応じて生成されます。<br> 今回のqueryは<pre class="language-graphql z-code" data-lang=graphql><code class=language-graphql data-lang=graphql><span class="z-source z-graphql"><span class="z-keyword z-declaration z-query z-graphql">query</span> <span class="z-entity z-name z-query z-graphql">Authenticate</span> <span class="z-meta z-block z-graphql"><span class="z-punctuation z-section z-block z-begin z-graphql">{</span>
</span></span><span class="z-source z-graphql"><span class="z-meta z-block z-graphql">  <span class="z-entity z-name z-field z-graphql">viewer</span> <span class="z-meta z-block z-graphql"><span class="z-punctuation z-section z-block z-begin z-graphql">{</span>
</span></span></span><span class="z-source z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql">    <span class="z-entity z-name z-field z-graphql">login</span><span class="z-punctuation z-separator z-sequence z-graphql">,</span>
</span></span></span><span class="z-source z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql">  <span class="z-punctuation z-section z-block z-end z-graphql">}</span></span>
</span></span><span class="z-source z-graphql"><span class="z-meta z-block z-graphql"><span class="z-punctuation z-section z-block z-end z-graphql">}</span></span>
</span></code></pre><p>のように定義したので、<code>res.viewer.login</code>のようにaccessできます。直感的ですね。<h3 id=issueyi-lan-noqu-de><a aria-label="Anchor link for: issueyi-lan-noqu-de" class=zola-anchor href=#issueyi-lan-noqu-de>Issue一覧の取得</a></h3><p>requestの処理の流れがわかったので、issue一覧を取得してみます。 queryを以下のように定義しました。<pre class="language-graphql z-code" data-lang=graphql><code class=language-graphql data-lang=graphql><span class="z-source z-graphql"><span class="z-keyword z-declaration z-query z-graphql">query</span> <span class="z-entity z-name z-query z-graphql">Issues</span><span class="z-punctuation z-section z-group z-begin z-graphql">(</span>
</span><span class="z-source z-graphql">  <span class="z-punctuation z-definition z-variable z-graphql">$</span><span class="z-variable z-parameter z-graphql">user</span><span class="z-punctuation z-separator z-type z-graphql">:</span> <span class="z-variable z-type z-graphql"><span class="z-support z-type z-graphql">String</span></span><span class="z-storage z-modifier z-required z-graphql">!</span><span class="z-punctuation z-separator z-sequence z-graphql">,</span> 
</span><span class="z-source z-graphql">  <span class="z-punctuation z-definition z-variable z-graphql">$</span><span class="z-variable z-parameter z-graphql">since</span><span class="z-punctuation z-separator z-type z-graphql">:</span> <span class="z-variable z-type z-graphql">DateTime</span><span class="z-storage z-modifier z-required z-graphql">!</span><span class="z-punctuation z-separator z-sequence z-graphql">,</span>
</span><span class="z-source z-graphql">  <span class="z-punctuation z-definition z-variable z-graphql">$</span><span class="z-variable z-parameter z-graphql">after</span><span class="z-punctuation z-separator z-type z-graphql">:</span> <span class="z-variable z-type z-graphql"><span class="z-support z-type z-graphql">String</span></span><span class="z-punctuation z-separator z-sequence z-graphql">,</span>
</span><span class="z-source z-graphql">  <span class="z-punctuation z-definition z-variable z-graphql">$</span><span class="z-variable z-parameter z-graphql">first</span><span class="z-punctuation z-separator z-type z-graphql">:</span> <span class="z-variable z-type z-graphql"><span class="z-support z-type z-graphql">Int</span></span> <span class="z-punctuation z-separator z-key-value z-graphql">=</span> <span class="z-constant z-numeric z-integer z-graphql">20</span><span class="z-punctuation z-separator z-sequence z-graphql">,</span>
</span><span class="z-source z-graphql"><span class="z-punctuation z-section z-group z-end z-graphql">)</span><span class="z-meta z-block z-graphql"><span class="z-punctuation z-section z-block z-begin z-graphql">{</span>
</span></span><span class="z-source z-graphql"><span class="z-meta z-block z-graphql">  <span class="z-entity z-name z-field z-graphql">viewer</span> <span class="z-meta z-block z-graphql"><span class="z-punctuation z-section z-block z-begin z-graphql">{</span>
</span></span></span><span class="z-source z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql">    <span class="z-entity z-name z-field z-graphql">login</span><span class="z-punctuation z-separator z-sequence z-graphql">,</span>
</span></span></span><span class="z-source z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql">    <span class="z-entity z-name z-field z-graphql">issues</span><span class="z-punctuation z-section z-group z-begin z-graphql">(</span>
</span></span></span><span class="z-source z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql">      <span class="z-variable z-parameter z-graphql">filterBy</span><span class="z-punctuation z-separator z-type z-graphql">:</span> <span class="z-meta z-mapping z-graphql"><span class="z-punctuation z-section z-mapping z-begin z-graphql">{</span> <span class="z-meta z-mapping z-key z-graphql">assignee</span><span class="z-punctuation z-separator z-key-value z-graphql">:</span> <span class="z-punctuation z-definition z-variable z-graphql">$</span><span class="z-variable z-other z-graphql">user</span> <span class="z-meta z-mapping z-key z-graphql">since</span><span class="z-punctuation z-separator z-key-value z-graphql">:</span> <span class="z-punctuation z-definition z-variable z-graphql">$</span><span class="z-variable z-other z-graphql">since</span> <span class="z-punctuation z-section z-mapping z-end z-graphql">}</span></span><span class="z-punctuation z-separator z-sequence z-graphql">,</span> 
</span></span></span><span class="z-source z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql">      <span class="z-variable z-parameter z-graphql">orderBy</span><span class="z-punctuation z-separator z-type z-graphql">:</span> <span class="z-meta z-mapping z-graphql"><span class="z-punctuation z-section z-mapping z-begin z-graphql">{</span> <span class="z-meta z-mapping z-key z-graphql">direction</span><span class="z-punctuation z-separator z-key-value z-graphql">:</span> <span class="z-constant z-other z-graphql">ASC</span><span class="z-punctuation z-separator z-sequence z-graphql">,</span> <span class="z-meta z-mapping z-key z-graphql">field</span><span class="z-punctuation z-separator z-key-value z-graphql">:</span> <span class="z-constant z-other z-graphql">CREATED_AT</span> <span class="z-punctuation z-section z-mapping z-end z-graphql">}</span></span><span class="z-punctuation z-separator z-sequence z-graphql">,</span>
</span></span></span><span class="z-source z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql">      <span class="z-variable z-parameter z-graphql">first</span><span class="z-punctuation z-separator z-type z-graphql">:</span> <span class="z-punctuation z-definition z-variable z-graphql">$</span><span class="z-variable z-other z-graphql">first</span><span class="z-punctuation z-separator z-sequence z-graphql">,</span> 
</span></span></span><span class="z-source z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql">      <span class="z-variable z-parameter z-graphql">after</span><span class="z-punctuation z-separator z-type z-graphql">:</span> <span class="z-punctuation z-definition z-variable z-graphql">$</span><span class="z-variable z-other z-graphql">after</span><span class="z-punctuation z-separator z-sequence z-graphql">,</span>
</span></span></span><span class="z-source z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql">    <span class="z-punctuation z-section z-group z-end z-graphql">)</span> <span class="z-meta z-block z-graphql"><span class="z-punctuation z-section z-block z-begin z-graphql">{</span>
</span></span></span></span><span class="z-source z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql">      <span class="z-entity z-name z-field z-graphql">totalCount</span><span class="z-punctuation z-separator z-sequence z-graphql">,</span>
</span></span></span></span><span class="z-source z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql">      <span class="z-entity z-name z-field z-graphql">pageInfo</span> <span class="z-meta z-block z-graphql"><span class="z-punctuation z-section z-block z-begin z-graphql">{</span>
</span></span></span></span></span><span class="z-source z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql">        <span class="z-entity z-name z-field z-graphql">endCursor</span><span class="z-punctuation z-separator z-sequence z-graphql">,</span>
</span></span></span></span></span><span class="z-source z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql">        <span class="z-entity z-name z-field z-graphql">hasNextPage</span><span class="z-punctuation z-separator z-sequence z-graphql">,</span>
</span></span></span></span></span><span class="z-source z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql">      <span class="z-punctuation z-section z-block z-end z-graphql">}</span></span><span class="z-punctuation z-separator z-sequence z-graphql">,</span>
</span></span></span></span><span class="z-source z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql">      <span class="z-entity z-name z-field z-graphql">nodes</span> <span class="z-meta z-block z-graphql"><span class="z-punctuation z-section z-block z-begin z-graphql">{</span>
</span></span></span></span></span><span class="z-source z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql">        <span class="z-entity z-name z-field z-graphql">assignees</span><span class="z-punctuation z-section z-group z-begin z-graphql">(</span><span class="z-variable z-parameter z-graphql">first</span><span class="z-punctuation z-separator z-type z-graphql">:</span> <span class="z-constant z-numeric z-integer z-graphql">10</span><span class="z-punctuation z-section z-group z-end z-graphql">)</span> <span class="z-meta z-block z-graphql"><span class="z-punctuation z-section z-block z-begin z-graphql">{</span>
</span></span></span></span></span></span><span class="z-source z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql">          <span class="z-entity z-name z-field z-graphql">nodes</span> <span class="z-meta z-block z-graphql"><span class="z-punctuation z-section z-block z-begin z-graphql">{</span>
</span></span></span></span></span></span></span><span class="z-source z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql">            <span class="z-entity z-name z-field z-graphql">login</span><span class="z-punctuation z-separator z-sequence z-graphql">,</span>
</span></span></span></span></span></span></span><span class="z-source z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql">          <span class="z-punctuation z-section z-block z-end z-graphql">}</span></span><span class="z-punctuation z-separator z-sequence z-graphql">,</span>
</span></span></span></span></span></span><span class="z-source z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql">        <span class="z-punctuation z-section z-block z-end z-graphql">}</span></span><span class="z-punctuation z-separator z-sequence z-graphql">,</span>
</span></span></span></span></span><span class="z-source z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql">        <span class="z-entity z-name z-field z-graphql">closed</span><span class="z-punctuation z-separator z-sequence z-graphql">,</span>
</span></span></span></span></span><span class="z-source z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql">        <span class="z-entity z-name z-field z-graphql">closedAt</span><span class="z-punctuation z-separator z-sequence z-graphql">,</span>
</span></span></span></span></span><span class="z-source z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql">        <span class="z-entity z-name z-field z-graphql">createdAt</span><span class="z-punctuation z-separator z-sequence z-graphql">,</span>
</span></span></span></span></span><span class="z-source z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql">        <span class="z-entity z-name z-field z-graphql">updatedAt</span><span class="z-punctuation z-separator z-sequence z-graphql">,</span>
</span></span></span></span></span><span class="z-source z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql">        <span class="z-entity z-name z-field z-graphql">number</span><span class="z-punctuation z-separator z-sequence z-graphql">,</span>
</span></span></span></span></span><span class="z-source z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql">        <span class="z-entity z-name z-field z-graphql">repository</span> <span class="z-meta z-block z-graphql"><span class="z-punctuation z-section z-block z-begin z-graphql">{</span>
</span></span></span></span></span></span><span class="z-source z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql">          <span class="z-entity z-name z-field z-graphql">name</span><span class="z-punctuation z-separator z-sequence z-graphql">,</span>
</span></span></span></span></span></span><span class="z-source z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql">          <span class="z-entity z-name z-field z-graphql">owner</span> <span class="z-meta z-block z-graphql"><span class="z-punctuation z-section z-block z-begin z-graphql">{</span>
</span></span></span></span></span></span></span><span class="z-source z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql">            <span class="z-entity z-name z-field z-graphql">__typename</span><span class="z-punctuation z-separator z-sequence z-graphql">,</span>
</span></span></span></span></span></span></span><span class="z-source z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql">            <span class="z-entity z-name z-field z-graphql">login</span><span class="z-punctuation z-separator z-sequence z-graphql">,</span>
</span></span></span></span></span></span></span><span class="z-source z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql">          <span class="z-punctuation z-section z-block z-end z-graphql">}</span></span><span class="z-punctuation z-separator z-sequence z-graphql">,</span>
</span></span></span></span></span></span><span class="z-source z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql">        <span class="z-punctuation z-section z-block z-end z-graphql">}</span></span><span class="z-punctuation z-separator z-sequence z-graphql">,</span>
</span></span></span></span></span><span class="z-source z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql">        <span class="z-entity z-name z-field z-graphql">state</span><span class="z-punctuation z-separator z-sequence z-graphql">,</span>
</span></span></span></span></span><span class="z-source z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql">        <span class="z-entity z-name z-field z-graphql">title</span><span class="z-punctuation z-separator z-sequence z-graphql">,</span>
</span></span></span></span></span><span class="z-source z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql">        <span class="z-entity z-name z-field z-graphql">url</span><span class="z-punctuation z-separator z-sequence z-graphql">,</span>
</span></span></span></span></span><span class="z-source z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql">        <span class="z-entity z-name z-field z-graphql">labels</span><span class="z-punctuation z-section z-group z-begin z-graphql">(</span><span class="z-variable z-parameter z-graphql">orderBy</span><span class="z-punctuation z-separator z-type z-graphql">:</span> <span class="z-meta z-mapping z-graphql"><span class="z-punctuation z-section z-mapping z-begin z-graphql">{</span> <span class="z-meta z-mapping z-key z-graphql">direction</span><span class="z-punctuation z-separator z-key-value z-graphql">:</span><span class="z-constant z-other z-graphql">ASC</span><span class="z-punctuation z-separator z-sequence z-graphql">,</span> <span class="z-meta z-mapping z-key z-graphql">field</span><span class="z-punctuation z-separator z-key-value z-graphql">:</span> <span class="z-constant z-other z-graphql">NAME</span> <span class="z-punctuation z-section z-mapping z-end z-graphql">}</span></span><span class="z-punctuation z-separator z-sequence z-graphql">,</span> <span class="z-variable z-parameter z-graphql">first</span><span class="z-punctuation z-separator z-type z-graphql">:</span> <span class="z-constant z-numeric z-integer z-graphql">10</span><span class="z-punctuation z-section z-group z-end z-graphql">)</span> <span class="z-meta z-block z-graphql"><span class="z-punctuation z-section z-block z-begin z-graphql">{</span>
</span></span></span></span></span></span><span class="z-source z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql">          <span class="z-entity z-name z-field z-graphql">nodes</span> <span class="z-meta z-block z-graphql"><span class="z-punctuation z-section z-block z-begin z-graphql">{</span>
</span></span></span></span></span></span></span><span class="z-source z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql">            <span class="z-entity z-name z-field z-graphql">name</span><span class="z-punctuation z-separator z-sequence z-graphql">,</span>
</span></span></span></span></span></span></span><span class="z-source z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql">          <span class="z-punctuation z-section z-block z-end z-graphql">}</span></span><span class="z-punctuation z-separator z-sequence z-graphql">,</span>
</span></span></span></span></span></span><span class="z-source z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql">        <span class="z-punctuation z-section z-block z-end z-graphql">}</span></span><span class="z-punctuation z-separator z-sequence z-graphql">,</span>
</span></span></span></span></span><span class="z-source z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql">        <span class="z-entity z-name z-field z-graphql">trackedIssuesCount</span><span class="z-punctuation z-separator z-sequence z-graphql">,</span>
</span></span></span></span></span><span class="z-source z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql">        <span class="z-entity z-name z-field z-graphql">trackedClosedIssuesCount</span><span class="z-punctuation z-separator z-key-value z-graphql">:</span> <span class="z-variable z-parameter z-graphql">trackedIssuesCount</span><span class="z-punctuation z-section z-group z-begin z-graphql">(</span><span class="z-variable z-parameter z-graphql">states</span><span class="z-punctuation z-separator z-type z-graphql">:</span> <span class="z-meta z-sequence z-graphql"><span class="z-punctuation z-section z-sequence z-begin z-graphql">[</span><span class="z-constant z-other z-graphql">CLOSED</span><span class="z-punctuation z-section z-sequence z-end z-graphql">]</span></span><span class="z-punctuation z-section z-group z-end z-graphql">)</span><span class="z-punctuation z-separator z-sequence z-graphql">,</span>
</span></span></span></span></span><span class="z-source z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql">      <span class="z-punctuation z-section z-block z-end z-graphql">}</span></span>
</span></span></span></span><span class="z-source z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql">    <span class="z-punctuation z-section z-block z-end z-graphql">}</span></span>
</span></span></span><span class="z-source z-graphql"><span class="z-meta z-block z-graphql"><span class="z-meta z-block z-graphql">  <span class="z-punctuation z-section z-block z-end z-graphql">}</span></span>
</span></span><span class="z-source z-graphql"><span class="z-meta z-block z-graphql"><span class="z-punctuation z-section z-block z-end z-graphql">}</span></span>
</span></code></pre><p><code>viewer.issues</code>のargument<code>filterBy</code>に<code>assignee</code>で先程取得した<code>viewer.login</code>を指定します。また、<code>since</code>を指定すると指定された時点以降に作成/更新されたissueのみが対象となります。<br> <code>Issues</code> queryの引数<code>$since</code>で指定した<code>DateTime!</code>はGitHub schemaで定義された型です。<br> このqueryをRustから使うには以下のように定義します。<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust"><span class="z-keyword z-other z-rust">use</span> <span class="z-meta z-path z-rust">graphql_client<span class="z-punctuation z-accessor z-rust">::</span></span>GraphQLQuery<span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-keyword z-other z-rust">use</span> <span class="z-keyword z-other z-rust">crate</span><span class="z-meta z-path z-rust"><span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-path z-rust">github<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-path z-rust">gql<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-path z-rust">scaler<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-keyword z-operator z-arithmetic z-rust">*</span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-meta z-annotation z-rust"><span class="z-punctuation z-definition z-annotation z-rust">#</span><span class="z-punctuation z-section z-group z-begin z-rust">[</span><span class="z-variable z-annotation z-rust">derive</span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust">GraphQLQuery</span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-punctuation z-section z-group z-end z-rust">]</span></span>
</span><span class="z-source z-rust"><span class="z-meta z-annotation z-rust"><span class="z-punctuation z-definition z-annotation z-rust">#</span><span class="z-punctuation z-section z-group z-begin z-rust">[</span><span class="z-variable z-annotation z-rust">graphql</span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust">
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-annotation z-rust"><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust">    schema_path <span class="z-keyword z-operator z-rust">=</span> <span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">"</span>src/github/gql/schema.json<span class="z-punctuation z-definition z-string z-end z-rust">"</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-annotation z-rust"><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust">    query_path <span class="z-keyword z-operator z-rust">=</span> <span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">"</span>src/github/gql/query.graphql<span class="z-punctuation z-definition z-string z-end z-rust">"</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-annotation z-rust"><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust">    variables_derives <span class="z-keyword z-operator z-rust">=</span> <span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">"</span>Debug<span class="z-punctuation z-definition z-string z-end z-rust">"</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-annotation z-rust"><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust">    response_derives <span class="z-keyword z-operator z-rust">=</span> <span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">"</span>Debug<span class="z-punctuation z-definition z-string z-end z-rust">"</span></span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-annotation z-rust"><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"></span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-punctuation z-section z-group z-end z-rust">]</span></span>
</span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-storage z-modifier z-rust">pub</span> <span class="z-storage z-type z-struct z-rust">struct</span> </span><span class="z-meta z-struct z-rust"><span class="z-entity z-name z-struct z-rust">Issues</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></code></pre><p><code>use crate::github::gql::scaler::*;</code>に着目してください。これはgraphql-clientがscaler型をサポートするための仕組みで、<code>#[derive(GraphQLQuery)]</code>を書いたscopeで、<code>DateTime</code>型を解決するために追加しています。<p><code>src/github/gql/mod.rs</code>に以下のようにscaler moduleを定義しました。(別fileにしてもいいです)<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust"><span class="z-storage z-modifier z-rust">pub</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-keyword z-other z-rust">super</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span> <span class="z-meta z-module z-rust"><span class="z-storage z-type z-module z-rust">mod</span> <span class="z-entity z-name z-module z-rust">scaler</span> <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-module z-rust"><span class="z-meta z-block z-rust">    <span class="z-keyword z-other z-rust">use</span> <span class="z-meta z-path z-rust">serde<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>Deserialize<span class="z-punctuation z-separator z-rust">,</span> Serialize</span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-module z-rust"><span class="z-meta z-block z-rust">
</span></span></span><span class="z-source z-rust"><span class="z-meta z-module z-rust"><span class="z-meta z-block z-rust">    <span class="z-meta z-annotation z-rust"><span class="z-punctuation z-definition z-annotation z-rust">#</span><span class="z-punctuation z-section z-group z-begin z-rust">[</span><span class="z-variable z-annotation z-rust">allow</span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust">clippy::upper_case_acronyms</span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-punctuation z-section z-group z-end z-rust">]</span></span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-module z-rust"><span class="z-meta z-block z-rust">    <span class="z-storage z-modifier z-rust">pub</span> <span class="z-storage z-type z-type z-rust">type</span> <span class="z-entity z-name z-type z-rust">URI</span> <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-support z-type z-rust">String</span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-module z-rust"><span class="z-meta z-block z-rust">
</span></span></span><span class="z-source z-rust"><span class="z-meta z-module z-rust"><span class="z-meta z-block z-rust">    <span class="z-meta z-annotation z-rust"><span class="z-punctuation z-definition z-annotation z-rust">#</span><span class="z-punctuation z-section z-group z-begin z-rust">[</span><span class="z-variable z-annotation z-rust">derive</span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust">Serialize<span class="z-punctuation z-separator z-rust">,</span> Deserialize<span class="z-punctuation z-separator z-rust">,</span> Debug</span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-punctuation z-section z-group z-end z-rust">]</span></span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-module z-rust"><span class="z-meta z-block z-rust">    <span class="z-meta z-struct z-rust"><span class="z-storage z-modifier z-rust">pub</span> <span class="z-storage z-type z-struct z-rust">struct</span> </span><span class="z-meta z-struct z-rust"><span class="z-entity z-name z-struct z-rust">DateTime</span></span><span class="z-meta z-struct z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>String</span><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-module z-rust"><span class="z-meta z-block z-rust">
</span></span></span><span class="z-source z-rust"><span class="z-meta z-module z-rust"><span class="z-meta z-block z-rust">    <span class="z-meta z-impl z-rust"><span class="z-storage z-type z-impl z-rust">impl</span> </span><span class="z-meta z-impl z-rust"><span class="z-meta z-generic z-rust"><span class="z-support z-type z-rust">From</span><span class="z-punctuation z-definition z-generic z-begin z-rust"><</span><span class="z-keyword z-operator z-rust">&</span><span class="z-meta z-path z-rust">chrono<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-generic z-rust">DateTime<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span><span class="z-meta z-path z-rust">chrono<span class="z-punctuation z-accessor z-rust">::</span></span>Utc<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span><span class="z-punctuation z-definition z-generic z-end z-rust">></span></span> <span class="z-keyword z-other z-rust">for</span></span><span class="z-meta z-impl z-rust"> <span class="z-entity z-name z-impl z-rust">DateTime</span> </span><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-module z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust">        <span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">from</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span><span class="z-variable z-parameter z-rust">value</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-keyword z-operator z-rust">&</span><span class="z-meta z-path z-rust">chrono<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-generic z-rust">DateTime<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span><span class="z-meta z-path z-rust">chrono<span class="z-punctuation z-accessor z-rust">::</span></span>Utc<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust"> <span class="z-meta z-function z-return-type z-rust"><span class="z-punctuation z-separator z-rust">-></span> <span class="z-storage z-type z-rust">Self</span></span> </span><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-module z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">            DateTime<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>value<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">to_rfc3339</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
</span></span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-module z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-module z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust">    </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-module z-rust"><span class="z-meta z-block z-rust">
</span></span></span><span class="z-source z-rust"><span class="z-meta z-module z-rust"><span class="z-meta z-block z-rust">    <span class="z-meta z-impl z-rust"><span class="z-storage z-type z-impl z-rust">impl</span> </span><span class="z-meta z-impl z-rust"><span class="z-meta z-generic z-rust">TryFrom<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>DateTime<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span> <span class="z-keyword z-other z-rust">for</span></span><span class="z-meta z-impl z-rust"> <span class="z-entity z-name z-impl z-rust">chrono</span>::<span class="z-entity z-name z-impl z-rust">DateTime</span><span class="z-meta z-generic z-rust"><span class="z-punctuation z-definition z-generic z-begin z-rust"><</span><span class="z-meta z-path z-rust">chrono<span class="z-punctuation z-accessor z-rust">::</span></span>Utc<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span> </span><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-module z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust">        <span class="z-storage z-type z-type z-rust">type</span> <span class="z-entity z-name z-type z-rust">Error</span> <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-meta z-path z-rust">chrono<span class="z-punctuation z-accessor z-rust">::</span></span>ParseError<span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-module z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust">
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-module z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust">        <span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">try_from</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span><span class="z-variable z-parameter z-rust">value</span><span class="z-punctuation z-separator z-rust">:</span> DateTime</span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust"> <span class="z-meta z-function z-return-type z-rust"><span class="z-punctuation z-separator z-rust">-></span> <span class="z-meta z-generic z-rust"><span class="z-support z-type z-rust">Result</span><span class="z-punctuation z-definition z-generic z-begin z-rust"><</span><span class="z-storage z-type z-rust">Self</span>, <span class="z-meta z-path z-rust"><span class="z-storage z-type z-rust"><span class="z-storage z-type z-rust">Self</span><span class="z-punctuation z-accessor z-rust">::</span></span></span>Error<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span></span> </span><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-module z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">            <span class="z-meta z-path z-rust">chrono<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-path z-rust">DateTime<span class="z-punctuation z-accessor z-rust">::</span></span>parse_from_rfc3339<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>value<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-constant z-numeric z-float z-rust">0.</span><span class="z-support z-function z-rust">as_str</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">map</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-support z-type z-rust">Into</span><span class="z-meta z-path z-rust"><span class="z-punctuation z-accessor z-rust">::</span></span>into</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
</span></span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-module z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-module z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust">    </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-module z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></code></pre><p><code>URI</code>型は、responseに<code>URI</code> scaler typeが指定されているため必要になります。<br> このようにschema側で定義されたcustom scalerに対応する型をRustで定義ないしuseして使うことができます。<br> GitHubの場合、<code>DateTime</code>型はRFC3339 formatであるとのことだったので、<code>chrono</code>を利用してparseしています。<br> <code>URI</code>も<code>String</code>でなく、<code>http::Url</code>型等を利用してもよいと思います。<p>この<code>Issues</code> queryをRustから利用する処理が以下です。<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust"><span class="z-keyword z-other z-rust">use</span> <span class="z-meta z-path z-rust">chrono<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>DateTime<span class="z-punctuation z-separator z-rust">,</span> Utc</span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust"><span class="z-keyword z-other z-rust">use</span> <span class="z-keyword z-other z-rust">crate</span><span class="z-meta z-path z-rust"><span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-path z-rust">github<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-path z-rust">gql<span class="z-punctuation z-accessor z-rust">::</span></span>query<span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-storage z-type z-impl z-rust">impl</span> </span><span class="z-meta z-impl z-rust"><span class="z-entity z-name z-impl z-rust">GithubClient</span> </span><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust">    <span class="z-storage z-modifier z-rust">pub</span> async <span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">query_issues</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust">        <span class="z-keyword z-operator z-rust">&</span><span class="z-variable z-parameter z-rust">self</span>,
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust">        <span class="z-variable z-parameter z-rust">gh_user</span><span class="z-punctuation z-separator z-rust">:</span> impl <span class="z-meta z-generic z-rust"><span class="z-support z-type z-rust">Into</span><span class="z-punctuation z-definition z-generic z-begin z-rust"><</span><span class="z-support z-type z-rust">String</span><span class="z-punctuation z-definition z-generic z-end z-rust">></span></span>,
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust">        <span class="z-variable z-parameter z-rust">since</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-keyword z-operator z-rust">&</span><span class="z-meta z-generic z-rust">DateTime<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>Utc<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span>,
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust">        <span class="z-variable z-parameter z-rust">cursor</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-generic z-rust"><span class="z-support z-type z-rust">Option</span><span class="z-punctuation z-definition z-generic z-begin z-rust"><</span><span class="z-support z-type z-rust">String</span><span class="z-punctuation z-definition z-generic z-end z-rust">></span></span>,
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust">    </span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust"> <span class="z-meta z-function z-return-type z-rust"><span class="z-punctuation z-separator z-rust">-></span> <span class="z-meta z-path z-rust">anyhow<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-generic z-rust"><span class="z-support z-type z-rust">Result</span><span class="z-punctuation z-definition z-generic z-begin z-rust"><</span><span class="z-meta z-path z-rust">query<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-path z-rust">issues<span class="z-punctuation z-accessor z-rust">::</span></span>ResponseData<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span></span> </span><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        <span class="z-storage z-type z-rust">let</span> variables <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-meta z-path z-rust">query<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-path z-rust">issues<span class="z-punctuation z-accessor z-rust">::</span></span>Variables <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">            user<span class="z-punctuation z-separator z-rust">:</span> gh_user<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">into</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">            since<span class="z-punctuation z-separator z-rust">:</span> since<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">into</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">            after<span class="z-punctuation z-separator z-rust">:</span> cursor<span class="z-punctuation z-separator z-rust">,</span>
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">            first<span class="z-punctuation z-separator z-rust">:</span> <span class="z-support z-type z-rust">Some</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-constant z-numeric z-integer z-decimal z-rust">100</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">        </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        <span class="z-storage z-type z-rust">let</span> req <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-meta z-path z-rust">query<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-path z-rust">Issues<span class="z-punctuation z-accessor z-rust">::</span></span>build_query<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>variables</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        <span class="z-storage z-type z-rust">let</span> res<span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-path z-rust">query<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-path z-rust">issues<span class="z-punctuation z-accessor z-rust">::</span></span>ResponseData <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-variable z-language z-rust">self</span><span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">request</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-keyword z-operator z-bitwise z-rust">&</span>req</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-accessor z-dot z-rust">.</span>await<span class="z-keyword z-operator z-rust">?</span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        <span class="z-support z-type z-rust">Ok</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>res</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></code></pre><p>今回のqueryではinputがあるので、対応するfieldが<code>query::issues::Variables</code>に生成されています。<br> query側のoptionalは<code>Option</code>で表現されています。<br> 今回のtoolでは全件取得したいので、以下の処理を追加しました。<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-storage z-type z-impl z-rust">impl</span> </span><span class="z-meta z-impl z-rust"><span class="z-entity z-name z-impl z-rust">GithubClient</span> </span><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust">    <span class="z-storage z-modifier z-rust">pub</span> async <span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">query_issues_all</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust">        <span class="z-keyword z-operator z-rust">&</span><span class="z-variable z-parameter z-rust">self</span>,
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust">        <span class="z-variable z-parameter z-rust">gh_user</span><span class="z-punctuation z-separator z-rust">:</span> impl <span class="z-meta z-generic z-rust"><span class="z-support z-type z-rust">Into</span><span class="z-punctuation z-definition z-generic z-begin z-rust"><</span><span class="z-support z-type z-rust">String</span><span class="z-punctuation z-definition z-generic z-end z-rust">></span></span>,
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust">        <span class="z-variable z-parameter z-rust">since</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-keyword z-operator z-rust">&</span><span class="z-meta z-generic z-rust">DateTime<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>Utc<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span>,
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust">    </span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust"> <span class="z-meta z-function z-return-type z-rust"><span class="z-punctuation z-separator z-rust">-></span> <span class="z-meta z-path z-rust">anyhow<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-generic z-rust"><span class="z-support z-type z-rust">Result</span><span class="z-punctuation z-definition z-generic z-begin z-rust"><</span><span class="z-meta z-generic z-rust"><span class="z-support z-type z-rust">Vec</span><span class="z-punctuation z-definition z-generic z-begin z-rust"><</span><span class="z-meta z-path z-rust">query<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-path z-rust">issues<span class="z-punctuation z-accessor z-rust">::</span></span>IssuesViewerIssuesNodes<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span><span class="z-punctuation z-definition z-generic z-end z-rust">></span></span></span> </span><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        <span class="z-storage z-type z-rust">let</span> gh_user <span class="z-keyword z-operator z-assignment z-rust">=</span> gh_user<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">into</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        <span class="z-storage z-type z-rust">let</span> since <span class="z-keyword z-operator z-assignment z-rust">=</span> since<span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        <span class="z-storage z-type z-rust">let</span> <span class="z-storage z-modifier z-rust">mut</span> cursor <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-support z-type z-rust">None</span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        <span class="z-storage z-type z-rust">let</span> <span class="z-storage z-modifier z-rust">mut</span> issues <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-support z-type z-rust">Vec</span><span class="z-meta z-path z-rust"><span class="z-punctuation z-accessor z-rust">::</span></span>new<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        <span class="z-keyword z-control z-rust">loop</span> <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">            <span class="z-storage z-type z-rust">let</span> res <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-variable z-language z-rust">self</span><span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">query_issues</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-keyword z-operator z-bitwise z-rust">&</span>gh_user<span class="z-punctuation z-separator z-rust">,</span> since<span class="z-punctuation z-separator z-rust">,</span> cursor</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-accessor z-dot z-rust">.</span>await<span class="z-keyword z-operator z-rust">?</span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">            <span class="z-keyword z-control z-rust">if</span> <span class="z-storage z-type z-rust">let</span> <span class="z-support z-type z-rust">Some</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>new_issues</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span> <span class="z-keyword z-operator z-assignment z-rust">=</span> res<span class="z-punctuation z-accessor z-dot z-rust">.</span>viewer<span class="z-punctuation z-accessor z-dot z-rust">.</span>issues<span class="z-punctuation z-accessor z-dot z-rust">.</span>nodes <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">                issues<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">extend</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>new_issues<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">into_iter</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">flatten</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">            </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span>
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">            <span class="z-keyword z-control z-rust">if</span> <span class="z-keyword z-operator z-logical z-rust">!</span>res<span class="z-punctuation z-accessor z-dot z-rust">.</span>viewer<span class="z-punctuation z-accessor z-dot z-rust">.</span>issues<span class="z-punctuation z-accessor z-dot z-rust">.</span>page_info<span class="z-punctuation z-accessor z-dot z-rust">.</span>has_next_page <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">                <span class="z-keyword z-control z-rust">break</span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">            </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span>
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">            cursor <span class="z-keyword z-operator z-assignment z-rust">=</span> res<span class="z-punctuation z-accessor z-dot z-rust">.</span>viewer<span class="z-punctuation z-accessor z-dot z-rust">.</span>issues<span class="z-punctuation z-accessor z-dot z-rust">.</span>page_info<span class="z-punctuation z-accessor z-dot z-rust">.</span>end_cursor<span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">        </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        <span class="z-support z-type z-rust">Ok</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>issues</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></code></pre><h2 id=matome><a aria-label="Anchor link for: matome" class=zola-anchor href=#matome>まとめ</a></h2><p>簡単ではありますが、Rustからgraphql-clientを利用してGraphQL APIを利用することができました。<br> queryは素のGraphQLを書いて結果に対応する型をRust側に生成するという形が使いやすいと思いました。<br> 今回のcodeは<code>gh-report-gen</code>というtoolを作成する際に書きました。<pre class="language-sh z-code" data-lang=sh><code class=language-sh data-lang=sh><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">cargo</span></span><span class="z-meta z-function-call z-arguments z-shell"> install gh-report-gen</span>
</span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">gh-report-gen</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>include</span> myorg/<span class="z-keyword z-operator z-regexp z-quantifier z-shell">*</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>exclude</span> myorg/foo<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>since</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>2023-03-01T00:00:00+09:00<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span>  </span>
</span></code></pre><p>のように利用できるので、最近やったissueを一覧にしてmarkdownにしたいみたいなユースケースでよかったら使ってください。</div></article></main><footer class=blog-footer><p>© 2025 <a href=https://blog.ymgyt.io> ymgyt </a> | Made with <a href=https://www.getzola.org rel=noopener target=_blank>Zola</a> | <a href=https://github.com/ymgyt/blog>Repository</a> | <a href=https://blog.ymgyt.io/atom.xml target=_blank title=rss> <svg viewbox="0 0 24 24" class=icon fill=none height=24 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx=5 cy=19 r=1></circle></svg> </a></footer></div></div>