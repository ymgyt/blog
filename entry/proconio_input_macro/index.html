<!doctype html><html lang=ja><head><meta charset=UTF-8><meta content="width=device-width,initial-scale=1" name=viewport><link href=https://blog.ymgyt.io/favicon.ico rel=icon sizes=any><link href=https://blog.ymgyt.io/icon.svg rel=icon type=image/svg+xml><link href=https://blog.ymgyt.io/apple-touch-icon.png rel=apple-touch-icon><link href=https://blog.ymgyt.io/manifest.webmanifest rel=manifest><link href=https://blog.ymgyt.io/style.css rel=stylesheet><link href=https://blog.ymgyt.io/atom.xml rel=alternate title=Atom type=application/atom+xml><script src="https://www.googletagmanager.com/gtag/js?id=G-GTB0KMLN90" async></script><script>window.dataLayer = window.dataLayer || [];
	function gtag() {dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-GTB0KMLN90');</script><title>âš™ï¸ proconio::input!ã®ä»•çµ„ã¿ã‚’è¿½ã£ã¦ã¿ã‚‹ | Happy developing</title><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><body><div class=world><div class=content-container><header class=blog-header-container><div class=blog-logo><a href=https://blog.ymgyt.io>Happy developing</a></div><div class=blog-nav><nav><ul><li><a href=https://blog.ymgyt.io/entry/>Entries</a><li><a href=https://blog.ymgyt.io/tags/>Tags</a><li><a href=https://blog.ymgyt.io/about/>About</a><li><a href=https://github.com/ymgyt> <img alt=Github class=icon src=https://blog.ymgyt.io/images/icon/github.svg> </a><li><a href="https://twitter.com/YAmaguchixt "> <img alt=Twitter class=icon src=https://blog.ymgyt.io/images/icon/twitter.svg> </a></ul></nav></div></header><main class=blog-main><article><header class=entry-header><h1 class=entry-title>âš™ï¸ proconio::input!ã®ä»•çµ„ã¿ã‚’è¿½ã£ã¦ã¿ã‚‹</h1><div class=entry-meta><p class=entry-meta-item>ğŸ—“ 2021-06-27<p class=entry-meta-item>ğŸ· <span class=tag><a href=https://blog.ymgyt.io/tags/rust/>rust</a></span></div></header><aside class=entry-toc><nav><ul class=entry-toc-toplevel-list><li><a href=https://blog.ymgyt.io/entry/proconio_input_macro/#proconio-input-toha>proconio::input! ã¨ã¯</a><li><a href=https://blog.ymgyt.io/entry/proconio_input_macro/#proconio-input-noshi-zu-mi>proconio::input! ã®ä»•çµ„ã¿</a> <ul><li><a href=https://blog.ymgyt.io/entry/proconio_input_macro/#stdinkaradu-muchang-he>stdinã‹ã‚‰èª­ã‚€å ´åˆ</a><li><a href=https://blog.ymgyt.io/entry/proconio_input_macro/#macronodebug>macroã®debug</a><li><a href=https://blog.ymgyt.io/entry/proconio_input_macro/#mut>mut</a><li><a href=https://blog.ymgyt.io/entry/proconio_input_macro/#marker-bytes-chars>marker::{Bytes,Chars}</a><li><a href=https://blog.ymgyt.io/entry/proconio_input_macro/#marker-usize1-isize1>marker::{Usize1,Isize1}</a><li><a href=https://blog.ymgyt.io/entry/proconio_input_macro/#array>array</a><li><a href=https://blog.ymgyt.io/entry/proconio_input_macro/#2d-array>2d array</a><li><a href=https://blog.ymgyt.io/entry/proconio_input_macro/#slice>slice</a><li><a href=https://blog.ymgyt.io/entry/proconio_input_macro/#tuple>tuple</a><li><a href=https://blog.ymgyt.io/entry/proconio_input_macro/#fu-shu-hui-yobidasi>è¤‡æ•°å›ã‚ˆã³ã ã—</a></ul><li><a href=https://blog.ymgyt.io/entry/proconio_input_macro/#matome>ã¾ã¨ã‚</a><li><a href=https://blog.ymgyt.io/entry/proconio_input_macro/#can-kao-dokiyumento>å‚è€ƒãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ</a></ul></nav></aside><div class=entry-content><p>ã“ã®è¨˜äº‹ã§ã¯Rustã®<a href=https://github.com/statiolake/proconio-rs/tree/master/proconio rel=external>proconio::input!</a> macroã«ã¤ã„ã¦æ›¸ãã¾ã™ã€‚<br> <a href=https://docs.rs/proconio/0.4.3/proconio/index.html rel=external>document</a>ã‚„<a href=https://github.com/statiolake/proconio-rs/blob/p-v0.4.3/proconio/src/lib.rs#L690 rel=external>test case</a>ã§æƒ³å®šã•ã‚Œã¦ã„ã‚‹ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã‚’ã©ã†ã‚„ã£ã¦å®Ÿç¾ã—ã¦ã„ã‚‹ã®ã‹ã‚’è¿½ã£ã¦ã„ãã¾ã™ã€‚ versionã¯è¨˜äº‹ã‚’æ›¸ã„ã¦ã„ã‚‹æ™‚ç‚¹ã§æœ€æ–°ã®<code>p-v0.4.3</code> ã‚’å¯¾è±¡ã«ã—ã¦ã„ã¾ã™ã€‚<h2 id=proconio-input-toha><a aria-label="Anchor link for: proconio-input-toha" class=zola-anchor href=#proconio-input-toha><code>proconio::input!</code> ã¨ã¯</a></h2><p><code>proconio</code> ã¨ã¯ä»¥ä¸‹ã®<a href=https://github.com/statiolake/proconio-rs/blob/p-v0.4.3/proconio/README.md rel=external>README</a> ã«ã‚ã‚‹ã‚ˆã†ã«ç«¶æŠ€ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã§åˆ©ç”¨ã•ã‚Œã‚‹ã“ã¨ã‚’æ„å›³ã—ãŸIO libraryã§ã™ã€‚<blockquote><p>Easy IO library for competitive programming.<br> proconio provides an easy way to read values from stdin (or other source). The main is input! macro.</blockquote><p><code>input!</code> ã¯å‡ºé¡Œã¨ã—ã¦stdinã‹ã‚‰ã‚ãŸãˆã‚‰ã‚Œã‚‹å…¥åŠ›ã‚’èª­ã¿å–ã‚‹å‡¦ç†ã‚’ç°¡æ½”ã«è¨˜è¿°ã§ãã‚‹ã“ã¨ã‚’æ„å›³ã—ãŸmacroã§ã™ã€‚<br> atcoderã®Rustã®å®Ÿè¡Œç’°å¢ƒ(judgeç’°å¢ƒ?)ã«æœ‰å¿—ã®æ–¹ã€…ãŒæº–å‚™ã—ã¦ãã ã•ã£ã¦ãŠã‚Šã€åˆ©ç”¨ã•ã‚Œã¦ã„ã‚‹æ–¹ã‚‚ãŠã‚‰ã‚Œã‚‹ã®ã§ã¯ãªã„ã§ã—ã‚‡ã†ã‹ã€‚<br> https://github.com/rust-lang-ja/atcoder-rust-resources/wiki/2020-Update<p>ä¾‹ãˆã°ã€å‡ºé¡Œã¨ã—ã¦ã€m * nã®è¡Œåˆ—ãŒä»¥ä¸‹ã®å½¢å¼ã§ã‚ãŸãˆã‚‰ã‚Œã‚‹ã¨ãã®å‡¦ç†ã¯ã“ã†æ›¸ã‘ã¾ã™ã€‚<p>ã“ã‚“ãªstdinãŒä¸ãˆã‚‰ã‚Œã‚‹ã¨ã—ã¦<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=plain><span class=giallo-l><span>3</span></span>
<span class=giallo-l><span>3</span></span>
<span class=giallo-l><span>1 2 3</span></span>
<span class=giallo-l><span>4 5 6</span></span>
<span class=giallo-l><span>7 8 9</span></span></code></pre><pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>fn</span><span style=color:#88c0d0> main</span><span style=color:#eceff4>() {</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>    input!</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span>        n</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> u8</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>        m</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> u8</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>        a</span><span style=color:#81a1c1>:</span><span style=color:#eceff4> [[</span><span style=color:#8fbcbb>i32</span><span style=color:#eceff4>;</span><span> m</span><span style=color:#eceff4>];</span><span> n</span><span style=color:#eceff4>],</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>    println!</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>n: </span><span style=color:#ebcb8b>{}</span><span style=color:#a3be8c>, m: </span><span style=color:#ebcb8b>{}</span><span style=color:#a3be8c>, a: </span><span style=color:#ebcb8b>{</span><span style=color:#a3be8c>:?</span><span style=color:#ebcb8b>}</span><span style=color:#eceff4>",</span><span> n</span><span style=color:#eceff4>,</span><span>m</span><span style=color:#eceff4>,</span><span>a</span><span style=color:#eceff4>);</span></span>
<span class=giallo-l><span style=color:#616e88>    // n: 3, m: 3, a: [[1, 2, 3], [4, 5, 6], [7, 8, 9]]</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span>
<span class=giallo-l></span></code></pre><p><code>input!</code> ã«ä¸ãˆã‚‰ã‚Œã‚‹ãƒ‡ãƒ¼ã‚¿ã®å‹ã¨bindã—ãŸã„å¤‰æ•°åã‚’æ›¸ã„ã¦ãŠãã¨ã€stdinã‹ã‚‰ã®read, å‹å¤‰æ›ã¾ã§ã‚’å®Ÿè¡Œã—ã¦ãã‚Œã¾ã™ã€‚<br> stdinã‹ã‚‰ã»ã—ã„ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã‚’ã©ã†èª­ã¿å–ã‚‹ã‹ã¯ã€å•é¡Œã®å›ç­”ã¨ã¯ã¾ãŸåˆ¥ã®è©±ã¨ã‚‚ã„ãˆã‚‹ã®ã§ã€ã“ã®å‡¦ç†ã‚’ç°¡æ½”ã«è¨˜è¿°ã§ãã‚‹æ‰‹æ®µãŒã‚ã‚‹ã®ã¯ã†ã‚Œã—ã„ã®ã§ã¯ãªã„ã§ã—ã‚‡ã†ã‹ã€‚<br> ãŸã ã—ã€macroãªã®ã§äººã«ã‚ˆã£ã¦ã¯æŠµæŠ—(ã¨ã‹ãƒ¢ãƒ¤ãƒ¢ãƒ¤)ã‚’ã‚‚ãŸã‚Œã‚‹ã“ã¨ã‚‚ã‚ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚ ã¨ã„ã†ã“ã¨ã§macroã®å†…å®¹ã‚’ç†è§£ã—ã¦ã€æ°—æŒã¡ã‚ˆãä½¿ãˆã‚‹ã‚ˆã†ã«ãªã‚‹ã®ãŒç›®æ¨™ã§ã™ã€‚<h2 id=proconio-input-noshi-zu-mi><a aria-label="Anchor link for: proconio-input-noshi-zu-mi" class=zola-anchor href=#proconio-input-noshi-zu-mi><code>proconio::input!</code> ã®ä»•çµ„ã¿</a></h2><p>ã§ãã‚‹ã ã‘å˜ç´”ãªå‡¦ç†ã‹ã‚‰è¿½ã£ã¦ã„ããŸã„ã®ã§ã€ä»¥ä¸‹ã§ã¯ãƒŸãƒ‹ãƒãƒ ã®<code>input!</code> macroã‚’ä½œã£ã¦ã„ãã¾ã™ã€‚<a href=https://github.com/ymgyt/proconio-handson rel=external>source</a><br> å®Ÿéš›ã®å‡¦ç†ã¯å¤–éƒ¨ã‹ã‚‰åˆ©ç”¨ã—ã‚„ã™ã„ã‚ˆã†ã«æ›¸ã‹ã‚Œã¦ã„ã¾ã™ãŒã€ä»Šå›ã¯å¿…è¦ãªå‹ã‚’1 file(module)ã«å±•é–‹ã—ã¾ã™ã€‚<p>ã¾ãšã¯ä¸€ç•ªã‚·ãƒ³ãƒ—ãƒ«ãªä»¥ä¸‹ã®å‡¦ç†ãŒã©ã†å®Ÿç¾ã•ã‚Œã¦ã„ã‚‹ã®ã‹ã‚’è¿½ã£ã¦ã„ãã¾ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#88c0d0;font-weight:700>input!</span><span style=color:#eceff4>{</span></span>
<span class=giallo-l><span>    n</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> u8</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p>ã¨ã„ã„ãŸã„ã¨ã“ã‚ã§ã™ãŒã€æ¯å›stdinã‹ã‚‰å…¥åŠ›ã‚’æ¸¡ã—ã¦å‹•ä½œç¢ºèªã™ã‚‹ã®ã¯é¢å€’ã§ã™ã—ã€ãƒ†ã‚¹ãƒˆã‚‚æ›¸ãã¥ã‚‰ã„ã§ã™ã€‚<br> <code>input!</code>ã«ã¯å…¥åŠ›ã‚’å¤‰æ•°çµŒç”±ã§æ¸¡ã›ã‚‹æ–¹æ³•ã‚‚ç”¨æ„ã•ã‚Œã¦ã„ã‚‹ã®ã§ãã¡ã‚‰ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚<br> ã¨ã„ã†ã“ã¨ã§æœ€åˆã«è¦‹ã¦ã„ãã®ã¯ã“ã¡ã‚‰<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>fn</span><span style=color:#88c0d0> main</span><span style=color:#eceff4>() {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    let</span><span> source</span><span style=color:#81a1c1> =</span><span style=color:#8fbcbb> OnceSource</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>from</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>10</span><span style=color:#ebcb8b>\n</span><span style=color:#eceff4>");</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>    input!</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span>            from source</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>            a</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> u8</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>    assert_eq!</span><span style=color:#eceff4>(</span><span>a</span><span style=color:#eceff4>,</span><span style=color:#b48ead> 10</span><span style=color:#eceff4>);</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p>æœ€åˆã®å…¥åŠ›ã« <code>from &lt;å…¥åŠ›å¤‰æ•°å></code> ã¨ã™ã‚‹ã“ã¨ã§ã“ã‚Œã‚’å…¥åŠ›ã¨ã—ã¦æ‰±ã£ã¦ãã‚Œã¾ã™ã€‚ <code>OnceSource</code>ã«ã¤ã„ã¦ã¯å¾Œè¿°ã€‚<br> ã•ã£ãã<code>input!</code> macroã‚’è¦‹ã¦ã„ãã¾ã—ã‚‡ã†ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#88c0d0;font-weight:700>macro_rules! input</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#616e88>    // terminator</span></span>
<span class=giallo-l><span style=color:#eceff4>    (</span><span style=color:#81a1c1>@</span><span>from</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span>source</span><span style=color:#81a1c1>:</span><span>expr</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @</span><span>rest</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> =></span><span style=color:#eceff4> {};</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#eceff4>    (</span><span style=color:#81a1c1>@</span><span>from</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span>source</span><span style=color:#81a1c1>:</span><span>expr</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @</span><span>rest</span><span style=color:#81a1c1> $</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>rest</span><span style=color:#81a1c1>:</span><span>tt</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>*</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> =></span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>        input!</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>            @</span><span>from</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span>source</span><span style=color:#eceff4>]</span></span>
<span class=giallo-l><span style=color:#81a1c1>            @mut</span><span style=color:#eceff4> []</span></span>
<span class=giallo-l><span style=color:#81a1c1>            @</span><span>rest</span><span style=color:#81a1c1> $</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>rest</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>*</span></span>
<span class=giallo-l><span style=color:#eceff4>        }</span></span>
<span class=giallo-l><span style=color:#eceff4>    };</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#eceff4>    (</span><span style=color:#81a1c1>@</span><span>from</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span>source</span><span style=color:#81a1c1>:</span><span>expr</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @mut</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>mut</span><span style=color:#81a1c1>:</span><span>tt</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>?</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @</span><span>rest</span><span style=color:#81a1c1> $</span><span>var</span><span style=color:#81a1c1>:</span><span>tt</span><span style=color:#81a1c1>: $</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>rest</span><span style=color:#81a1c1>:</span><span>tt</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>*</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> =></span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>        input!</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>            @</span><span>from</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span>source</span><span style=color:#eceff4>]</span></span>
<span class=giallo-l><span style=color:#81a1c1>            @mut</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>mut</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>*</span><span style=color:#eceff4>]</span></span>
<span class=giallo-l><span style=color:#81a1c1>            @</span><span>var</span><span style=color:#81a1c1> $</span><span>var</span></span>
<span class=giallo-l><span style=color:#81a1c1>            @</span><span>kind</span><span style=color:#eceff4> []</span></span>
<span class=giallo-l><span style=color:#81a1c1>            @</span><span>rest</span><span style=color:#81a1c1> $</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>rest</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>*</span></span>
<span class=giallo-l><span style=color:#eceff4>        }</span></span>
<span class=giallo-l><span style=color:#eceff4>    };</span></span>
<span class=giallo-l><span>    </span></span>
<span class=giallo-l><span style=color:#eceff4>    (</span><span style=color:#81a1c1>@</span><span>from</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span>source</span><span style=color:#81a1c1>:</span><span>expr</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @mut</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>mut</span><span style=color:#81a1c1>:</span><span>tt</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>?</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @</span><span>var</span><span style=color:#81a1c1> $</span><span>var</span><span style=color:#81a1c1>:</span><span>tt</span><span style=color:#81a1c1> @</span><span>kind</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>kind</span><span style=color:#81a1c1>:</span><span>tt</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>*</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @</span><span>rest</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> =></span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>        let $</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>mut</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>* $</span><span>var</span><span style=color:#81a1c1> =</span><span style=color:#88c0d0;font-weight:700> read_value!</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>@</span><span>source</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span>source</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @</span><span>kind</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>kind</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>*</span><span style=color:#eceff4>]);</span></span>
<span class=giallo-l><span style=color:#eceff4>    };</span></span>
<span class=giallo-l><span style=color:#eceff4>    (</span><span style=color:#81a1c1>@</span><span>from</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span>source</span><span style=color:#81a1c1>:</span><span>expr</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @mut</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>mut</span><span style=color:#81a1c1>:</span><span>tt</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>?</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @</span><span>var</span><span style=color:#81a1c1> $</span><span>var</span><span style=color:#81a1c1>:</span><span>tt</span><span style=color:#81a1c1> @</span><span>kind</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>kind</span><span style=color:#81a1c1>:</span><span>tt</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>*</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @</span><span>rest</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> $</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>rest</span><span style=color:#81a1c1>:</span><span>tt</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>*</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> =></span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>        input!</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>@</span><span>from</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span>source</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @mut</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>mut</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>*</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @</span><span>var</span><span style=color:#81a1c1> $</span><span>var</span><span style=color:#81a1c1> @</span><span>kind</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>kind</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>*</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @</span><span>rest</span><span style=color:#eceff4>);</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>        input!</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>@</span><span>from</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span>source</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @</span><span>rest</span><span style=color:#81a1c1> $</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>rest</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>*</span><span style=color:#eceff4>);</span></span>
<span class=giallo-l><span style=color:#eceff4>    };</span></span>
<span class=giallo-l><span style=color:#eceff4>    (</span><span style=color:#81a1c1>@</span><span>from</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span>source</span><span style=color:#81a1c1>:</span><span>expr</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @mut</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>mut</span><span style=color:#81a1c1>:</span><span>tt</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>?</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @</span><span>var</span><span style=color:#81a1c1> $</span><span>var</span><span style=color:#81a1c1>:</span><span>tt</span><span style=color:#81a1c1> @</span><span>kind</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>kind</span><span style=color:#81a1c1>:</span><span>tt</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>*</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @</span><span>rest</span><span style=color:#81a1c1> $</span><span>tt</span><span style=color:#81a1c1>:</span><span>tt</span><span style=color:#81a1c1> $</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>rest</span><span style=color:#81a1c1>:</span><span>tt</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>*</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> =></span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>        input!</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>@</span><span>from</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span>source</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @mut</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>mut</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>*</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @</span><span>var</span><span style=color:#81a1c1> $</span><span>var</span><span style=color:#81a1c1> @</span><span>kind</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>kind</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>* $</span><span>tt</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @</span><span>rest</span><span style=color:#81a1c1> $</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>rest</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>*</span><span style=color:#eceff4>);</span></span>
<span class=giallo-l><span style=color:#eceff4>    };</span></span>
<span class=giallo-l><span>    </span></span>
<span class=giallo-l><span style=color:#eceff4>    (</span><span>from</span><span style=color:#81a1c1> $</span><span>source</span><span style=color:#81a1c1>:</span><span>expr</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> $</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>rest</span><span style=color:#81a1c1>:</span><span>tt</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>*</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> =></span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>       let mut</span><span> s</span><span style=color:#81a1c1> = $</span><span>source</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>       input!</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>           @</span><span>from</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>&mut</span><span> s</span><span style=color:#eceff4>]</span></span>
<span class=giallo-l><span style=color:#81a1c1>           @</span><span>rest</span><span style=color:#81a1c1> $</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>rest</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>*</span></span>
<span class=giallo-l><span style=color:#eceff4>       }</span></span>
<span class=giallo-l><span style=color:#eceff4>    };</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p>å®Ÿéš›ã«ã¯ã‚‚ã†å°‘ã—armãŒã‚ã‚‹ã®ã§ã™ãŒã€ä»Šå›ã®ã‚±ãƒ¼ã‚¹ã‚’æ‰±ã†ã«ã¯ã“ã‚Œã§ååˆ†ã§ã™ã€‚<br> macroã«ã¤ã„ã¦ã“ã®è¨˜äº‹ã§é–¢é€£ã™ã‚‹ç¯„å›²ã§ç°¡å˜ã«è£œè¶³ã—ã¾ã™ã€‚<ul><li><code>input!{ ... }</code> macroã«æ¸¡ã—ãŸå†…å®¹ãŒtokenåˆ—ã¨ã—ã¦ã€æ¸¡ã•ã‚Œã‚‹(æ­£ç¢ºã«ã¯token tree åˆ—)<li>ä¸Šã‹ã‚‰å„armã«ãƒãƒƒãƒã™ã‚‹ã‹ã©ã†ã‹åˆ¤å®šã•ã‚Œã¦ã€ãƒãƒƒãƒã—ãŸã‚‰ãã®å†…å®¹ãŒå®Ÿè¡Œã•ã‚Œã‚‹ã€‚(ã®ã§ã€armã®é †ç•ªã«æ„å‘³ãŒã‚ã‚‹)<li><code>$name:type</code> ã¨æ›¸ãã¨ã€typeã«å¿œã˜ãŸtokenãŒãƒãƒƒãƒã—ã¦ã€<code>=></code> ã®å†…å´ã§nameã§å‚ç…§ã§ãã‚‹<li><code>@from</code> ã®å…ˆé ­ã®<code>@</code>ã¯ç‰¹åˆ¥ãªè¨˜å·ã§ã¯ãªãã€ãƒªãƒ†ãƒ©ãƒ«ã¨ã—ã¦ãƒãƒƒãƒã™ã‚‹ã€‚(ã“ã‚ŒãŒã‚ã‚‹ã¨ãƒãƒƒãƒã™ã‚‹ç¯„å›²ã‚’æŒ‡å®šã—ã‚„ã™ã„ã®ã‹ãªã¨æ€ã£ã¦ã„ã‚‹)<li><code>$rest:tt</code> ã®<code>tt</code>ã¯ã©ã®tokenã«ã‚‚ãƒãƒƒãƒã™ã‚‹<li><code>$(rest:tt)*</code> ã“ã†æ›¸ãã¨ã€ã™ã¹ã¦ã®tokenåˆ—ã«ãƒãƒƒãƒã§ãã‚‹ã®ã§ã€æ®‹ã‚Šå…¨éƒ¨ã‚’å¾Œç¶šã®å‡¦ç†ã«ãã®ã¾ã¾æ¸¡ã›ã‚‹(tailçš„ãªæ„Ÿã˜)<li>ã‚«ãƒƒã‚³( <code>[]</code>, <code>()</code>)ã§ããã‚‰ã‚Œã¦ã„ã‚‹ã¨ãã‚ŒãŒã²ã¨ã¤ã®<code>tt</code>ã¨ã—ã¦ãƒãƒƒãƒã™ã‚‹ã€‚(<code>$v:tt</code> ã« <code>[i32; 3]</code> ãŒãƒãƒƒãƒã™ã‚‹)</ul><p>ã¨ã„ã†ã“ã¨ã§<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#88c0d0;font-weight:700>input!</span><span style=color:#eceff4>{</span></span>
<span class=giallo-l><span>    from source</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>    a</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> u8</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p>ãŒã©ã†å±•é–‹ã•ã‚Œã¦ã„ãã‹è¦‹ã¦ã„ãã¾ã™ã€‚çµè«–ã‚’å…ˆã«ã„ã†ã¨ä»¥ä¸‹ã®ã‚ˆã†ã«å±•é–‹ã•ã‚Œã¾ã™ã€‚(<code>cargo expand</code> ã—ã¾ã—ãŸ)<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>let</span><span> source</span><span style=color:#81a1c1> =</span><span style=color:#8fbcbb> OnceSource</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>from</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>10</span><span style=color:#ebcb8b>\n</span><span style=color:#eceff4>");</span></span>
<span class=giallo-l><span style=color:#81a1c1>let mut</span><span> s</span><span style=color:#81a1c1> =</span><span> source</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>let</span><span> a</span><span style=color:#81a1c1> =</span><span style=color:#eceff4> &lt;</span><span style=color:#8fbcbb>u8</span><span style=color:#81a1c1> as</span><span style=color:#8fbcbb> Readable</span><span style=color:#eceff4>></span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>read</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&mut</span><span> s</span><span style=color:#eceff4>);</span></span></code></pre><p>ã¾ãšã€<code>input!</code>ã®æœ€åˆã«<code>from source</code>ã‚’æ¸¡ã—ã¦ã„ã‚‹ã®ã§<code> (from $source:expr, $($rest:tt)*)</code>ã«ãƒãƒƒãƒã—ã¾ã™ã€‚ãã“ã§ä»¥ä¸‹ã®ã‚ˆã†ã«å±•é–‹ã•ã‚Œã¾ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>let mut</span><span> s</span><span style=color:#81a1c1> =</span><span> source</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>input!</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>  @</span><span>from</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>&mut</span><span> s</span><span style=color:#eceff4>]</span></span>
<span class=giallo-l><span style=color:#81a1c1>  @</span><span>rest a</span><span style=color:#81a1c1> :</span><span style=color:#8fbcbb> u8</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p><code>@from</code>ã¨<code>@rest</code>ã‚’ä»˜ã‘åŠ ãˆã¦ã•ã‚‰ã«<code>input!</code>ã‚’å‘¼ã³å‡ºã—ã¾ã™ã€‚<br> æ¬¡ã«ã€<code>(@from [$source:expr] @rest $($rest:tt)*)</code>ã«ãƒãƒƒãƒã—ã¦ä»¥ä¸‹ã®ã‚ˆã†ã«å±•é–‹ã•ã‚Œã¾ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#88c0d0;font-weight:700>input!</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    @</span><span>from</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>&mut</span><span> s</span><span style=color:#eceff4>]</span></span>
<span class=giallo-l><span style=color:#81a1c1>    @mut</span><span style=color:#eceff4> []</span></span>
<span class=giallo-l><span style=color:#81a1c1>    @</span><span>rest a</span><span style=color:#81a1c1> :</span><span style=color:#8fbcbb> u8</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p><code>@mut</code>ã‚’ä»˜ã‘åŠ ãˆã¦ã€<code>input!</code>ã‚’å‘¼ã³å‡ºã—ã¾ã™ã€‚<br> ã“ã‚ŒãŒ <code>(@from [$source:expr] @mut [$($mut:tt)?] @rest $var:tt: $($rest:tt)*)</code>ã«ãƒãƒƒãƒã—ã¾ã™ã€‚<br> <code>@mut []</code> ã®ã‚ˆã†ã«<code>@mut</code>ã«ã¯ãªã«ã‚‚æ¸¡ã—ã¦ã„ã¾ã›ã‚“ãŒã€ <code>@mut [$($mut:tt)?]</code> ã¨repeatãŒ<code>?</code>ã«ãªã£ã¦ã„ã‚‹ã®ã§ãƒãƒƒãƒã—ã¾ã™ã€‚<br> ã•ã‚‰ã«ã“ã®armã«ã¯ã€<code>@rest $var:tt: $($rest:tt)*</code> ã¨æ›¸ã‹ã‚Œã¦ã„ã¦ã€å¤‰æ•°åã¨ã—ã¦æ¸¡ã—ãŸ<code>a</code> ãŒ<code>$var</code>ã«ãƒãƒƒãƒã—ã¦ã„ã¾ã™ã€‚<code>$var:tt</code>ã§ã¯ãªã<code>$var:tt:</code>ã§ã‚ã‚‹ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚(æœ€å¾Œã«ã‚³ãƒ­ãƒ³ãŒã‚ã‚‹)ã€‚ã“ã®ã‚³ãƒ­ãƒ³ã®ãƒªãƒ†ãƒ©ãƒ«ã«ã‚ˆã£ã¦ã€<code>$rest</code> ã«ã¯å¤‰æ•°<code>a</code>ã®å‹ãŒå…ˆé ­ã«ãã‚‹ã‚ˆã†ã«èª¿æ•´ã•ã‚Œã¦ã„ã¾ã™ã€‚ã“ã®armã§ã¯ã•ã‚‰ã«ä»¥ä¸‹ã®å‘¼ã³å‡ºã—ã«å±•é–‹ã•ã‚Œã¾ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#88c0d0;font-weight:700>input!</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    @</span><span>from</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>&mut</span><span> s</span><span style=color:#eceff4>]</span></span>
<span class=giallo-l><span style=color:#81a1c1>    @mut</span><span style=color:#eceff4> []</span></span>
<span class=giallo-l><span style=color:#81a1c1>    @</span><span>var a</span></span>
<span class=giallo-l><span style=color:#81a1c1>    @</span><span>kind</span><span style=color:#eceff4> []</span></span>
<span class=giallo-l><span style=color:#81a1c1>    @</span><span>rest</span><span style=color:#8fbcbb> u8</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p><code>@kind</code>ãŒä»˜ä¸ã•ã‚ŒãŸå‘¼ã³å‡ºã—ã¯ã©ã®armã«ãƒãƒƒãƒã™ã‚‹ã§ã—ã‚‡ã†ã‹ã€‚<code>@kind</code>ãŒæ›¸ã‹ã‚Œã¦ã„ã‚‹armã¯ï¼“ã¤ã‚ã‚Šã¾ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#eceff4>(</span><span style=color:#81a1c1>@</span><span>from</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span>source</span><span style=color:#81a1c1>:</span><span>expr</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @mut</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>mut</span><span style=color:#81a1c1>:</span><span>tt</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>?</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @</span><span>var</span><span style=color:#81a1c1> $</span><span>var</span><span style=color:#81a1c1>:</span><span>tt</span><span style=color:#81a1c1> @</span><span>kind</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>kind</span><span style=color:#81a1c1>:</span><span>tt</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>*</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @</span><span>rest</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> =></span><span style=color:#eceff4> {}</span><span style=color:#616e88>                     // (1)</span></span>
<span class=giallo-l><span style=color:#eceff4>(</span><span style=color:#81a1c1>@</span><span>from</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span>source</span><span style=color:#81a1c1>:</span><span>expr</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @mut</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>mut</span><span style=color:#81a1c1>:</span><span>tt</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>?</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @</span><span>var</span><span style=color:#81a1c1> $</span><span>var</span><span style=color:#81a1c1>:</span><span>tt</span><span style=color:#81a1c1> @</span><span>kind</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>kind</span><span style=color:#81a1c1>:</span><span>tt</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>*</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @</span><span>rest</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> $</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>rest</span><span style=color:#81a1c1>:</span><span>tt</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>*</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> =></span><span style=color:#eceff4> {}</span><span style=color:#616e88>       // (2)</span></span>
<span class=giallo-l><span style=color:#eceff4>(</span><span style=color:#81a1c1>@</span><span>from</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span>source</span><span style=color:#81a1c1>:</span><span>expr</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @mut</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>mut</span><span style=color:#81a1c1>:</span><span>tt</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>?</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @</span><span>var</span><span style=color:#81a1c1> $</span><span>var</span><span style=color:#81a1c1>:</span><span>tt</span><span style=color:#81a1c1> @</span><span>kind</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>kind</span><span style=color:#81a1c1>:</span><span>tt</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>*</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @</span><span>rest</span><span style=color:#81a1c1> $</span><span>tt</span><span style=color:#81a1c1>:</span><span>tt</span><span style=color:#81a1c1> $</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>rest</span><span style=color:#81a1c1>:</span><span>tt</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>*</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> =></span><span style=color:#eceff4> {}</span><span style=color:#616e88> // (3)</span></span></code></pre><p>ä¸Šã‹ã‚‰(1),(2),(3)ã¨ã—ã¾ã™ã€‚ä»Šå›ã¯<code>@rest u8,</code>ã¨ã—ã¦ã‚ˆã³ã ã—ã¦ã„ã‚‹ã®ã§ã€<code>@rest</code>ã§çµ‚ã‚ã£ã¦ã„ã‚‹(1)ã«ã¯ãƒãƒƒãƒã—ã¾ã›ã‚“ã€‚<br> (2)ã¯ <code>@rest,</code> ã¨å…ˆé ­ãŒ<code>,</code>(ã‚«ãƒ³ãƒ)ã«ãªã£ã¦ã„ã‚‹ã®ã§ãƒãƒƒãƒã—ã¾ã›ã‚“ã€‚ã¨ã„ã†ã“ã¨ã§ã€(3)ã«ãƒãƒƒãƒã—ã¾ã™ã€‚<br> ã¨ã„ã†ã“ã¨ã§ã€(3)ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«å±•é–‹ã•ã‚Œã¾ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span>input</span><span style=color:#81a1c1> !</span><span style=color:#eceff4> (</span><span style=color:#81a1c1>@</span><span> from</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>&mut</span><span> s</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @ mut</span><span style=color:#eceff4> []</span><span style=color:#81a1c1> @</span><span> var a</span><span style=color:#81a1c1> @</span><span> kind</span><span style=color:#eceff4> [</span><span style=color:#8fbcbb>u8</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @</span><span> rest</span><span style=color:#eceff4>,)</span></span></code></pre><p>ã„ã‚ˆã„ã‚ˆå¤‰æ•°<code>a</code>ãŒ<code>kind [u8]</code>ã§parseã•ã‚Œãã†ã§ã™ã­ã€‚ã•ã‚‰ã«<code>@ rest,</code>ã¨ãªã£ã¦ã„ã‚‹ã®ã§ã€ä»Šåº¦ã¯ã•ãã»ã©ã®(2)ã«ãƒãƒƒãƒã—ã¾ã™ã€‚ (2)ã®ä¸­ã§ä»¥ä¸‹ã®ã‚ˆã†ã«å±•é–‹ã•ã‚Œã€(1)ã«ãƒãƒƒãƒã—ã¾ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span>input</span><span style=color:#81a1c1> !</span><span style=color:#eceff4> (</span><span style=color:#81a1c1>@</span><span> from</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>&mut</span><span> s</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @ mut</span><span style=color:#eceff4> []</span><span style=color:#81a1c1> @</span><span> var a</span><span style=color:#81a1c1> @</span><span> kind</span><span style=color:#eceff4> [</span><span style=color:#8fbcbb>u8</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @</span><span> rest</span><span style=color:#eceff4>) ;</span><span> </span></span></code></pre><p>ã‚ã‚‰ãŸã‚ã¦(1)ã®å®šç¾©ã¯ã“ã†ãªã£ã¦ã„ã¦<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#eceff4>(</span><span style=color:#81a1c1>@</span><span>from</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span>source</span><span style=color:#81a1c1>:</span><span>expr</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @mut</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>mut</span><span style=color:#81a1c1>:</span><span>tt</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>?</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @</span><span>var</span><span style=color:#81a1c1> $</span><span>var</span><span style=color:#81a1c1>:</span><span>tt</span><span style=color:#81a1c1> @</span><span>kind</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>kind</span><span style=color:#81a1c1>:</span><span>tt</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>*</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @</span><span>rest</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> =></span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    let $</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>mut</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>* $</span><span>var</span><span style=color:#81a1c1> =</span><span style=color:#88c0d0;font-weight:700> read_value!</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>@</span><span>source</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span>source</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @</span><span>kind</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>kind</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>*</span><span style=color:#eceff4>]);</span></span>
<span class=giallo-l><span style=color:#eceff4>};</span></span></code></pre><p>ã“ã‚“ãªãµã†ã«å±•é–‹ã•ã‚Œã¾ã™<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#eceff4>(</span><span style=color:#81a1c1>@</span><span> from</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>&mut</span><span> s</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @ mut</span><span style=color:#eceff4> []</span><span style=color:#81a1c1> @</span><span> var a</span><span style=color:#81a1c1> @</span><span> kind</span><span style=color:#eceff4> [</span><span style=color:#8fbcbb>u8</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @</span><span> rest</span><span style=color:#eceff4> )</span><span style=color:#81a1c1> =></span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    let</span><span> a</span><span style=color:#81a1c1> =</span><span> read_value</span><span style=color:#81a1c1> !</span><span style=color:#eceff4> (</span><span style=color:#81a1c1>@</span><span> source</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>&mut</span><span> s</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @</span><span> kind</span><span style=color:#eceff4> [</span><span style=color:#8fbcbb>u8</span><span style=color:#eceff4>]) ;</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p>ã¾ã ã€<code>read_value!</code>ã«ã¤ã„ã¦ã¯ãµã‚Œã¦ã„ã¾ã›ã‚“ãŒã€ã“ã®macroã«å…¥åŠ›ã®<code>source</code>ã¨å‹<code>u8</code>ã‚’æ¸¡ã—ãŸçµæœãŒå¤‰æ•°<code>a</code>ã«bindã•ã‚Œã¾ã—ãŸã€‚<br> <code>read_value!</code>ã«ã¯ã„ã‚‹å‰ã«ã€(2)ã§ã¯<code>input!</code>ã‚’2å›å‘¼ã³å‡ºã—ã¦ã„ã¾ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#616e88>// (2)</span></span>
<span class=giallo-l><span style=color:#eceff4>(</span><span style=color:#81a1c1>@</span><span>from</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span>source</span><span style=color:#81a1c1>:</span><span>expr</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @mut</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>mut</span><span style=color:#81a1c1>:</span><span>tt</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>?</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @</span><span>var</span><span style=color:#81a1c1> $</span><span>var</span><span style=color:#81a1c1>:</span><span>tt</span><span style=color:#81a1c1> @</span><span>kind</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>kind</span><span style=color:#81a1c1>:</span><span>tt</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>*</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @</span><span>rest</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> $</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>rest</span><span style=color:#81a1c1>:</span><span>tt</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>*</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> =></span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>    input!</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>@</span><span>from</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span>source</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @mut</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>mut</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>*</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @</span><span>var</span><span style=color:#81a1c1> $</span><span>var</span><span style=color:#81a1c1> @</span><span>kind</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>kind</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>*</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @</span><span>rest</span><span style=color:#eceff4>);</span><span style=color:#616e88> // &lt;- read_value!</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>    input!</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>@</span><span>from</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span>source</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @</span><span>rest</span><span style=color:#81a1c1> $</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>rest</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>*</span><span style=color:#eceff4>);</span></span>
<span class=giallo-l><span style=color:#eceff4>};</span></span></code></pre><p>1å›ç›®ã®<code>input!</code>ã¯<code>read_value!</code>ã«å±•é–‹ã•ã‚Œã€æ®‹ã£ãŸå‡¦ç†ã¯ã‚ã‚‰ãŸã‚ã¦ã€<code>@from [$source] @rest $($rest)*</code>ã®å½¢ã§å‘¼ã°ã‚Œã¾ã™ã€‚<br> ãŸã ã—ä»Šå›æ¸¡ã—ã¦ã„ã‚‹ã€<code>a: u8,</code>ã¯ã™ã§ã«å‡¦ç†ã•ã‚Œã¦ã„ã‚‹ã®ã§ã€ <code> $($rest)*</code>ã¯ç©ºã«å±•é–‹ã•ã‚Œã¾ã™ã€‚ãã‚ŒãŒarmã®å…ˆé ­ã«å®šç¾©ã•ã‚Œã¦ã„ã‚‹<br> <code>(@from [$source:expr] @rest) => {};</code> ã«ãƒãƒƒãƒã•ã‚Œã€<code>input!</code>å‘¼ã³å‡ºã—ã®å±•é–‹ãŒçµ‚äº†ã—ã¾ã™ã€‚<br> ã¨ã„ã†ã“ã¨ã§ã€<code>read_value ! (@ source [&mut s] @ kind [u8])</code>ã“ã®å‡¦ç†ãŒå…¥åŠ›ã‹ã‚‰<code>u8</code>å‹ã‚’å‘¼ã‚“ã§è¿”ã›ã°ã€<code>input!</code>ãŒå®Œäº†ã—ãŸã“ã¨ã«ãªã‚Šã¾ã™ã€‚<p><code>read_value!</code>ã§<code>input!</code>å‘¼ã³å‡ºã—å´ã‹ã‚‰æ¸¡ã•ã‚Œã‚‹ä»»æ„ã®å‹ã®èª­ã¿å–ã‚Šå‡¦ç†ã‚’ãŠã“ãªã„ã¾ã™ã€‚ä»Šå›ã¯ <code>a: u8,</code>ãªã®ã§ãã‚Œã‚’å‡¦ç†ã™ã‚‹ãŸã‚ã ã‘ãªã‚‰ä»¥ä¸‹ã®armã®ã¿ã§å¯¾å¿œã§ãã¾ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#88c0d0;font-weight:700>macro_rules! read_value</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#eceff4>    (</span><span style=color:#81a1c1>@</span><span>source</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span>source</span><span style=color:#81a1c1>:</span><span>expr</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @</span><span>kind</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span>kind</span><span style=color:#81a1c1>:</span><span>ty</span><span style=color:#eceff4>])</span><span style=color:#81a1c1> =></span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#eceff4>        &lt;</span><span style=color:#81a1c1>$</span><span>kind</span><span style=color:#81a1c1> as</span><span style=color:#8fbcbb> Readable</span><span style=color:#eceff4>></span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>read</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>source</span><span style=color:#eceff4>)</span></span>
<span class=giallo-l><span style=color:#eceff4>    };</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p>ã¨ã„ã†ã“ã¨ã§ã€<code>$kind:ty</code>ã§æ¸¡ã•ã‚Œã‚‹å‹ãŒ<code>Readable</code> traitã‚’å®Ÿè£…ã—ã¦ã„ã‚‹ã“ã¨ã‚’å‰æã«ã—ã¦ã€<code>Readable::read()</code>ã‚’å‘¼ã³å‡ºã—ã¦ã„ã¾ã™ã€‚ <code>Readable</code>ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«å®šç¾©ã•ã‚Œã¦ã„ã¾ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>pub trait</span><span style=color:#8fbcbb;font-weight:700> Readable</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    type</span><span style=color:#8fbcbb> Output</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>    fn</span><span style=color:#88c0d0> read</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>R</span><span style=color:#81a1c1>:</span><span> std</span><span style=color:#81a1c1>::</span><span>io</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>BufRead</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> S</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Source</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>R</span><span style=color:#eceff4>>>(</span><span>source</span><span style=color:#81a1c1>: &mut</span><span style=color:#8fbcbb> S</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -> Self::</span><span style=color:#8fbcbb>Output</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p><code>Source</code>ã‹ã‚‰è‡ªèº«ã‚’ç”Ÿæˆã§ãã‚‹å‹ãŒ<code>Readable</code>ã¨ã„ã†æ„Ÿã˜ã§ã—ã‚‡ã†ã‹ã€‚ã¨ã„ã†ã“ã¨ã§<code>Source</code>ã®å®šç¾©ã§ã™ãŒä»¥ä¸‹ã®ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>pub trait</span><span style=color:#8fbcbb;font-weight:700> Source</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>R</span><span style=color:#81a1c1>:</span><span> std</span><span style=color:#81a1c1>::</span><span>io</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>BufRead</span><span style=color:#eceff4>> {</span></span>
<span class=giallo-l><span style=color:#616e88>    /// Gets a whitespace-splitted next token.</span></span>
<span class=giallo-l><span style=color:#81a1c1>    fn</span><span style=color:#88c0d0> next_token</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&mut self</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> Option</span><span style=color:#eceff4>&lt;</span><span style=color:#81a1c1>&</span><span style=color:#8fbcbb>str</span><span style=color:#eceff4>>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#616e88>    /// Check if tokens are empty</span></span>
<span class=giallo-l><span style=color:#81a1c1>    fn</span><span style=color:#88c0d0> is_empty</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&mut self</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> bool</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#616e88>    /// Force gets a whitespace-splitted next token.</span></span>
<span class=giallo-l><span style=color:#81a1c1>    fn</span><span style=color:#88c0d0> next_token_unwrap</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&mut self</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -> &</span><span style=color:#8fbcbb>str</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>        self.</span><span style=color:#88c0d0>next_token</span><span style=color:#eceff4>()</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>expect</span><span style=color:#eceff4>(</span><span style=color:#88c0d0;font-weight:700>concat!</span><span style=color:#eceff4>(</span></span>
<span class=giallo-l><span style=color:#eceff4>        "</span><span style=color:#a3be8c>failed to get the next token; </span><span style=color:#eceff4>",</span></span>
<span class=giallo-l><span style=color:#eceff4>        "</span><span style=color:#a3be8c>maybe reader reached an end of input. </span><span style=color:#eceff4>",</span></span>
<span class=giallo-l><span style=color:#eceff4>        "</span><span style=color:#a3be8c>ensure that arguments for `input!` macro is correctly </span><span style=color:#eceff4>",</span></span>
<span class=giallo-l><span style=color:#eceff4>        "</span><span style=color:#a3be8c>specified to match the problem input.</span><span style=color:#eceff4>"</span></span>
<span class=giallo-l><span style=color:#eceff4>        ))</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p>ä»Šå›ã®ä¾‹ã§ã¯ã€<code>source</code>ã¨ã—ã¦ã€<code>OnceSource</code>ã‚’æ¸¡ã—ã¦ã„ã¾ã—ãŸã€‚<code>OnceSource</code>ã¯æ¦‚ã­ã€å…¥åŠ›(stdinã ã£ãŸã‚Šã€&'static str)ã‚’wrapã—ã¦ã€ãƒ‡ãƒ¼ã‚¿ã®åŒºåˆ‡ã‚Š(atcoderã§ã¯white spaceã¨newline)ã‚’éš è”½ã™ã‚‹å½¹å‰²ã‚’ã‚‚ã£ã¦ã„ã¾ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>struct</span><span style=color:#8fbcbb> OnceSource</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>R</span><span style=color:#81a1c1>:</span><span> std</span><span style=color:#81a1c1>::</span><span>io</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>BufRead</span><span style=color:#eceff4>> {</span></span>
<span class=giallo-l><span>    tokens</span><span style=color:#81a1c1>:</span><span> std</span><span style=color:#81a1c1>::</span><span>iter</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Peekable</span><span style=color:#eceff4>&lt;</span><span>std</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>str</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>SplitWhitespace</span><span style=color:#eceff4>&lt;'</span><span style=color:#8fbcbb>static</span><span style=color:#eceff4>>>,</span></span>
<span class=giallo-l><span>    context</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Box</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>str</span><span style=color:#eceff4>>,</span></span>
<span class=giallo-l><span>    _read</span><span style=color:#81a1c1>:</span><span> std</span><span style=color:#81a1c1>::</span><span>marker</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>PhantomData</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>R</span><span style=color:#eceff4>>,</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>impl</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>R</span><span style=color:#81a1c1>:</span><span> std</span><span style=color:#81a1c1>::</span><span>io</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>BufRead</span><span style=color:#eceff4>></span><span style=color:#8fbcbb> OnceSource</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>R</span><span style=color:#eceff4>> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    fn</span><span style=color:#88c0d0> new</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>mut</span><span> source</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> R</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> OnceSource</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>R</span><span style=color:#eceff4>> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>        let mut</span><span> context</span><span style=color:#81a1c1> =</span><span style=color:#8fbcbb> String</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>new</span><span style=color:#eceff4>();</span></span>
<span class=giallo-l><span>        source</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>read_to_string</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&mut</span><span> context</span><span style=color:#eceff4>)</span></span>
<span class=giallo-l><span style=color:#81a1c1>            .</span><span style=color:#88c0d0>unwrap</span><span style=color:#eceff4>();</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>        let</span><span> context</span><span style=color:#81a1c1> =</span><span> context</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>into_boxed_str</span><span style=color:#eceff4>();</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>        let mut</span><span> res</span><span style=color:#81a1c1> =</span><span style=color:#8fbcbb> OnceSource</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span>            context</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>            tokens</span><span style=color:#81a1c1>:</span><span style=color:#eceff4> ""</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>split_whitespace</span><span style=color:#eceff4>()</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>peekable</span><span style=color:#eceff4>(),</span></span>
<span class=giallo-l><span>            _read</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> PhantomData</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#eceff4>        };</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>        use</span><span> std</span><span style=color:#81a1c1>::</span><span>mem</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>        let</span><span> context</span><span style=color:#81a1c1>: &</span><span style=color:#eceff4>'</span><span style=color:#8fbcbb>static str</span><span style=color:#81a1c1> = unsafe</span><span style=color:#eceff4> {</span><span> mem</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>transmute</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&*</span><span>res</span><span style=color:#81a1c1>.</span><span>context</span><span style=color:#eceff4>) };</span></span>
<span class=giallo-l><span>        res</span><span style=color:#81a1c1>.</span><span>tokens </span><span style=color:#81a1c1>=</span><span> context</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>split_whitespace</span><span style=color:#eceff4>()</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>peekable</span><span style=color:#eceff4>();</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>        res</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>impl</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>R</span><span style=color:#81a1c1>:</span><span> std</span><span style=color:#81a1c1>::</span><span>io</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>BufRead</span><span style=color:#eceff4>></span><span style=color:#8fbcbb> Source</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>R</span><span style=color:#eceff4>></span><span style=color:#81a1c1> for</span><span style=color:#8fbcbb> OnceSource</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>R</span><span style=color:#eceff4>> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    fn</span><span style=color:#88c0d0> next_token</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&mut self</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> Option</span><span style=color:#eceff4>&lt;</span><span style=color:#81a1c1>&</span><span style=color:#8fbcbb>str</span><span style=color:#eceff4>> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>        self.</span><span>tokens</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>next</span><span style=color:#eceff4>()</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>    fn</span><span style=color:#88c0d0> is_empty</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&mut self</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> bool</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>        self.</span><span>tokens</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>peek</span><span style=color:#eceff4>()</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>is_none</span><span style=color:#eceff4>()</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>impl</span><span style=color:#eceff4>&lt;'</span><span style=color:#8fbcbb>a</span><span style=color:#eceff4>></span><span style=color:#8fbcbb> From</span><span style=color:#eceff4>&lt;</span><span style=color:#81a1c1>&</span><span style=color:#eceff4>'</span><span style=color:#8fbcbb>a str</span><span style=color:#eceff4>></span><span style=color:#81a1c1> for</span><span style=color:#8fbcbb> OnceSource</span><span style=color:#eceff4>&lt;</span><span>std</span><span style=color:#81a1c1>::</span><span>io</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>BufReader</span><span style=color:#eceff4>&lt;</span><span style=color:#81a1c1>&</span><span style=color:#eceff4>'</span><span style=color:#8fbcbb>a</span><span style=color:#eceff4> [</span><span style=color:#8fbcbb>u8</span><span style=color:#eceff4>]>> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    fn</span><span style=color:#88c0d0> from</span><span style=color:#eceff4>(</span><span>s</span><span style=color:#81a1c1>: &</span><span style=color:#eceff4>'</span><span style=color:#8fbcbb>a str</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> OnceSource</span><span style=color:#eceff4>&lt;</span><span>std</span><span style=color:#81a1c1>::</span><span>io</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>BufReader</span><span style=color:#eceff4>&lt;</span><span style=color:#81a1c1>&</span><span style=color:#eceff4>'</span><span style=color:#8fbcbb>a</span><span style=color:#eceff4> [</span><span style=color:#8fbcbb>u8</span><span style=color:#eceff4>]>> {</span></span>
<span class=giallo-l><span style=color:#8fbcbb>        OnceSource</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>new</span><span style=color:#eceff4>(</span><span>std</span><span style=color:#81a1c1>::</span><span>io</span><span style=color:#81a1c1>::</span><span>BufReader</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>new</span><span style=color:#eceff4>(</span><span>s</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>as_bytes</span><span style=color:#eceff4>()))</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p>å…¥åŠ›ã‚’heapã«ç¢ºä¿ã—ã¤ã¤ã€<code>mem::transmute()</code>ã—ã¦ã€<code>'static</code>ãªlifetimeã«å¤‰æ›ã—ã¦white spaceã‚’delimiterã¨ã—ã¦iteratorã‚’ä¿æŒã—ã¦ã„ã‚‹æ„Ÿã˜ã§ã—ã‚‡ã†ã‹ã€‚<br> SourceãŒãªã‚“ã¨ãªãã‚ã‹ã£ãŸã®ã§ã€æœ€å¾Œã¯<code>u8</code>ã®<code>Readable</code>å®Ÿè£…ã§ã™ã€‚è¦ã¯stringã‹ã‚‰è‡ªèº«ã‚’ç”Ÿæˆã§ãã‚Œã°ã‚ˆã„ã®ã§ã€<code>str::FromStr</code>ã¨åŒã˜çŠ¶æ³ã¨ã„ãˆã¾ã™ã€‚ãªã®ã§ä»¥ä¸‹ã®ã‚ˆã†ã«ã€<code>str::FromStr</code>ã‚’å®Ÿè£…ã—ã¦ã„ã‚‹å‹ã¯<code>Readable</code>ã«ãªã‚Šã¾ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>impl</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>T</span><span style=color:#81a1c1>:</span><span> std</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>str</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>FromStr</span><span style=color:#eceff4>></span><span style=color:#8fbcbb> Readable</span><span style=color:#81a1c1> for</span><span style=color:#8fbcbb> T</span></span>
<span class=giallo-l><span style=color:#81a1c1>    where</span></span>
<span class=giallo-l><span style=color:#8fbcbb>        T</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Err</span><span style=color:#81a1c1>:</span><span> std</span><span style=color:#81a1c1>::</span><span>fmt</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Debug</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#eceff4>{</span></span>
<span class=giallo-l><span style=color:#81a1c1>    type</span><span style=color:#8fbcbb> Output</span><span style=color:#81a1c1> =</span><span style=color:#8fbcbb> T</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>    fn</span><span style=color:#88c0d0> read</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>R</span><span style=color:#81a1c1>:</span><span> std</span><span style=color:#81a1c1>::</span><span>io</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>BufRead</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> S</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Source</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>R</span><span style=color:#eceff4>>>(</span><span>source</span><span style=color:#81a1c1>: &mut</span><span style=color:#8fbcbb> S</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> T</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>        let</span><span> token</span><span style=color:#81a1c1> =</span><span> source</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>next_token_unwrap</span><span style=color:#eceff4>();</span></span>
<span class=giallo-l><span style=color:#81a1c1>        match</span><span> token</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>parse</span><span style=color:#eceff4>() {</span></span>
<span class=giallo-l><span style=color:#8fbcbb>            Ok</span><span style=color:#eceff4>(</span><span>v</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> =></span><span> v</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#8fbcbb>            Err</span><span style=color:#eceff4>(</span><span>e</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> =></span><span style=color:#88c0d0;font-weight:700> panic!</span><span style=color:#eceff4>(</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>                concat!</span><span style=color:#eceff4>(</span></span>
<span class=giallo-l><span style=color:#eceff4>                "</span><span style=color:#a3be8c>failed to parse the input `</span><span style=color:#ebcb8b>{</span><span style=color:#a3be8c>input</span><span style=color:#ebcb8b>}</span><span style=color:#a3be8c>` </span><span style=color:#eceff4>",</span></span>
<span class=giallo-l><span style=color:#eceff4>                "</span><span style=color:#a3be8c>to the value of type `</span><span style=color:#ebcb8b>{</span><span style=color:#a3be8c>ty</span><span style=color:#ebcb8b>}</span><span style=color:#a3be8c>`: </span><span style=color:#ebcb8b>{</span><span style=color:#a3be8c>err:?</span><span style=color:#ebcb8b>}</span><span style=color:#a3be8c>; </span><span style=color:#eceff4>",</span></span>
<span class=giallo-l><span style=color:#eceff4>                "</span><span style=color:#a3be8c>ensure that the input format is collectly specified </span><span style=color:#eceff4>",</span></span>
<span class=giallo-l><span style=color:#eceff4>                "</span><span style=color:#a3be8c>and that the input value must handle specified type.</span><span style=color:#eceff4>",</span></span>
<span class=giallo-l><span style=color:#eceff4>                ),</span></span>
<span class=giallo-l><span>                input</span><span style=color:#81a1c1> =</span><span> token</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>                ty</span><span style=color:#81a1c1> =</span><span> std</span><span style=color:#81a1c1>::</span><span>any</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>type_name</span><span style=color:#81a1c1>::</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>T</span><span style=color:#eceff4>>(),</span></span>
<span class=giallo-l><span>                err</span><span style=color:#81a1c1> =</span><span> e</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#eceff4>            ),</span></span>
<span class=giallo-l><span style=color:#eceff4>        }</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p>ã“ã“ã«ãã¦ã€<code>input!</code>ãŒ<code>parse::&lt;u8>().unwrap()</code> ã‚’ä»£ã‚ã‚Šã«ã«å‘¼ã‚“ã§ãã‚Œã¦ã„ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã—ãŸã€‚<br> (ä½™è«‡ã§ã™ãŒã€<code>std::any::type_name()</code>ã¯ã“ã†ã„ã†ã¨ã“ã‚ã§ä½¿ã‚ã‚Œã‚‹ã‚“ã§ã™ã­)<p>ã“ã“ã¾ã§ã§ã‚ˆã†ã‚„ãã€<code>input!</code>ã®å‡¦ç†ã‚’é€šã—ã§è¿½ã†ã“ã¨ãŒã§ãã¾ã—ãŸã€‚æœ€çµ‚çš„ã«ã¯ã“ã‚ŒãŒ<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>fn</span><span style=color:#88c0d0> main</span><span style=color:#eceff4>() {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    let</span><span> source</span><span style=color:#81a1c1> =</span><span style=color:#8fbcbb> OnceSource</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>from</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>10</span><span style=color:#ebcb8b>\n</span><span style=color:#eceff4>");</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>    input!</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span>            from source</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>            a</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> u8</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p>ã“ã†ãªã‚Šã¾ã—ãŸã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>fn</span><span style=color:#88c0d0> main</span><span style=color:#eceff4>() {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    let</span><span> source</span><span style=color:#81a1c1> =</span><span style=color:#8fbcbb> OnceSource</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>from</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>10</span><span style=color:#ebcb8b>\n</span><span style=color:#eceff4>");</span></span>
<span class=giallo-l><span style=color:#81a1c1>    let mut</span><span> s</span><span style=color:#81a1c1> =</span><span> source</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>    let</span><span> a</span><span style=color:#81a1c1> =</span><span style=color:#eceff4> &lt;</span><span style=color:#8fbcbb>u8</span><span style=color:#81a1c1> as</span><span style=color:#8fbcbb> Readable</span><span style=color:#eceff4>></span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>read</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&mut</span><span> s</span><span style=color:#eceff4>);</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p>ä»Šå›ã¯ã€<code>u8</code>ã§ã—ãŸãŒã€<code>str::FromStr</code>ã‚’å®Ÿè£…ã—ã¦ã„ã‚‹å‹ã¯<code>Readable</code>ãªã®ã§ã€ä»–ã®åŸºæœ¬çš„ãªå‹ã‚‚åŒã˜ã§ã™ã€‚<br> æ¬¡ã¯<code>[i32; 3]</code>ã®ã‚ˆã†ãªé…åˆ—/sliceã‚’ã¿ã¦ã„ããŸã„ã®ã§ã™ãŒã€ã¾ã æ¨™æº–å…¥åŠ›ã‹ã‚‰èª­ã‚€å‡¦ç†ã‚’ã¿ã¦ã„ãªã‹ã£ãŸã®ã§ã€ãã®å ´åˆã®armã‚’è¿½åŠ ã—ã¾ã—ã‚‡ã†ã€‚<h3 id=stdinkaradu-muchang-he><a aria-label="Anchor link for: stdinkaradu-muchang-he" class=zola-anchor href=#stdinkaradu-muchang-he>stdinã‹ã‚‰èª­ã‚€å ´åˆ</a></h3><p>ä»¥ä¸‹ã®armã‚’è¿½åŠ ã™ã‚‹ã ã‘ã§ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span>lazy_static</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0;font-weight:700>lazy_static!</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    static ref</span><span> STDIN_SOURCE</span><span style=color:#81a1c1>:</span><span> std</span><span style=color:#81a1c1>::</span><span>sync</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Mutex</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>OnceSource</span><span style=color:#eceff4>&lt;</span><span>std</span><span style=color:#81a1c1>::</span><span>io</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>BufReader</span><span style=color:#eceff4>&lt;</span><span>std</span><span style=color:#81a1c1>::</span><span>io</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Stdin</span><span style=color:#eceff4>>>></span><span style=color:#81a1c1> =</span></span>
<span class=giallo-l><span>        std</span><span style=color:#81a1c1>::</span><span>sync</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Mutex</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>new</span><span style=color:#eceff4>(</span><span>OnceSource</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>new</span><span style=color:#eceff4>(</span><span>std</span><span style=color:#81a1c1>::</span><span>io</span><span style=color:#81a1c1>::</span><span>BufReader</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>new</span><span style=color:#eceff4>(</span><span>std</span><span style=color:#81a1c1>::</span><span>io</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>stdin</span><span style=color:#eceff4>())));</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>macro_rules!</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#616e88>    // ... </span></span>
<span class=giallo-l><span style=color:#eceff4>    (</span><span>from</span><span style=color:#81a1c1> $</span><span>source</span><span style=color:#81a1c1>:</span><span>expr</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> $</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>rest</span><span style=color:#81a1c1>:</span><span>tt</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>*</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> =></span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>       let mut</span><span> s</span><span style=color:#81a1c1> = $</span><span>source</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>       input!</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>           @</span><span>from</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>&mut</span><span> s</span><span style=color:#eceff4>]</span></span>
<span class=giallo-l><span style=color:#81a1c1>           @</span><span>rest</span><span style=color:#81a1c1> $</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>rest</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>*</span></span>
<span class=giallo-l><span style=color:#eceff4>       }</span></span>
<span class=giallo-l><span style=color:#eceff4>    };</span></span>
<span class=giallo-l><span style=color:#616e88>    // ã“ã®armã‚’è¿½åŠ </span></span>
<span class=giallo-l><span style=color:#eceff4>    (</span><span style=color:#81a1c1>$</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>rest</span><span style=color:#81a1c1>:</span><span>tt</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>*</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> =></span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>        let mut</span><span> locked_stdin</span><span style=color:#81a1c1> =</span><span> STDIN_SOURCE</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>lock</span><span style=color:#eceff4>()</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>unwrap</span><span style=color:#eceff4>();</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>        input!</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>            @</span><span>from</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>&mut *</span><span>locked_stdin</span><span style=color:#eceff4>]</span></span>
<span class=giallo-l><span style=color:#81a1c1>            @</span><span>rest</span><span style=color:#81a1c1> $</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>rest</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>*</span></span>
<span class=giallo-l><span style=color:#eceff4>        }</span></span>
<span class=giallo-l><span style=color:#88c0d0>        drop</span><span style=color:#eceff4>(</span><span>locked_stdin</span><span style=color:#eceff4>);</span><span style=color:#616e88> // release the lock</span></span>
<span class=giallo-l><span style=color:#eceff4>    };</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p><code>input!</code>ã‹ã‚‰sourceã‚’ã‚‚ã‚‰ã†ã‹ã‚ã‚Šã«ã€<code>std::io::Stdin</code>ã‹ã‚‰<code>OnceSource</code>ã‚’ç”Ÿæˆã—ã¦ã€å¾Œç¶šã®<code>input!</code>ã«æ¸¡ã—ã¦ã„ã¾ã™ã€‚ä»¥é™ã®å‡¦ç†ã¯<code>from source</code>ã§æ¸¡ã—ãŸã¨ãã¨åŒæ§˜ã§ã™ã€‚<br> ä¸€ç•ªä¸Šã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ã§å…¥åŠ›ãŒã©ã“ã‹ã‚‰ããŸã‹ã‚’å¸åã—ã¦ã„ã¦ã€éå¸¸ã«å‚è€ƒã«ãªã‚Šã¾ã™ã€‚<br> ã¡ãªã¿ã«å®Ÿéš›ã®å‡¦ç†ã¯ã‚‚ã†ã²ã¨ã²ã­ã‚Šã•ã‚ŒãŠã‚Šã¾ã—ã¦ã€ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#88c0d0;font-weight:700>lazy_static!</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#5e81ac>    #[doc(hidden)]</span></span>
<span class=giallo-l><span style=color:#81a1c1>    pub static ref</span><span> STDIN_SOURCE</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Mutex</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>AutoSource</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>BufReader</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Stdin</span><span style=color:#eceff4>>>></span><span style=color:#81a1c1> =</span></span>
<span class=giallo-l><span style=color:#8fbcbb>        Mutex</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>new</span><span style=color:#eceff4>(</span><span>AutoSource</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>new</span><span style=color:#eceff4>(</span><span>BufReader</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>new</span><span style=color:#eceff4>(</span><span>io</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>stdin</span><span style=color:#eceff4>())));</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p>https://github.com/statiolake/proconio-rs/blob/a3b10f55c15177ec322ce686f0bd977011593366/proconio/src/lib.rs#L525-L529<br> ã•ãã»ã©ã¯ã€<code>OnceSource</code>ã ã£ãŸç®‡æ‰€ãŒ<code>AutoSource</code>ã«ãªã£ã¦ã„ã¾ã™ã€‚ã•ã‚‰ã«<code>AutoSource</code>ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>pub mod</span><span> auto</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#616e88>    //! Defines `AutoSource`.</span></span>
<span class=giallo-l><span style=color:#616e88>    //!</span></span>
<span class=giallo-l><span style=color:#616e88>    //! It is `LineSource` for debug build, `OnceSource` for release build.</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#5e81ac>    #[cfg(debug_assertions)]</span></span>
<span class=giallo-l><span style=color:#81a1c1>    pub use super::</span><span>line</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>LineSource</span><span style=color:#81a1c1> as</span><span style=color:#8fbcbb> AutoSource</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#5e81ac>    #[cfg(not(debug_assertions))]</span></span>
<span class=giallo-l><span style=color:#81a1c1>    pub use super::</span><span>once</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>OnceSource</span><span style=color:#81a1c1> as</span><span style=color:#8fbcbb> AutoSource</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p>https://github.com/statiolake/proconio-rs/blob/a3b10f55c15177ec322ce686f0bd977011593366/proconio/src/source/mod.rs#L63-L72<p>atcoderä¸Šã§ã¯æå‡ºã—ãŸã‚³ãƒ¼ãƒ‰ã¯release buildã•ã‚Œã‚‹ã¯ãšã ã£ãŸã®ã§ã€çµæœçš„ã«<code>OnceSource</code>ãŒå®Ÿè¡Œã•ã‚Œã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚<br> ã•ã‚‰ã«ã€<code>OnceSource</code>ã®ç”Ÿæˆå‡¦ç†ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã£ã¦ãŠã‚Šã€<code>lazy_static</code>ã§ä¸€åº¦ã ã‘èµ°ã‚‹åˆæœŸåŒ–å‡¦ç†æ™‚ã«å…¥åŠ›ã‚’ã™ã¹ã¦ãƒ¡ãƒ¢ãƒªã«ä¿æŒã—ã¾ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>impl</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>R</span><span style=color:#81a1c1>:</span><span> std</span><span style=color:#81a1c1>::</span><span>io</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>BufRead</span><span style=color:#eceff4>></span><span style=color:#8fbcbb> OnceSource</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>R</span><span style=color:#eceff4>> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    fn</span><span style=color:#88c0d0> new</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>mut</span><span> source</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> R</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> OnceSource</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>R</span><span style=color:#eceff4>> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>        let mut</span><span> context</span><span style=color:#81a1c1> =</span><span style=color:#8fbcbb> String</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>new</span><span style=color:#eceff4>();</span></span>
<span class=giallo-l><span>        source</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>read_to_string</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&mut</span><span> context</span><span style=color:#eceff4>)</span></span>
<span class=giallo-l><span style=color:#81a1c1>            .</span><span style=color:#88c0d0>unwrap</span><span style=color:#eceff4>();</span></span>
<span class=giallo-l><span style=color:#616e88>        // ...</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p>ãªã®ã§ã€<code>input!</code> ã‚’è¤‡æ•°å›å‘¼ã³å‡ºã—ã¦ã‚‚ã€èª­ã¿è¾¼ã¿å‡¦ç†ãŒè¤‡æ•°å›èµ°ã‚‹ã‚ã‘ã§ã¯ãªã•ãã†ã§ã™ã€‚<h3 id=macronodebug><a aria-label="Anchor link for: macronodebug" class=zola-anchor href=#macronodebug>macroã®debug</a></h3><p>ã“ã“ã¾ã§ã§ã€ä¸€ç•ªã‚·ãƒ³ãƒ—ãƒ«ãªã‚±ãƒ¼ã‚¹ã§<code>input!</code>ãŒã©ã†æ©Ÿèƒ½ã™ã‚‹ã‹è¦‹ã¦ãã¾ã—ãŸã€‚ä»¥é™ã¯ã“ã®<code>input!</code>ã‚’æ‹¡å¼µã—ãªãŒã‚‰ä»–ã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã«ã‚‚å¯¾å¿œã§ãã‚‹ã‚ˆã†ã«ã—ã¦ã„ãã¾ã™ã€‚<br> ãŸã ãã®å‰ã«ã€macroã®å±•é–‹debugã™ã‚‹æ–¹æ³•ã«ã¤ã„ã¦æ›¸ã„ã¦ãŠãã¾ã™ã€‚ä»¥é™ã¯ã“ã®debugã®å‡ºåŠ›ã‚’ã¿ãªãŒã‚‰é€²ã‚ã¦ã„ãã¾ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#5e81ac>#![feature(trace_macros)]</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#616e88>// ...</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>fn</span><span style=color:#88c0d0> main</span><span style=color:#eceff4>() {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    let</span><span> source</span><span style=color:#81a1c1> =</span><span style=color:#8fbcbb> OnceSource</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>from</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>10</span><span style=color:#ebcb8b>\n</span><span style=color:#a3be8c>-20</span><span style=color:#eceff4>");</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>    trace_macros!</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>true</span><span style=color:#eceff4>);</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>    input!</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span>        from source</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>        n</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> i8</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>    trace_macros!</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>false</span><span style=color:#eceff4>);</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>    println!</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>m: </span><span style=color:#ebcb8b>{}</span><span style=color:#eceff4>",</span><span> n</span><span style=color:#eceff4>);</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p><code>#![feature(trace_macros)]</code>ã‚’æœ‰åŠ¹åŒ–ã—ã¦ã€<code>input!</code>ã®å‰å¾Œã«<code>trace_macros!</code>ã‚’è¿½åŠ ã—ã¾ã™ã€‚<br> <code>cargo +nightly run</code> ã®ã‚ˆã†ã«<code>nightly</code>ã§å®Ÿè¡Œã™ã‚‹ã¨ã€ä»¥ä¸‹ã®å‡ºåŠ›ã‚’å¾—ã¾ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=shellscript><span class=giallo-l><span style=color:#88c0d0>â¯</span><span style=color:#a3be8c> cargo +nightly run</span></span>
<span class=giallo-l><span style=color:#88c0d0>   Compiling</span><span style=color:#a3be8c> proconio-handson v0.1.0</span><span> (/Users/ymgyt/rs/proconio-handson)</span></span>
<span class=giallo-l><span style=color:#88c0d0>note:</span><span style=color:#a3be8c> trace_macro</span></span>
<span class=giallo-l><span style=color:#88c0d0>   --</span><span>></span><span style=color:#a3be8c> src/main.rs:299:5</span></span>
<span class=giallo-l><span style=color:#81a1c1>    |</span></span>
<span class=giallo-l><span style=color:#88c0d0>299</span><span style=color:#81a1c1> |</span><span style=color:#88c0d0> /</span><span style=color:#a3be8c>     input! {</span></span>
<span class=giallo-l><span style=color:#88c0d0>300</span><span style=color:#81a1c1> | |</span><span style=color:#88c0d0>         from</span><span style=color:#a3be8c> source,</span></span>
<span class=giallo-l><span style=color:#88c0d0>301</span><span style=color:#81a1c1> | |</span><span style=color:#88c0d0>         n:</span><span style=color:#a3be8c> i8,</span></span>
<span class=giallo-l><span style=color:#88c0d0>302</span><span style=color:#81a1c1> | |</span><span>     }</span></span>
<span class=giallo-l><span style=color:#81a1c1>    | |</span><span style=color:#88c0d0>_____^</span></span>
<span class=giallo-l><span style=color:#81a1c1>    |</span></span>
<span class=giallo-l><span style=color:#a3be8c>    = note: expanding</span><span style=color:#eceff4> `</span><span style=color:#88c0d0>input!</span><span style=color:#a3be8c> { from source, n : i8, }</span><span style=color:#eceff4>`</span></span>
<span class=giallo-l><span style=color:#a3be8c>    = note: to</span><span style=color:#eceff4> `</span><span style=color:#88c0d0>let</span><span style=color:#a3be8c> mut s = source</span><span style=color:#81a1c1> ;</span><span style=color:#88c0d0> input</span><span style=color:#a3be8c> ! { @ from [</span><span style=color:#eceff4>&</span><span style=color:#88c0d0> mut</span><span style=color:#a3be8c> s] @ rest n : i8, }</span><span style=color:#eceff4>`</span></span>
<span class=giallo-l><span style=color:#a3be8c>    = note: expanding</span><span style=color:#eceff4> `</span><span style=color:#88c0d0>input!</span><span style=color:#a3be8c> { @ from [</span><span style=color:#eceff4>&</span><span style=color:#88c0d0> mut</span><span style=color:#a3be8c> s] @ rest n : i8, }</span><span style=color:#eceff4>`</span></span>
<span class=giallo-l><span style=color:#a3be8c>    = note: to</span><span style=color:#eceff4> `</span><span style=color:#88c0d0>input</span><span style=color:#a3be8c> ! { @ from [</span><span style=color:#eceff4>&</span><span style=color:#88c0d0>mut</span><span style=color:#a3be8c> s] @ mut [] @ rest n </span><span style=color:#88c0d0>:</span><span style=color:#a3be8c> i8, }</span><span style=color:#eceff4>`</span></span>
<span class=giallo-l><span style=color:#a3be8c>    = note: expanding</span><span style=color:#eceff4> `</span><span style=color:#88c0d0>input!</span><span style=color:#a3be8c> { @ from [</span><span style=color:#eceff4>&</span><span style=color:#88c0d0>mut</span><span style=color:#a3be8c> s] @ mut [] @ rest n </span><span style=color:#88c0d0>:</span><span style=color:#a3be8c> i8, }</span><span style=color:#eceff4>`</span></span>
<span class=giallo-l><span style=color:#a3be8c>    = note: to</span><span style=color:#eceff4> `</span><span style=color:#88c0d0>input</span><span style=color:#a3be8c> ! { @ from [</span><span style=color:#eceff4>&</span><span style=color:#88c0d0>mut</span><span style=color:#a3be8c> s] @ mut [] @ var n @ kind </span><span style=color:#eceff4>[]</span><span style=color:#a3be8c> @ rest i8, }</span><span style=color:#eceff4>`</span></span>
<span class=giallo-l><span style=color:#a3be8c>    = note: expanding</span><span style=color:#eceff4> `</span><span style=color:#88c0d0>input!</span><span style=color:#a3be8c> { @ from [</span><span style=color:#eceff4>&</span><span style=color:#88c0d0>mut</span><span style=color:#a3be8c> s] @ mut [] @ var n @ kind </span><span style=color:#eceff4>[]</span><span style=color:#a3be8c> @ rest i8, }</span><span style=color:#eceff4>`</span></span>
<span class=giallo-l><span style=color:#a3be8c>    = note: to</span><span style=color:#eceff4> `</span><span style=color:#88c0d0>input</span><span style=color:#a3be8c> ! (@ from [</span><span style=color:#eceff4>&</span><span style=color:#88c0d0>mut</span><span style=color:#a3be8c> s] @ mut [] @ var n @ kind </span><span style=color:#eceff4>[</span><span style=color:#a3be8c>i8</span><span style=color:#eceff4>]</span><span style=color:#a3be8c> @ rest,) </span><span style=color:#81a1c1>;</span><span style=color:#eceff4>`</span></span>
<span class=giallo-l><span style=color:#a3be8c>    = note: expanding</span><span style=color:#eceff4> `</span><span style=color:#88c0d0>input!</span><span style=color:#a3be8c> { @ from [</span><span style=color:#eceff4>&</span><span style=color:#88c0d0>mut</span><span style=color:#a3be8c> s] @ mut [] @ var n @ kind </span><span style=color:#eceff4>[</span><span style=color:#a3be8c>i8</span><span style=color:#eceff4>]</span><span style=color:#a3be8c> @ rest, }</span><span style=color:#eceff4>`</span></span>
<span class=giallo-l><span style=color:#a3be8c>    = note: to</span><span style=color:#eceff4> `</span><span style=color:#88c0d0>input</span><span style=color:#a3be8c> ! (@ from [</span><span style=color:#eceff4>&</span><span style=color:#88c0d0>mut</span><span style=color:#a3be8c> s] @ mut [] @ var n @ kind </span><span style=color:#eceff4>[</span><span style=color:#a3be8c>i8</span><span style=color:#eceff4>]</span><span style=color:#a3be8c> @ rest) </span><span style=color:#81a1c1>;</span><span style=color:#88c0d0> input</span><span style=color:#a3be8c> !</span></span>
<span class=giallo-l><span style=color:#eceff4>            (</span><span style=color:#88c0d0>@</span><span style=color:#a3be8c> from [</span><span style=color:#eceff4>&</span><span style=color:#88c0d0>mut</span><span style=color:#a3be8c> s] @ rest</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> ;</span><span style=color:#eceff4>`</span></span>
<span class=giallo-l><span style=color:#a3be8c>    = note: expanding</span><span style=color:#eceff4> `</span><span style=color:#88c0d0>input!</span><span style=color:#a3be8c> { @ from [</span><span style=color:#eceff4>&</span><span style=color:#88c0d0>mut</span><span style=color:#a3be8c> s] @ mut [] @ var n @ kind </span><span style=color:#eceff4>[</span><span style=color:#a3be8c>i8</span><span style=color:#eceff4>]</span><span style=color:#a3be8c> @ rest }</span><span style=color:#eceff4>`</span></span>
<span class=giallo-l><span style=color:#a3be8c>    = note: to</span><span style=color:#eceff4> `</span><span style=color:#88c0d0>let</span><span style=color:#a3be8c> n = read_value ! (@ source [</span><span style=color:#eceff4>&</span><span style=color:#88c0d0>mut</span><span style=color:#a3be8c> s] @ kind [i8]) </span><span style=color:#81a1c1>;</span><span style=color:#eceff4>`</span></span>
<span class=giallo-l><span style=color:#a3be8c>    = note: expanding</span><span style=color:#eceff4> `</span><span style=color:#88c0d0>read_value!</span><span style=color:#a3be8c> { @ source [</span><span style=color:#eceff4>&</span><span style=color:#88c0d0>mut</span><span style=color:#a3be8c> s] @ kind [i8] }</span><span style=color:#eceff4>`</span></span>
<span class=giallo-l><span style=color:#a3be8c>    = note: to</span><span style=color:#eceff4> `</span><span style=color:#81a1c1>&lt;</span><span style=color:#a3be8c> i8 as Readable </span><span style=color:#81a1c1>></span><span style=color:#a3be8c> :: read(</span><span style=color:#eceff4>&</span><span style=color:#88c0d0>mut</span><span style=color:#a3be8c> s)</span><span style=color:#eceff4>`</span></span>
<span class=giallo-l><span style=color:#a3be8c>    = note: expanding</span><span style=color:#eceff4> `</span><span style=color:#88c0d0>input!</span><span style=color:#a3be8c> { @ from [</span><span style=color:#eceff4>&</span><span style=color:#88c0d0>mut</span><span style=color:#a3be8c> s] @ rest }</span><span style=color:#eceff4>`</span></span>
<span class=giallo-l><span style=color:#a3be8c>    = note: to</span><span style=color:#eceff4> ``</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#88c0d0>    Finished</span><span style=color:#a3be8c> dev</span><span> [unoptimized</span><span style=color:#a3be8c> + debuginfo] target</span><span style=color:#eceff4>(</span><span style=color:#88c0d0>s</span><span style=color:#eceff4>)</span><span style=color:#a3be8c> in 0.49s</span></span>
<span class=giallo-l><span style=color:#88c0d0>     Running</span><span style=color:#eceff4> `</span><span style=color:#88c0d0>target/debug/proconio-handson</span><span style=color:#eceff4>`</span></span>
<span class=giallo-l><span style=color:#88c0d0>m:</span><span style=color:#b48ead> 10</span></span></code></pre><p><code>input!</code>ã‹ã‚‰<code>input!</code>ã‚’å‘¼ã³å‡ºã—ã¦ã„ã‚‹ã®ã§ã€æ…£ã‚Œãªã„ã¨è¦‹ã¥ã‚‰ã„ã§ã™ãŒè‡ªåˆ†ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«èª­ã‚“ã§ã„ã¾ã™ã€‚<br> <code>expanding</code> ãŒmacroå‘¼ã³å‡ºã—æ™‚ã®traceã€‚<code>@</code>ã®ä½ç½®ã‚’å‚è€ƒã«ã©ã®armã«ãƒãƒƒãƒã™ã‚‹ã‹ã¯ã“ã“ã§åˆ¤æ–­ã§ãã‚‹ã€‚<br> <code>to</code> ãŒãƒãƒƒãƒã—ãŸarmã®å±•é–‹å†…å®¹ã€å¾Œç¶šã®macroå‘¼ã³å‡ºã—æ™‚ã«ã©ã®ã‚ˆã†ã«å±•é–‹ã•ã‚ŒãŸã‹ãŒã‚ã‹ã‚‹ã€‚<br> ã“ã®traceã‚’ãŠã£ã¦ã„ãã¨ã•ãã»ã©ã¾ã§ã¿ã¦ããŸæµã‚Œã¨åŒã˜ã ã¨ã‚ã‹ã‚Šã¾ã™ã€‚<br> æœ€çµ‚çš„ãªå±•é–‹çµæœãŒã¿ãŸã„å ´åˆã¯ã€<code>cargo expand</code>ã‚’åˆ©ç”¨ã—ã¾ã—ãŸã€‚<h3 id=mut><a aria-label="Anchor link for: mut" class=zola-anchor href=#mut><code>mut</code></a></h3><p>å…¥åŠ›ã‚’bindã™ã‚‹å¤‰æ•°ã‚’<code>mut</code>ã«ã—ã¦ãŠãã“ã¨ã‚‚ã§ãã¾ã™ã€‚ä»Šå›ã‚‚armã‚’ã²ã¨ã¤è¿½åŠ ã™ã‚‹ã ã‘ã§ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#88c0d0;font-weight:700>macro_rules! input</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#616e88>    // terminator</span></span>
<span class=giallo-l><span style=color:#eceff4>    (</span><span style=color:#81a1c1>@</span><span>from</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span>source</span><span style=color:#81a1c1>:</span><span>expr</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @</span><span>rest</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> =></span><span style=color:#eceff4> {};</span></span>
<span class=giallo-l><span style=color:#616e88>    // ã“ã®armã‚’è¿½åŠ </span></span>
<span class=giallo-l><span style=color:#616e88>    // parse mutability</span></span>
<span class=giallo-l><span style=color:#eceff4>    (</span><span style=color:#81a1c1>@</span><span>from</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span>source</span><span style=color:#81a1c1>:</span><span>expr</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @</span><span>rest</span><span style=color:#81a1c1> mut $</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>rest</span><span style=color:#81a1c1>:</span><span>tt</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>*</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> =></span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>        input!</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>            @</span><span>from</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span>source</span><span style=color:#eceff4>]</span></span>
<span class=giallo-l><span style=color:#81a1c1>            @mut</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>mut</span><span style=color:#eceff4>]</span></span>
<span class=giallo-l><span style=color:#81a1c1>            @</span><span>rest</span><span style=color:#81a1c1> $</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>rest</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>*</span></span>
<span class=giallo-l><span style=color:#eceff4>        }</span></span>
<span class=giallo-l><span style=color:#eceff4>    };</span></span>
<span class=giallo-l><span style=color:#616e88>    // ... </span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p><code>mut</code>ã‚’ãƒªãƒ†ãƒ©ãƒ«ã§ã‚ã¦ã¦ã€å¾Œç¶šã®å‡¦ç†ã«æ¸¡ã—ã¦ã„ã¾ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#eceff4>(</span><span style=color:#81a1c1>@</span><span>from</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span>source</span><span style=color:#81a1c1>:</span><span>expr</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @mut</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>mut</span><span style=color:#81a1c1>:</span><span>tt</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>?</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @</span><span>var</span><span style=color:#81a1c1> $</span><span>var</span><span style=color:#81a1c1>:</span><span>tt</span><span style=color:#81a1c1> @</span><span>kind</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>kind</span><span style=color:#81a1c1>:</span><span>tt</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>*</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @</span><span>rest</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> =></span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    let $</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>mut</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>* $</span><span>var</span><span style=color:#81a1c1> =</span><span style=color:#88c0d0;font-weight:700> read_value!</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>@</span><span>source</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span>source</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @</span><span>kind</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>kind</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>*</span><span style=color:#eceff4>]);</span></span>
<span class=giallo-l><span style=color:#eceff4>};</span></span></code></pre><p>æœ€çµ‚çš„ã«ã€å¤‰æ•°å®£è¨€æ™‚ã«<code>mut</code>ãŒä»˜ä¸ã•ã‚Œã¾ã™ã€‚<h3 id=marker-bytes-chars><a aria-label="Anchor link for: marker-bytes-chars" class=zola-anchor href=#marker-bytes-chars><code>marker::{Bytes,Chars}</code></a></h3><p>ã“ã‚Œã¾ã§ã¿ã¦ããŸã‚ˆã†ã«ã€å…¥åŠ›ã‹ã‚‰ã®å¤‰æ›å‡¦ç†ã¯ã€<code>input!</code>ã«æŒ‡å®šã—ãŸå‹ã®<code>Readable::read()</code>ã®å®Ÿè£…æ¬¡ç¬¬ã§ã™ã€‚(<code>str::FromStr</code>ã‚’å®Ÿè£…ã—ã¦ã„ã‚Œã°ã€<code>FromStr::from_str()</code>ãŒã‚ˆã°ã‚Œã‚‹)<br> ãã®ãŸã‚ã€å…¥åŠ›ã‚’<code>String</code>ã¨ã—ã¦å—ã‘å–ã‚ŠãŸã‘ã‚Œã°ã€<code>String</code>ãŒãã®ã¾ã¾åˆ©ç”¨ã§ãã¾ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#88c0d0;font-weight:700>input!</span><span style=color:#eceff4>{</span></span>
<span class=giallo-l><span>  s</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> String</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p>ã“ã‚Œã¯ã€<code>String</code>ãŒ<a href=https://doc.rust-lang.org/src/alloc/string.rs.html#2225 rel=external><code>FromStr</code>ã‚’å®Ÿè£…</a>ã—ã¦ã„ã‚‹ãŸã‚ã§ã™ã€‚<br> å…¥åŠ›ã‚’<code>Vec&lt;char></code>ã‚„ã€<code>Vec&lt;u8></code>ã§ã†ã‘ã¨ã‚ŠãŸã„ã¨ãã¯ã©ã†ã™ã‚Œã°ã‚ˆã„ã§ã—ã‚‡ã†ã‹ã€‚å‹å®šç¾©ã—ã¦ã€<code>Readable</code>ã‚’å®Ÿè£…ã™ã‚Œã°ã‚ˆã„ã®ã§ã™ãŒã€æƒ³å®šã•ã‚Œã‚‹ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ãªã®ã§ã€<code>proconio</code>å´ãŒç”¨æ„ã—ã¦ãã‚Œã¦ã„ã¾ã™ã€‚ãã‚ŒãŒã€<code>marker::{Chars,Bytes}</code>ã§ã™ã€‚ [https://github.com/statiolake/proconio-rs/blob/master/proconio/src/marker.rs]<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>enum</span><span style=color:#8fbcbb> Chars</span><span style=color:#eceff4> {}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>impl</span><span style=color:#8fbcbb> Readable</span><span style=color:#81a1c1> for</span><span style=color:#8fbcbb> Chars</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    type</span><span style=color:#8fbcbb> Output</span><span style=color:#81a1c1> =</span><span style=color:#8fbcbb> Vec</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>char</span><span style=color:#eceff4>>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>    fn</span><span style=color:#88c0d0> read</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>R</span><span style=color:#81a1c1>:</span><span> std</span><span style=color:#81a1c1>::</span><span>io</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>BufRead</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> S</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Source</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>R</span><span style=color:#eceff4>>>(</span><span>source</span><span style=color:#81a1c1>: &mut</span><span style=color:#8fbcbb> S</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> Vec</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>char</span><span style=color:#eceff4>> {</span></span>
<span class=giallo-l><span>        source</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>next_token_unwrap</span><span style=color:#eceff4>()</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>chars</span><span style=color:#eceff4>()</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>collect</span><span style=color:#eceff4>()</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>enum</span><span style=color:#8fbcbb> Bytes</span><span style=color:#eceff4> {}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>impl</span><span style=color:#8fbcbb> Readable</span><span style=color:#81a1c1> for</span><span style=color:#8fbcbb> Bytes</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    type</span><span style=color:#8fbcbb> Output</span><span style=color:#81a1c1> =</span><span style=color:#8fbcbb> Vec</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>u8</span><span style=color:#eceff4>>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>    fn</span><span style=color:#88c0d0> read</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>R</span><span style=color:#81a1c1>:</span><span> std</span><span style=color:#81a1c1>::</span><span>io</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>BufRead</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> S</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Source</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>R</span><span style=color:#eceff4>>>(</span><span>source</span><span style=color:#81a1c1>: &mut</span><span style=color:#8fbcbb> S</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> Vec</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>u8</span><span style=color:#eceff4>> {</span></span>
<span class=giallo-l><span>        source</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>next_token_unwrap</span><span style=color:#eceff4>()</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>bytes</span><span style=color:#eceff4>()</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>collect</span><span style=color:#eceff4>()</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p>ãã‚Œãã‚ŒãŒ<code>Readable</code>ã‚’å®šç¾©ã—ã¦ã„ã‚‹ã®ã§ã€ä»¥ä¸‹ã®ã‚ˆã†ã«ã‹ã‘ã¾ã™ã€‚ debugã‚’æŠœç²‹ã™ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã£ã¦ã„ã‚‹ã®ãŒã‚ã‹ã‚Šã¾ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=plain><span class=giallo-l><span>= note: to `&lt; String as Readable > :: read(&mut s)`</span></span>
<span class=giallo-l><span>= note: to `&lt; Chars as Readable > :: read(&mut s)`</span></span>
<span class=giallo-l><span>= note: to `&lt; Bytes as Readable > :: read(&mut s)`</span></span></code></pre><h3 id=marker-usize1-isize1><a aria-label="Anchor link for: marker-usize1-isize1" class=zola-anchor href=#marker-usize1-isize1><code>marker::{Usize1,Isize1}</code></a></h3><p>1ã‚ªãƒªã‚¸ãƒ³ã®æ•°ã‚’0ã‚ªãƒªã‚¸ãƒ³ã«å¤‰æ›ã™ã‚‹utilityã‚’æä¾›ã—ã¦ãã‚Œã¾ã™ã€‚å‡¦ç†ã¨ã—ã¦ã¯<a href=https://github.com/statiolake/proconio-rs/blob/a3b10f55c15177ec322ce686f0bd977011593366/proconio/src/marker.rs#L41 rel=external>readæ™‚ã«<code>checked_sub()</code>ã‚’å®Ÿè¡Œã—ã¦ãã‚Œã¦ã„ã¾ã™</a><h3 id=array><a aria-label="Anchor link for: array" class=zola-anchor href=#array>array</a></h3><p>æ¬¡ã«ã€arrayã®èª­ã¿è¾¼ã¿ã«ã¤ã„ã¦è¦‹ã¦ã„ãã¾ã™ã€‚æœ€åˆã«arrayã®è¦ç´ æ•°ã€æ¬¡ã«è¦ç´ æ•°ã«å¯¾å¿œã—ãŸå„è¦ç´ ãŒæ¸¡ã•ã‚Œã‚‹å…¥åŠ›ã‚’æƒ³å®šã—ã¦ã„ã¾ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span># </span><span style=color:#81a1c1>!</span><span style=color:#eceff4>[</span><span style=color:#88c0d0>feature</span><span style=color:#eceff4>(</span><span>trace_macros</span><span style=color:#eceff4>)]</span></span>
<span class=giallo-l><span style=color:#616e88>// ...</span></span>
<span class=giallo-l><span style=color:#81a1c1>fn</span><span style=color:#88c0d0> main</span><span style=color:#eceff4>() {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    let</span><span> source</span><span style=color:#81a1c1> =</span><span style=color:#8fbcbb> OnceSource</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>from</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>3 1 2 3</span><span style=color:#eceff4>");</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>    trace_macros!</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>true</span><span style=color:#eceff4>);</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>    input!</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span>        from source</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>        n</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> usize</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>        a</span><span style=color:#81a1c1>:</span><span style=color:#eceff4> [</span><span style=color:#8fbcbb>i32</span><span style=color:#eceff4>;</span><span> n</span><span style=color:#eceff4>],</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>    trace_macros!</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>false</span><span style=color:#eceff4>);</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>    assert_eq!</span><span style=color:#eceff4>(</span><span>a</span><span style=color:#eceff4>, [</span><span style=color:#b48ead>1</span><span style=color:#eceff4>,</span><span style=color:#b48ead> 2</span><span style=color:#eceff4>,</span><span style=color:#b48ead> 3</span><span style=color:#eceff4>]);</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>    println!</span><span style=color:#eceff4>("</span><span style=color:#ebcb8b>{</span><span style=color:#a3be8c>:?</span><span style=color:#ebcb8b>}</span><span style=color:#eceff4>",</span><span> a</span><span style=color:#eceff4>);</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p>å®Ÿã¯<code>input!</code> macroè‡ªä½“ã¯ã•ãã»ã©ã®mutå¯¾å¿œã§ã€å®Œæˆã—ã€ä»¥å¾Œã¯<code>read_value!</code>ã®æ‹¡å¼µã§å¯¾å¿œã§ãã‚‹å‹ã‚’å¢—ã‚„ã—ã¦ã„ãã¾ã™ã€‚ã©ã†ã„ã†ã“ã¨ã‹ã¨ã„ã†ã¨ã€debugã®æŠœç²‹ã§ã™ãŒä»¥ä¸‹ã®ã‚ˆã†ãªå‡ºåŠ›ã‚’ãˆã¾ã™ã€‚(<code>n: usize,</code>ãŒå‡¦ç†ã•ã‚ŒãŸã‚ã¨ã‚’æƒ³å®šã—ã¦ãã ã•ã„)<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=plain><span class=giallo-l><span>    = note: expanding `input! { @ from [&mut s] @ rest a : [i32 ; n], }`</span></span>
<span class=giallo-l><span>    = note: to `input ! { @ from [&mut s] @ mut [] @ rest a : [i32 ; n], }`</span></span>
<span class=giallo-l><span>    = note: expanding `input! { @ from [&mut s] @ mut [] @ rest a : [i32 ; n], }`</span></span>
<span class=giallo-l><span>    = note: to `input ! { @ from [&mut s] @ mut [] @ var a @ kind [] @ rest [i32 ; n], }`</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>    // ã“ã“ãŒãƒã‚¤ãƒ³ãƒˆ</span></span>
<span class=giallo-l><span>    = note: expanding `input! { @ from [&mut s] @ mut [] @ var a @ kind [] @ rest [i32 ; n], }`</span></span>
<span class=giallo-l><span>    = note: to `input ! (@ from [&mut s] @ mut [] @ var a @ kind [[i32 ; n]] @ rest,) ;`</span></span>
<span class=giallo-l><span>     //                                                           â†‘ `[i32 ; n] ãŒttã¨ã—ã¦æ‰±ã‚ã‚Œã¦ã„ã‚‹</span></span>
<span class=giallo-l><span>     //</span></span>
<span class=giallo-l><span>    = note: expanding `input! { @ from [&mut s] @ mut [] @ var a @ kind [[i32 ; n]] @ rest, }`</span></span>
<span class=giallo-l><span>    = note: to `input ! (@ from [&mut s] @ mut [] @ var a @ kind [[i32 ; n]] @ rest) ; input !</span></span>
<span class=giallo-l><span>            (@ from [&mut s] @ rest) ;`</span></span>
<span class=giallo-l><span>    = note: expanding `input! { @ from [&mut s] @ mut [] @ var a @ kind [[i32 ; n]] @ rest }`</span></span>
<span class=giallo-l><span>    = note: to `let a = read_value ! (@ source [&mut s] @ kind [[i32 ; n]]) ;`</span></span></code></pre><p>ã“ã“ãŒãƒã‚¤ãƒ³ãƒˆãªã®ã§ã™ãŒã€<code>a: [i32; n]</code> ã¨ã„ã†å…¥åŠ›ãŒmacroã«ã¯token treesã¨ã—ã¦æ¸¡ã•ã‚Œã¾ã™ã€‚æ“¬ä¼¼çš„ã«ã²ã¨ã¤ã®token treeã‚’<code>{}</code> ã§ããã‚‹ã¨ã™ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚<br> <code>{a} {:} {[i32 ; n]} {,}</code><br> ãã®çµæœã€<code>[i32 ; n]</code>ãŒã²ã¨ã¤ã®å‹æƒ…å ±ã¨ã—ã¦æ‰±ã‚ã€<code>read_value ! (@ source [&mut s] @ kind [[i32 ; n]]) ;</code> ã¨ã—ã¦ã€<code>read_value!</code>ã«arrayã¨ã—ã¦æ¸¡ã•ã‚Œã¾ã™ã€‚(nã¯parseæ¸ˆ)<br> ã—ãŸãŒã£ã¦ã€<code>read_value!</code>ã§arrayã‚’æ¸¡ã•ã‚Œã¦ã‚‚å€¤ã‚’ã‹ãˆã›ã‚‹ã‚ˆã†ã«ã™ã‚Œã°ã‚ˆã„ã“ã¨ã«ãªã‚Šã¾ã™ã€‚<br> arrayã«å¯¾å¿œã™ã‚‹armã‚’è¿½åŠ ã—ãŸã‚ã¨ã®<code>read_value!</code>ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#88c0d0;font-weight:700>macro_rules! read_value</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#616e88>    // array</span></span>
<span class=giallo-l><span style=color:#eceff4>    (</span><span style=color:#81a1c1>@</span><span>source</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span>source</span><span style=color:#81a1c1>:</span><span>expr</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @</span><span>kind</span><span style=color:#eceff4> [[</span><span style=color:#81a1c1>$</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>kind</span><span style=color:#81a1c1>:</span><span>tt</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>*</span><span style=color:#eceff4>]])</span><span style=color:#81a1c1> =></span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>        read_value!</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>@</span><span>array</span><span style=color:#81a1c1> @</span><span>source</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span>source</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @</span><span>kind</span><span style=color:#eceff4> []</span><span style=color:#81a1c1> @</span><span>rest</span><span style=color:#81a1c1> $</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>kind</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>*</span><span style=color:#eceff4>)</span></span>
<span class=giallo-l><span style=color:#eceff4>    };</span></span>
<span class=giallo-l><span style=color:#eceff4>    (</span><span style=color:#81a1c1>@</span><span>array</span><span style=color:#81a1c1> @</span><span>source</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span>source</span><span style=color:#81a1c1>:</span><span>expr</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @</span><span>kind</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>kind</span><span style=color:#81a1c1>:</span><span>tt</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>*</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @</span><span>rest</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> =></span><span style=color:#eceff4> {{</span></span>
<span class=giallo-l><span style=color:#81a1c1>        let</span><span> len</span><span style=color:#81a1c1> =</span><span style=color:#eceff4> &lt;</span><span style=color:#8fbcbb>usize</span><span style=color:#81a1c1> as</span><span style=color:#8fbcbb> Readable</span><span style=color:#eceff4>></span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>read</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>source</span><span style=color:#eceff4>);</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>        read_value!</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>@</span><span>source</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span>source</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @</span><span>kind</span><span style=color:#eceff4> [[</span><span style=color:#81a1c1>$</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>kind</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>*</span><span style=color:#eceff4>;</span><span> len</span><span style=color:#eceff4>]])</span></span>
<span class=giallo-l><span style=color:#eceff4>    }};</span></span>
<span class=giallo-l><span style=color:#eceff4>    (</span><span style=color:#81a1c1>@</span><span>array</span><span style=color:#81a1c1> @</span><span>source</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span>source</span><span style=color:#81a1c1>:</span><span>expr</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @</span><span>kind</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>kind</span><span style=color:#81a1c1>:</span><span>tt</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>*</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @</span><span>rest</span><span style=color:#eceff4> ;</span><span style=color:#81a1c1> $</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>rest</span><span style=color:#81a1c1>:</span><span>tt</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>*</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> =></span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>        read_value!</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>@</span><span>array</span><span style=color:#81a1c1> @</span><span>source</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span>source</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @</span><span>kind</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>kind</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>*</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @</span><span>len</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>rest</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>*</span><span style=color:#eceff4>])</span></span>
<span class=giallo-l><span style=color:#eceff4>    };</span></span>
<span class=giallo-l><span style=color:#eceff4>    (</span><span style=color:#81a1c1>@</span><span>array</span><span style=color:#81a1c1> @</span><span>source</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span>source</span><span style=color:#81a1c1>:</span><span>expr</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @</span><span>kind</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>kind</span><span style=color:#81a1c1>:</span><span>tt</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>*</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @</span><span>rest</span><span style=color:#81a1c1> $</span><span>tt</span><span style=color:#81a1c1>:</span><span>tt</span><span style=color:#81a1c1> $</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>rest</span><span style=color:#81a1c1>:</span><span>tt</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>*</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> =></span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>        read_value!</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>@</span><span>array</span><span style=color:#81a1c1> @</span><span>source</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span>source</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @</span><span>kind</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>kind</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>* $</span><span>tt</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @</span><span>rest</span><span style=color:#81a1c1> $</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>rest</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>*</span><span style=color:#eceff4>)</span></span>
<span class=giallo-l><span style=color:#eceff4>    };</span></span>
<span class=giallo-l><span style=color:#eceff4>    (</span><span style=color:#81a1c1>@</span><span>array</span><span style=color:#81a1c1> @</span><span>source</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span>source</span><span style=color:#81a1c1>:</span><span>expr</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @</span><span>kind</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>kind</span><span style=color:#81a1c1>:</span><span>tt</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>*</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @</span><span>len</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>len</span><span style=color:#81a1c1>:</span><span>tt</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>*</span><span style=color:#eceff4>])</span><span style=color:#81a1c1> =></span><span style=color:#eceff4> {{</span></span>
<span class=giallo-l><span style=color:#81a1c1>        let</span><span> len</span><span style=color:#81a1c1> = $</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>len</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>*</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#eceff4>        (</span><span style=color:#b48ead>0</span><span style=color:#81a1c1>..</span><span>len</span><span style=color:#eceff4>)</span></span>
<span class=giallo-l><span style=color:#81a1c1>            .</span><span style=color:#88c0d0>map</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>|</span><span>_</span><span style=color:#81a1c1>|</span><span style=color:#88c0d0;font-weight:700> read_value!</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>@</span><span>source</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span>source</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @</span><span>kind</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>kind</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>*</span><span style=color:#eceff4>]))</span></span>
<span class=giallo-l><span style=color:#81a1c1>            .</span><span style=color:#88c0d0>collect</span><span style=color:#81a1c1>::</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Vec</span><span style=color:#eceff4>&lt;</span><span>_</span><span style=color:#eceff4>>>()</span></span>
<span class=giallo-l><span style=color:#eceff4>    }};</span></span>
<span class=giallo-l></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#eceff4>    (</span><span style=color:#81a1c1>@</span><span>source</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span>source</span><span style=color:#81a1c1>:</span><span>expr</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @</span><span>kind</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span>kind</span><span style=color:#81a1c1>:</span><span>ty</span><span style=color:#eceff4>])</span><span style=color:#81a1c1> =></span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#eceff4>        &lt;</span><span style=color:#81a1c1>$</span><span>kind</span><span style=color:#81a1c1> as</span><span style=color:#8fbcbb> Readable</span><span style=color:#eceff4>></span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>read</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>source</span><span style=color:#eceff4>)</span></span>
<span class=giallo-l><span style=color:#eceff4>    };</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p>ãƒã‚¤ãƒ³ãƒˆã¯<code>(@source [$source:expr] @kind [[$($kind:tt)*]])</code> armã§ã€<code>[[ ... ]]</code>ã§ã†ã‘ã‚‹ã“ã¨ã§ã€<code>[i32 ; n ]</code>ã‚’å†ã³ã€<code>{i32}, {;}, {n}</code>ã®ã‚ˆã†ã«token treeåˆ—ã«ã—ã¦ã„ã‚‹ã¨ã“ã‚ã§ã™ã€‚<br> ã“ã†ã™ã‚‹ã“ã¨ã§ã€æœ€çµ‚çš„ã«<code>i32</code>ã‚’<code>n</code>å›readã™ã‚‹loopãŒç”Ÿæˆã•ã‚Œã¦ã„ã¾ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=plain><span class=giallo-l><span>    = note: expanding `input! { @ from [&mut s] @ mut [] @ var a @ kind [[i32 ; n]] @ rest }`</span></span>
<span class=giallo-l><span>    = note: to `let a = read_value ! (@ source [&mut s] @ kind [[i32 ; n]]) ;`</span></span>
<span class=giallo-l><span>    = note: expanding `read_value! { @ source [&mut s] @ kind [[i32 ; n]] }`</span></span>
<span class=giallo-l><span>    = note: to `read_value ! (@ array @ source [&mut s] @ kind [] @ rest i32 ; n)`</span></span>
<span class=giallo-l><span>    = note: expanding `read_value! { @ array @ source [&mut s] @ kind [] @ rest i32 ; n }`</span></span>
<span class=giallo-l><span>    = note: to `read_value ! (@ array @ source [&mut s] @ kind [i32] @ rest ; n)`</span></span>
<span class=giallo-l><span>    = note: expanding `read_value! { @ array @ source [&mut s] @ kind [i32] @ rest ; n }`</span></span>
<span class=giallo-l><span>    = note: to `read_value ! (@ array @ source [&mut s] @ kind [i32] @ len [n])`</span></span>
<span class=giallo-l><span>    = note: expanding `read_value! { @ array @ source [&mut s] @ kind [i32] @ len [n] }`</span></span>
<span class=giallo-l><span>    = note: to `{</span></span>
<span class=giallo-l><span>                let len = n ; (0 .. len) .</span></span>
<span class=giallo-l><span>                map(| _ | read_value ! (@ source [&mut s] @ kind [i32])) . collect :: &lt;</span></span>
<span class=giallo-l><span>                Vec &lt; _ >> ()</span></span>
<span class=giallo-l><span>            }`</span></span>
<span class=giallo-l><span>    = note: expanding `read_value! { @ source [&mut s] @ kind [i32] }`</span></span>
<span class=giallo-l><span>    = note: to `&lt; i32 as Readable > :: read(&mut s)`</span></span></code></pre><p>expandã—ã¦ã¿ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ã«ãªã£ã¦ã„ã¾ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>fn</span><span style=color:#88c0d0> main</span><span style=color:#eceff4>() {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    let</span><span> source</span><span style=color:#81a1c1> =</span><span style=color:#8fbcbb> OnceSource</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>from</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>3 1 2 3</span><span style=color:#eceff4>");</span></span>
<span class=giallo-l><span style=color:#81a1c1>    let mut</span><span> s</span><span style=color:#81a1c1> =</span><span> source</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>    let</span><span> n</span><span style=color:#81a1c1> =</span><span style=color:#eceff4> &lt;</span><span style=color:#8fbcbb>usize</span><span style=color:#81a1c1> as</span><span style=color:#8fbcbb> Readable</span><span style=color:#eceff4>></span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>read</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&mut</span><span> s</span><span style=color:#eceff4>);</span></span>
<span class=giallo-l><span style=color:#81a1c1>    let</span><span> a</span><span style=color:#81a1c1> =</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>        let</span><span> len</span><span style=color:#81a1c1> =</span><span> n</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#eceff4>        (</span><span style=color:#b48ead>0</span><span style=color:#81a1c1>..</span><span>len</span><span style=color:#eceff4>)</span></span>
<span class=giallo-l><span style=color:#81a1c1>            .</span><span style=color:#88c0d0>map</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>|</span><span>_</span><span style=color:#81a1c1>|</span><span style=color:#eceff4> &lt;</span><span style=color:#8fbcbb>i32</span><span style=color:#81a1c1> as</span><span style=color:#8fbcbb> Readable</span><span style=color:#eceff4>></span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>read</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&mut</span><span> s</span><span style=color:#eceff4>))</span></span>
<span class=giallo-l><span style=color:#81a1c1>            .</span><span style=color:#88c0d0>collect</span><span style=color:#81a1c1>::</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Vec</span><span style=color:#eceff4>&lt;</span><span>_</span><span style=color:#eceff4>>>()</span></span>
<span class=giallo-l><span style=color:#eceff4>    };</span></span>
<span class=giallo-l><span style=color:#616e88>    // ...</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p>ã“ã“ã‹ã‚‰ã€<code>input!</code>ã«<code>a: [i32 ; 3]</code> ã¨æ¸¡ã—ã¦ã‚‚arrayã§ã¯ãªã<code>Vec&lt;i32></code>ãŒç”Ÿæˆã•ã‚Œã‚‹ã“ã¨ã‚‚ã‚ã‹ã‚Šã¾ã™ã­ã€‚<h3 id=2d-array><a aria-label="Anchor link for: 2d-array" class=zola-anchor href=#2d-array>2d array</a></h3><p>arrayã‚’èª­ã¿è¾¼ã‚ã‚‹ã‚ˆã†ã«ãªã£ãŸã®ã§æ¬¡ã«2d arrayã‚’èª­ã¿è¾¼ã‚ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚ãªã‚“ã¨macroã¯ç‰¹ã«è¿½åŠ ã™ã‚‹ã“ã¨ãªãæ—¢ã«å¯¾å¿œã§ãã¦ã„ã¾ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span># </span><span style=color:#81a1c1>!</span><span style=color:#eceff4>[</span><span style=color:#88c0d0>feature</span><span style=color:#eceff4>(</span><span>trace_macros</span><span style=color:#eceff4>)]</span></span>
<span class=giallo-l><span style=color:#616e88>// ...</span></span>
<span class=giallo-l><span style=color:#81a1c1>fn</span><span style=color:#88c0d0> main</span><span style=color:#eceff4>() {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    let</span><span> source</span><span style=color:#81a1c1> =</span><span style=color:#8fbcbb> OnceSource</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>from</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>1 2 3 4 5 6</span><span style=color:#eceff4>");</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>    trace_macros!</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>true</span><span style=color:#eceff4>);</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>    input!</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span>        from source</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>        m</span><span style=color:#81a1c1>:</span><span style=color:#eceff4> [[</span><span style=color:#8fbcbb>i32</span><span style=color:#eceff4>;</span><span style=color:#b48ead> 3</span><span style=color:#eceff4>];</span><span style=color:#b48ead> 2</span><span style=color:#eceff4>],</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>    trace_macros!</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>false</span><span style=color:#eceff4>);</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>    assert_eq!</span><span style=color:#eceff4>(</span><span>m</span><span style=color:#eceff4>,</span><span style=color:#88c0d0;font-weight:700> vec!</span><span style=color:#eceff4>[</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>        vec!</span><span style=color:#eceff4>[</span><span style=color:#b48ead>1</span><span style=color:#eceff4>,</span><span style=color:#b48ead>2</span><span style=color:#eceff4>,</span><span style=color:#b48ead>3</span><span style=color:#eceff4>],</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>        vec!</span><span style=color:#eceff4>[</span><span style=color:#b48ead>4</span><span style=color:#eceff4>,</span><span style=color:#b48ead>5</span><span style=color:#eceff4>,</span><span style=color:#b48ead>6</span><span style=color:#eceff4>],</span></span>
<span class=giallo-l><span style=color:#eceff4>    ]);</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>    println!</span><span style=color:#eceff4>("</span><span style=color:#ebcb8b>{</span><span style=color:#a3be8c>:?</span><span style=color:#ebcb8b>}</span><span style=color:#eceff4>",</span><span> m</span><span style=color:#eceff4>);</span></span>
<span class=giallo-l><span style=color:#616e88>    // [[1, 2, 3], [4, 5, 6]]</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p>ä»Šå›ã¯debugã‚’ã™ã¹ã¦ã®ã›ã¾ã™<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=plain><span class=giallo-l><span>â¯ c +nightly run</span></span>
<span class=giallo-l><span>note: trace_macro</span></span>
<span class=giallo-l><span>   --> src/main.rs:272:5</span></span>
<span class=giallo-l><span>    |</span></span>
<span class=giallo-l><span>272 | /     input! {</span></span>
<span class=giallo-l><span>273 | |         from source,</span></span>
<span class=giallo-l><span>274 | |         m: [[i32; 3]; 2],</span></span>
<span class=giallo-l><span>275 | |     }</span></span>
<span class=giallo-l><span>    | |_____^</span></span>
<span class=giallo-l><span>    |</span></span>
<span class=giallo-l><span>    = note: expanding `input! { from source, m : [[i32 ; 3] ; 2], }`</span></span>
<span class=giallo-l><span>    = note: to `let mut s = source ; input ! { @ from [& mut s] @ rest m : [[i32 ; 3] ; 2], }`</span></span>
<span class=giallo-l><span>    = note: expanding `input! { @ from [& mut s] @ rest m : [[i32 ; 3] ; 2], }`</span></span>
<span class=giallo-l><span>    = note: to `input ! { @ from [&mut s] @ mut [] @ rest m : [[i32 ; 3] ; 2], }`</span></span>
<span class=giallo-l><span>    = note: expanding `input! { @ from [&mut s] @ mut [] @ rest m : [[i32 ; 3] ; 2], }`</span></span>
<span class=giallo-l><span>    = note: to `input ! { @ from [&mut s] @ mut [] @ var m @ kind [] @ rest [[i32 ; 3] ; 2], }`</span></span>
<span class=giallo-l><span>    = note: expanding `input! { @ from [&mut s] @ mut [] @ var m @ kind [] @ rest [[i32 ; 3] ; 2], }`</span></span>
<span class=giallo-l><span>    = note: to `input ! (@ from [&mut s] @ mut [] @ var m @ kind [[[i32 ; 3] ; 2]] @ rest,) ;`</span></span>
<span class=giallo-l><span>    = note: expanding `input! { @ from [&mut s] @ mut [] @ var m @ kind [[[i32 ; 3] ; 2]] @ rest, }`</span></span>
<span class=giallo-l><span>    = note: to `input ! (@ from [&mut s] @ mut [] @ var m @ kind [[[i32 ; 3] ; 2]] @ rest) ;</span></span>
<span class=giallo-l><span>            input ! (@ from [&mut s] @ rest) ;`</span></span>
<span class=giallo-l><span>    = note: expanding `input! { @ from [&mut s] @ mut [] @ var m @ kind [[[i32 ; 3] ; 2]] @ rest }`</span></span>
<span class=giallo-l><span>    = note: to `let m = read_value ! (@ source [&mut s] @ kind [[[i32 ; 3] ; 2]]) ;`</span></span>
<span class=giallo-l><span>    = note: expanding `read_value! { @ source [&mut s] @ kind [[[i32 ; 3] ; 2]] }`</span></span>
<span class=giallo-l><span>    = note: to `read_value ! (@ array @ source [&mut s] @ kind [] @ rest [i32 ; 3] ; 2)`</span></span>
<span class=giallo-l><span>    = note: expanding `read_value! { @ array @ source [&mut s] @ kind [] @ rest [i32 ; 3] ; 2 }`</span></span>
<span class=giallo-l><span>    = note: to `read_value ! (@ array @ source [&mut s] @ kind [[i32 ; 3]] @ rest ; 2)`</span></span>
<span class=giallo-l><span>    = note: expanding `read_value! { @ array @ source [&mut s] @ kind [[i32 ; 3]] @ rest ; 2 }`</span></span>
<span class=giallo-l><span>    = note: to `read_value ! (@ array @ source [&mut s] @ kind [[i32 ; 3]] @ len [2])`</span></span>
<span class=giallo-l><span>    = note: expanding `read_value! { @ array @ source [&mut s] @ kind [[i32 ; 3]] @ len [2] }`</span></span>
<span class=giallo-l><span>    = note: to `{</span></span>
<span class=giallo-l><span>                let len = 2 ; (0 .. len) .</span></span>
<span class=giallo-l><span>                map(| _ | read_value ! (@ source [&mut s] @ kind [[i32 ; 3]])) . collect</span></span>
<span class=giallo-l><span>                :: &lt; Vec &lt; _ >> ()</span></span>
<span class=giallo-l><span>            }`</span></span>
<span class=giallo-l><span>    = note: expanding `read_value! { @ source [&mut s] @ kind [[i32 ; 3]] }`</span></span>
<span class=giallo-l><span>    = note: to `read_value ! (@ array @ source [&mut s] @ kind [] @ rest i32 ; 3)`</span></span>
<span class=giallo-l><span>    = note: expanding `read_value! { @ array @ source [&mut s] @ kind [] @ rest i32 ; 3 }`</span></span>
<span class=giallo-l><span>    = note: to `read_value ! (@ array @ source [&mut s] @ kind [i32] @ rest ; 3)`</span></span>
<span class=giallo-l><span>    = note: expanding `read_value! { @ array @ source [&mut s] @ kind [i32] @ rest ; 3 }`</span></span>
<span class=giallo-l><span>    = note: to `read_value ! (@ array @ source [&mut s] @ kind [i32] @ len [3])`</span></span>
<span class=giallo-l><span>    = note: expanding `read_value! { @ array @ source [&mut s] @ kind [i32] @ len [3] }`</span></span>
<span class=giallo-l><span>    = note: to `{</span></span>
<span class=giallo-l><span>                let len = 3 ; (0 .. len) .</span></span>
<span class=giallo-l><span>                map(| _ | read_value ! (@ source [&mut s] @ kind [i32])) . collect :: &lt;</span></span>
<span class=giallo-l><span>                Vec &lt; _ >> ()</span></span>
<span class=giallo-l><span>            }`</span></span>
<span class=giallo-l><span>    = note: expanding `read_value! { @ source [&mut s] @ kind [i32] }`</span></span>
<span class=giallo-l><span>    = note: to `&lt; i32 as Readable > :: read(&mut s)`</span></span>
<span class=giallo-l><span>    = note: expanding `input! { @ from [&mut s] @ rest }`</span></span>
<span class=giallo-l><span>    = note: to ``</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>    Finished dev [unoptimized + debuginfo] target(s) in 0.00s</span></span>
<span class=giallo-l><span>     Running `target/debug/proconio-handson`</span></span>
<span class=giallo-l><span>[[1, 2, 3], [4, 5, 6]]</span></span></code></pre><p>ã•ãã»ã©arrayã§è¿°ã¹ãŸã‚ˆã†ã«ã€<code>[...]</code> ã¯ã²ã¨ã¤ã®token treeã¨ã—ã¦æ‰±ã‚ã‚Œã‚‹ã®ã§ã€<code>read_value!</code>ã¸ã¯ã€<code>@ kind [    [[i32 ; 3] ; 2]    ])</code> ã¨ã—ã¦ã€<code>[[i32; 3]; 2]</code>ã¨ã„ã†2d arrayã®å‹æƒ…å ±ã‚’ãŸã‚‚ã£ãŸã¾ã¾æ‰±ã‚ã‚Œã¾ã™ã€‚ ã“ã“ãŒ2d arrayã®ãƒã‚¤ãƒ³ãƒˆãªã®ã§ã™ãŒã€<code>read_value!</code>ã¯å…ˆé ­ã®armã§<code>@kind [[$($kind:tt)*]]</code>ã®ã‚ˆã†ã«ãƒãƒƒãƒã•ã›ã¦ã„ã‚‹ã®ã§ã€<code>@rest</code>ã¨ã—ã¦ã€<code>[i32 ; 3] ; 2</code>ãŒæ®‹ã‚Šã¾ã™ã€‚arrayã®ã¨ã“ã‚ã§ã¯ã€<code>read_value!</code>ã¯ <code>i32 ; 3</code>ã®ã‚ˆã†ãªå…¥åŠ›ã‚’ã†ã¾ãæ‰±ãˆã¾ã—ãŸãŒã€ã“ã‚Œã¯<code>å‹ ; len</code>ã¨ã„ã†é †ç•ªã®token treeã¨ã‚‚ã„ãˆã¾ã™ã€‚<code>[i32 ; 3] ; 2</code>ã§ã‚ã£ã¦ã‚‚ã€<code>[]</code>ã§ã‚°ãƒ«ãƒ¼ãƒ”ãƒ³ã‚°ã•ã‚Œã²ã¨ã¤ã®token treeã¨ã—ã¦æ‰±ã‚ã‚Œã‚‹ã®ã§ã€<code>[i32 ; 3](å‹) ; 2(len)</code>ã¨åŒã˜ä¸¦ã³ã¨ã„ãˆã¾ã™ã€‚ã—ãŸãŒã£ã¦ã€<code>i32</code>ã‚’3å›readã™ã‚‹ã‚³ãƒ¼ãƒ‰ãŒç”Ÿæˆã•ã‚ŒãŸã®ã¨åŒã˜ç†ç”±ã§ã€<code>[i32 ; 3]</code>ã‚’2å›readã™ã‚‹ã‚³ãƒ¼ãƒ‰ãŒç”Ÿæˆã•ã‚Œã¾ã™ã€‚ expandã—ã¦ã¿ã‚‹ã¨<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>let</span><span> source</span><span style=color:#81a1c1> =</span><span style=color:#8fbcbb> OnceSource</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>from</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>1 2 3 4 5 6</span><span style=color:#eceff4>");</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>input!</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span>    from source</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>    m</span><span style=color:#81a1c1>:</span><span style=color:#eceff4> [[</span><span style=color:#8fbcbb>i32</span><span style=color:#eceff4>;</span><span style=color:#b48ead> 3</span><span style=color:#eceff4>];</span><span style=color:#b48ead> 2</span><span style=color:#eceff4>],</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p>ã‹ã‚‰<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>fn</span><span style=color:#88c0d0> main</span><span style=color:#eceff4>() {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    let</span><span> source</span><span style=color:#81a1c1> =</span><span style=color:#8fbcbb> OnceSource</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>from</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>1 2 3 4 5 6</span><span style=color:#eceff4>");</span></span>
<span class=giallo-l><span style=color:#eceff4>    ();</span></span>
<span class=giallo-l><span style=color:#81a1c1>    let mut</span><span> s</span><span style=color:#81a1c1> =</span><span> source</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>    let</span><span> m</span><span style=color:#81a1c1> =</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>        let</span><span> len</span><span style=color:#81a1c1> =</span><span style=color:#b48ead> 2</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#eceff4>        (</span><span style=color:#b48ead>0</span><span style=color:#81a1c1>..</span><span>len</span><span style=color:#eceff4>)</span></span>
<span class=giallo-l><span style=color:#81a1c1>            .</span><span style=color:#88c0d0>map</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>|</span><span>_</span><span style=color:#81a1c1>|</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>                let</span><span> len</span><span style=color:#81a1c1> =</span><span style=color:#b48ead> 3</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#eceff4>                (</span><span style=color:#b48ead>0</span><span style=color:#81a1c1>..</span><span>len</span><span style=color:#eceff4>)</span></span>
<span class=giallo-l><span style=color:#81a1c1>                    .</span><span style=color:#88c0d0>map</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>|</span><span>_</span><span style=color:#81a1c1>|</span><span style=color:#eceff4> &lt;</span><span style=color:#8fbcbb>i32</span><span style=color:#81a1c1> as</span><span style=color:#8fbcbb> Readable</span><span style=color:#eceff4>></span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>read</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&mut</span><span> s</span><span style=color:#eceff4>))</span></span>
<span class=giallo-l><span style=color:#81a1c1>                    .</span><span style=color:#88c0d0>collect</span><span style=color:#81a1c1>::</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Vec</span><span style=color:#eceff4>&lt;</span><span>_</span><span style=color:#eceff4>>>()</span></span>
<span class=giallo-l><span style=color:#eceff4>            })</span></span>
<span class=giallo-l><span style=color:#81a1c1>            .</span><span style=color:#88c0d0>collect</span><span style=color:#81a1c1>::</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Vec</span><span style=color:#eceff4>&lt;</span><span>_</span><span style=color:#eceff4>>>()</span></span>
<span class=giallo-l><span style=color:#eceff4>    };</span></span>
<span class=giallo-l><span style=color:#616e88>    // ...</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p>ã¨ã„ã†ã‚³ãƒ¼ãƒ‰ãŒç”Ÿæˆã•ã‚Œã¾ã—ãŸã€‚<br> ã¨ã„ã†ã“ã¨ã§ã€å†å¸°çš„ã«å‡¦ç†ã•ã‚Œã‚‹ã®ã§<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#88c0d0;font-weight:700>input!</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span>    m</span><span style=color:#81a1c1>:</span><span style=color:#eceff4> [[[</span><span style=color:#8fbcbb>i32</span><span style=color:#eceff4>;</span><span style=color:#b48ead> 2</span><span style=color:#eceff4>];</span><span style=color:#b48ead> 2</span><span style=color:#eceff4>];</span><span style=color:#b48ead> 3</span><span style=color:#eceff4>],</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p>ã®ã‚ˆã†ã«æ‹¡å¼µã§ãã‚‹ã“ã¨ã‚‚ã‚ã‹ã‚Šã¾ã—ãŸã€‚<h3 id=slice><a aria-label="Anchor link for: slice" class=zola-anchor href=#slice>slice</a></h3><p>documentã§ã¯jagged arrayã¨ã—ã¦æ›¸ã‹ã‚Œã¦ã„ã‚‹sliceã®èª­ã¿è¾¼ã¿ã«ã¤ã„ã¦<blockquote><p>If the first input is the length of the array, you can omit the length. This is the only way to read jagged array (an array of arrays of which the member arrays can be of different sizes) at once.</blockquote><p>å…¥åŠ›ãŒ<code>2 X Y</code>ã®ã‚ˆã†ã«è¦ç´ æ•° è¦ç´ ..è¦ç´ ã®å ´åˆã€<code>input!</code>ã«sliceã‚’æ¸¡ã™ã“ã¨ãŒã§ãã¾ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span># </span><span style=color:#81a1c1>!</span><span style=color:#eceff4>[</span><span style=color:#88c0d0>feature</span><span style=color:#eceff4>(</span><span>trace_macros</span><span style=color:#eceff4>)]</span></span>
<span class=giallo-l><span style=color:#616e88>// ...</span></span>
<span class=giallo-l><span style=color:#81a1c1>fn</span><span style=color:#88c0d0> main</span><span style=color:#eceff4>() {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    let</span><span> source</span><span style=color:#81a1c1> =</span><span style=color:#8fbcbb> OnceSource</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>from</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>3  3 1 2 3  0  2 1 2</span><span style=color:#eceff4>");</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>    trace_macros!</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>true</span><span style=color:#eceff4>);</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>    input!</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span>        from source</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>        n</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> usize</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>        a</span><span style=color:#81a1c1>:</span><span style=color:#eceff4> [[</span><span style=color:#8fbcbb>i32</span><span style=color:#eceff4>];</span><span> n</span><span style=color:#eceff4>],</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>    trace_macros!</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>false</span><span style=color:#eceff4>);</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>    assert_eq!</span><span style=color:#eceff4>(</span><span>a</span><span style=color:#eceff4>,</span><span style=color:#88c0d0;font-weight:700> vec!</span><span style=color:#eceff4>[</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>        vec!</span><span style=color:#eceff4>[</span><span style=color:#b48ead>1</span><span style=color:#eceff4>,</span><span style=color:#b48ead>2</span><span style=color:#eceff4>,</span><span style=color:#b48ead>3</span><span style=color:#eceff4>],</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>        vec!</span><span style=color:#eceff4>[],</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>        vec!</span><span style=color:#eceff4>[</span><span style=color:#b48ead>1</span><span style=color:#eceff4>,</span><span style=color:#b48ead>2</span><span style=color:#eceff4>],</span></span>
<span class=giallo-l><span style=color:#eceff4>    ]);</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>    println!</span><span style=color:#eceff4>("</span><span style=color:#ebcb8b>{</span><span style=color:#a3be8c>:?</span><span style=color:#ebcb8b>}</span><span style=color:#eceff4>",</span><span> a</span><span style=color:#eceff4>);</span></span>
<span class=giallo-l><span style=color:#616e88>    // [[1, 2, 3], [], [1, 2]]</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p>ã“ã“ã¯ãƒã‚¤ãƒ³ãƒˆã ã‘ã‹ã„ã¤ã¾ã‚“ã§è©±ã™ã¨<code>[i32]</code>ãŒ<code>read_value</code>ã«ä»¥ä¸‹ã®ã‚ˆã†ã«æ¸¡ã•ã‚Œã¾ã™ã€‚ <code> = note: expanding read_value! { @ source [&mut s] @ kind [[i32]] }</code><br> ãã—ã¦ã€ã“ã®armã«ãƒãƒƒãƒã—ã¾ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#eceff4>(</span><span style=color:#81a1c1>@</span><span>array</span><span style=color:#81a1c1> @</span><span>source</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span>source</span><span style=color:#81a1c1>:</span><span>expr</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @</span><span>kind</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>kind</span><span style=color:#81a1c1>:</span><span>tt</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>*</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @</span><span>rest</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> =></span><span style=color:#eceff4> {{</span></span>
<span class=giallo-l><span style=color:#81a1c1>    let</span><span> len</span><span style=color:#81a1c1> =</span><span style=color:#eceff4> &lt;</span><span style=color:#8fbcbb>usize</span><span style=color:#81a1c1> as</span><span style=color:#8fbcbb> Readable</span><span style=color:#eceff4>></span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>read</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>source</span><span style=color:#eceff4>);</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>    read_value!</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>@</span><span>source</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span>source</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @</span><span>kind</span><span style=color:#eceff4> [[</span><span style=color:#81a1c1>$</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>kind</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>*</span><span style=color:#eceff4>;</span><span> len</span><span style=color:#eceff4>]])</span></span>
<span class=giallo-l><span style=color:#eceff4>}};</span></span></code></pre><p>ã“ã®ãŸã‚ã€<code>read_value!</code>ãŒè¦ç´ æ•°ãŒæ¸¡ã•ã‚Œã¦ã„ã‚‹å‰æã§<code>len</code>ã‚’å–å¾—ã™ã‚‹å‡¦ç†ãŒç”Ÿæˆã•ã‚Œã€è¦ç´ æ•°åˆ†readã™ã‚‹loopãŒç”Ÿæˆã•ã‚Œã¾ã™ã€‚<h3 id=tuple><a aria-label="Anchor link for: tuple" class=zola-anchor href=#tuple>tuple</a></h3><p>tupleã®å ´åˆã¯ã©ã†ã§ã—ã‚‡ã†ã‹ã€‚ã‚·ãƒ³ãƒ—ãƒ«ãªè¦ç´ æ•°2ã®ã‚¿ãƒ—ãƒ«ã‚’èª­ã‚€å‡¦ç†ã§ã¿ã¦ã„ãã¾ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span># </span><span style=color:#81a1c1>!</span><span style=color:#eceff4>[</span><span style=color:#88c0d0>feature</span><span style=color:#eceff4>(</span><span>trace_macros</span><span style=color:#eceff4>)]</span></span>
<span class=giallo-l><span style=color:#616e88>// ...</span></span>
<span class=giallo-l><span style=color:#81a1c1>fn</span><span style=color:#88c0d0> main</span><span style=color:#eceff4>() {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    let</span><span> source</span><span style=color:#81a1c1> =</span><span style=color:#8fbcbb> OnceSource</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>from</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>10 X</span><span style=color:#eceff4>");</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>    trace_macros!</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>true</span><span style=color:#eceff4>);</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>    input!</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span>        from source</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>        t</span><span style=color:#81a1c1>:</span><span style=color:#eceff4> (</span><span style=color:#8fbcbb>i8</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> String</span><span style=color:#eceff4>),</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>    trace_macros!</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>false</span><span style=color:#eceff4>);</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>    assert_eq!</span><span style=color:#eceff4>(</span><span>t</span><span style=color:#eceff4>, (</span><span style=color:#b48ead>10</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> String</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>from</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>X</span><span style=color:#eceff4>")));</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>    println!</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>t: </span><span style=color:#ebcb8b>{</span><span style=color:#a3be8c>:?</span><span style=color:#ebcb8b>}</span><span style=color:#eceff4>",</span><span> t</span><span style=color:#eceff4>);</span></span>
<span class=giallo-l><span style=color:#616e88>    // t: (10, "X")</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p>tupleã‚‚arrayåŒæ§˜ã«ã€<code>()</code>ã§ã‚°ãƒ«ãƒ¼ãƒ”ãƒ³ã‚°ã•ã‚Œã€<code>read_value!</code>ã«æ¸¡ã•ã‚Œã¾ã™ã€‚tupleã®ãŸã‚ã«è¿½åŠ ã™ã‚‹armã¯ä»¥ä¸‹ã§ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#88c0d0;font-weight:700>macro_rules! read_value</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#616e88>    // ...</span></span>
<span class=giallo-l><span style=color:#616e88>    // tuple</span></span>
<span class=giallo-l><span style=color:#eceff4>    (</span><span style=color:#81a1c1>@</span><span>source</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span>source</span><span style=color:#81a1c1>:</span><span>expr</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @</span><span>kind</span><span style=color:#eceff4> [(</span><span style=color:#81a1c1>$</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>kinds</span><span style=color:#81a1c1>:</span><span>tt</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>*</span><span style=color:#eceff4>)])</span><span style=color:#81a1c1> =></span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>        read_value!</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>@</span><span>tuple</span><span style=color:#81a1c1> @</span><span>source</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span>source</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @</span><span>kinds</span><span style=color:#eceff4> []</span><span style=color:#81a1c1> @</span><span>current</span><span style=color:#eceff4> []</span><span style=color:#81a1c1> @</span><span>rest</span><span style=color:#81a1c1> $</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>kinds</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>*</span><span style=color:#eceff4>)</span></span>
<span class=giallo-l><span style=color:#eceff4>    };</span></span>
<span class=giallo-l><span style=color:#eceff4>    (</span><span style=color:#81a1c1>@</span><span>tuple</span><span style=color:#81a1c1> @</span><span>source</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span>source</span><span style=color:#81a1c1>:</span><span>expr</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @</span><span>kinds</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span style=color:#eceff4>([</span><span style=color:#81a1c1>$</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>kind</span><span style=color:#81a1c1>:</span><span>tt</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>*</span><span style=color:#eceff4>])</span><span style=color:#81a1c1>*</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @</span><span>current</span><span style=color:#eceff4> []</span><span style=color:#81a1c1> @</span><span>rest</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> =></span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#eceff4>        (</span></span>
<span class=giallo-l><span style=color:#81a1c1>            $</span><span style=color:#eceff4>(</span><span style=color:#88c0d0;font-weight:700>read_value!</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>@</span><span>source</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span>source</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @</span><span>kind</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>kind</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>*</span><span style=color:#eceff4>]),)</span><span style=color:#81a1c1>*</span></span>
<span class=giallo-l><span style=color:#eceff4>        )</span></span>
<span class=giallo-l><span style=color:#eceff4>    };</span></span>
<span class=giallo-l><span style=color:#eceff4>    (</span><span style=color:#81a1c1>@</span><span>tuple</span><span style=color:#81a1c1> @</span><span>source</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span>source</span><span style=color:#81a1c1>:</span><span>expr</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @</span><span>kinds</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>kinds</span><span style=color:#81a1c1>:</span><span>tt</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>*</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @</span><span>current</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>curr</span><span style=color:#81a1c1>:</span><span>tt</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>*</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @</span><span>rest</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> =></span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>        read_value!</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>@</span><span>tuple</span><span style=color:#81a1c1> @</span><span>source</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span>source</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @</span><span>kinds</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>kinds</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>*</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>curr</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>*</span><span style=color:#eceff4>]]</span><span style=color:#81a1c1> @</span><span>current</span><span style=color:#eceff4> []</span><span style=color:#81a1c1> @</span><span>rest</span><span style=color:#eceff4>)</span></span>
<span class=giallo-l><span style=color:#eceff4>    };</span></span>
<span class=giallo-l><span style=color:#eceff4>    (</span><span style=color:#81a1c1>@</span><span>tuple</span><span style=color:#81a1c1> @</span><span>source</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span>source</span><span style=color:#81a1c1>:</span><span>expr</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @</span><span>kinds</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>kinds</span><span style=color:#81a1c1>:</span><span>tt</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>*</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @</span><span>current</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>curr</span><span style=color:#81a1c1>:</span><span>tt</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>*</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @</span><span>rest</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> $</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>rest</span><span style=color:#81a1c1>:</span><span>tt</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>*</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> =></span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>        read_value!</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>@</span><span>tuple</span><span style=color:#81a1c1> @</span><span>source</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span>source</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @</span><span>kinds</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>kinds</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>*</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>curr</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>*</span><span style=color:#eceff4>]]</span><span style=color:#81a1c1> @</span><span>current</span><span style=color:#eceff4> []</span><span style=color:#81a1c1> @</span><span>rest</span><span style=color:#81a1c1> $</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>rest</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>*</span><span style=color:#eceff4>)</span></span>
<span class=giallo-l><span style=color:#eceff4>    };</span></span>
<span class=giallo-l><span style=color:#eceff4>    (</span><span style=color:#81a1c1>@</span><span>tuple</span><span style=color:#81a1c1> @</span><span>source</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span>source</span><span style=color:#81a1c1>:</span><span>expr</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @</span><span>kinds</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>kinds</span><span style=color:#81a1c1>:</span><span>tt</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>*</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @</span><span>current</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>curr</span><span style=color:#81a1c1>:</span><span>tt</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>*</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @</span><span>rest</span><span style=color:#81a1c1> $</span><span>tt</span><span style=color:#81a1c1>:</span><span>tt</span><span style=color:#81a1c1> $</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>rest</span><span style=color:#81a1c1>:</span><span>tt</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>*</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> =></span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>        read_value!</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>@</span><span>tuple</span><span style=color:#81a1c1> @</span><span>source</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span>source</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @</span><span>kinds</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>kinds</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>*</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @</span><span>current</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>curr</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>* $</span><span>tt</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @</span><span>rest</span><span style=color:#81a1c1> $</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>rest</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>*</span><span style=color:#eceff4>)</span></span>
<span class=giallo-l><span style=color:#eceff4>    };</span></span>
<span class=giallo-l></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#eceff4>    (</span><span style=color:#81a1c1>@</span><span>source</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span>source</span><span style=color:#81a1c1>:</span><span>expr</span><span style=color:#eceff4>]</span><span style=color:#81a1c1> @</span><span>kind</span><span style=color:#eceff4> [</span><span style=color:#81a1c1>$</span><span>kind</span><span style=color:#81a1c1>:</span><span>ty</span><span style=color:#eceff4>])</span><span style=color:#81a1c1> =></span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#eceff4>        &lt;</span><span style=color:#81a1c1>$</span><span>kind</span><span style=color:#81a1c1> as</span><span style=color:#8fbcbb> Readable</span><span style=color:#eceff4>></span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>read</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>source</span><span style=color:#eceff4>)</span></span>
<span class=giallo-l><span style=color:#eceff4>    };</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p>arrayã§ã¯ã€<code>@kind [[$($kind:tt)*]]</code>ã§ãƒãƒƒãƒã•ã›ã¦ã„ãŸã¨ã“ã‚ãŒã€<code>@kind [($($kinds:tt)*)]</code>ã«ãªã£ã¦ã„ã¾ã™ã€‚arrayã¨é•ã†ã®ã¯ã€tupleã®è¦ç´ ã®å‹ã‚’é †ç•ªã«å‡¦ç†ã—ã¦æœ€çµ‚çš„ã«ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã—ã¦ã„ã‚‹ã¨ã“ã‚ã§ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>let</span><span> t</span><span style=color:#81a1c1> =</span><span style=color:#eceff4> (</span></span>
<span class=giallo-l><span style=color:#eceff4>    &lt;</span><span style=color:#8fbcbb>i8</span><span style=color:#81a1c1> as</span><span style=color:#8fbcbb> Readable</span><span style=color:#eceff4>></span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>read</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&mut</span><span> s</span><span style=color:#eceff4>),</span></span>
<span class=giallo-l><span style=color:#eceff4>    &lt;</span><span style=color:#8fbcbb>String</span><span style=color:#81a1c1> as</span><span style=color:#8fbcbb> Readable</span><span style=color:#eceff4>></span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>read</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&mut</span><span> s</span><span style=color:#eceff4>),</span></span>
<span class=giallo-l><span style=color:#eceff4>    );</span></span></code></pre><p>debugã—ã¦ã¿ã‚‹ã¨ä»¥ä¸‹ã®å‡ºåŠ›ã‚’ãˆã¾ã™<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=plain><span class=giallo-l><span>â¯ c +nightly run</span></span>
<span class=giallo-l><span>   Compiling proconio-handson v0.1.0 (/Users/ymgyt/rs/proconio-handson)</span></span>
<span class=giallo-l><span>note: trace_macro</span></span>
<span class=giallo-l><span>   --> src/main.rs:366:5</span></span>
<span class=giallo-l><span>    |</span></span>
<span class=giallo-l><span>366 | /     input! {</span></span>
<span class=giallo-l><span>367 | |         from source,</span></span>
<span class=giallo-l><span>368 | |         t: (i8, String),</span></span>
<span class=giallo-l><span>369 | |     }</span></span>
<span class=giallo-l><span>    | |_____^</span></span>
<span class=giallo-l><span>    |</span></span>
<span class=giallo-l><span>    = note: expanding `input! { from source, t : (i8, String), }`</span></span>
<span class=giallo-l><span>    = note: to `let mut s = source ; input ! { @ from [& mut s] @ rest t : (i8, String), }`</span></span>
<span class=giallo-l><span>    = note: expanding `input! { @ from [& mut s] @ rest t : (i8, String), }`</span></span>
<span class=giallo-l><span>    = note: to `input ! { @ from [&mut s] @ mut [] @ rest t : (i8, String), }`</span></span>
<span class=giallo-l><span>    = note: expanding `input! { @ from [&mut s] @ mut [] @ rest t : (i8, String), }`</span></span>
<span class=giallo-l><span>    = note: to `input ! { @ from [&mut s] @ mut [] @ var t @ kind [] @ rest(i8, String), }`</span></span>
<span class=giallo-l><span>    = note: expanding `input! { @ from [&mut s] @ mut [] @ var t @ kind [] @ rest(i8, String), }`</span></span>
<span class=giallo-l><span>    = note: to `input ! (@ from [&mut s] @ mut [] @ var t @ kind [(i8, String)] @ rest,) ;`</span></span>
<span class=giallo-l><span>    = note: expanding `input! { @ from [&mut s] @ mut [] @ var t @ kind [(i8, String)] @ rest, }`</span></span>
<span class=giallo-l><span>    = note: to `input ! (@ from [&mut s] @ mut [] @ var t @ kind [(i8, String)] @ rest) ;</span></span>
<span class=giallo-l><span>            input ! (@ from [&mut s] @ rest) ;`</span></span>
<span class=giallo-l><span>    = note: expanding `input! { @ from [&mut s] @ mut [] @ var t @ kind [(i8, String)] @ rest }`</span></span>
<span class=giallo-l><span>    = note: to `let t = read_value ! (@ source [&mut s] @ kind [(i8, String)]) ;`</span></span>
<span class=giallo-l><span>    = note: expanding `read_value! { @ source [&mut s] @ kind [(i8, String)] }`</span></span>
<span class=giallo-l><span>    = note: to `read_value !</span></span>
<span class=giallo-l><span>            (@ tuple @ source [&mut s] @ kinds [] @ current [] @ rest i8, String)`</span></span>
<span class=giallo-l><span>    = note: expanding `read_value! { @ tuple @ source [&mut s] @ kinds [] @ current [] @ rest i8, String }`</span></span>
<span class=giallo-l><span>    = note: to `read_value !</span></span>
<span class=giallo-l><span>            (@ tuple @ source [&mut s] @ kinds [] @ current [i8] @ rest, String)`</span></span>
<span class=giallo-l><span>    = note: expanding `read_value! { @ tuple @ source [&mut s] @ kinds [] @ current [i8] @ rest, String }`</span></span>
<span class=giallo-l><span>    = note: to `read_value !</span></span>
<span class=giallo-l><span>            (@ tuple @ source [&mut s] @ kinds [[i8]] @ current [] @ rest String)`</span></span>
<span class=giallo-l><span>    = note: expanding `read_value! { @ tuple @ source [&mut s] @ kinds [[i8]] @ current [] @ rest String }`</span></span>
<span class=giallo-l><span>    = note: to `read_value !</span></span>
<span class=giallo-l><span>            (@ tuple @ source [&mut s] @ kinds [[i8]] @ current [String] @ rest)`</span></span>
<span class=giallo-l><span>    = note: expanding `read_value! { @ tuple @ source [&mut s] @ kinds [[i8]] @ current [String] @ rest }`</span></span>
<span class=giallo-l><span>    = note: to `read_value !</span></span>
<span class=giallo-l><span>            (@ tuple @ source [&mut s] @ kinds [[i8] [String]] @ current [] @ rest)`</span></span>
<span class=giallo-l><span>    = note: expanding `read_value! { @ tuple @ source [&mut s] @ kinds [[i8] [String]] @ current [] @ rest }`</span></span>
<span class=giallo-l><span>    = note: to `(read_value ! (@ source [&mut s] @ kind [i8]), read_value !</span></span>
<span class=giallo-l><span>             (@ source [&mut s] @ kind [String]),)`</span></span>
<span class=giallo-l><span>    = note: expanding `read_value! { @ source [&mut s] @ kind [i8] }`</span></span>
<span class=giallo-l><span>    = note: to `&lt; i8 as Readable > :: read(&mut s)`</span></span>
<span class=giallo-l><span>    = note: expanding `read_value! { @ source [&mut s] @ kind [String] }`</span></span>
<span class=giallo-l><span>    = note: to `&lt; String as Readable > :: read(&mut s)`</span></span>
<span class=giallo-l><span>    = note: expanding `input! { @ from [&mut s] @ rest }`</span></span>
<span class=giallo-l><span>    = note: to ``</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>    Finished dev [unoptimized + debuginfo] target(s) in 0.37s</span></span>
<span class=giallo-l><span>     Running `target/debug/proconio-handson`</span></span>
<span class=giallo-l><span>t: (10, "X")</span></span></code></pre><p><code>@current</code> ã‚’çµŒç”±ã—ã¦ã€ä¸€ã¤ã¥ã¤tupleã®å‹ã‚’å‡¦ç†ã—ã¦ã€ã™ã¹ã¦å‡¦ç†ã—ãŸã‚‰(<code>@current []</code>) tupleã®ç”Ÿæˆè¡¨ç¾ã«å¤‰æ›ã—ã¦ã„ã¾ã™ã€‚ 2d arrayã¨åŒæ§˜ã«ã€tupleã‚‚arrayã®è¦ç´ å‹ã«ã§ãã¾ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>fn</span><span style=color:#88c0d0> main</span><span style=color:#eceff4>() {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    let</span><span> source</span><span style=color:#81a1c1> =</span><span style=color:#8fbcbb> OnceSource</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>from</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>2 10 X 20 Y</span><span style=color:#eceff4>");</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>    trace_macros!</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>true</span><span style=color:#eceff4>);</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>    input!</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span>        from source</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>        n</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> usize</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>        ts</span><span style=color:#81a1c1>:</span><span style=color:#eceff4> [(</span><span style=color:#8fbcbb>i8</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> String</span><span style=color:#eceff4>);</span><span> n</span><span style=color:#eceff4>],</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>    trace_macros!</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>false</span><span style=color:#eceff4>);</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>    assert_eq!</span><span style=color:#eceff4>(</span><span>ts</span><span style=color:#eceff4>,</span><span style=color:#88c0d0;font-weight:700> vec!</span><span style=color:#eceff4>[</span></span>
<span class=giallo-l><span style=color:#eceff4>        (</span><span style=color:#b48ead>10</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> String</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>from</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>X</span><span style=color:#eceff4>")),</span></span>
<span class=giallo-l><span style=color:#eceff4>        (</span><span style=color:#b48ead>20</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> String</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>from</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>Y</span><span style=color:#eceff4>")),</span></span>
<span class=giallo-l><span style=color:#eceff4>    ]);</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>    println!</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>ts: </span><span style=color:#ebcb8b>{</span><span style=color:#a3be8c>:?</span><span style=color:#ebcb8b>}</span><span style=color:#eceff4>",</span><span> ts</span><span style=color:#eceff4>);</span></span>
<span class=giallo-l><span style=color:#616e88>    // ts: [(10, "X"), (20, "Y")]</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><h3 id=fu-shu-hui-yobidasi><a aria-label="Anchor link for: fu-shu-hui-yobidasi" class=zola-anchor href=#fu-shu-hui-yobidasi>è¤‡æ•°å›ã‚ˆã³ã ã—</a></h3><p><code>OnceSource</code>ã®ã¨ã“ã‚ã§ã¿ãŸã‚ˆã†ã«<code>input!</code>ã¯æœ€åˆã®å‘¼ã³å‡ºã—ã§ã€å…¥åŠ›ã‚’ã™ã¹ã¦ãƒ¡ãƒ¢ãƒªã«èª­ã¿è¾¼ã‚“ã§<code>lazy_static</code>çµŒç”±ã§globalã«ä¿æŒã™ã‚‹ã®ã§2å›ç›®ä»¥é™ã®å‘¼ã³å‡ºã—ã§ã‚‚å‰å›å‘¼ã³å‡ºã—ã®çŠ¶æ…‹ã‹ã‚‰èª­ã¿è¾¼ã‚€ã“ã¨ãŒã§ãã¾ã™ã€‚ãã®ãŸã‚ã€å…¥åŠ›ã®æ§‹é€ ã«ã‚ã‚ã›ã¦é©å®œloopã®ä¸­ã§ã‚‚ã‚ˆã¹ã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚<h2 id=matome><a aria-label="Anchor link for: matome" class=zola-anchor href=#matome>ã¾ã¨ã‚</a></h2><p><code>proconio::input!</code> macroãŒã©ã†ã‚„ã£ã¦å…¥åŠ›ã‚’èª­ã¿è¾¼ã‚€å‡¦ç†ã‚’å®Ÿç¾ã—ã¦ã„ã‚‹ã®ã‹ã‚’ã¿ã¦ãã¾ã—ãŸã€‚<br> <code>input!</code>ã¨æ›¸ã„ãŸã¨ãã®ãƒ¢ãƒ¤ãƒ¢ãƒ¤ãŒã™ã“ã—ã§ã‚‚è»½æ¸›ã•ã‚Œã‚Œã°ã†ã‚Œã—ã„ã§ã™ã€‚<br> ã‚·ãƒ³ãƒ—ãƒ«ãªarmã‚’çµ„ã¿åˆã‚ã›ã¦ã€ä»»æ„ãªå‹ã®èª­ã¿è¾¼ã¿å‡¦ç†ã‚’è¡Œã†ã‚³ãƒ¼ãƒ‰ãŒç”Ÿæˆã•ã‚Œã¦ãŠã‚Šã€ã¨ã¦ã‚‚ã™ã”ã„ã¨æ€ã„ã¾ã—ãŸã€‚ ä»Šå›ã¯è§¦ã‚Œã‚‰ã‚Œã¾ã›ã‚“ã§ã—ãŸãŒã€Userå®šç¾©å‹ã«è‡ªå‹•ã§ã€<code>Readable</code>ã®å®Ÿè£…ã‚’ç”Ÿæˆã™ã‚‹<code>#[derive_readable]</code>ã«ã¤ã„ã¦ã‚‚ãã®ã†ã¡è¿½ã£ã¦ã¿ã‚ˆã†ã¨æ€ã£ã¦ã„ã¾ã™ã€‚ ã“ã†ã„ã£ãŸç’°å¢ƒã‚’æ•´å‚™ã—ã¦ãã ã•ã£ã¦ã„ã‚‹æœ‰å¿—ã®çš†æ§˜ã«ã¯ã„ã¤ã‚‚å¤§å¤‰æ„Ÿè¬ã—ã¦ãŠã‚Šã¾ã™ã€‚ (<code>proconio</code>ä»¥å¤–ã«ã‚‚ã„ã‚ã„ã‚ãªã‚³ãƒ¼ãƒ‰ãŒatcoderä¸Šã§ä½¿ãˆã¾ã™ ) [https://github.com/rust-lang-ja/atcoder-rust-resources/wiki/2020-Update:embed:cite]<h2 id=can-kao-dokiyumento><a aria-label="Anchor link for: can-kao-dokiyumento" class=zola-anchor href=#can-kao-dokiyumento>å‚è€ƒãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ</a></h2><ul><li><a href=https://danielkeep.github.io/tlborm/book/index.html rel=external>The Little Book of Rust Macros </a></ul></div></article></main><footer class=blog-footer><p>Â© 2026 <a href=https://blog.ymgyt.io> ymgyt </a> | Made with <a href=https://www.getzola.org rel=noopener target=_blank>Zola</a> | <a href=https://github.com/ymgyt/blog>Repository</a> | <a href=https://blog.ymgyt.io/atom.xml target=_blank title=rss> <svg viewbox="0 0 24 24" class=icon fill=none height=24 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx=5 cy=19 r=1></circle></svg> </a></footer></div></div>