<!doctype html><html lang=ja><head><meta charset=UTF-8><meta content="width=device-width,initial-scale=1" name=viewport><link href=https://blog.ymgyt.io/favicon.ico rel=icon sizes=any><link href=https://blog.ymgyt.io/icon.svg rel=icon type=image/svg+xml><link href=https://blog.ymgyt.io/apple-touch-icon.png rel=apple-touch-icon><link href=https://blog.ymgyt.io/manifest.webmanifest rel=manifest><link href=https://blog.ymgyt.io/style.css rel=stylesheet><link href=https://blog.ymgyt.io/atom.xml rel=alternate title=Atom type=application/atom+xml><script src="https://www.googletagmanager.com/gtag/js?id=G-GTB0KMLN90" async></script><script>window.dataLayer = window.dataLayer || [];
	function gtag() {dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-GTB0KMLN90');</script><title> âœï¸ HelixãŒfileã‚’renderingã™ã‚‹ä»•çµ„ã¿ã‚’ç†è§£ã™ã‚‹ | Happy developing</title><meta content="helix source code readingã®ç¬¬ä¸€å¼¾ã€‚ã¾ãšã¯renderingã®æµã‚Œã‚’ç¢ºèªã—ã¾ã™ã€‚" name=description><meta content=summary name=twitter:card><meta content="@YAmaguchixt " name=twitter:site><meta content=" âœï¸ HelixãŒfileã‚’renderingã™ã‚‹ä»•çµ„ã¿ã‚’ç†è§£ã™ã‚‹" name=twitter:title><meta content="helix source code readingã®ç¬¬ä¸€å¼¾ã€‚ã¾ãšã¯renderingã®æµã‚Œã‚’ç¢ºèªã—ã¾ã™ã€‚" name=twitter:description><meta content=https://blog.ymgyt.io/images/emoji/pencil2.png name=twitter:image><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><body><div class=world><div class=content-container><header class=blog-header-container><div class=blog-logo><a href=https://blog.ymgyt.io>Happy developing</a></div><div class=blog-nav><nav><ul><li><a href=https://blog.ymgyt.io/entry/>Entries</a><li><a href=https://blog.ymgyt.io/tags/>Tags</a><li><a href=https://blog.ymgyt.io/about/>About</a><li><a href=https://github.com/ymgyt> <img alt=Github class=icon src=https://blog.ymgyt.io/images/icon/github.svg> </a><li><a href="https://twitter.com/YAmaguchixt "> <img alt=Twitter class=icon src=https://blog.ymgyt.io/images/icon/twitter.svg> </a></ul></nav></div></header><main class=blog-main><article><header class=entry-header><h1 class=entry-title>âœï¸ HelixãŒfileã‚’renderingã™ã‚‹ä»•çµ„ã¿ã‚’ç†è§£ã™ã‚‹</h1><div class=entry-meta><p class=entry-meta-item>ğŸ—“ 2023-04-30<p class=entry-meta-item>ğŸ· <span class=tag><a href=https://blog.ymgyt.io/tags/rust/>rust</a></span></div></header><aside class=entry-toc><nav><ul class=entry-toc-toplevel-list><li><a href=https://blog.ymgyt.io/entry/how-helix-render-file/#ben-ji-shi-nogoru>æœ¬è¨˜äº‹ã®ã‚´ãƒ¼ãƒ«</a><li><a href=https://blog.ymgyt.io/entry/how-helix-render-file/#helixnoinstall>Helixã®install</a><li><a href=https://blog.ymgyt.io/entry/how-helix-render-file/#clinoque-ren>CLIã®ç¢ºèª</a><li><a href=https://blog.ymgyt.io/entry/how-helix-render-file/#applicationnoqi-dong-karazhong-liao-madenogai-yao>Applicationã®èµ·å‹•ã‹ã‚‰çµ‚äº†ã¾ã§ã®æ¦‚è¦</a> <ul><li><a href=https://blog.ymgyt.io/entry/how-helix-render-file/#chu-qi-hua-chu-li>åˆæœŸåŒ–å‡¦ç†</a><li><a href=https://blog.ymgyt.io/entry/how-helix-render-file/#application-new>Application::new()</a><li><a href=https://blog.ymgyt.io/entry/how-helix-render-file/#application-run>Application::run()</a><li><a href=https://blog.ymgyt.io/entry/how-helix-render-file/#kokomadenohua-wocodede>ã“ã“ã¾ã§ã®è©±ã‚’codeã§</a></ul><li><a href=https://blog.ymgyt.io/entry/how-helix-render-file/#application-render>Application::render()</a><li><a href=https://blog.ymgyt.io/entry/how-helix-render-file/#compositor-render>Compositor::render()</a><li><a href=https://blog.ymgyt.io/entry/how-helix-render-file/#compositornosheng-cheng>Compositorã®ç”Ÿæˆ</a><li><a href=https://blog.ymgyt.io/entry/how-helix-render-file/#editorview-render>EditorView::render()</a><li><a href=https://blog.ymgyt.io/entry/how-helix-render-file/#documenttoviewnosheng-cheng-chu-li>Documentã¨Viewã®ç”Ÿæˆå‡¦ç†</a><li><a href=https://blog.ymgyt.io/entry/how-helix-render-file/#editor-open>Editor::open()</a> <ul><li><a href=https://blog.ymgyt.io/entry/how-helix-render-file/#document-open>Document::open()</a><li><a href=https://blog.ymgyt.io/entry/how-helix-render-file/#editor-new-document>Editor::new_document()</a><li><a href=https://blog.ymgyt.io/entry/how-helix-render-file/#editor-switch>Editor::switch()</a></ul><li><a href=https://blog.ymgyt.io/entry/how-helix-render-file/#editorview-reder-view>EditorView::reder_view()</a> <ul><li><a href=https://blog.ymgyt.io/entry/how-helix-render-file/#reder-document>reder_document()</a><li><a href=https://blog.ymgyt.io/entry/how-helix-render-file/#render-text>render_text()</a><li><a href=https://blog.ymgyt.io/entry/how-helix-render-file/#grapheme-toha>Grapheme ã¨ã¯</a><li><a href=https://blog.ymgyt.io/entry/how-helix-render-file/#textrenderer-draw-grapheme>TextRenderer::draw_grapheme()</a></ul><li><a href=https://blog.ymgyt.io/entry/how-helix-render-file/#terminalbackendtobuffer>TerminalBackendã¨Buffer</a><li><a href=https://blog.ymgyt.io/entry/how-helix-render-file/#terminal-draw>Terminal::draw()</a> <ul><li><a href=https://blog.ymgyt.io/entry/how-helix-render-file/#terminal-flush>Terminal::flush()</a><li><a href=https://blog.ymgyt.io/entry/how-helix-render-file/#buffer-diff>Buffer::diff()</a><li><a href=https://blog.ymgyt.io/entry/how-helix-render-file/#crosstermbackend-draw>CrosstermBackend::draw()</a></ul><li><a href=https://blog.ymgyt.io/entry/how-helix-render-file/#matome>ã¾ã¨ã‚</a></ul></nav></aside><div class=entry-content><p>æœ¬è¨˜äº‹ã§ã¯Rustè£½Editor, <a href=https://github.com/helix-editor/helix rel=external>helix</a>ã«ãŠã„ã¦ã€fileã®ä¸­èº«ãŒã©ã®ã‚ˆã†ã«renderingã•ã‚Œã‚‹ã‹ã‚’ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‹ã‚‰ç†è§£ã™ã‚‹ã“ã¨ã‚’ç›®æŒ‡ã—ã¾ã™ã€‚<br> å…·ä½“çš„ã«ã¯ã€<code>hx ./Cargo.toml</code>ã®ã‚ˆã†ã«ã—ã¦ã€renderingã—ãŸã„file pathã‚’å¼•æ•°ã«ã—ã¦helixã‚’å®Ÿè¡Œã—ãŸå ´åˆã‚’æƒ³å®šã—ã¦ã„ã¾ã™ã€‚<br> ä»Šå¾Œã¯keyboardã‹ã‚‰ã®å…¥åŠ›ã‚’ã©ã®ã‚ˆã†ã«å‡¦ç†ã—ã¦ã„ã‚‹ã‹ã®event handlingç·¨, LSPã¨ã©ã®ã‚ˆã†ã«è©±ã—ã¦ã„ã‚‹ã‹ã®LSPç·¨, å„ç¨®è¨­å®šfileã‚„åˆæœŸåŒ–å‡¦ç†ã®èµ·å‹•ç·¨ç­‰ã‚’äºˆå®šã—ã¦ã„ã¾ã™ã€‚<p>versionã¯ç¾æ™‚ç‚¹ã§ã®master branchã®æœ€æ–°<a href=https://github.com/helix-editor/helix/tree/0097e191bb9f9f144043c2afcf04bc8632021281 rel=external>0097e19</a>ã‚’å¯¾è±¡ã«ã—ã¦ã„ã¾ã™ã€‚ç›´è¿‘ã®releaseã¯<a href=https://github.com/helix-editor/helix/releases/tag/23.03 rel=external><code>23.03</code></a>ã§ã™ã€‚<h2 id=ben-ji-shi-nogoru><a aria-label="Anchor link for: ben-ji-shi-nogoru" class=zola-anchor href=#ben-ji-shi-nogoru>æœ¬è¨˜äº‹ã®ã‚´ãƒ¼ãƒ«</a></h2><p>æœ¬è¨˜äº‹ã§ã¯ä»¥ä¸‹ã®ç‚¹ã‚’ç›®æŒ‡ã—ã¾ã™ã€‚<ul><li>helixã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã«ç¾ã‚Œã‚‹å„ç¨®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®æ¦‚è¦ã‚„è²¬å‹™ã®ç†è§£ <ul><li><code>Application</code>, <code>Editor</code>, <code>View</code>, <code>Document</code>, <code>Compositor</code>, <code>TerminalBackend</code> ç­‰ã€…..<li>renderingå‡¦ç†ä»¥å¤–ã§ã‚‚å¿…ãšç™»å ´ã™ã‚‹å‹é”ãªã®ã§ã€ä»–ã®å‡¦ç†ã‚’èª­ã‚€éš›ã«ã‚‚ç†è§£ãŒå½¹ç«‹ã¡ã¾ã™</ul><li>å¼•æ•°ã§æ¸¡ã—ãŸfileã®ä¸­èº«ãŒæœ€çµ‚çš„ã«ã©ã®ã‚ˆã†ã«terminalã«renderingã•ã‚Œã‚‹ã‹ã®å‡¦ç†ã®æµã‚Œ</ul><p>æœ¬è¨˜äº‹ã§æ‰±ã‚ãªã„ã“ã¨ã€‚<ul><li>èµ·å‹•æ™‚ã®åˆæœŸåŒ–å‡¦ç† <ul><li>å„ç¨®è¨­å®šã¯ãªã‚“ã‚‰ã‹ã®æ–¹æ³•ã§æ¸¡ã•ã‚Œã¦ã„ã‚‹å‰æ</ul><li>Fileã®ç·¨é›† <ul><li>Fileã‚’é–‹ã„ã¦è¡¨ç¤ºã™ã‚‹ã¾ã§ãŒã‚¹ã‚³ãƒ¼ãƒ—ã§ã™</ul><li>Inline text(<code>TextAnnotations</code>) <ul><li>LSPã®å‹ãƒ’ãƒ³ãƒˆã®ã‚ˆã†ã«è¡¨ç¤ºã¯ã•ã‚Œã¦ã„ã‚‹ãŒã€æ“ä½œã®å¯¾è±¡ã«ã¯ãªã‚‰ãªã„text<li>ã“ã®å‡¦ç†ã‚’çœãã“ã¨ã§èª¬æ˜ãŒå¤§å¹…ã«ã‚·ãƒ³ãƒ—ãƒ«ã«ãªã‚Šã¾ã™</ul></ul><h2 id=helixnoinstall><a aria-label="Anchor link for: helixnoinstall" class=zola-anchor href=#helixnoinstall>Helixã®install</a></h2><p>ã‚‚ã—ã‚‚ã¾ã helixã‚’installã•ã‚Œã¦ã„ãªã„å ´åˆã¯ã€<a href=https://docs.helix-editor.com/install.html rel=external>å…¬å¼doc</a>ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚<br> å…¬å¼docã¯æœ€æ–°releaseç‰ˆã¨ã¯åˆ¥ã«<a href=https://docs.helix-editor.com/master/ rel=external>masterç‰ˆ</a>ã‚‚ã‚ã‚Šã¾ã™ã€‚sourceã‹ã‚‰buildã•ã‚ŒãŸéš›ã¯masterç‰ˆã‚’ã¿ã‚‹ã¨ã„ã„ã¨æ€ã„ã¾ã™ã€‚<p>sourceã‹ã‚‰buildã™ã‚‹æ–¹æ³•ã¯ç°¡å˜ã§ä»¥ä¸‹ã®ã‚ˆã†ã«è¡Œã„ã¾ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=shellscript><span class=giallo-l><span style=color:#88c0d0>git</span><span style=color:#a3be8c> clone https://github.com/helix-editor/helix</span></span>
<span class=giallo-l><span style=color:#88c0d0>cd</span><span style=color:#a3be8c> helix</span></span>
<span class=giallo-l><span style=color:#88c0d0>cargo</span><span style=color:#a3be8c> install --path helix-term --locked</span></span></code></pre><p><code>--locked</code>ã¯ã¤ã‘ã¦å¤§ä¸ˆå¤«ã§ã™ã€‚<br> maintenerã®ä¸€äººã§ã‚ã‚‹pascalå…ˆç”ŸãŒcargo updateã®å¤‰æ›´commitã‚’<a href=https://github.com/helix-editor/helix/pull/6808 rel=external>ä¸€ã¤ä¸€ã¤review</a>ã—ãŸã‚Šã—ã¦ã„ã¾ã—ãŸã€‚<p>Editorã¨ã—ã¦ãƒ•ãƒ«ã«æ´»ç”¨ã™ã‚‹ã«ã¯ã“ã®å¾Œã«runtime directoryã‚’ä½œæˆã—ãŸã‚Šã€åˆ©ç”¨è¨€èªã®lsp server(<code>rust-analyzer</code>ç­‰)ã‚’è¨­å®šã—ãŸã‚Šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ãŒã€ä»Šå›ã¯ãã‚Œã‚‰ã®æ©Ÿèƒ½ã‚’åˆ©ç”¨ã—ãªã„ã®ã§ã€ç‰¹ã«å¿…è¦ã‚ã‚Šã¾ã›ã‚“ã€‚<h2 id=clinoque-ren><a aria-label="Anchor link for: clinoque-ren" class=zola-anchor href=#clinoque-ren>CLIã®ç¢ºèª</a></h2><p>æ¬¡ã«helixã®binary, <code>hx</code>ã®ä½¿ã„æ–¹ã«ã¤ã„ã¦ç°¡å˜ã«ãŠã•ã‚‰ã„ã—ã¾ã™ã€‚<br> åŸºæœ¬çš„ã«ã¯é–‹ããŸã„fileã‚’å¼•æ•°ã«ã—ã¦å®Ÿè¡Œã™ã‚‹ã ã‘ã§ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=shellscript><span class=giallo-l><span style=color:#88c0d0>hx</span><span style=color:#a3be8c> ./Cargo.toml</span></span></code></pre><p>ã“ã®éš›<code>-v</code>ã‚’ã¤ã‘ã‚‹ã¨loggingã®levelãŒå¤‰ã‚ã‚Š<code>--log</code>ã§log fileã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯<code>~/.cache/helix/helix.log</code>ã§ã™ã€‚ ã¾ãŸã€fileã‚’é–‹ãéš›ã«è¡Œæ•°ã¨åˆ—æ•°ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=shellscript><span class=giallo-l><span style=color:#88c0d0>hx</span><span style=color:#a3be8c> ./Cargo.toml:3:5</span></span></code></pre><p>ã“ã®ã‚ˆã†ã«å®Ÿè¡Œã™ã‚‹ã¨3è¡Œç›®ã®5æ–‡å­—ç›®ãŒãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã•ã‚ŒãŸçŠ¶æ…‹ã§fileã‚’é–‹ã‘ã¾ã™ã€‚<br> ã¾ãŸã€è¤‡æ•°fileã‚’windowã®åˆ†å‰²æ–¹æ³•ã‚’æŒ‡å®šã—ã¦é–‹ãã“ã¨ã‚‚ã§ãã¾ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=shellscript><span class=giallo-l><span style=color:#88c0d0>hx</span><span style=color:#a3be8c> README.md Cargo.toml --vsplit</span></span></code></pre><p>ãã®ä»–ã«ã‚‚<code>--tutor</code>ã§tutorialã§ã‚ã£ãŸã‚Šã€<code>--health</code>ã§è¨€èªæ¯ã®syntax highlightã‚„lspã®è¨­å®šçŠ¶æ³ã‚’ç¢ºèªã§ããŸã‚Šã—ã¾ã™ãŒã€ä»Šå›ã¯è§¦ã‚Œã¾ã›ã‚“ã€‚<h2 id=applicationnoqi-dong-karazhong-liao-madenogai-yao><a aria-label="Anchor link for: applicationnoqi-dong-karazhong-liao-madenogai-yao" class=zola-anchor href=#applicationnoqi-dong-karazhong-liao-madenogai-yao>Applicationã®èµ·å‹•ã‹ã‚‰çµ‚äº†ã¾ã§ã®æ¦‚è¦</a></h2><p>Helixã‚‚installã—ã¦èµ·å‹•æ–¹æ³•ã‚‚ç¢ºèªã—ãŸã®ã§ã€æ—©é€Ÿ<code>main.rs</code>ã‹ã‚‰èª­ã‚“ã§ã„ããŸã„ã¨ã“ã‚ã§ã™ãŒã€ã¾ãšhelixã¨ã„ã†applicationã®èµ·å‹•ã‹ã‚‰çµ‚äº†ã¾ã§ã®æ¦‚è¦ã‚’èª¬æ˜ã•ã›ã¦ãã ã•ã„ã€‚<br> Applicationã®lifecycleã¯å¤§ããä»¥ä¸‹ã®3ã¤ã«åˆ†ã‘ã‚‰ã‚Œã¾ã™ã€‚<ol><li>åˆæœŸåŒ–å‡¦ç†<li><code>Application::new()</code><li><code>Application::run()</code></ol><h3 id=chu-qi-hua-chu-li><a aria-label="Anchor link for: chu-qi-hua-chu-li" class=zola-anchor href=#chu-qi-hua-chu-li>åˆæœŸåŒ–å‡¦ç†</a></h3><p>åˆæœŸåŒ–å‡¦ç†ã§ã¯ã€å¼•æ•°ã®å‡¦ç†ã‚„è¨­å®šfileã®parseã€loggingã®setupç­‰ã‚’è¡Œã„ã¾ã™ã€‚<br> <code>Application::new()</code>ã«å¿…è¦ãªå¼•æ•°ã®æº–å‚™ãŒä¸»ãªå‡¦ç†ã§ã™ã€‚<h3 id=application-new><a aria-label="Anchor link for: application-new" class=zola-anchor href=#application-new><code>Application::new()</code></a></h3><p><code>Application</code>ã¯å‡¦ç†ã®top levelã®å‹ã§fieldã«editorã«å¿…è¦ãªå„ç¨®componentã‚’ä¿æŒã—ã¦ã„ã¾ã™ã€‚<br> å‹ã¨ã—ã¦ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«å®šç¾©ã•ã‚Œã¦ã„ã¾ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>pub struct</span><span style=color:#8fbcbb> Application</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span>    compositor</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Compositor</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>    terminal</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Terminal</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#81a1c1>    pub</span><span> editor</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Editor</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>    config</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Arc</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>ArcSwap</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Config</span><span style=color:#eceff4>>>,</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#5e81ac>    #[allow(dead_code)]</span></span>
<span class=giallo-l><span>    theme_loader</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Arc</span><span style=color:#eceff4>&lt;</span><span>theme</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Loader</span><span style=color:#eceff4>>,</span></span>
<span class=giallo-l><span style=color:#5e81ac>    #[allow(dead_code)]</span></span>
<span class=giallo-l><span>    syn_loader</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Arc</span><span style=color:#eceff4>&lt;</span><span>syntax</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Loader</span><span style=color:#eceff4>>,</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>    signals</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Signals</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>    jobs</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Jobs</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>    lsp_progress</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> LspProgressMap</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>    last_render</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Instant</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p><a href=https://github.com/helix-editor/helix/blob/0097e191bb9f9f144043c2afcf04bc8632021281/helix-term/src/application.rs#L63 rel=external>https://github.com/helix-editor/helix/blob/0097e191bb9f9f144043c2afcf04bc8632021281/helix-term/src/application.rs#L63</a><p>ã“ã‚Œã‚‰ã®fieldã¯å‡¦ç†ã‚’è¿½ã£ã¦ã„ãä¸­ã§å½¹å‰²ãŒã‚ã‹ã£ã¦ãã‚‹ã®ã§ä»Šã¯ç‰¹ã«ç†è§£ã—ã¦ãŠãå¿…è¦ã¯ãªã„ã§ã™ã€‚<br> rederingã‚’è¿½ã£ã¦ã„ãæœ¬è¨˜äº‹ã¨ã®é–¢ä¿‚ã§ã¯<code>Compositor</code>, <code>Terminal</code>, <code>Editor</code>ãŒé–¢ã‚ã£ã¦ãã¾ã™ã€‚<br> <code>arc_swap::ArcSwap</code>ã¯helixå¤–ã®å‹ãªã®ã§ã™ãŒã€å‡¦ç†ã‚’ç†è§£ã™ã‚‹ã«ã¯ã‚ã‹ã£ã¦ã„ã‚‹ã“ã¨ãŒæœ›ã¾ã—ã„ã§ã™ã€‚<br> helixå¤–ã®é‡è¦ãªcrateã«ã¤ã„ã¦ã¯åˆ¥è¨˜äº‹ã§ã¾ã¨ã‚ã¦æ‰±ã†äºˆå®šã§ã™ã€‚<p>ä¸€å¿œå„fieldã®æ¦‚è¦ã‚’èª¬æ˜ã—ã¦ãŠãã¨<ul><li><code>compositor: Compositor</code>: rederingã‚’æ‹…ã†å„ç¨®Componentã‚’ç®¡ç†ã—ã¦ã„ã‚‹<li><code>terminal: Terminal</code>: å®Ÿéš›ã«terminalã¸ã®å‡ºåŠ›ã‚„åˆ¶å¾¡ã‚’æ‹…ã†<li><code>editor: Editor</code>: Fileã‚„Viewã®ç®¡ç†ã‚„å±¥æ­´ç­‰ã®çŠ¶æ…‹ã‚’ä¿æŒ<li><code>config: Arc&lt;ArcSwap&lt;Config>></code>: å„ç¨®è¨­å®šã¸ã®accessã‚’æä¾›<li><code>theme_loader: Arc&lt;theme::Loader></code>: Themeã¸ã®accessã‚’æä¾›<li><code>syn_loader: Arc&lt;syntax::Loader></code>: syntaxè¨­å®šã¸ã®accessã‚’æä¾›<li><code>signals: Signals</code>: signal handling<li><code>jobs: Jobs</code>: éåŒæœŸã®taskã‚’ç®¡ç†<li><code>lsp_pregress: LspProgressMap</code>: LSPé–¢é€£ã®çŠ¶æ…‹ã‚’ä¿æŒ<li><code>last_render: Instant</code>: renderé–¢é€£ã®çŠ¶æ…‹</ul><p><code>Application::new()</code>ã®è©³ç´°ã«ã¤ã„ã¦ã¯å®Ÿéš›ã®å‡¦ç†ã§ã©ã®ã‚ˆã†ã«åˆ©ç”¨ã•ã‚Œã‚‹ã‹ã‚’è¦‹ã¦ã‹ã‚‰ãã‚Œã‚‰ãŒã©ã†ç”Ÿæˆã•ã‚ŒãŸã‹ã‚’ç¢ºèªã—ãŸã»ã†ãŒã‚ã‹ã‚Šã‚„ã™ã„ã¨æ€ã£ãŸã®ã§å¾Œã»ã©æˆ»ã£ã¦ãã¾ã™ã€‚<h3 id=application-run><a aria-label="Anchor link for: application-run" class=zola-anchor href=#application-run><code>Application::run()</code></a></h3><p><code>Appliation</code>ãŒç”Ÿæˆã§ãã‚‹ã¨ã€<code>Application::run()</code>ãŒå‘¼ã°ã‚Œã¾ã™ã€‚<br> ã“ã®å‡¦ç†ãŒå®Ÿè³ªçš„ãªå‡¦ç†ã®é–‹å§‹ã§ã€userã®å…¥åŠ›ã‚’å‡¦ç†ã—ã¦çµæœã‚’renderingã™ã‚‹event loopã«å…¥ã‚Šã¾ã™ã€‚<br> ã“ã“ã§terminalã‚’åˆæœŸåŒ–ã—ã¦ã€panic hookã‚’è¨­å®šã—ãŸã‚Šã™ã‚‹ã®ã§ã€terminalã®åˆ¶å¾¡ãŒhelixã«ç§»ã‚Šã¾ã™ã€‚<br> ã“ã®event_loopã®ä¸­ã§ä»Šå›è¿½ã£ã¦ã„ã, <code>Application::render()</code>ãŒç™»å ´ã—ã¾ã™ã€‚<h3 id=kokomadenohua-wocodede><a aria-label="Anchor link for: kokomadenohua-wocodede" class=zola-anchor href=#kokomadenohua-wocodede>ã“ã“ã¾ã§ã®è©±ã‚’codeã§</a></h3><p>ä»¥ä¸Šã‚’å¿µé ­ã«ã€å®Ÿéš›ã®codeã‚’æ²è¼‰ã—ã¾ã™ã€‚ãƒ¡ãƒ³ã‚¿ãƒ«ãƒ¢ãƒ‡ãƒ«ã‚’å…±æœ‰ã§ãã‚Œã°ã„ã„ã®ã§ã‚‚ã‚ã‚‚ã‚å‰²æ„›ã—ã¦è¼‰ã›ã¦ã„ã¾ã™ã€‚<br> Helixã§ã¯<a href=https://github.com/helix-editor/helix/issues/39 rel=external>GUIã‚‚æ¤œè¨</a>ã•ã‚Œã¦ã„ã¾ã™ãŒã€ç¾çŠ¶ã¯terminal editorãªã®ã§mainã¯<code>helix-term/src/main.rs</code>ã«ã‚ã‚Šã¾ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>fn</span><span style=color:#88c0d0> main</span><span style=color:#eceff4>()</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> Result</span><span style=color:#eceff4>&lt;()> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    let</span><span> exit_code</span><span style=color:#81a1c1> =</span><span style=color:#88c0d0> main_impl</span><span style=color:#eceff4>()</span><span style=color:#81a1c1>?</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span>    std</span><span style=color:#81a1c1>::</span><span>process</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>exit</span><span style=color:#eceff4>(</span><span>exit_code</span><span style=color:#eceff4>);</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p><a href=https://github.com/helix-editor/helix/blob/0097e191bb9f9f144043c2afcf04bc8632021281/helix-term/src/main.rs#L37 rel=external>https://github.com/helix-editor/helix/blob/0097e191bb9f9f144043c2afcf04bc8632021281/helix-term/src/main.rs#L37</a><p>mainã¯exit codeã®å‡¦ç†ã®ã¿è¡Œã„ã¾ã™ã€‚ ä»¥ä¸‹ãŒå®Ÿè³ªçš„ãªmainå‡¦ç†ã§ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>use</span><span> anyhow</span><span style=color:#81a1c1>::</span><span style=color:#eceff4>{</span><span style=color:#8fbcbb>Context</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> Error</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> Result</span><span style=color:#eceff4>};</span></span>
<span class=giallo-l><span style=color:#81a1c1>use</span><span> crossterm</span><span style=color:#81a1c1>::</span><span>event</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>EventStream</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#5e81ac>#[tokio::main]</span></span>
<span class=giallo-l><span style=color:#81a1c1>async fn</span><span style=color:#88c0d0> main_impl</span><span style=color:#eceff4>()</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> Result</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>i32</span><span style=color:#eceff4>> {</span></span>
<span class=giallo-l><span style=color:#616e88>    // ...</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>    let</span><span> args</span><span style=color:#81a1c1> =</span><span style=color:#8fbcbb> Args</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>parse_args</span><span style=color:#eceff4>()</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>context</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>could not parse arguments</span><span style=color:#eceff4>")</span><span style=color:#81a1c1>?</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>    let</span><span> config</span><span style=color:#81a1c1> =</span><span style=color:#eceff4> {</span><span style=color:#616e88> /* load config ... */</span><span style=color:#eceff4> }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>    let</span><span> syn_loader_conf</span><span style=color:#81a1c1> =</span><span style=color:#eceff4> {</span><span style=color:#616e88> /* init syntax loader */</span><span style=color:#eceff4> }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>    let mut</span><span> app</span><span style=color:#81a1c1> =</span><span style=color:#8fbcbb> Application</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>new</span><span style=color:#eceff4>(</span><span>args</span><span style=color:#eceff4>,</span><span> config</span><span style=color:#eceff4>,</span><span> syn_loader_conf</span><span style=color:#eceff4>)</span></span>
<span class=giallo-l><span style=color:#81a1c1>        .</span><span style=color:#88c0d0>context</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>unable to create new application</span><span style=color:#eceff4>")</span><span style=color:#81a1c1>?</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>    let</span><span> exit_code</span><span style=color:#81a1c1> =</span><span> app</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>run</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&mut</span><span> EventStream</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>new</span><span style=color:#eceff4>())</span><span style=color:#81a1c1>.await?</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#8fbcbb>    Ok</span><span style=color:#eceff4>(</span><span>exit_code</span><span style=color:#eceff4>)</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p><a href=https://github.com/helix-editor/helix/blob/0097e191bb9f9f144043c2afcf04bc8632021281/helix-term/src/main.rs#L43 rel=external>https://github.com/helix-editor/helix/blob/0097e191bb9f9f144043c2afcf04bc8632021281/helix-term/src/main.rs#L43</a><p>ã‚‚ã‚ã‚‚ã‚çœç•¥ã™ã‚‹ã¨ã“ã‚Œã¾ã§è¦‹ã¦ããŸã¨ãŠã‚Šã€mainã§ã¯<code>Application::new()</code>ã‚’å®Ÿè¡Œã—ãŸã®ã¡ã€<code>Application::run()</code>ã‚’å‘¼ã‚“ã§ã€æˆ»ã‚Šå€¤ã‚’exit codeã¨ã—ã¦è¿”ã—ã¦ã„ã¾ã™ã€‚<br> helixã§ã¯Errorã®è¡¨ç¾ã¨ã—ã¦ã€<code>anyhow</code>ã‚’åˆ©ç”¨ã—ã¦ãŠã‚Šã€Errorã‚’å‘¼ã³å‡ºã—å´ã§handlingã—ãŸã„å ´åˆã®ã¿å°‚ç”¨ã®å‹ã‚’å®šç¾©ã—ã¦ã„ã¾ã™ã€‚<br> ã¾ãŸæœ¬è¨˜äº‹ã§ã¯userã‹ã‚‰ã®keyboardå…¥åŠ›ç­‰ã®event handlingã‚’æ‰±ã‚ãªã„ã®ã§è©³ã—ãã¯ãµã‚Œã¾ã›ã‚“ãŒã€<code>crossterm::event::EventStream</code>ãŒuserã‹ã‚‰ã®å…¥åŠ›ã‚’è¡¨ã—ã¦ã„ã¾ã™ã€‚<br> ã¡ãªã¿ã«ã§ã™ãŒã€<code>main()</code>ä»¥å¤–ã«<code>#[tokio::main]</code> annotationã‚’ä½¿ã£ã¦ã„ã‚‹ä¾‹ã‚’åˆã‚ã¦è¦‹ã¾ã—ãŸã€‚<p>æ¬¡ã«<code>Application::run()</code>ã§ã™ãŒä»¥ä¸‹ã®ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>impl</span><span style=color:#8fbcbb> Application</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>    pub async fn</span><span style=color:#88c0d0> run</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>S</span><span style=color:#eceff4>>(</span><span style=color:#81a1c1>&mut self</span><span style=color:#eceff4>,</span><span> input_stream</span><span style=color:#81a1c1>: &mut</span><span style=color:#8fbcbb> S</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> Result</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>i32</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> Error</span><span style=color:#eceff4>></span></span>
<span class=giallo-l><span style=color:#81a1c1>    where</span></span>
<span class=giallo-l><span style=color:#8fbcbb>        S</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Stream</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Item</span><span style=color:#81a1c1> =</span><span> crossterm</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Result</span><span style=color:#eceff4>&lt;</span><span>crossterm</span><span style=color:#81a1c1>::</span><span>event</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Event</span><span style=color:#eceff4>>></span><span style=color:#81a1c1> +</span><span style=color:#8fbcbb> Unpin</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#eceff4>    {</span></span>
<span class=giallo-l><span style=color:#81a1c1>        self.</span><span style=color:#88c0d0>claim_term</span><span style=color:#eceff4>()</span><span style=color:#81a1c1>.await?</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#616e88>        // Exit the alternate screen and disable raw mode before panicking</span></span>
<span class=giallo-l><span style=color:#81a1c1>        let</span><span> hook</span><span style=color:#81a1c1> =</span><span> std</span><span style=color:#81a1c1>::</span><span>panic</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>take_hook</span><span style=color:#eceff4>();</span></span>
<span class=giallo-l><span>        std</span><span style=color:#81a1c1>::</span><span>panic</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>set_hook</span><span style=color:#eceff4>(</span><span>Box</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>new</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>move |</span><span>info</span><span style=color:#81a1c1>|</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#616e88>            // We can't handle errors properly inside this closure.  And it's</span></span>
<span class=giallo-l><span style=color:#616e88>            // probably not a good idea to `unwrap()` inside a panic handler.</span></span>
<span class=giallo-l><span style=color:#616e88>            // So we just ignore the `Result`.</span></span>
<span class=giallo-l><span style=color:#81a1c1>            let</span><span> _</span><span style=color:#81a1c1> =</span><span> TerminalBackend</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>force_restore</span><span style=color:#eceff4>();</span></span>
<span class=giallo-l><span style=color:#88c0d0>            hook</span><span style=color:#eceff4>(</span><span>info</span><span style=color:#eceff4>);</span></span>
<span class=giallo-l><span style=color:#eceff4>        }));</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>        self.</span><span style=color:#88c0d0>event_loop</span><span style=color:#eceff4>(</span><span>input_stream</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>.await</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>        let</span><span> close_errs</span><span style=color:#81a1c1> = self.</span><span style=color:#88c0d0>close</span><span style=color:#eceff4>()</span><span style=color:#81a1c1>.await</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>        self.</span><span style=color:#88c0d0>restore_term</span><span style=color:#eceff4>()</span><span style=color:#81a1c1>?</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>        for</span><span> err</span><span style=color:#81a1c1> in</span><span> close_errs</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>            self.</span><span>editor</span><span style=color:#81a1c1>.</span><span>exit_code </span><span style=color:#81a1c1>=</span><span style=color:#b48ead> 1</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>            eprintln!</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>Error: </span><span style=color:#ebcb8b>{}</span><span style=color:#eceff4>",</span><span> err</span><span style=color:#eceff4>);</span></span>
<span class=giallo-l><span style=color:#eceff4>        }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#8fbcbb>        Ok</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>self.</span><span>editor</span><span style=color:#81a1c1>.</span><span>exit_code</span><span style=color:#eceff4>)</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p><a href=https://github.com/helix-editor/helix/blob/0097e191bb9f9f144043c2afcf04bc8632021281/helix-term/src/application.rs#L1106 rel=external>https://github.com/helix-editor/helix/blob/0097e191bb9f9f144043c2afcf04bc8632021281/helix-term/src/application.rs#L1106</a><p>åŸºæœ¬çš„ã«ã¯event loopå‰å¾Œã®å‡¦ç†ã‚’å®Ÿæ–½ã—ã¦ã„ã¾ã™ã€‚<br> <code>self.claim_term()</code>ã§terminalã‚’åˆæœŸåŒ–ã—ã¦ã„ã¾ã™ã€‚<code>std::panic_set_hook()</code>ã‚’å‘¼ã‚“ã§ã„ã‚‹ã®ã¯helixã®å‡¦ç†ä¸­ã«panicã™ã‚‹ã¨userã®shellã«ç¶ºéº—ã«æˆ»ã‚Œãªããªã‚‹ã“ã¨ã‚’é˜²ããŸã‚ã§ã™ã€‚<p>ç¶šã„ã¦event_loopã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>impl</span><span style=color:#8fbcbb> Application</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>  pub async fn</span><span style=color:#88c0d0> event_loop</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>S</span><span style=color:#eceff4>>(</span><span style=color:#81a1c1>&mut self</span><span style=color:#eceff4>,</span><span> input_stream</span><span style=color:#81a1c1>: &mut</span><span style=color:#8fbcbb> S</span><span style=color:#eceff4>)</span></span>
<span class=giallo-l><span style=color:#81a1c1>    where</span></span>
<span class=giallo-l><span style=color:#8fbcbb>        S</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Stream</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Item</span><span style=color:#81a1c1> =</span><span> crossterm</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Result</span><span style=color:#eceff4>&lt;</span><span>crossterm</span><span style=color:#81a1c1>::</span><span>event</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Event</span><span style=color:#eceff4>>></span><span style=color:#81a1c1> +</span><span style=color:#8fbcbb> Unpin</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#eceff4>    {</span></span>
<span class=giallo-l><span style=color:#81a1c1>        self.</span><span style=color:#88c0d0>render</span><span style=color:#eceff4>()</span><span style=color:#81a1c1>.await</span><span style=color:#eceff4>;</span><span style=color:#616e88>  //  ğŸ‘ˆ</span></span>
<span class=giallo-l><span style=color:#81a1c1>        self.</span><span>last_render </span><span style=color:#81a1c1>=</span><span style=color:#8fbcbb> Instant</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>now</span><span style=color:#eceff4>();</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>        loop</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>            if !self.</span><span style=color:#88c0d0>event_loop_until_idle</span><span style=color:#eceff4>(</span><span>input_stream</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>.await</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>                break</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#eceff4>            }</span></span>
<span class=giallo-l><span style=color:#eceff4>        }</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span>
<span class=giallo-l></span></code></pre><p><a href=https://github.com/helix-editor/helix/blob/0097e191bb9f9f144043c2afcf04bc8632021281/helix-term/src/application.rs#L291 rel=external>https://github.com/helix-editor/helix/blob/0097e191bb9f9f144043c2afcf04bc8632021281/helix-term/src/application.rs#L291</a><p>ã¾ãš<code>Application::render()</code>ã‚’å®Ÿè¡Œã—ã¦åˆæœŸåŒ–ã—ãŸterminalã«helixã®viewã‚’renderingã—ãŸã®ã¡ã€å®Ÿè³ªçš„ãªevent loopã§ã‚ã‚‹<code>Application::event_loop_until_idle()</code>ã«å…¥ã‚Šã¾ã™ã€‚<br> ã¨ã„ã†ã‚ã‘ã§ã€ä»Šå›ã®ä¸»é¡Œã§ã‚ã‚‹<code>Application::render()</code>ã«ãŸã©ã‚Šç€ãã¾ã—ãŸã€‚ã“ã®å‡¦ç†ã‚’ç†è§£ã™ã‚‹ã®ãŒæœ¬è¨˜äº‹ã®ç›®æ¨™ã§ã™ã€‚<h2 id=application-render><a aria-label="Anchor link for: application-render" class=zola-anchor href=#application-render><code>Application::render()</code></a></h2><pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>impl</span><span style=color:#8fbcbb> Application</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>  async fn</span><span style=color:#88c0d0> render</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&mut self</span><span style=color:#eceff4>) {</span></span>
<span class=giallo-l><span style=color:#81a1c1>      let mut</span><span> cx</span><span style=color:#81a1c1> = crate::</span><span>compositor</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Context</span><span style=color:#eceff4> {</span><span style=color:#616e88> // 1ï¸âƒ£</span></span>
<span class=giallo-l><span>          editor</span><span style=color:#81a1c1>: &mut self.</span><span>editor</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#616e88>          // ...</span></span>
<span class=giallo-l><span style=color:#eceff4>      };</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>      let</span><span> area</span><span style=color:#81a1c1> = self</span><span style=color:#616e88> // 2</span></span>
<span class=giallo-l><span style=color:#81a1c1>          .</span><span>terminal</span></span>
<span class=giallo-l><span style=color:#81a1c1>          .</span><span style=color:#88c0d0>autoresize</span><span style=color:#eceff4>()</span></span>
<span class=giallo-l><span style=color:#81a1c1>          .</span><span style=color:#88c0d0>expect</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>Unable to determine terminal size</span><span style=color:#eceff4>");</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>      let</span><span> surface</span><span style=color:#81a1c1> = self.</span><span>terminal</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>current_buffer_mut</span><span style=color:#eceff4>();</span><span style=color:#616e88> // 3</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>      self.</span><span>compositor</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>render</span><span style=color:#eceff4>(</span><span>area</span><span style=color:#eceff4>,</span><span> surface</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> &mut</span><span> cx</span><span style=color:#eceff4>);</span><span style=color:#616e88> // 4</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>      self.</span><span>terminal</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>draw</span><span style=color:#eceff4>(</span><span>pos</span><span style=color:#eceff4>,</span><span> kind</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>unwrap</span><span style=color:#eceff4>();</span><span style=color:#616e88> // 5</span></span>
<span class=giallo-l><span style=color:#eceff4>  }</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p><a href=https://github.com/helix-editor/helix/blob/0097e191bb9f9f144043c2afcf04bc8632021281/helix-term/src/application.rs#L255 rel=external>https://github.com/helix-editor/helix/blob/0097e191bb9f9f144043c2afcf04bc8632021281/helix-term/src/application.rs#L255</a><p><code>Application::render()</code>ã®ä¸»è¦ãªå‡¦ç†ã¯ä¸Šè¨˜ã®ã‚ˆã†ãªæµã‚Œã§ã™ã€‚å„å‡¦ç†ã”ã¨ã®æ¦‚è¦ã‚’èª¬æ˜ã—ã¾ã™ã€‚<ol><li>renderingå‡¦ç†ã§å¼•ãå›ã™æƒ…å ±ã‚’è¡¨ç¾ã—ãŸ<code>compositor::Context</code>ã‚’ä½œã‚Šã¾ã™ã€‚å¤§äº‹ãªã®ã¯rederingã«<code>Editor</code>ã«accessã§ãã‚‹ã¨ã„ã†ç‚¹ã§ã™ã€‚<li>ç¾åœ¨ã®terminalã®window sizeã‚’å–å¾—ã—ã¾ã™ã€‚<li>helixãŒç®¡ç†ã—ã¦ã„ã‚‹terminal renderingç”¨ã®bufferã‚’å–å¾—ã—ã¾ã™ã€‚ã“ã®bufferã¸ã®æ›¸ãè¾¼ã¿ã¯ã™ãã«terminalã«åæ˜ ã•ã‚Œã‚‹ã®ã§ã¯ãªã5ã®å‡¦ç†ã§åæ˜ ã•ã‚Œã¾ã™ã€‚<li>renderingå‡¦ç†ã®å®Ÿè£…ã§ã™ã€‚<code>Application</code>ã¯rederingå‡¦ç†ã‚’<code>Compositor</code>ã«å§”è­²ã—ã¦ã„ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚<li><code>Compositor</code>ã«ã‚ˆã£ã¦bufferã¸æ›¸ãè¾¼ã¾ã‚ŒãŸæƒ…å ±ã‚’å®Ÿéš›ã«terminalã«åæ˜ ã—ã¾ã™ã€‚ 5ã‚’ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã™ã‚‹ã¨å®Ÿéš›ã«ãªã«ã‚‚æç”»ã•ã‚Œãªããªã‚Šã¾ã™ã€‚(<code>:q</code>ã§æŠœã‘ã‚Œã¾ã™)</ol><p>ã¨ã„ã†ã‚ã‘ã§ã€<code>Application::render()</code>ã¯renderingã™ã‚‹ãŸã‚ã®æº–å‚™(contextã®ç”Ÿæˆã€terminal sizeã®å–å¾—, æ›¸ãè¾¼ã¿å…ˆã®bufferç®¡ç†)ã‚’è¡Œã£ãŸã®ã¡ã€<code>Compositor</code>ã«å‡¦ç†ã‚’å§”è­²ã—ã¦ã€æœ€å¾Œã«ãã®çµæœã‚’terminalã«åæ˜ ã•ã›ã¦ã„ã‚‹ã¨ã„ã†ã“ã¨ãŒã‚ã‹ã‚Šã¾ã—ãŸã€‚<br> <code>self.terminal.draw()</code>ã¯å¾Œã»ã©è¦‹ã¦ã„ãã¾ã™ã€‚<h2 id=compositor-render><a aria-label="Anchor link for: compositor-render" class=zola-anchor href=#compositor-render><code>Compositor::render()</code></a></h2><p>ç¶šã„ã¦ã€<code>Compository::render()</code>ã§ã™ã€‚å‡¦ç†ã¯simpleã§<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>impl</span><span style=color:#8fbcbb> Compositor</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    pub fn</span><span style=color:#88c0d0> render</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&mut self</span><span style=color:#eceff4>,</span><span> area</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Rect</span><span style=color:#eceff4>,</span><span> surface</span><span style=color:#81a1c1>: &mut</span><span style=color:#8fbcbb> Surface</span><span style=color:#eceff4>,</span><span> cx</span><span style=color:#81a1c1>: &mut</span><span style=color:#8fbcbb> Context</span><span style=color:#eceff4>) {</span></span>
<span class=giallo-l><span style=color:#81a1c1>        for</span><span> layer</span><span style=color:#81a1c1> in &mut self.</span><span>layers </span><span style=color:#eceff4>{</span></span>
<span class=giallo-l><span>            layer</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>render</span><span style=color:#eceff4>(</span><span>area</span><span style=color:#eceff4>,</span><span> surface</span><span style=color:#eceff4>,</span><span> cx</span><span style=color:#eceff4>);</span></span>
<span class=giallo-l><span style=color:#eceff4>        }</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p><a href=https://github.com/helix-editor/helix/blob/0097e191bb9f9f144043c2afcf04bc8632021281/helix-term/src/compositor.rs#L168 rel=external>https://github.com/helix-editor/helix/blob/0097e191bb9f9f144043c2afcf04bc8632021281/helix-term/src/compositor.rs#L168</a><p>è‡ªèº«ãŒä¿æŒã—ã¦ã„ã‚‹layerã‚’iterateã—ã¦é †ç•ªã«<code>layer.render()</code>ã‚’å‘¼ã³å‡ºã—ã¦ã„ã‚‹ã ã‘ã§ã™ã€‚<p><code>Compository</code>ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ã€layersã¨ã—ã¦<code>dyn Component</code> trait objectã‚’ä¿æŒã—ã¦ã„ã¾ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>pub struct</span><span style=color:#8fbcbb> Compositor</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span>    layers</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Vec</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Box</span><span style=color:#eceff4>&lt;</span><span style=color:#81a1c1>dyn</span><span style=color:#8fbcbb> Component</span><span style=color:#eceff4>>>,</span></span>
<span class=giallo-l><span>    area</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Rect</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>    pub</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>crate</span><span style=color:#eceff4>)</span><span> last_picker</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Option</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Box</span><span style=color:#eceff4>&lt;</span><span style=color:#81a1c1>dyn</span><span style=color:#8fbcbb> Component</span><span style=color:#eceff4>>>,</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p>ã“ã“ã¾ã§ã§ã€ãŠãã‚‰ã<code>Component</code> traitã«<code>render()</code>ãŒå®šç¾©ã•ã‚Œã¦ã„ã¦ã€dynamic traitã«ãªã£ã¦ã„ã‚‹ã“ã¨ã‹ã‚‰ã€helixã®å„ç¨®component(editor, filepicker, buffer list, file tree,..)ãŒ<code>Component</code>ã‚’å®Ÿè£…ã—ã¦ã„ã‚‹ã ã‚ã†ã¨ã„ã†ã“ã¨ãŒäºˆæƒ³ã§ãã‚‹ã‹ã¨æ€ã„ã¾ã™ã€‚<br> ã¾ãŸã€ä»Šã¿ã¦ã„ã‚‹å‡¦ç†ã¯helixèµ·å‹•å¾Œã«userã‹ã‚‰ã®å…¥åŠ›ã‚’å‡¦ç†ã™ã‚‹å‰ã«å‘¼ã°ã‚Œã¦ã„ã‚‹renderingå‡¦ç†ã§ã™ã€‚ã¨ãªã‚‹ã¨ã€<code>Compositor</code>ãŒä¿æŒã—ã¦ã„ã‚‹componentã¯<code>Application::new()</code>ã®ç”Ÿæˆå‡¦ç†ã®ä¸­ã§ã‚»ãƒƒãƒˆã•ã‚Œã¦ã„ã‚‹ã¨å½“ãŸã‚Šã‚’ã¤ã‘ã‚‹ã“ã¨ãŒã§ããªã„ã§ã—ã‚‡ã†ã‹ã€‚<br> ã¨ã„ã†ã“ã¨ã§ã€<code>Component</code> traitã‚’å®Ÿè£…ã—ãŸå…·ä½“çš„ãªå‹ã‚’æ¢ã™ã¹ãã€<code>Application::new()</code>ã«æˆ»ã‚Šã¾ã™ã€‚<h2 id=compositornosheng-cheng><a aria-label="Anchor link for: compositornosheng-cheng" class=zola-anchor href=#compositornosheng-cheng><code>Compositor</code>ã®ç”Ÿæˆ</a></h2><p><code>Application::new()</code>ã®ä¸­ã§è¡Œã‚ã‚Œã¦ã„ã‚‹<code>Compository</code>ã®ç”Ÿæˆå‡¦ç†ã‚’è¦‹ã¦ã„ãã¾ã™ã€‚å…·ä½“çš„ã«ã¯ã€<code>Component</code> traitã‚’å®Ÿè£…ã—ã¦ã„ã‚‹structã‚’ç‰¹å®šã—ã¾ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>use</span><span> arc_swap</span><span style=color:#81a1c1>::</span><span style=color:#eceff4>{</span><span>access</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Map</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> ArcSwap</span><span style=color:#eceff4>};</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>impl</span><span style=color:#8fbcbb> Application</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>    pub fn</span><span style=color:#88c0d0> new</span><span style=color:#eceff4>(</span></span>
<span class=giallo-l><span>        args</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Args</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>        config</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Config</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>        syn_loader_conf</span><span style=color:#81a1c1>:</span><span> syntax</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Configuration</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#eceff4>    )</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> Result</span><span style=color:#eceff4>&lt;</span><span style=color:#81a1c1>Self</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> Error</span><span style=color:#eceff4>> {</span></span>
<span class=giallo-l><span style=color:#616e88>        // ...</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>        let mut</span><span> compositor</span><span style=color:#81a1c1> =</span><span style=color:#8fbcbb> Compositor</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>new</span><span style=color:#eceff4>(</span><span>area</span><span style=color:#eceff4>);</span><span style=color:#616e88> // 1</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>        let</span><span> config</span><span style=color:#81a1c1> =</span><span style=color:#8fbcbb> Arc</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>new</span><span style=color:#eceff4>(</span><span>ArcSwap</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>from_pointee</span><span style=color:#eceff4>(</span><span>config</span><span style=color:#eceff4>));</span><span style=color:#616e88> // 2</span></span>
<span class=giallo-l><span style=color:#81a1c1>        let mut</span><span> editor</span><span style=color:#81a1c1> =</span><span style=color:#8fbcbb> Editor</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>new</span><span style=color:#eceff4>(</span></span>
<span class=giallo-l><span>            area</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>            theme_loader</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>clone</span><span style=color:#eceff4>(),</span></span>
<span class=giallo-l><span>            syn_loader</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>clone</span><span style=color:#eceff4>(),</span></span>
<span class=giallo-l><span>            Arc</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>new</span><span style=color:#eceff4>(</span><span>Map</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>new</span><span style=color:#eceff4>(</span><span>Arc</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>clone</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&</span><span>config</span><span style=color:#eceff4>),</span><span style=color:#81a1c1> |</span><span>config</span><span style=color:#81a1c1>: &</span><span style=color:#8fbcbb>Config</span><span style=color:#81a1c1>|</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>                &</span><span>config</span><span style=color:#81a1c1>.</span><span>editor</span></span>
<span class=giallo-l><span style=color:#eceff4>            })),</span></span>
<span class=giallo-l><span style=color:#eceff4>        );</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>        let</span><span> keys</span><span style=color:#81a1c1> =</span><span style=color:#8fbcbb> Box</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>new</span><span style=color:#eceff4>(</span><span>Map</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>new</span><span style=color:#eceff4>(</span><span>Arc</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>clone</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&</span><span>config</span><span style=color:#eceff4>),</span><span style=color:#81a1c1> |</span><span>config</span><span style=color:#81a1c1>: &</span><span style=color:#8fbcbb>Config</span><span style=color:#81a1c1>|</span><span style=color:#eceff4> {</span><span style=color:#616e88> // 3</span></span>
<span class=giallo-l><span style=color:#81a1c1>            &</span><span>config</span><span style=color:#81a1c1>.</span><span>keys</span></span>
<span class=giallo-l><span style=color:#eceff4>        }));</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>        let</span><span> editor_view</span><span style=color:#81a1c1> =</span><span style=color:#8fbcbb> Box</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>new</span><span style=color:#eceff4>(</span><span>ui</span><span style=color:#81a1c1>::</span><span>EditorView</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>new</span><span style=color:#eceff4>(</span><span>Keymaps</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>new</span><span style=color:#eceff4>(</span><span>keys</span><span style=color:#eceff4>)));</span><span style=color:#616e88> // 4</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>        compositor</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>push</span><span style=color:#eceff4>(</span><span>editor_view</span><span style=color:#eceff4>);</span><span style=color:#616e88> // 5</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#616e88>        // ...</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>        let</span><span> app</span><span style=color:#81a1c1> = Self</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span>            compositor</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>            terminal</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>            editor</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>            config</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#616e88>            // ...</span></span>
<span class=giallo-l><span style=color:#eceff4>        };</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#8fbcbb>        Ok</span><span style=color:#eceff4>(</span><span>app</span><span style=color:#eceff4>)</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p><a href=https://github.com/helix-editor/helix/blob/0097e191bb9f9f144043c2afcf04bc8632021281/helix-term/src/application.rs#L104 rel=external>https://github.com/helix-editor/helix/blob/0097e191bb9f9f144043c2afcf04bc8632021281/helix-term/src/application.rs#L104</a><p><code>Compositor</code>é–¢é€£ã®å‡¦ç†ã®ã¿è¼‰ã›ã¦ã„ã¾ã™ã€‚<ol><li><code>Compositor</code>ã‚’ç”Ÿæˆã—ã¦ã„ã¾ã™ã€‚å¼•æ•°ã®<code>area</code>ã¯æ°—ã«ã—ãªãã¦å¤§ä¸ˆå¤«ã§ã™ã€‚<li><code>Config</code>ã‚’<code>Arc</code>ã¨<code>ArcSwap</code>ã§wrapã—ã¦ã„ã¾ã™ã€‚å„ç¨®componentã«ãã‚Œãã‚Œã«è¨­å®šã‚’æ¸¡ã™ãŸã‚ã§ã™ã€‚<li>è¨­å®šã®ã†ã¡key bindã«é–¢ã™ã‚‹è¨­å®šã§ã™ã€‚<li>key bindã®è¨­å®šã‚’æ¸¡ã—ã¦,<code>EditorView</code> componentã‚’è¨­å®šã—ã¦ã„ã¾ã™ã€‚<li><code>EditorView</code>ã‚’<code>Compositor</code>ã«pushã—ã¾ã™ã€‚</ol><p>ã¨ã„ã†ã“ã¨ã§ã€<code>Compositor</code>ã«æ¸¡ã•ã‚ŒãŸcomponentã¯<code>EditorView</code>ã¨ã„ã†ã“ã¨ãŒã‚ã‹ã‚Šã¾ã—ãŸã€‚<p>ä¸€å¿œã€<code>Compositor::push()</code>ã‚’ã¿ã¦ãŠãã¨<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>impl</span><span style=color:#8fbcbb> Compositor</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#616e88>    /// Add a layer to be rendered in front of all existing layers.</span></span>
<span class=giallo-l><span style=color:#81a1c1>    pub fn</span><span style=color:#88c0d0> push</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&mut self</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> mut</span><span> layer</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Box</span><span style=color:#eceff4>&lt;</span><span style=color:#81a1c1>dyn</span><span style=color:#8fbcbb> Component</span><span style=color:#eceff4>>) {</span></span>
<span class=giallo-l><span style=color:#81a1c1>        let</span><span> size</span><span style=color:#81a1c1> = self.</span><span style=color:#88c0d0>size</span><span style=color:#eceff4>();</span></span>
<span class=giallo-l><span style=color:#616e88>        // trigger required_size on init</span></span>
<span class=giallo-l><span>        layer</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>required_size</span><span style=color:#eceff4>((</span><span>size</span><span style=color:#81a1c1>.</span><span>width</span><span style=color:#eceff4>,</span><span> size</span><span style=color:#81a1c1>.</span><span>height</span><span style=color:#eceff4>));</span></span>
<span class=giallo-l><span style=color:#81a1c1>        self.</span><span>layers</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>push</span><span style=color:#eceff4>(</span><span>layer</span><span style=color:#eceff4>);</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p><a href=https://github.com/helix-editor/helix/blob/0097e191bb9f9f144043c2afcf04bc8632021281/helix-term/src/compositor.rs#L102 rel=external>https://github.com/helix-editor/helix/blob/0097e191bb9f9f144043c2afcf04bc8632021281/helix-term/src/compositor.rs#L102</a><p>æ¸¡ã•ã‚ŒãŸ<code>dyn Component</code>ã«sizeã®æƒ…å ±ã‚’æ¸¡ã—ãŸå¾Œã€è‡ªèº«ã®Vecã«pushã—ã¦ã„ã¾ã™ã€‚<br> <code>EditorView</code>ã¯<code>required_size()</code>ã‚’å®Ÿè£…ã—ã¦ãŠã‚‰ãšnoopãªå‡¦ç†ãªã®ã§ã“ã“ã§ã¯æ°—ã«ã—ãªãã¦ã‚ˆã„ã§ã™ã€‚<p>ã¾ãŸã€ã“ã“ã§<code>Component</code>ã®å®šç¾©ã‚’ç¢ºèªã—ã¦ãŠãã¾ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>use</span><span> std</span><span style=color:#81a1c1>::</span><span>any</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Any</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>pub trait</span><span style=color:#8fbcbb;font-weight:700> Component</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Any</span><span style=color:#81a1c1> +</span><span style=color:#8fbcbb> AnyComponent</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#616e88>    /// Process input events, return true if handled.</span></span>
<span class=giallo-l><span style=color:#81a1c1>    fn</span><span style=color:#88c0d0> handle_event</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&mut self</span><span style=color:#eceff4>,</span><span> _event</span><span style=color:#81a1c1>: &</span><span style=color:#8fbcbb>Event</span><span style=color:#eceff4>,</span><span> _ctx</span><span style=color:#81a1c1>: &mut</span><span style=color:#8fbcbb> Context</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> EventResult</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#8fbcbb>        EventResult</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>Ignored</span><span style=color:#eceff4>(</span><span style=color:#8fbcbb>None</span><span style=color:#eceff4>)</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l><span style=color:#616e88>    // , args: ()</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#616e88>    /// Should redraw? Useful for saving redraw cycles if we know component didn't change.</span></span>
<span class=giallo-l><span style=color:#81a1c1>    fn</span><span style=color:#88c0d0> should_update</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&self</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> bool</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>        true</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#616e88>    /// Render the component onto the provided surface.</span></span>
<span class=giallo-l><span style=color:#81a1c1>    fn</span><span style=color:#88c0d0> render</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&mut self</span><span style=color:#eceff4>,</span><span> area</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Rect</span><span style=color:#eceff4>,</span><span> frame</span><span style=color:#81a1c1>: &mut</span><span style=color:#8fbcbb> Surface</span><span style=color:#eceff4>,</span><span> ctx</span><span style=color:#81a1c1>: &mut</span><span style=color:#8fbcbb> Context</span><span style=color:#eceff4>);</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#616e88>    /// Get cursor position and cursor kind.</span></span>
<span class=giallo-l><span style=color:#81a1c1>    fn</span><span style=color:#88c0d0> cursor</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&self</span><span style=color:#eceff4>,</span><span> _area</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Rect</span><span style=color:#eceff4>,</span><span> _ctx</span><span style=color:#81a1c1>: &</span><span style=color:#8fbcbb>Editor</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span style=color:#eceff4> (</span><span style=color:#8fbcbb>Option</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Position</span><span style=color:#eceff4>>,</span><span style=color:#8fbcbb> CursorKind</span><span style=color:#eceff4>) {</span></span>
<span class=giallo-l><span style=color:#eceff4>        (</span><span style=color:#8fbcbb>None</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> CursorKind</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Hidden</span><span style=color:#eceff4>)</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#616e88>    /// May be used by the parent component to compute the child area.</span></span>
<span class=giallo-l><span style=color:#616e88>    /// viewport is the maximum allowed area, and the child should stay within those bounds.</span></span>
<span class=giallo-l><span style=color:#616e88>    ///</span></span>
<span class=giallo-l><span style=color:#616e88>    /// The returned size might be larger than the viewport if the child is too big to fit.</span></span>
<span class=giallo-l><span style=color:#616e88>    /// In this case the parent can use the values to calculate scroll.</span></span>
<span class=giallo-l><span style=color:#81a1c1>    fn</span><span style=color:#88c0d0> required_size</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&mut self</span><span style=color:#eceff4>,</span><span> _viewport</span><span style=color:#81a1c1>:</span><span style=color:#eceff4> (</span><span style=color:#8fbcbb>u16</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> u16</span><span style=color:#eceff4>))</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> Option</span><span style=color:#eceff4>&lt;(</span><span style=color:#8fbcbb>u16</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> u16</span><span style=color:#eceff4>)> {</span></span>
<span class=giallo-l><span style=color:#8fbcbb>        None</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>    fn</span><span style=color:#88c0d0> type_name</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&self</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -> &</span><span style=color:#eceff4>'</span><span style=color:#8fbcbb>static str</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span>        std</span><span style=color:#81a1c1>::</span><span>any</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>type_name</span><span style=color:#81a1c1>::</span><span style=color:#eceff4>&lt;</span><span style=color:#81a1c1>Self</span><span style=color:#eceff4>>()</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>    fn</span><span style=color:#88c0d0> id</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&self</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> Option</span><span style=color:#eceff4>&lt;</span><span style=color:#81a1c1>&</span><span style=color:#eceff4>'</span><span style=color:#8fbcbb>static str</span><span style=color:#eceff4>> {</span></span>
<span class=giallo-l><span style=color:#8fbcbb>        None</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p><a href=https://github.com/helix-editor/helix/blob/0097e191bb9f9f144043c2afcf04bc8632021281/helix-term/src/compositor.rs#L39 rel=external>https://github.com/helix-editor/helix/blob/0097e191bb9f9f144043c2afcf04bc8632021281/helix-term/src/compositor.rs#L39</a><p><code>AnyComponent</code>ã¯æ°—ã«ã—ãªãã¦ã‚ˆã„ã§ã™ã€‚<br> Renderingã¨ã®é–¢ä¿‚ã§ã¯ã€<code>Component</code>ã®è²¬å‹™ã¯æ¸¡ã•ã‚ŒãŸ<code>Surface</code>(buffer)ã«<code>Context</code>ã®æƒ…å ±ã‚’ä½¿ã£ã¦ã€rederå‡¦ç†ã‚’è¡Œã†ã“ã¨ã§ã™ã€‚<p>ã¨ã„ã†ã“ã¨ã§renderå‡¦ç†ã¯<code>Application</code>, <code>Compositor</code>ã¨å§”è­²ã•ã‚Œã¦<code>EditorView</code>ãŒæ¬¡ã«å‘¼ã°ã‚Œã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã—ãŸã€‚<h2 id=editorview-render><a aria-label="Anchor link for: editorview-render" class=zola-anchor href=#editorview-render><code>EditorView::render()</code></a></h2><pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>impl</span><span style=color:#8fbcbb> Component</span><span style=color:#81a1c1> for</span><span style=color:#8fbcbb> EditorView</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    fn</span><span style=color:#88c0d0> render</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&mut self</span><span style=color:#eceff4>,</span><span> area</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Rect</span><span style=color:#eceff4>,</span><span> surface</span><span style=color:#81a1c1>: &mut</span><span style=color:#8fbcbb> Surface</span><span style=color:#eceff4>,</span><span> cx</span><span style=color:#81a1c1>: &mut</span><span style=color:#8fbcbb> Context</span><span style=color:#eceff4>) {</span></span>
<span class=giallo-l><span style=color:#616e88>        // clear with background color</span></span>
<span class=giallo-l><span>        surface</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>set_style</span><span style=color:#eceff4>(</span><span>area</span><span style=color:#eceff4>,</span><span> cx</span><span style=color:#81a1c1>.</span><span>editor</span><span style=color:#81a1c1>.</span><span>theme</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>get</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>ui.background</span><span style=color:#eceff4>"));</span><span style=color:#616e88> // 1</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#616e88>        // -1 for commandline and -1 for bufferline</span></span>
<span class=giallo-l><span style=color:#81a1c1>        let mut</span><span> editor_area</span><span style=color:#81a1c1> =</span><span> area</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>clip_bottom</span><span style=color:#eceff4>(</span><span style=color:#b48ead>1</span><span style=color:#eceff4>);</span><span style=color:#616e88> // 2</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>        for</span><span style=color:#eceff4> (</span><span>view</span><span style=color:#eceff4>,</span><span> is_focused</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> in</span><span> cx</span><span style=color:#81a1c1>.</span><span>editor</span><span style=color:#81a1c1>.</span><span>tree</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>views</span><span style=color:#eceff4>() {</span><span style=color:#616e88> // 3</span></span>
<span class=giallo-l><span style=color:#81a1c1>            let</span><span> doc</span><span style=color:#81a1c1> =</span><span> cx</span><span style=color:#81a1c1>.</span><span>editor</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>document</span><span style=color:#eceff4>(</span><span>view</span><span style=color:#81a1c1>.</span><span>doc</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>unwrap</span><span style=color:#eceff4>();</span><span style=color:#616e88> // 4</span></span>
<span class=giallo-l><span style=color:#81a1c1>            self.</span><span style=color:#88c0d0>render_view</span><span style=color:#eceff4>(</span><span>cx</span><span style=color:#81a1c1>.</span><span>editor</span><span style=color:#eceff4>,</span><span> doc</span><span style=color:#eceff4>,</span><span> view</span><span style=color:#eceff4>,</span><span> area</span><span style=color:#eceff4>,</span><span> surface</span><span style=color:#eceff4>,</span><span> is_focused</span><span style=color:#eceff4>);</span><span style=color:#616e88> // 5</span></span>
<span class=giallo-l><span style=color:#eceff4>        }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#616e88>        // ...</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p><a href=https://github.com/helix-editor/helix/blob/0097e191bb9f9f144043c2afcf04bc8632021281/helix-term/src/ui/editor.rs#L1359 rel=external>https://github.com/helix-editor/helix/blob/0097e191bb9f9f144043c2afcf04bc8632021281/helix-term/src/ui/editor.rs#L1359</a><p>æœ¬æ¥ã®å‡¦ç†ã¯buffer line(é–‹ã„ã¦ã„ã‚‹bufferã®list)ã‚„status lineç­‰ã®renderå‡¦ç†ãŒã‚ã‚‹ã®ã§ã™ãŒå‰²æ„›ã—ã¦ã„ã¾ã™ã€‚<br> ãã‚Œã‚‰ã‚’ç„¡è¦–ã§ãã‚Œã°ã€<code>EditorView::render()</code>ã®è²¬å‹™ã¯simpleã§ã€themeã®èƒŒæ™¯è‰²ã‚’setã—ãŸã®ã¡ã€<code>Editor</code>ãŒä¿æŒã—ã¦ã„ã‚‹<code>View</code>ã®rederingå‡¦ç†ã‚’å‘¼ã¶ã“ã¨ã ã‘ã§ã™ã€‚<ol><li><code>cx.editor.theme.get("ui.background")</code>ã§userãŒæŒ‡å®šã—ãŸthemeã®èƒŒæ™¯è‰²ç”¨ã®<code>Theme</code>ãŒå–å¾—ã§ãã¾ã™ã€‚ä»®ã«ã“ã®è¡Œã‚’ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã™ã‚‹ã¨èƒŒæ™¯è‰²ãŒåæ˜ ã•ã‚Œãªããªã‚Šã¾ã™ã€‚<li>æç”»é ˜åŸŸã‚’ä¸‹ã‹ã‚‰1è¡Œæ¸›ã‚‰ã™å‡¦ç†ã§ã™ã€‚ç©ºã„ãŸè¡Œã«status lineã‚’æç”»ã—ã¾ã™ã€‚<li><code>Editor</code>ãŒä¿æŒã—ã¦ã„ã‚‹<code>View</code>ã‚’iterateã—ã¾ã™ã€‚<code>is_forcus</code> ã¯userãŒç¾åœ¨focusã—ã¦ã„ã‚‹ã‹ã®flagã§cursorã‚’æç”»ã™ã‚‹ã‹ã®åˆ¤å®šç­‰ã«åˆ©ç”¨ã—ã¾ã™ã€‚<li><code>View</code>ã«å¯¾å¿œã™ã‚‹<code>Document</code>ã‚’å–å¾—ã—ã¾ã™ã€‚<code>View</code>ã¨<code>Document</code>ã«ã¤ã„ã¦ã¯å¾Œè¿°ã—ã¾ã™ã€‚ã“ã®å–å¾—ãŒå¤±æ•—ã™ã‚‹ã®ã¯bugãªã®ã§unwrapã§ã™ã€‚<li><code>View</code>ã®rederingå‡¦ç†ã‚’å‘¼ã³å‡ºã—ã¾ã™ã€‚</ol><p>ã“ã“ã§<code>Editor</code>ã‹ã‚‰<code>View</code>ã‚’å–å¾—ã—ã¦ã„ã¾ã™ã€‚<code>Compositor</code>ã®æ™‚ã¨åŒã˜ã‚ˆã†ã«ã¾ã userã®å…¥åŠ›ã‚’å‡¦ç†ã™ã‚‹å‰ã®æ®µéšãªã®ã§ã€<code>Editor</code>ãŒä¿æŒã—ã¦ã„ã‚‹ãªã‚“ã‚‰ã‹ã®<code>View</code>ã¯<code>Application::new()</code>ã®å‡¦ç†ã®ä¸­ã§ç”Ÿæˆã•ã‚ŒãŸã¨è€ƒãˆã‚‰ã‚Œã¾ã™ã€‚<br> ã¨ã„ã†ã“ã¨ã§ã€<code>Editor</code>ãŒ<code>View</code>ã‚’ã©ã®ã‚ˆã†ã«ç”Ÿæˆã—ãŸã‹ã‚’è¦‹ã¦ã„ãã¾ã™ã€‚<h2 id=documenttoviewnosheng-cheng-chu-li><a aria-label="Anchor link for: documenttoviewnosheng-cheng-chu-li" class=zola-anchor href=#documenttoviewnosheng-cheng-chu-li><code>Document</code>ã¨<code>View</code>ã®ç”Ÿæˆå‡¦ç†</a></h2><pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>impl</span><span style=color:#8fbcbb> Application</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    pub fn</span><span style=color:#88c0d0> new</span><span style=color:#eceff4>(</span></span>
<span class=giallo-l><span>        args</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Args</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>        config</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Config</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>        syn_loader_conf</span><span style=color:#81a1c1>:</span><span> syntax</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Configuration</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#eceff4>    )</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> Result</span><span style=color:#eceff4>&lt;</span><span style=color:#81a1c1>Self</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> Error</span><span style=color:#eceff4>> {</span></span>
<span class=giallo-l><span style=color:#616e88>        // ...</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>        let</span><span> editor_view</span><span style=color:#81a1c1> =</span><span style=color:#8fbcbb> Box</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>new</span><span style=color:#eceff4>(</span><span>ui</span><span style=color:#81a1c1>::</span><span>EditorView</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>new</span><span style=color:#eceff4>(</span><span>Keymaps</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>new</span><span style=color:#eceff4>(</span><span>keys</span><span style=color:#eceff4>)));</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>        compositor</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>push</span><span style=color:#eceff4>(</span><span>editor_view</span><span style=color:#eceff4>);</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>        if</span><span> args</span><span style=color:#81a1c1>.</span><span>load_tutor </span><span style=color:#eceff4>{</span></span>
<span class=giallo-l><span style=color:#616e88>            // ...</span></span>
<span class=giallo-l><span style=color:#eceff4>        }</span><span style=color:#81a1c1> else if !</span><span>args</span><span style=color:#81a1c1>.</span><span>files</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>is_empty</span><span style=color:#eceff4>() {</span></span>
<span class=giallo-l><span style=color:#81a1c1>            let</span><span> first</span><span style=color:#81a1c1> = &</span><span>args</span><span style=color:#81a1c1>.</span><span>files</span><span style=color:#eceff4>[</span><span style=color:#b48ead>0</span><span style=color:#eceff4>]</span><span style=color:#81a1c1>.</span><span style=color:#b48ead>0</span><span style=color:#eceff4>;</span><span style=color:#616e88> // we know it's not empty</span></span>
<span class=giallo-l><span style=color:#81a1c1>            if</span><span> first</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>is_dir</span><span style=color:#eceff4>() {</span></span>
<span class=giallo-l><span style=color:#616e88>                // ...</span></span>
<span class=giallo-l><span style=color:#eceff4>            }</span><span style=color:#81a1c1> else</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>                let</span><span> nr_of_files</span><span style=color:#81a1c1> =</span><span> args</span><span style=color:#81a1c1>.</span><span>files</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>len</span><span style=color:#eceff4>();</span></span>
<span class=giallo-l><span style=color:#81a1c1>                for</span><span style=color:#eceff4> (</span><span>i</span><span style=color:#eceff4>, (</span><span>file</span><span style=color:#eceff4>,</span><span> pos</span><span style=color:#eceff4>))</span><span style=color:#81a1c1> in</span><span> args</span><span style=color:#81a1c1>.</span><span>files</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>into_iter</span><span style=color:#eceff4>()</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>enumerate</span><span style=color:#eceff4>() {</span></span>
<span class=giallo-l><span style=color:#81a1c1>                    if</span><span> file</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>is_dir</span><span style=color:#eceff4>() {</span></span>
<span class=giallo-l><span style=color:#81a1c1>                        return</span><span style=color:#8fbcbb> Err</span><span style=color:#eceff4>(</span><span>anyhow</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0;font-weight:700>anyhow!</span><span style=color:#eceff4>(</span></span>
<span class=giallo-l><span style=color:#eceff4>                            "</span><span style=color:#a3be8c>expected a path to file, found a directory. (to open a directory pass it as first argument)</span><span style=color:#eceff4>"</span></span>
<span class=giallo-l><span style=color:#eceff4>                        ));</span></span>
<span class=giallo-l><span style=color:#eceff4>                    }</span><span style=color:#81a1c1> else</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>                        let</span><span> action</span><span style=color:#81a1c1> = match</span><span> args</span><span style=color:#81a1c1>.</span><span>split </span><span style=color:#eceff4>{</span></span>
<span class=giallo-l><span>                            _</span><span style=color:#81a1c1> if</span><span> i</span><span style=color:#81a1c1> ==</span><span style=color:#b48ead> 0</span><span style=color:#81a1c1> =></span><span style=color:#8fbcbb> Action</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>VerticalSplit</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#8fbcbb>                            Some</span><span style=color:#eceff4>(</span><span style=color:#8fbcbb>Layout</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Vertical</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> =></span><span style=color:#8fbcbb> Action</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>VerticalSplit</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#8fbcbb>                            Some</span><span style=color:#eceff4>(</span><span style=color:#8fbcbb>Layout</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Horizontal</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> =></span><span style=color:#8fbcbb> Action</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>HorizontalSplit</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#8fbcbb>                            None</span><span style=color:#81a1c1> =></span><span style=color:#8fbcbb> Action</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Load</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#eceff4>                        };</span></span>
<span class=giallo-l><span style=color:#81a1c1>                        let</span><span> doc_id</span><span style=color:#81a1c1> =</span><span> editor</span></span>
<span class=giallo-l><span style=color:#81a1c1>                            .</span><span style=color:#88c0d0>open</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&</span><span>file</span><span style=color:#eceff4>,</span><span> action</span><span style=color:#eceff4>)</span><span style=color:#616e88> // 1  ğŸ‘ˆğŸ‘ˆğŸ‘ˆ</span></span>
<span class=giallo-l><span style=color:#81a1c1>                            .</span><span style=color:#88c0d0>context</span><span style=color:#eceff4>(</span><span style=color:#88c0d0;font-weight:700>format!</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>open '</span><span style=color:#ebcb8b>{}</span><span style=color:#a3be8c>'</span><span style=color:#eceff4>",</span><span> file</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>to_string_lossy</span><span style=color:#eceff4>()))</span><span style=color:#81a1c1>?</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>                        let</span><span> view_id</span><span style=color:#81a1c1> =</span><span> editor</span><span style=color:#81a1c1>.</span><span>tree</span><span style=color:#81a1c1>.</span><span>focus</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>                        let</span><span> doc</span><span style=color:#81a1c1> =</span><span style=color:#88c0d0;font-weight:700> doc_mut!</span><span style=color:#eceff4>(</span><span>editor</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> &</span><span>doc_id</span><span style=color:#eceff4>);</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>                        let</span><span> pos</span><span style=color:#81a1c1> =</span><span style=color:#8fbcbb> Selection</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>point</span><span style=color:#eceff4>(</span><span style=color:#88c0d0>pos_at_coords</span><span style=color:#eceff4>(</span><span>doc</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>text</span><span style=color:#eceff4>()</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>slice</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>..</span><span style=color:#eceff4>),</span><span> pos</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> true</span><span style=color:#eceff4>));</span></span>
<span class=giallo-l><span>                        doc</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>set_selection</span><span style=color:#eceff4>(</span><span>view_id</span><span style=color:#eceff4>,</span><span> pos</span><span style=color:#eceff4>);</span></span>
<span class=giallo-l><span style=color:#eceff4>                    }</span></span>
<span class=giallo-l><span style=color:#eceff4>                }</span></span>
<span class=giallo-l><span style=color:#eceff4>            }</span></span>
<span class=giallo-l><span style=color:#eceff4>        }</span><span style=color:#81a1c1> else</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#616e88>            // ...</span></span>
<span class=giallo-l><span style=color:#eceff4>        }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>        let</span><span> app</span><span style=color:#81a1c1> = Self</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#616e88>            // ...</span></span>
<span class=giallo-l><span style=color:#eceff4>        };</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#8fbcbb>        Ok</span><span style=color:#eceff4>(</span><span>app</span><span style=color:#eceff4>)</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p>å†ã³<code>Application::new()</code>ã§ã™ã€‚ã•ãã»ã©ã¯<code>Compository</code>ã¨<code>EditorView</code>ã®ç”Ÿæˆå‡¦ç†ã«æ³¨ç›®ã—ã¾ã—ãŸãŒã€ä»Šå›ã¯ãã®æ¬¡ã®å‡¦ç†ãŒé‡è¦ã§ã™ã€‚<br> <code>hx ./Cargo.toml</code>ã®ã‚ˆã†ã«å¼•æ•°ã«openã—ãŸfileãŒæ¸¡ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’å‰æã«ã—ã¦ã€ãªã‚“ã‚„ã‹ã‚“ã‚„åˆ¤å®šã—ã¦ã€1ã®<code>editor.open()</code>ã®ã¨ã“ã‚ã¾ã§æ¥ã¾ã™ã€‚<br> å¼•æ•°ã®<code>file</code>ã¯file path, <code>action</code>ã«ã¯<code>Action::VerticalSplit</code>ãŒè¨­å®šã•ã‚Œã¾ã™ã€‚<code>editor.open()</code>ã®æˆ»ã‚Šå€¤ãŒ<code>doc_id</code>ã¨ãªã£ã¦ãŠã‚Šã€æ¬¡ã®å‡¦ç†ã§<code>view_id</code>ã‚’å–å¾—ã—ã¦ã„ã‚‹ã“ã¨ã‹ã‚‰ã“ã®å‡¦ç†ãŒ<code>Document</code>ãŠã‚ˆã³<code>View</code>ã®ç”Ÿæˆå‡¦ç†ã§ã‚ã‚‹ã“ã¨ãŒäºˆæƒ³ã§ãã¾ã™ã€‚<br> ã¨ã„ã†ã“ã¨ã§ã€<code>Editor::open()</code>ã‚’è¦‹ã¦ã„ãã¾ã—ã‚‡ã†ã€‚<p><a href=https://github.com/helix-editor/helix/blob/0097e191bb9f9f144043c2afcf04bc8632021281/helix-term/src/application.rs#L192 rel=external>https://github.com/helix-editor/helix/blob/0097e191bb9f9f144043c2afcf04bc8632021281/helix-term/src/application.rs#L192</a><h2 id=editor-open><a aria-label="Anchor link for: editor-open" class=zola-anchor href=#editor-open><code>Editor::open()</code></a></h2><pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>impl</span><span style=color:#8fbcbb> Editor</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    pub fn</span><span style=color:#88c0d0> open</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&mut self</span><span style=color:#eceff4>,</span><span> path</span><span style=color:#81a1c1>: &</span><span style=color:#8fbcbb>Path</span><span style=color:#eceff4>,</span><span> action</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Action</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> Result</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>DocumentId</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> Error</span><span style=color:#eceff4>> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>        let</span><span> path</span><span style=color:#81a1c1> =</span><span> helix_core</span><span style=color:#81a1c1>::</span><span>path</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>get_canonicalized_path</span><span style=color:#eceff4>(</span><span>path</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>?</span><span style=color:#eceff4>;</span><span style=color:#616e88> // 1</span></span>
<span class=giallo-l><span style=color:#81a1c1>        let</span><span> id</span><span style=color:#81a1c1> = self.</span><span style=color:#88c0d0>document_by_path</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&</span><span>path</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>map</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>|</span><span>doc</span><span style=color:#81a1c1>|</span><span> doc</span><span style=color:#81a1c1>.</span><span>id</span><span style=color:#eceff4>);</span><span style=color:#616e88> // 2</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>        let</span><span> id</span><span style=color:#81a1c1> = if let</span><span style=color:#8fbcbb> Some</span><span style=color:#eceff4>(</span><span>id</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> =</span><span> id</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span>            id</span></span>
<span class=giallo-l><span style=color:#eceff4>        }</span><span style=color:#81a1c1> else</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>            let mut</span><span> doc</span><span style=color:#81a1c1> =</span><span style=color:#8fbcbb> Document</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>open</span><span style=color:#eceff4>(</span><span style=color:#616e88> // 3</span></span>
<span class=giallo-l><span style=color:#81a1c1>                &</span><span>path</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#8fbcbb>                None</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#8fbcbb>                Some</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>self.</span><span>syn_loader</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>clone</span><span style=color:#eceff4>()),</span></span>
<span class=giallo-l><span style=color:#81a1c1>                self.</span><span>config</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>clone</span><span style=color:#eceff4>(),</span></span>
<span class=giallo-l><span style=color:#eceff4>            )</span><span style=color:#81a1c1>?</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#616e88>            // ...</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>            let</span><span> id</span><span style=color:#81a1c1> = self.</span><span style=color:#88c0d0>new_document</span><span style=color:#eceff4>(</span><span>doc</span><span style=color:#eceff4>);</span><span style=color:#616e88> // 4</span></span>
<span class=giallo-l><span style=color:#81a1c1>            let</span><span> _</span><span style=color:#81a1c1> = self.</span><span style=color:#88c0d0>launch_language_server</span><span style=color:#eceff4>(</span><span>id</span><span style=color:#eceff4>);</span><span style=color:#616e88> // 5</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>            id</span></span>
<span class=giallo-l><span style=color:#eceff4>        };</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>        self.</span><span style=color:#88c0d0>switch</span><span style=color:#eceff4>(</span><span>id</span><span style=color:#eceff4>,</span><span> action</span><span style=color:#eceff4>);</span><span style=color:#616e88> // 6</span></span>
<span class=giallo-l><span style=color:#8fbcbb>        Ok</span><span style=color:#eceff4>(</span><span>id</span><span style=color:#eceff4>)</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p><a href=https://github.com/helix-editor/helix/blob/0097e191bb9f9f144043c2afcf04bc8632021281/helix-view/src/editor.rs#L1310 rel=external>https://github.com/helix-editor/helix/blob/0097e191bb9f9f144043c2afcf04bc8632021281/helix-view/src/editor.rs#L1310</a><p><code>Editor::open()</code>ã¯å¼•æ•°ã«file pathã¨fileã®é–‹ãæ–¹(windowã‚’vertical,horizonã©ã¡ã‚‰ã«åˆ†å‰²ã™ã‚‹ã‹)ã‚’ã¨ã£ã¦ã€å¯¾å¿œã™ã‚‹<code>Document</code>ã‚’ç”Ÿæˆã—ãŸã®ã¡ã€è­˜åˆ¥å­ã§ã‚ã‚‹<code>DocumentId</code>ã‚’è¿”ã—ã¾ã™ã€‚<ol><li>file pathã®æ­£è¦åŒ–å‡¦ç†ã§ã™ã€‚<code>~</code>ã‚’å±•é–‹ã—ãŸã‚Šã—ã¾ã™ã€‚<li>æ—¢ã«pathã«è©²å½“ã™ã‚‹<code>Document</code>ãŒã‚ã‚‹ã‹ã‚’ç¢ºã‹ã‚ã¾ã™ã€‚ã“ã“ã§ã¯<code>None</code>ãŒè¿”ã£ã¦ãã¾ã™ã€‚<li><code>Document</code>ã®ç”Ÿæˆå‡¦ç†ã€‚<li>ç”Ÿæˆã—ãŸ<code>Document</code>ã‚’ä¿æŒã™ã‚‹å‡¦ç†ã§ã™ã€‚<li>ä»Šå›ã¯ãµã‚Œã¾ã›ã‚“ãŒã€ã“ã“ã§LSP serverã‚’èµ·å‹•ã—ã¾ã™ã€‚<li>å¾Œè¿°ã—ã¾ã™ã€‚</ol><p>ã¨ã„ã†ã“ã¨ã§ã€<code>Document::open()</code>ã‚’ã¿ã¾ã™<h3 id=document-open><a aria-label="Anchor link for: document-open" class=zola-anchor href=#document-open><code>Document::open()</code></a></h3><pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>use crate::</span><span>editor</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Config</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>impl</span><span style=color:#8fbcbb> Document</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    pub fn</span><span style=color:#88c0d0> open</span><span style=color:#eceff4>(</span></span>
<span class=giallo-l><span>        path</span><span style=color:#81a1c1>: &</span><span style=color:#8fbcbb>Path</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>        encoding</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Option</span><span style=color:#eceff4>&lt;</span><span style=color:#81a1c1>&</span><span style=color:#eceff4>'</span><span style=color:#8fbcbb>static</span><span> encoding</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Encoding</span><span style=color:#eceff4>>,</span></span>
<span class=giallo-l><span>        config_loader</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Option</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Arc</span><span style=color:#eceff4>&lt;</span><span>syntax</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Loader</span><span style=color:#eceff4>>>,</span></span>
<span class=giallo-l><span>        config</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Arc</span><span style=color:#eceff4>&lt;</span><span style=color:#81a1c1>dyn</span><span style=color:#8fbcbb> DynAccess</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Config</span><span style=color:#eceff4>>>,</span></span>
<span class=giallo-l><span style=color:#eceff4>    )</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> Result</span><span style=color:#eceff4>&lt;</span><span style=color:#81a1c1>Self</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> Error</span><span style=color:#eceff4>> {</span></span>
<span class=giallo-l><span style=color:#616e88>        // Open the file if it exists, otherwise assume it is a new file (and thus empty).</span></span>
<span class=giallo-l><span style=color:#81a1c1>        let</span><span style=color:#eceff4> (</span><span>rope</span><span style=color:#eceff4>,</span><span> encoding</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> = if</span><span> path</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>exists</span><span style=color:#eceff4>() {</span></span>
<span class=giallo-l><span style=color:#81a1c1>            let mut</span><span> file</span><span style=color:#81a1c1> =</span></span>
<span class=giallo-l><span>                std</span><span style=color:#81a1c1>::</span><span>fs</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>File</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>open</span><span style=color:#eceff4>(</span><span>path</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>context</span><span style=color:#eceff4>(</span><span style=color:#88c0d0;font-weight:700>format!</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>unable to open </span><span style=color:#ebcb8b>{</span><span style=color:#a3be8c>:?</span><span style=color:#ebcb8b>}</span><span style=color:#eceff4>",</span><span> path</span><span style=color:#eceff4>))</span><span style=color:#81a1c1>?</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#88c0d0>            from_reader</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&mut</span><span> file</span><span style=color:#eceff4>,</span><span> encoding</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>?</span></span>
<span class=giallo-l><span style=color:#eceff4>        }</span><span style=color:#81a1c1> else</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#616e88>            // ...</span></span>
<span class=giallo-l><span style=color:#eceff4>        };</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>        let mut</span><span> doc</span><span style=color:#81a1c1> = Self::</span><span style=color:#88c0d0>from</span><span style=color:#eceff4>(</span><span>rope</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> Some</span><span style=color:#eceff4>(</span><span>encoding</span><span style=color:#eceff4>),</span><span> config</span><span style=color:#eceff4>);</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#616e88>        // ...</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#8fbcbb>        Ok</span><span style=color:#eceff4>(</span><span>doc</span><span style=color:#eceff4>)</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p><a href=https://github.com/helix-editor/helix/blob/0097e191bb9f9f144043c2afcf04bc8632021281/helix-view/src/document.rs#L508 rel=external>https://github.com/helix-editor/helix/blob/0097e191bb9f9f144043c2afcf04bc8632021281/helix-view/src/document.rs#L508</a><p><code>Document::open()</code>ã§ã¯fileãŒå­˜åœ¨ã™ã‚‹å ´åˆã«ã€filesystemã‹ã‚‰openã—ãŸã®ã¡ã€<code>from_reader()</code>ã‚’å‘¼ã³å‡ºã—ã¦ã„ã¾ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>pub fn</span><span style=color:#88c0d0> from_reader</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>R</span><span style=color:#81a1c1>:</span><span> std</span><span style=color:#81a1c1>::</span><span>io</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Read</span><span style=color:#81a1c1> + ?</span><span style=color:#8fbcbb>Sized</span><span style=color:#eceff4>>(</span></span>
<span class=giallo-l><span>    reader</span><span style=color:#81a1c1>: &mut</span><span style=color:#8fbcbb> R</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>    encoding</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Option</span><span style=color:#eceff4>&lt;</span><span style=color:#81a1c1>&</span><span style=color:#eceff4>'</span><span style=color:#8fbcbb>static</span><span> encoding</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Encoding</span><span style=color:#eceff4>>,</span></span>
<span class=giallo-l><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> Result</span><span style=color:#eceff4>&lt;(</span><span style=color:#8fbcbb>Rope</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> &</span><span style=color:#eceff4>'</span><span style=color:#8fbcbb>static</span><span> encoding</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Encoding</span><span style=color:#eceff4>),</span><span style=color:#8fbcbb> Error</span><span style=color:#eceff4>> {</span><span style=color:#616e88> /* ... */</span><span style=color:#eceff4> }</span></span></code></pre><p>https://github.com/helix-editor/helix/blob/0097e191bb9f9f144043c2afcf04bc8632021281/helix-view/src/document.rs#L283<p><code>from_reader()</code>ã¯ä¸Šè¨˜ã®ã‚ˆã†ãªsignatureã‚’ã—ã¦ãŠã‚Šã€<code>reader</code>(file)ã®encodingã‚’åˆ¤å®šã—ãŸã®ã¡ã€<code>Rope</code>ã¨åˆ¤å®šã—ãŸencodingã‚’è¿”ã™é–¢æ•°ã§ã™ã€‚<br> ã“ã®é–¢æ•°ã‚‚ã¨ã¦ã‚‚ãŠã‚‚ã—ã‚ã„ã®ã§è¦‹ã¦ã„ããŸã„ã¨ã“ã‚ãªã®ã§ã™ãŒã€renderingå‡¦ç†ã¨ã„ã†æœ¬é¡Œã‹ã‚‰ãã‚Œã¦ã—ã¾ã†ã®ã§ä»Šå›ã¯é£›ã°ã—ã¾ã™ã€‚<br> ã¾ãŸã€<code>Rope</code>ã¨ã„ã†ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã¯helixã«ãŠã‘ã‚‹ç·¨é›†å¯¾è±¡ã®textã‚’ä¿æŒã™ã‚‹æ ¸ã¨ãªã‚‹ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã§ã€åˆ¥ã®æ©Ÿä¼šã«ã‚ˆã‚Šè©³ã—ãè¿°ã¹ãŸã„ã¨æ€ã„ã¾ã™ã€‚<br> ã“ã“ã§ã¯ã€ç·¨é›†å¯¾è±¡ã®text(file)ã‚’ä¿æŒã—ã¦ã€å„ç¨®åŠ¹ç‡çš„ãªæ“ä½œã®APIã‚’æä¾›ã—ã¦ãã‚Œã‚‹ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã¨ã„ã†ç¨‹åº¦ã«ç†è§£ã—ã¾ã™ã€‚ crateã¨ã—ã¦ã¯<a href=https://github.com/cessen/ropey rel=external>ropey</a>ã‚’åˆ©ç”¨ã—ã¦ã„ã¾ã™ã€‚<p><code>Document::from</code>ã¯<code>Document</code>ã®constructå‡¦ç†ã§ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>impl</span><span style=color:#8fbcbb> Document</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    pub fn</span><span style=color:#88c0d0> from</span><span style=color:#eceff4>(</span></span>
<span class=giallo-l><span>        text</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Rope</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>        encoding</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Option</span><span style=color:#eceff4>&lt;</span><span style=color:#81a1c1>&</span><span style=color:#eceff4>'</span><span style=color:#8fbcbb>static</span><span> encoding</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Encoding</span><span style=color:#eceff4>>,</span></span>
<span class=giallo-l><span>        config</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Arc</span><span style=color:#eceff4>&lt;</span><span style=color:#81a1c1>dyn</span><span style=color:#8fbcbb> DynAccess</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Config</span><span style=color:#eceff4>>>,</span></span>
<span class=giallo-l><span style=color:#eceff4>    )</span><span style=color:#81a1c1> -> Self</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>        let</span><span> encoding</span><span style=color:#81a1c1> =</span><span> encoding</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>unwrap_or</span><span style=color:#eceff4>(</span><span>encoding</span><span style=color:#81a1c1>::</span><span>UTF_8</span><span style=color:#eceff4>);</span></span>
<span class=giallo-l><span style=color:#81a1c1>        let</span><span> changes</span><span style=color:#81a1c1> =</span><span style=color:#8fbcbb> ChangeSet</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>new</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&</span><span>text</span><span style=color:#eceff4>);</span></span>
<span class=giallo-l><span style=color:#81a1c1>        let</span><span> old_state</span><span style=color:#81a1c1> =</span><span style=color:#8fbcbb> None</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>        Self</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span>            id</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> DocumentId</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>default</span><span style=color:#eceff4>(),</span></span>
<span class=giallo-l><span>            path</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> None</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>            encoding</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>            text</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>            selections</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> HashMap</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>default</span><span style=color:#eceff4>(),</span></span>
<span class=giallo-l><span>            config</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#616e88>            // ...</span></span>
<span class=giallo-l><span style=color:#eceff4>        }</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p><a href=https://github.com/helix-editor/helix/blob/0097e191bb9f9f144043c2afcf04bc8632021281/helix-view/src/document.rs#L464 rel=external>https://github.com/helix-editor/helix/blob/0097e191bb9f9f144043c2afcf04bc8632021281/helix-view/src/document.rs#L464</a><p><code>Document</code>ã¯ã„ã‚ã„ã‚ãªçŠ¶æ…‹ã‚’ä¿æŒã—ã¦ã„ã‚‹ã®ã§ã™ãŒã€renderingã‚’è¿½ã£ã¦ã„ãä¸Šã§æŠ‘ãˆã¦ã»ã—ã„ã®ã¯fileã®å†…å®¹ã‚’<code>Rope</code>ã§ä¿æŒã—ã¦ã„ã‚‹ã“ã¨ã§ã™ã€‚<br> <code>Selection</code>ã¯cursorã®ä½ç½®ã‚’è¡¨ç¾ã—ã¦ã„ã¾ã™ã€‚ã“ã®å®Ÿè£…ã‹ã‚‰helixã«ãŠã„ã¦ã¯cursorã®ç¾åœ¨ä½ç½®ã¨é¸æŠç¯„å›²ãŒ<code>Selection</code>ã§è¡¨ç¾ã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚<br> <code>Selection</code>ã¯rederingã«é–¢ã‚ã£ã¦ãã‚‹ã®ã§ã®ã¡ã»ã©ã‚‚ã†å°‘ã—è©³ã—ãèª¬æ˜ã—ã¾ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>pub struct</span><span style=color:#8fbcbb> Document</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    pub</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>crate</span><span style=color:#eceff4>)</span><span> id</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> DocumentId</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>    text</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Rope</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>    selections</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> HashMap</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>ViewId</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> Selection</span><span style=color:#eceff4>>,</span></span>
<span class=giallo-l><span style=color:#616e88>    // ...</span></span>
<span class=giallo-l><span>    path</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Option</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>PathBuf</span><span style=color:#eceff4>>,</span></span>
<span class=giallo-l><span>    encoding</span><span style=color:#81a1c1>: &</span><span style=color:#eceff4>'</span><span style=color:#8fbcbb>static</span><span> encoding</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Encoding</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p><a href=https://github.com/helix-editor/helix/blob/0097e191bb9f9f144043c2afcf04bc8632021281/helix-view/src/document.rs#L118 rel=external>https://github.com/helix-editor/helix/blob/0097e191bb9f9f144043c2afcf04bc8632021281/helix-view/src/document.rs#L118</a><p>ã¨ã„ã†ã“ã¨ã§ã€<code>Document</code>ã®ç”Ÿæˆã‚’ç¢ºèªã—ã¾ã—ãŸã€‚è¦ã¯fileã‹ã‚‰openã—ãŸ<code>Rope</code>ã¨ã€helixçš„ã«ç®¡ç†ã—ãŸã„çŠ¶æ…‹ã‚’ä¿æŒã—ã¦ã„ã‚‹ã®ãŒ<code>Document</code>ã¨ã„ã†ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã¨ã„ã†ã“ã¨ãŒä»Šã®ã¨ã“ã‚ã‚ã‹ã‚Šã¾ã—ãŸã€‚<br> ä»Šã¿ã¦ã„ã‚‹ã¨ã“ã‚ã‚’å†æ²ã™ã‚‹ã¨<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>impl</span><span style=color:#8fbcbb> Editor</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    pub fn</span><span style=color:#88c0d0> open</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&mut self</span><span style=color:#eceff4>,</span><span> path</span><span style=color:#81a1c1>: &</span><span style=color:#8fbcbb>Path</span><span style=color:#eceff4>,</span><span> action</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Action</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> Result</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>DocumentId</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> Error</span><span style=color:#eceff4>> {</span></span>
<span class=giallo-l><span style=color:#616e88>        // ...</span></span>
<span class=giallo-l><span style=color:#81a1c1>        let</span><span> id</span><span style=color:#81a1c1> = if let</span><span style=color:#8fbcbb> Some</span><span style=color:#eceff4>(</span><span>id</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> =</span><span> id</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span>            id</span></span>
<span class=giallo-l><span style=color:#eceff4>        }</span><span style=color:#81a1c1> else</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>            let mut</span><span> doc</span><span style=color:#81a1c1> =</span><span style=color:#8fbcbb> Document</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>open</span><span style=color:#eceff4>(</span><span style=color:#616e88> // ğŸ‘ˆ</span></span>
<span class=giallo-l><span style=color:#81a1c1>                &</span><span>path</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#8fbcbb>                None</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#8fbcbb>                Some</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>self.</span><span>syn_loader</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>clone</span><span style=color:#eceff4>()),</span></span>
<span class=giallo-l><span style=color:#81a1c1>                self.</span><span>config</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>clone</span><span style=color:#eceff4>(),</span></span>
<span class=giallo-l><span style=color:#eceff4>            )</span><span style=color:#81a1c1>?</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#616e88>            // ...</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>            let</span><span> id</span><span style=color:#81a1c1> = self.</span><span style=color:#88c0d0>new_document</span><span style=color:#eceff4>(</span><span>doc</span><span style=color:#eceff4>);</span><span style=color:#616e88> // 4</span></span>
<span class=giallo-l><span style=color:#81a1c1>            let</span><span> _</span><span style=color:#81a1c1> = self.</span><span style=color:#88c0d0>launch_language_server</span><span style=color:#eceff4>(</span><span>id</span><span style=color:#eceff4>);</span><span style=color:#616e88> // 5</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>            id</span></span>
<span class=giallo-l><span style=color:#eceff4>        };</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>        self.</span><span style=color:#88c0d0>switch</span><span style=color:#eceff4>(</span><span>id</span><span style=color:#eceff4>,</span><span> action</span><span style=color:#eceff4>);</span><span style=color:#616e88> // 6</span></span>
<span class=giallo-l><span style=color:#8fbcbb>        Ok</span><span style=color:#eceff4>(</span><span>id</span><span style=color:#eceff4>)</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p><a href=https://github.com/helix-editor/helix/blob/0097e191bb9f9f144043c2afcf04bc8632021281/helix-view/src/editor.rs#L1310 rel=external>https://github.com/helix-editor/helix/blob/0097e191bb9f9f144043c2afcf04bc8632021281/helix-view/src/editor.rs#L1310</a><p><code>Document::open()</code>ã‹ã‚‰æˆ»ã£ã¦ãã¦ã€<code>self.new_document()</code>ãŒæ¬¡ã®å‡¦ç†ã§ã™ã€‚<h3 id=editor-new-document><a aria-label="Anchor link for: editor-new-document" class=zola-anchor href=#editor-new-document><code>Editor::new_document()</code></a></h3><pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>pub struct</span><span style=color:#8fbcbb> Editor</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#616e88>    // ...</span></span>
<span class=giallo-l><span style=color:#81a1c1>    pub</span><span> next_document_id</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> DocumentId</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#81a1c1>    pub</span><span> documents</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> BTreeMap</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>DocumentId</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> Document</span><span style=color:#eceff4>>,</span></span>
<span class=giallo-l><span style=color:#616e88>    // ...</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>impl</span><span style=color:#8fbcbb> Editor</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#616e88>    /// Generate an id for a new document and register it.</span></span>
<span class=giallo-l><span style=color:#81a1c1>    fn</span><span style=color:#88c0d0> new_document</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&mut self</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> mut</span><span> doc</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Document</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> DocumentId</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>        let</span><span> id</span><span style=color:#81a1c1> = self.</span><span>next_document_id</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#616e88>        // Safety: adding 1 from 1 is fine, probably impossible to reach usize max</span></span>
<span class=giallo-l><span style=color:#81a1c1>        self.</span><span>next_document_id </span><span style=color:#81a1c1>=</span></span>
<span class=giallo-l><span style=color:#88c0d0>            DocumentId</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>unsafe</span><span style=color:#eceff4> {</span><span> NonZeroUsize</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>new_unchecked</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>self.</span><span>next_document_id</span><span style=color:#81a1c1>.</span><span style=color:#b48ead>0</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>get</span><span style=color:#eceff4>()</span><span style=color:#81a1c1> +</span><span style=color:#b48ead> 1</span><span style=color:#eceff4>) });</span></span>
<span class=giallo-l><span>        doc</span><span style=color:#81a1c1>.</span><span>id </span><span style=color:#81a1c1>=</span><span> id</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>        self.</span><span>documents</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>insert</span><span style=color:#eceff4>(</span><span>id</span><span style=color:#eceff4>,</span><span> doc</span><span style=color:#eceff4>);</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#616e88>        // ...</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>        id</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p><a href=https://github.com/helix-editor/helix/blob/0097e191bb9f9f144043c2afcf04bc8632021281/helix-view/src/editor.rs#L1274 rel=external>https://github.com/helix-editor/helix/blob/0097e191bb9f9f144043c2afcf04bc8632021281/helix-view/src/editor.rs#L1274</a><p><code>Editor::new_document()</code>ã¯<code>DocumentId</code>ã‚’æ¡ç•ªã—ã¦ã€<code>Document</code>ã«setã—ãŸã®ã¡ã€<code>Editor</code>ã®<code>BTreeMap</code>ã«ä¿æŒã—ã¦ã„ã¾ã™ã€‚<br> ä»Šå›ã¯LSPã«ã¤ã„ã¦ã¯ãµã‚Œã¾ã›ã‚“ãŒã€ã“ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§language serverã‚’èµ·å‹•ã—ã¦ã„ã‚‹ã“ã¨ã‹ã‚‰ã€helixã§ã¯fileã‚’é–‹ã„ãŸéš›ã«åˆã‚ã¦fileã«å¯¾å¿œã™ã‚‹language serverã‚’èµ·å‹•ã—ã¦ã„ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚<br> <code>Editor::open()</code>ã®å‡¦ç†ã®ã†ã¡ã€<code>Documentã‚’</code>ç”Ÿæˆã—ã¦ã€<code>Editor</code>ã«ç™»éŒ²ã—ãŸã‚ã¨ã¯<code>Editor::switch()</code>ã‚’å®Ÿè¡Œã—ã¦çµ‚ã‚ã‚Šã§ã™ã€‚<br> ã¾ã <code>View</code>ãŒå‡ºã¦ãã¦ã„ãªã„ã®ã§ãŠãã‚‰ãã“ã®å‡¦ç†ã§ã€ç”Ÿæˆã—ãŸ<code>Editor</code>ã«å¯¾å¿œã™ã‚‹<code>View</code>ã‚’ä½œã‚‹ã®ã ã‚ã†ã¨ã„ã†ã“ã¨ãŒäºˆæƒ³ã§ãã¾ã™ã€‚<h3 id=editor-switch><a aria-label="Anchor link for: editor-switch" class=zola-anchor href=#editor-switch><code>Editor::switch()</code></a></h3><pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>pub struct</span><span style=color:#8fbcbb> Editor</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    pub</span><span> tree</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Tree</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#616e88>    // ...</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>impl</span><span style=color:#8fbcbb> Editor</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    pub fn</span><span style=color:#88c0d0> switch</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&mut self</span><span style=color:#eceff4>,</span><span> id</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> DocumentId</span><span style=color:#eceff4>,</span><span> action</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Action</span><span style=color:#eceff4>) {</span></span>
<span class=giallo-l><span style=color:#616e88>        // ...</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>        match</span><span> action</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#616e88>            // ...</span></span>
<span class=giallo-l><span style=color:#8fbcbb>            Action</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>HorizontalSplit</span><span style=color:#81a1c1> |</span><span style=color:#8fbcbb> Action</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>VerticalSplit</span><span style=color:#81a1c1> =></span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#616e88>                // copy the current view, unless there is no view yet</span></span>
<span class=giallo-l><span style=color:#81a1c1>                let</span><span> view</span><span style=color:#81a1c1> = self</span></span>
<span class=giallo-l><span style=color:#81a1c1>                    .</span><span>tree</span></span>
<span class=giallo-l><span style=color:#81a1c1>                    .</span><span style=color:#88c0d0>try_get</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>self.</span><span>tree</span><span style=color:#81a1c1>.</span><span>focus</span><span style=color:#eceff4>)</span></span>
<span class=giallo-l><span style=color:#81a1c1>                    .</span><span style=color:#88c0d0>filter</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>|</span><span>v</span><span style=color:#81a1c1>|</span><span> id</span><span style=color:#81a1c1> ==</span><span> v</span><span style=color:#81a1c1>.</span><span>doc</span><span style=color:#eceff4>)</span><span style=color:#616e88> // Different Document</span></span>
<span class=giallo-l><span style=color:#81a1c1>                    .</span><span style=color:#88c0d0>cloned</span><span style=color:#eceff4>()</span></span>
<span class=giallo-l><span style=color:#81a1c1>                    .</span><span style=color:#88c0d0>unwrap_or_else</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>||</span><span> View</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>new</span><span style=color:#eceff4>(</span><span>id</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> self.</span><span style=color:#88c0d0>config</span><span style=color:#eceff4>()</span><span style=color:#81a1c1>.</span><span>gutters</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>clone</span><span style=color:#eceff4>()));</span><span style=color:#616e88> // 1</span></span>
<span class=giallo-l><span style=color:#81a1c1>                let</span><span> view_id</span><span style=color:#81a1c1> = self.</span><span>tree</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>split</span><span style=color:#eceff4>(</span><span style=color:#616e88> // 2</span></span>
<span class=giallo-l><span>                    view</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#81a1c1>                    match</span><span> action</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span>                        Action</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>HorizontalSplit</span><span style=color:#81a1c1> =></span><span> Layout</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Horizontal</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>                        Action</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>VerticalSplit</span><span style=color:#81a1c1> =></span><span> Layout</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Vertical</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>                        _</span><span style=color:#81a1c1> =></span><span style=color:#88c0d0;font-weight:700> unreachable!</span><span style=color:#eceff4>(),</span></span>
<span class=giallo-l><span style=color:#eceff4>                    },</span></span>
<span class=giallo-l><span style=color:#eceff4>                );</span></span>
<span class=giallo-l><span style=color:#616e88>                // initialize selection for view</span></span>
<span class=giallo-l><span style=color:#81a1c1>                let</span><span> doc</span><span style=color:#81a1c1> =</span><span style=color:#88c0d0;font-weight:700> doc_mut!</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>self</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> &</span><span>id</span><span style=color:#eceff4>);</span><span style=color:#616e88> // 3</span></span>
<span class=giallo-l><span>                doc</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>ensure_view_init</span><span style=color:#eceff4>(</span><span>view_id</span><span style=color:#eceff4>);</span><span style=color:#616e88> // 4</span></span>
<span class=giallo-l><span style=color:#eceff4>            }</span></span>
<span class=giallo-l><span style=color:#eceff4>        }</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p><a href=https://github.com/helix-editor/helix/blob/0097e191bb9f9f144043c2afcf04bc8632021281/helix-view/src/editor.rs#L1180 rel=external>https://github.com/helix-editor/helix/blob/0097e191bb9f9f144043c2afcf04bc8632021281/helix-view/src/editor.rs#L1180</a><p>ãªã«ã‚„ã‚‰<code>View</code>ã‚’ç”Ÿæˆã—ã¦ã„ãã†ãªæ„Ÿã˜ãŒã‚ã‚Šã¾ã™ã€‚<ol><li>ã¾ãš<code>self.tree</code>ã¯<code>Tree</code>ã‚’å‚ç…§ã—ã¾ã™ã€‚ã“ã“ã§ã¯è©³ã—ãè¿°ã¹ã‚Œãªã„ã®ã§ã™ãŒ<code>View</code>ã‚’ç®¡ç†ã—ã¦ã„ã‚‹æœ¨æ§‹é€ ã§ã™ã€‚åŸºæœ¬çš„ã«æ–°ã—ã„<code>View</code>ã‚’ä½œã‚‹ã«ã¯ç¾åœ¨ã®windowã‚’åˆ†å‰²ã—ã¦ã„ãã®ã§ã€ã“ã‚Œã‚’æœ¨æ§‹é€ ã§è¡¨ç¾ã—ã¦ã„ã¾ã™ã€‚ç¾åœ¨ã®å‡¦ç†ã§ã¯<code>unwrap_or_else()</code>ã®elseã«å…¥ã£ã¦<code>View::new()</code>ãŒå‘¼ã°ã‚Œã¾ã™ã€‚<li>ç”Ÿæˆã—ãŸ<code>View</code>ã‚’<code>Tree</code>ã«ç™»éŒ²ã—ã¾ã™ã€‚<li><code>doc_mut!()</code>ã¯<code>Editor</code>ã‹ã‚‰<code>DocumentId</code>ã«å¯¾å¿œã™ã‚‹<code>Document</code>ã‚’å–å¾—ã™ã‚‹helper macroã§ã™ã€‚<li>cursorã‚’fileã®å…ˆé ­ã«setã™ã‚‹å‡¦ç†ã¨ã„ã†ç†è§£ã§å¤§ä¸ˆå¤«ã§ã™ã€‚</ol><pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#5e81ac>#[derive(</span><span style=color:#8fbcbb>Clone</span><span style=color:#5e81ac>)]</span></span>
<span class=giallo-l><span style=color:#81a1c1>pub struct</span><span style=color:#8fbcbb> View</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    pub</span><span> id</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> ViewId</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#81a1c1>    pub</span><span> offset</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> ViewPosition</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#81a1c1>    pub</span><span> area</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Rect</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#81a1c1>    pub</span><span> doc</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> DocumentId</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#81a1c1>    pub</span><span> gutters</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> GutterConfig</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#616e88>    // ...</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>impl</span><span style=color:#8fbcbb> View</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    pub fn</span><span style=color:#88c0d0> new</span><span style=color:#eceff4>(</span><span>doc</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> DocumentId</span><span style=color:#eceff4>,</span><span> gutters</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> GutterConfig</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -> Self</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>        Self</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span>            id</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> ViewId</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>default</span><span style=color:#eceff4>(),</span></span>
<span class=giallo-l><span>            doc</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>            offset</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> ViewPosition</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span>                anchor</span><span style=color:#81a1c1>:</span><span style=color:#b48ead> 0</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>                horizontal_offset</span><span style=color:#81a1c1>:</span><span style=color:#b48ead> 0</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>                vertical_offset</span><span style=color:#81a1c1>:</span><span style=color:#b48ead> 0</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#eceff4>            },</span></span>
<span class=giallo-l><span>            area</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Rect</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>default</span><span style=color:#eceff4>(),</span><span style=color:#616e88> // will get calculated upon inserting into tree</span></span>
<span class=giallo-l><span>            gutters</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#eceff4>        }</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p><code>View</code>ã¯ä¸Šè¨˜ã®ã‚ˆã†ã«å®šç¾©ã•ã‚Œã¦ã„ã¾ã™ã€‚ã‚‚ã£ã¨å¤šãã®fieldãŒå®Ÿéš›ã«ã¯ã‚ã‚Šã¾ã™ãŒã€æœ¬è¨˜äº‹ã§é–¢é€£ã™ã‚‹fieldã¯ä¸Šè¨˜ã§ã™ã€‚<br> <code>offset: ViewPosition</code>ã¯<code>Document</code>ã®ã©ã“ã‚’è¦‹ã¦ã„ã‚‹ã‹ã‚’è¡¨ã™structã§ã™ã€‚<br> <code>area: Rect</code>ã¯terminalã«æç”»ã•ã‚Œã‚‹ç¯„å›²ã§ã™ã€‚ä»Šã¿ã¦ã„ã‚‹<code>View</code>ã‚’vertical/horizonã©ã¡ã‚‰ã§åˆ†å‰²ã™ã‚‹ã‹ã§å¤‰ã‚ã£ã¦ãã‚‹ã®ã§ã€ç”Ÿæˆæ™‚ã«ã¯ã‚ã‹ã‚‰ãš<code>Tree</code>ã«insertã•ã‚Œã‚‹éš›ã«è¨ˆç®—ã•ã‚Œã‚‹ã¨ã„ã†ã“ã¨ãŒã‚³ãƒ¡ãƒ³ãƒˆã«æ›¸ã„ã¦ã‚ã‚Šã¾ã™ã€‚<p><code>self.tree.split()</code>ã¯<code>helix-view::Tree</code>ã«<code>View</code>ã‚’ç™»éŒ²ã™ã‚‹å‡¦ç†ã§ã™ã€‚<code>Tree</code>ã®å®Ÿè£…ã‚‚ãŠã‚‚ã—ã‚ã„ã®ã§ã™ãŒrenderingã®è©±ã‹ã‚‰é€¸ã‚Œã‚‹ã®ã§ã€Viewã®åˆ†å‰²ã‚’è¡¨ç¾ã—ãŸãƒ‡ãƒ¼ã‚¿æ§‹é€ ã«ç™»éŒ²ã™ã‚‹ãã‚‰ã„ã®ç†è§£ã§æ¬¡ã«ã„ãã¾ã™ã€‚<p>ã‚ã‚‰ãŸã‚ã¦ç¾åœ¨ä½ç½®ã‚’æŒ¯ã‚Šè¿”ã‚‹ã¨ã€ä»Šã¯<code>Application::new()</code>ã®ä¸­ã§è¡Œã‚ã‚Œã¦ã„ã‚‹å¼•æ•°ã®fileã‚’å‡¦ç†ã™ã‚‹ç®‡æ‰€ã‚’ç¢ºèªã—ã¦ã„ã¾ã—ãŸã€‚<br> ã©ã†ã—ã¦ãã®å‡¦ç†ã‚’ç¢ºèªã—ã¦ã„ãŸã‹ã¨ã„ã†ã¨ã€<code>Application</code> -> <code>Compositor</code> -> <code>EditorView</code>ã¨ã‚ˆã°ã‚ŒãŸ<code>render()</code>ã®ä¸­ã§ã€ä¸‹è¨˜ã®ã‚ˆã†ã«<code>editor.tree.views()</code>ã§<code>View</code>ãŒiterateã•ã‚Œã¦ã„ã‚‹ãŒã“ã‚ŒãŒã©ã“ç”Ÿæˆã•ã‚ŒãŸã‹ã‚’ç¢ºèªã™ã‚‹ãŸã‚ã§ã—ãŸã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>impl</span><span style=color:#8fbcbb> Component</span><span style=color:#81a1c1> for</span><span style=color:#8fbcbb> EditorView</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    fn</span><span style=color:#88c0d0> render</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&mut self</span><span style=color:#eceff4>,</span><span> area</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Rect</span><span style=color:#eceff4>,</span><span> surface</span><span style=color:#81a1c1>: &mut</span><span style=color:#8fbcbb> Surface</span><span style=color:#eceff4>,</span><span> cx</span><span style=color:#81a1c1>: &mut</span><span style=color:#8fbcbb> Context</span><span style=color:#eceff4>) {</span></span>
<span class=giallo-l><span style=color:#616e88>        // clear with background color</span></span>
<span class=giallo-l><span>        surface</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>set_style</span><span style=color:#eceff4>(</span><span>area</span><span style=color:#eceff4>,</span><span> cx</span><span style=color:#81a1c1>.</span><span>editor</span><span style=color:#81a1c1>.</span><span>theme</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>get</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>ui.background</span><span style=color:#eceff4>"));</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#616e88>        // -1 for commandline and -1 for bufferline</span></span>
<span class=giallo-l><span style=color:#81a1c1>        let mut</span><span> editor_area</span><span style=color:#81a1c1> =</span><span> area</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>clip_bottom</span><span style=color:#eceff4>(</span><span style=color:#b48ead>1</span><span style=color:#eceff4>);</span><span> </span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>        for</span><span style=color:#eceff4> (</span><span>view</span><span style=color:#eceff4>,</span><span> is_focused</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> in</span><span> cx</span><span style=color:#81a1c1>.</span><span>editor</span><span style=color:#81a1c1>.</span><span>tree</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>views</span><span style=color:#eceff4>() {</span><span style=color:#616e88> // ğŸ‘ˆ</span></span>
<span class=giallo-l><span style=color:#81a1c1>            let</span><span> doc</span><span style=color:#81a1c1> =</span><span> cx</span><span style=color:#81a1c1>.</span><span>editor</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>document</span><span style=color:#eceff4>(</span><span>view</span><span style=color:#81a1c1>.</span><span>doc</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>unwrap</span><span style=color:#eceff4>();</span><span style=color:#616e88>  // 1</span></span>
<span class=giallo-l><span style=color:#81a1c1>            self.</span><span style=color:#88c0d0>render_view</span><span style=color:#eceff4>(</span><span>cx</span><span style=color:#81a1c1>.</span><span>editor</span><span style=color:#eceff4>,</span><span> doc</span><span style=color:#eceff4>,</span><span> view</span><span style=color:#eceff4>,</span><span> area</span><span style=color:#eceff4>,</span><span> surface</span><span style=color:#eceff4>,</span><span> is_focused</span><span style=color:#eceff4>);</span><span> </span></span>
<span class=giallo-l><span style=color:#eceff4>        }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#616e88>        // ...</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p><a href=https://github.com/helix-editor/helix/blob/0097e191bb9f9f144043c2afcf04bc8632021281/helix-term/src/ui/editor.rs#L1359 rel=external>https://github.com/helix-editor/helix/blob/0097e191bb9f9f144043c2afcf04bc8632021281/helix-term/src/ui/editor.rs#L1359</a><p>ã¨ã„ã†ã“ã¨ã§ã€<code>cx.editor.tree.views()</code>ã§iterateã•ã‚Œã‚‹<code>view</code>ã¯<code>hx ./Cargo.toml</code>ã§èµ·å‹•æ™‚ã«æ¸¡ã—ãŸfileã«å¯¾å¿œã™ã‚‹<code>View</code>ã§ã‚ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã—ãŸã€‚<ol><li>ã®<code>editor.document()</code>ã¯<code>View</code>ã«å¯¾å¿œã™ã‚‹<code>Document</code>ã‚’å–å¾—ã™ã‚‹å‡¦ç†ã§ã™ã€‚<code>View</code>ã¯<code>DocumentId</code>ã‚’ä¿æŒã—ã¦ãŠã‚Šã€<code>Editor</code>ã¯<code>Document</code>ã‚’<code>BTreeMap&lt;DocumentId, Document></code>ã§ç®¡ç†ã—ã¦ã„ã‚‹ã®ã§ã€å¯¾å¿œã™ã‚‹<code>Document</code>ã¯å¸¸ã«å–å¾—ã§ãã¾ã™ã€‚<br> <code>is_forcused</code>ã¯trueãŒå…¥ã£ã¦ã„ã¾ã™ã€‚</ol><h2 id=editorview-reder-view><a aria-label="Anchor link for: editorview-reder-view" class=zola-anchor href=#editorview-reder-view><code>EditorView::reder_view()</code></a></h2><p>ã„ã‚ˆã„ã‚ˆrederingå‡¦ç†ã®å®Ÿè³ªçš„ãªå‡¦ç†ã«è¿‘ã¥ã„ã¦ãã¾ã—ãŸã€‚<br> å®Ÿéš›ã®å‡¦ç†ã§ã¯ã‚‚ã£ã¨è‰²ã€…ãªã“ã¨ã‚’ã‚„ã£ã¦ã„ã¾ã™ãŒã€ã“ã“ã§æŠ‘ãˆãŸã„ã®ã¯ã€syntaxã‚„selectionã®æƒ…å ±ã‹ã‚‰<code>Box&lt;dyn Iterator&lt;Item = HighlightEvent>></code>ã‚’ç”Ÿæˆã—ã¦ã„ã‚‹ã¨ã„ã†ç‚¹ã§ã™ã€‚<br> Helixã«ãŠã„ã¦syntax highlightã‚„cursor, selectionãŒã©ã®ã‚ˆã†ã«renderingã•ã‚Œã¦ã„ã‚‹ã‹ãŒä»Šå›ä¼ãˆãŸã„ãŠã‚‚ã—ã‚ã„ç®‡æ‰€ãªã®ã§ã€ã“ã“ã¯å¾Œã§ç´°ã‹ããµã‚Œã¾ã™ã€‚<br> ã¾ãŸã€æ®‹å¿µãªãŒã‚‰<code>text_annotations</code>ã‚„<code>LineDecoration</code>, <code>TranslatedPosition</code>ã«ã¯ãµã‚Œã¾ã›ã‚“ã€‚<br> ç†ç”±ã¨ã—ã¦ã¯ã“ã‚Œã‚’ãªã—ã«ã—ã¦ã‚‚æœ¬è¨˜äº‹ãŒååˆ†é•·ããªã‚‹ã“ã¨ã«åŠ ãˆã¦ã€è‡ªåˆ†ã‚‚ã¾ã ç†è§£ã—ãã‚Œã¦ãŠã‚‰ãšã€LSPã®è©±ã‚’ã—ãŸã‚ã¨ã®ã»ã†ãŒã‚ã‹ã‚Šã‚„ã™ã„ã‹ãªã¨æ€ã£ãŸã‹ã‚‰ã§ã™ã€‚<br> (rederingå‡¦ç†ã®ç†è§£ã«ãŠã„ã¦ã“ã“ã¯é¿ã‘ã¦ã¯é€šã‚Œãªã„ç®‡æ‰€ãªã®ã§ã„ãšã‚Œæˆ»ã£ã¦ããŸã„)<p>ã¨ã„ã†ã“ã¨ã§æ¬¡ã¯<code>reder_document()</code>ã§ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>impl</span><span style=color:#8fbcbb> EditorView</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    pub fn</span><span style=color:#88c0d0> render_view</span><span style=color:#eceff4>(</span></span>
<span class=giallo-l><span style=color:#81a1c1>        &self</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>        editor</span><span style=color:#81a1c1>: &</span><span style=color:#8fbcbb>Editor</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>        doc</span><span style=color:#81a1c1>: &</span><span style=color:#8fbcbb>Document</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>        view</span><span style=color:#81a1c1>: &</span><span style=color:#8fbcbb>View</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>        viewport</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Rect</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>        surface</span><span style=color:#81a1c1>: &mut</span><span style=color:#8fbcbb> Surface</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>        is_focused</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> bool</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#eceff4>    ) {</span></span>
<span class=giallo-l><span style=color:#81a1c1>        let</span><span> inner</span><span style=color:#81a1c1> =</span><span> view</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>inner_area</span><span style=color:#eceff4>(</span><span>doc</span><span style=color:#eceff4>);</span></span>
<span class=giallo-l><span style=color:#81a1c1>        let</span><span> area</span><span style=color:#81a1c1> =</span><span> view</span><span style=color:#81a1c1>.</span><span>area</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>        let</span><span> theme</span><span style=color:#81a1c1> = &</span><span>editor</span><span style=color:#81a1c1>.</span><span>theme</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>        let</span><span> config</span><span style=color:#81a1c1> =</span><span> editor</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>config</span><span style=color:#eceff4>();</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>        let</span><span> text_annotations</span><span style=color:#81a1c1> =</span><span> view</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>text_annotations</span><span style=color:#eceff4>(</span><span>doc</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> Some</span><span style=color:#eceff4>(</span><span>theme</span><span style=color:#eceff4>));</span></span>
<span class=giallo-l><span style=color:#81a1c1>        let mut</span><span> line_decorations</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Vec</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Box</span><span style=color:#eceff4>&lt;</span><span style=color:#81a1c1>dyn</span><span style=color:#8fbcbb> LineDecoration</span><span style=color:#eceff4>>></span><span style=color:#81a1c1> =</span><span style=color:#8fbcbb> Vec</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>new</span><span style=color:#eceff4>();</span></span>
<span class=giallo-l><span style=color:#81a1c1>        let mut</span><span> translated_positions</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Vec</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>TranslatedPosition</span><span style=color:#eceff4>></span><span style=color:#81a1c1> =</span><span style=color:#8fbcbb> Vec</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>new</span><span style=color:#eceff4>();</span></span>
<span class=giallo-l></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>        let mut</span><span> highlights</span><span style=color:#81a1c1> =</span></span>
<span class=giallo-l><span style=color:#81a1c1>            Self::</span><span style=color:#88c0d0>doc_syntax_highlights</span><span style=color:#eceff4>(</span><span>doc</span><span style=color:#eceff4>,</span><span> view</span><span style=color:#81a1c1>.</span><span>offset</span><span style=color:#81a1c1>.</span><span>anchor</span><span style=color:#eceff4>,</span><span> inner</span><span style=color:#81a1c1>.</span><span>height</span><span style=color:#eceff4>,</span><span> theme</span><span style=color:#eceff4>);</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>        let</span><span> highlights</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Box</span><span style=color:#eceff4>&lt;</span><span style=color:#81a1c1>dyn</span><span style=color:#8fbcbb> Iterator</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Item</span><span style=color:#81a1c1> =</span><span style=color:#8fbcbb> HighlightEvent</span><span style=color:#eceff4>>></span><span style=color:#81a1c1> = if</span><span> is_focused</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>            let</span><span> highlights</span><span style=color:#81a1c1> =</span><span> syntax</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>merge</span><span style=color:#eceff4>(</span></span>
<span class=giallo-l><span>                highlights</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#81a1c1>                Self::</span><span style=color:#88c0d0>doc_selection_highlights</span><span style=color:#eceff4>(</span></span>
<span class=giallo-l><span>                    editor</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>mode</span><span style=color:#eceff4>(),</span></span>
<span class=giallo-l><span>                    doc</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>                    view</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>                    theme</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#81a1c1>                    &</span><span>config</span><span style=color:#81a1c1>.</span><span>cursor_shape</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#eceff4>                ),</span></span>
<span class=giallo-l><span style=color:#eceff4>            );</span></span>
<span class=giallo-l><span style=color:#eceff4>        }</span><span style=color:#81a1c1> else</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#8fbcbb>            Box</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>new</span><span style=color:#eceff4>(</span><span>highlights</span><span style=color:#eceff4>)</span></span>
<span class=giallo-l><span style=color:#eceff4>        };</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#88c0d0>        render_document</span><span style=color:#eceff4>(</span></span>
<span class=giallo-l><span>            surface</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>            inner</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>            doc</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>            view</span><span style=color:#81a1c1>.</span><span>offset</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#81a1c1>            &</span><span>text_annotations</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>            highlights</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>            theme</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#81a1c1>            &mut</span><span> line_decorations</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#81a1c1>            &mut</span><span> translated_positions</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#eceff4>        );</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#616e88>        // ...</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p><a href=https://github.com/helix-editor/helix/blob/0097e191bb9f9f144043c2afcf04bc8632021281/helix-term/src/ui/editor.rs#L78 rel=external>https://github.com/helix-editor/helix/blob/0097e191bb9f9f144043c2afcf04bc8632021281/helix-term/src/ui/editor.rs#L78</a><h3 id=reder-document><a aria-label="Anchor link for: reder-document" class=zola-anchor href=#reder-document><code>reder_document()</code></a></h3><pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>pub fn</span><span style=color:#88c0d0> render_document</span><span style=color:#eceff4>(</span></span>
<span class=giallo-l><span>    surface</span><span style=color:#81a1c1>: &mut</span><span style=color:#8fbcbb> Surface</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>    viewport</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Rect</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>    doc</span><span style=color:#81a1c1>: &</span><span style=color:#8fbcbb>Document</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>    offset</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> ViewPosition</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>    doc_annotations</span><span style=color:#81a1c1>: &</span><span style=color:#8fbcbb>TextAnnotations</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>    highlight_iter</span><span style=color:#81a1c1>: impl</span><span style=color:#8fbcbb> Iterator</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Item</span><span style=color:#81a1c1> =</span><span style=color:#8fbcbb> HighlightEvent</span><span style=color:#eceff4>>,</span></span>
<span class=giallo-l><span>    theme</span><span style=color:#81a1c1>: &</span><span style=color:#8fbcbb>Theme</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>    line_decoration</span><span style=color:#81a1c1>: &mut</span><span style=color:#eceff4> [</span><span style=color:#8fbcbb>Box</span><span style=color:#eceff4>&lt;</span><span style=color:#81a1c1>dyn</span><span style=color:#8fbcbb> LineDecoration</span><span style=color:#81a1c1> +</span><span style=color:#eceff4> '</span><span style=color:#8fbcbb>_</span><span style=color:#eceff4>>],</span></span>
<span class=giallo-l><span>    translated_positions</span><span style=color:#81a1c1>: &mut</span><span style=color:#eceff4> [</span><span style=color:#8fbcbb>TranslatedPosition</span><span style=color:#eceff4>],</span></span>
<span class=giallo-l><span style=color:#eceff4>) {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    let mut</span><span> renderer</span><span style=color:#81a1c1> =</span><span style=color:#8fbcbb> TextRenderer</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>new</span><span style=color:#eceff4>(</span><span>surface</span><span style=color:#eceff4>,</span><span> doc</span><span style=color:#eceff4>,</span><span> theme</span><span style=color:#eceff4>,</span><span> offset</span><span style=color:#81a1c1>.</span><span>horizontal_offset</span><span style=color:#eceff4>,</span><span> viewport</span><span style=color:#eceff4>);</span></span>
<span class=giallo-l><span style=color:#88c0d0>    render_text</span><span style=color:#eceff4>(</span></span>
<span class=giallo-l><span style=color:#81a1c1>        &mut</span><span> renderer</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>        doc</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>text</span><span style=color:#eceff4>()</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>slice</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>..</span><span style=color:#eceff4>),</span></span>
<span class=giallo-l><span>        offset</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#81a1c1>        &</span><span>doc</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>text_format</span><span style=color:#eceff4>(</span><span>viewport</span><span style=color:#81a1c1>.</span><span>width</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> Some</span><span style=color:#eceff4>(</span><span>theme</span><span style=color:#eceff4>)),</span></span>
<span class=giallo-l><span>        doc_annotations</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>        highlight_iter</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>        theme</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>        line_decoration</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>        translated_positions</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#eceff4>    )</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p><a href=https://github.com/helix-editor/helix/blob/0097e191bb9f9f144043c2afcf04bc8632021281/helix-term/src/ui/document.rs#L94 rel=external>https://github.com/helix-editor/helix/blob/0097e191bb9f9f144043c2afcf04bc8632021281/helix-term/src/ui/document.rs#L94</a><p>ã“ã“ã¯ã»ã¼å§”è­²ã—ã¦ã„ã‚‹ã ã‘ã§ã™ã€‚<br> <code>TextRenderer</code>ã¯ä½¿ã†éš›ã«è¦‹ã¦ã„ãã¾ã™ã€‚<h3 id=render-text><a aria-label="Anchor link for: render-text" class=zola-anchor href=#render-text><code>render_text()</code></a></h3><p><code>render_text()</code>ã«ã¦ã¤ã„ã«bufferã¸ã®æ›¸ãè¾¼ã¿ã‚’è¡Œã„ã¾ã™ã€‚<p>ã¾ãšå¼•æ•°ã«ã¤ã„ã¦ã§ã™<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>pub fn</span><span style=color:#88c0d0> render_text</span><span style=color:#eceff4>&lt;'</span><span style=color:#8fbcbb>t</span><span style=color:#eceff4>>(</span></span>
<span class=giallo-l><span>    renderer</span><span style=color:#81a1c1>: &mut</span><span style=color:#8fbcbb> TextRenderer</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>    text</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> RopeSlice</span><span style=color:#eceff4>&lt;'</span><span style=color:#8fbcbb>t</span><span style=color:#eceff4>>,</span></span>
<span class=giallo-l><span>    offset</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> ViewPosition</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>    text_fmt</span><span style=color:#81a1c1>: &</span><span style=color:#8fbcbb>TextFormat</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>    text_annotations</span><span style=color:#81a1c1>: &</span><span style=color:#8fbcbb>TextAnnotations</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>    highlight_iter</span><span style=color:#81a1c1>: impl</span><span style=color:#8fbcbb> Iterator</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Item</span><span style=color:#81a1c1> =</span><span style=color:#8fbcbb> HighlightEvent</span><span style=color:#eceff4>>,</span></span>
<span class=giallo-l><span>    theme</span><span style=color:#81a1c1>: &</span><span style=color:#8fbcbb>Theme</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>    line_decorations</span><span style=color:#81a1c1>: &mut</span><span style=color:#eceff4> [</span><span style=color:#8fbcbb>Box</span><span style=color:#eceff4>&lt;</span><span style=color:#81a1c1>dyn</span><span style=color:#8fbcbb> LineDecoration</span><span style=color:#81a1c1> +</span><span style=color:#eceff4> '</span><span style=color:#8fbcbb>_</span><span style=color:#eceff4>>],</span></span>
<span class=giallo-l><span>    translated_positions</span><span style=color:#81a1c1>: &mut</span><span style=color:#eceff4> [</span><span style=color:#8fbcbb>TranslatedPosition</span><span style=color:#eceff4>],</span></span>
<span class=giallo-l><span style=color:#eceff4>) {</span><span style=color:#616e88> /* ... */</span><span style=color:#eceff4> }</span></span></code></pre><p><code>TextRenderer</code>ã¯renderingæ™‚ã®contextã¨å„ç¨®è¨­å®šã‚’ä¿æŒã—ã¦ã„ã¾ã™ã€‚å…·ä½“çš„ã«ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«å®šç¾©ã•ã‚Œã¦ã„ã¾ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#5e81ac>#[derive(</span><span style=color:#8fbcbb>Debug</span><span style=color:#5e81ac>)]</span></span>
<span class=giallo-l><span style=color:#81a1c1>pub struct</span><span style=color:#8fbcbb> TextRenderer</span><span style=color:#eceff4>&lt;'</span><span style=color:#8fbcbb>a</span><span style=color:#eceff4>> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    pub</span><span> surface</span><span style=color:#81a1c1>: &</span><span style=color:#eceff4>'</span><span style=color:#8fbcbb>a</span><span style=color:#81a1c1> mut</span><span style=color:#8fbcbb> Surface</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#81a1c1>    pub</span><span> text_style</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Style</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#81a1c1>    pub</span><span> whitespace_style</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Style</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#81a1c1>    pub</span><span> indent_guide_char</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> String</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#81a1c1>    pub</span><span> indent_guide_style</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Style</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#81a1c1>    pub</span><span> newline</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> String</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#81a1c1>    pub</span><span> nbsp</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> String</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#81a1c1>    pub</span><span> space</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> String</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#81a1c1>    pub</span><span> tab</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> String</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#81a1c1>    pub</span><span> virtual_tab</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> String</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#81a1c1>    pub</span><span> indent_width</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> u16</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#81a1c1>    pub</span><span> starting_indent</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> usize</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#81a1c1>    pub</span><span> draw_indent_guides</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> bool</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#81a1c1>    pub</span><span> col_offset</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> usize</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#81a1c1>    pub</span><span> viewport</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Rect</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p><a href=https://github.com/helix-editor/helix/blob/0097e191bb9f9f144043c2afcf04bc8632021281/helix-term/src/ui/document.rs#L307 rel=external>https://github.com/helix-editor/helix/blob/0097e191bb9f9f144043c2afcf04bc8632021281/helix-term/src/ui/document.rs#L307</a><p><code>text: RopeSlice&lt;'t></code>ã¯renderingå¯¾è±¡ã®textã§ã™ã€‚ <code>RopeSlice</code>ã¯<a href=https://docs.rs/ropey/latest/ropey/struct.RopeSlice.html rel=external>doc</a>ã«ã‚ã‚‹é€šã‚Šã€An immutable view into part of a Rope ã§ã™ã€‚<br> <code>offset: ViewPosition</code>ã¯<code>Document</code>ã®ã†ã¡ç¾åœ¨ã®<code>View</code>ãŒè¡¨ç¤ºã—ã¦ã„ã‚‹ç¯„å›²ã«ã¤ã„ã¦ã®æƒ…å ±ã§ã™ã€‚scrollã™ã‚‹ã¨ã“ã“ãŒå¤‰ã‚ã‚Šã¾ã™ã€‚<br> <code>text_fmt: &TextFormat</code>ã¨<code>text_annotations: &TextAnnotations</code>ã¯ä»Šå›ã¯æ°—ã«ã—ãªãã¦ã‚ˆã„ã§ã™ã€‚<br> <code>highlight_iter: impl Iterator&lt;Item = HighlightEvent></code>ã¯ã•ãã»ã©ãµã‚ŒãŸã€syntax highlightã‚„cursorã®æƒ…å ±ã‚’iterateã—ã¦ãã‚Œã¾ã™ã€‚<code>redner_text()</code>ã§ã“ã®æƒ…å ±ã‚’renderingã™ã‚‹éš›ã«é©ç”¨ã™ã‚‹styleã«å¤‰æ›ã—ã¾ã™ã€‚<br> <code>theme: &Theme</code>ã¯é©ç”¨ã™ã‚‹themeã§ã™ã€‚<br> <code>line_decorations: &mut [Box&lt;dyn LineDecorations + '_]</code>ã¨<code>translated_positions: &mut [TranslatedPosition]</code>ã‚‚é£›ã°ã—ã¾ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>pub fn</span><span style=color:#88c0d0> render_text</span><span style=color:#eceff4>&lt;'</span><span style=color:#8fbcbb>t</span><span style=color:#eceff4>>(</span></span>
<span class=giallo-l><span>    renderer</span><span style=color:#81a1c1>: &mut</span><span style=color:#8fbcbb> TextRenderer</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>    text</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> RopeSlice</span><span style=color:#eceff4>&lt;'</span><span style=color:#8fbcbb>t</span><span style=color:#eceff4>>,</span></span>
<span class=giallo-l><span>    offset</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> ViewPosition</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>    text_fmt</span><span style=color:#81a1c1>: &</span><span style=color:#8fbcbb>TextFormat</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>    text_annotations</span><span style=color:#81a1c1>: &</span><span style=color:#8fbcbb>TextAnnotations</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>    highlight_iter</span><span style=color:#81a1c1>: impl</span><span style=color:#8fbcbb> Iterator</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Item</span><span style=color:#81a1c1> =</span><span style=color:#8fbcbb> HighlightEvent</span><span style=color:#eceff4>>,</span></span>
<span class=giallo-l><span>    theme</span><span style=color:#81a1c1>: &</span><span style=color:#8fbcbb>Theme</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>    line_decorations</span><span style=color:#81a1c1>: &mut</span><span style=color:#eceff4> [</span><span style=color:#8fbcbb>Box</span><span style=color:#eceff4>&lt;</span><span style=color:#81a1c1>dyn</span><span style=color:#8fbcbb> LineDecoration</span><span style=color:#81a1c1> +</span><span style=color:#eceff4> '</span><span style=color:#8fbcbb>_</span><span style=color:#eceff4>>],</span></span>
<span class=giallo-l><span>    translated_positions</span><span style=color:#81a1c1>: &mut</span><span style=color:#eceff4> [</span><span style=color:#8fbcbb>TranslatedPosition</span><span style=color:#eceff4>],</span></span>
<span class=giallo-l><span style=color:#eceff4>) {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    let</span><span style=color:#eceff4> (</span></span>
<span class=giallo-l><span style=color:#8fbcbb>        Position</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span>            row</span><span style=color:#81a1c1>: mut</span><span> row_off</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> ..</span></span>
<span class=giallo-l><span style=color:#eceff4>        },</span></span>
<span class=giallo-l><span style=color:#81a1c1>        mut</span><span> char_pos</span><span style=color:#eceff4>,</span><span style=color:#616e88> // 1</span></span>
<span class=giallo-l><span style=color:#eceff4>    )</span><span style=color:#81a1c1> =</span><span style=color:#88c0d0> visual_offset_from_block</span><span style=color:#eceff4>(</span></span>
<span class=giallo-l><span>        text</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>        offset</span><span style=color:#81a1c1>.</span><span>anchor</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>        offset</span><span style=color:#81a1c1>.</span><span>anchor</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>        text_fmt</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>        text_annotations</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#eceff4>    );</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>    let</span><span style=color:#eceff4> (</span><span style=color:#81a1c1>mut</span><span> formatter</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> mut</span><span> first_visible_char_idx</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> =</span></span>
<span class=giallo-l><span style=color:#8fbcbb>        DocumentFormatter</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>new_at_prev_checkpoint</span><span style=color:#eceff4>(</span><span>text</span><span style=color:#eceff4>,</span><span> text_fmt</span><span style=color:#eceff4>,</span><span> text_annotations</span><span style=color:#eceff4>,</span><span> offset</span><span style=color:#81a1c1>.</span><span>anchor</span><span style=color:#eceff4>);</span><span style=color:#616e88> // 2</span></span>
<span class=giallo-l><span style=color:#81a1c1>    let mut</span><span> styles</span><span style=color:#81a1c1> =</span><span style=color:#8fbcbb> StyleIter</span><span style=color:#eceff4> {</span><span style=color:#616e88> // 3</span></span>
<span class=giallo-l><span>        text_style</span><span style=color:#81a1c1>:</span><span> renderer</span><span style=color:#81a1c1>.</span><span>text_style</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>        active_highlights</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Vec</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>with_capacity</span><span style=color:#eceff4>(</span><span style=color:#b48ead>64</span><span style=color:#eceff4>),</span></span>
<span class=giallo-l><span>        highlight_iter</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>        theme</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#eceff4>    };</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>    let mut</span><span> style_span</span><span style=color:#81a1c1> =</span><span> styles</span><span style=color:#616e88> // 4</span></span>
<span class=giallo-l><span style=color:#81a1c1>        .</span><span style=color:#88c0d0>next</span><span style=color:#eceff4>()</span></span>
<span class=giallo-l><span style=color:#81a1c1>        .</span><span style=color:#88c0d0>unwrap_or_else</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>||</span><span style=color:#eceff4> (</span><span>Style</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>default</span><span style=color:#eceff4>(),</span><span> usize</span><span style=color:#81a1c1>::</span><span>MAX</span><span style=color:#eceff4>));</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>    loop</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>        let</span><span style=color:#8fbcbb> Some</span><span style=color:#eceff4>((</span><span>grapheme</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> mut</span><span> pos</span><span style=color:#eceff4>))</span><span style=color:#81a1c1> =</span><span> formatter</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>next</span><span style=color:#eceff4>()</span><span style=color:#81a1c1> else</span><span style=color:#eceff4> {</span><span style=color:#616e88> // 5</span></span>
<span class=giallo-l><span style=color:#616e88>            // ...</span></span>
<span class=giallo-l><span style=color:#81a1c1>            break</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#eceff4>        };</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#616e88>        // if the end of the viewport is reached stop rendering</span></span>
<span class=giallo-l><span style=color:#81a1c1>        if</span><span> pos</span><span style=color:#81a1c1>.</span><span>row </span><span style=color:#81a1c1>as</span><span style=color:#8fbcbb> u16</span><span style=color:#81a1c1> >=</span><span> renderer</span><span style=color:#81a1c1>.</span><span>viewport</span><span style=color:#81a1c1>.</span><span>height </span><span style=color:#eceff4>{</span><span style=color:#616e88> // 6</span></span>
<span class=giallo-l><span style=color:#81a1c1>            break</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#eceff4>        }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#616e88>        // acquire the correct grapheme style</span></span>
<span class=giallo-l><span style=color:#81a1c1>        if</span><span> char_pos</span><span style=color:#81a1c1> >=</span><span> style_span</span><span style=color:#81a1c1>.</span><span style=color:#b48ead>1</span><span style=color:#eceff4> {</span><span style=color:#616e88> // 7</span></span>
<span class=giallo-l><span>            style_span</span><span style=color:#81a1c1> =</span><span> styles</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>next</span><span style=color:#eceff4>()</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>unwrap_or</span><span style=color:#eceff4>((</span><span>Style</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>default</span><span style=color:#eceff4>(),</span><span> usize</span><span style=color:#81a1c1>::</span><span>MAX</span><span style=color:#eceff4>));</span></span>
<span class=giallo-l><span style=color:#eceff4>        }</span></span>
<span class=giallo-l><span>        char_pos</span><span style=color:#81a1c1> +=</span><span> grapheme</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>doc_chars</span><span style=color:#eceff4>();</span><span style=color:#616e88> // 8</span></span>
<span class=giallo-l></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>        let</span><span> grapheme_style</span><span style=color:#81a1c1> = if let</span><span style=color:#8fbcbb> GraphemeSource</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>VirtualText</span><span style=color:#eceff4> {</span><span> highlight</span><span style=color:#eceff4> }</span><span style=color:#81a1c1> =</span><span> grapheme</span><span style=color:#81a1c1>.</span><span>source </span><span style=color:#eceff4>{</span><span style=color:#616e88> // 9</span></span>
<span class=giallo-l><span style=color:#616e88>            // ...</span></span>
<span class=giallo-l><span style=color:#eceff4>        }</span><span style=color:#81a1c1> else</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span>            style_span</span><span style=color:#81a1c1>.</span><span style=color:#b48ead>0</span></span>
<span class=giallo-l><span style=color:#eceff4>        };</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>        let</span><span> virt</span><span style=color:#81a1c1> =</span><span> grapheme</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>is_virtual</span><span style=color:#eceff4>();</span><span> </span></span>
<span class=giallo-l><span>        renderer</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>draw_grapheme</span><span style=color:#eceff4>(</span><span style=color:#616e88> // 10</span></span>
<span class=giallo-l><span>            grapheme</span><span style=color:#81a1c1>.</span><span>grapheme</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>            grapheme_style</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>            virt</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#81a1c1>            &mut</span><span> last_line_indent_level</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#81a1c1>            &mut</span><span> is_in_indent_area</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>            pos</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#eceff4>        );</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l><span style=color:#616e88>    // ...</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p><a href=https://github.com/helix-editor/helix/blob/0097e191bb9f9f144043c2afcf04bc8632021281/helix-term/src/ui/document.rs#L154 rel=external>https://github.com/helix-editor/helix/blob/0097e191bb9f9f144043c2afcf04bc8632021281/helix-term/src/ui/document.rs#L154</a><p>ä¾‹ã«æ¼ã‚Œãšã‚‚ã£ã¨ã„ã‚ã„ã‚ãªå‡¦ç†ã‚ã‚‹ã®ã§ã™ãŒã€fileã®å†…å®¹ã‚’è¡¨ç¤ºã™ã‚‹ã“ã¨ã ã‘ã«çµã‚‹ã¨<code>reder_text()</code>ã¯æ¦‚ã­ä¸Šè¨˜ã®ã‚ˆã†ãªå‡¦ç†ã§ã™ã€‚<ol><li><code>visual_offset_from_block()</code>ã¯viewã®offsetæƒ…å ±ã‹ã‚‰renderingã‚’é–‹å§‹ã™ã‚‹ã®ã¯textä¸Šã®ä½•æ–‡å­—ç›®(<code>char_pos</code>)ã‚’è¿”ã—ã¾ã™ã€‚<li><code>DocumentFormatter</code>ã‚’ç”Ÿæˆã—ã¾ã™ã€‚ã“ã®structã¯æœ€çµ‚çš„ã«renderingã™ã¹ãæ–‡å­—ã‚’iterateã—ã¦ãã‚Œã‚‹structã§ã™ã€‚ <code>first_visible_char_idx</code>ã¯æ°—ã«ã—ãªãã¦è‰¯ã„ã§ã™ã€‚<li><code>StyleIter</code>ã¯themeã¨<code>HilightEvent</code>ã®æƒ…å ±ã‹ã‚‰æœ€çµ‚çš„ã«é©ç”¨ã™ã‚‹styleã‚’iterateã—ã¦ãã‚Œã‚‹structã§ã™ã€‚<li>æœ€åˆã«é©ç”¨ã™ã‚‹styleã‚’å–å¾—ã€‚ã‚‚ã—ãªã‘ã‚Œã°ãã®ã¾ã¾è¡¨ç¤ºã™ã‚‹ã®ã§ã€<code>Style::default()</code>ã‚’ä½¿ã„ã¾ã™ã€‚<li>æ¬¡ã«renderingã™ã‚‹"æ–‡å­—"ã§ã™ã€‚graphemeã«ã¤ã„ã¦ã¯å¾Œè¿°ã—ã¾ã™ã€‚NoneãŒè¿”ã‚‹ã¨rederingã™ã¹ãæ–‡å­—ã‚’ã™ã¹ã¦bufferã«æ›¸ã„ãŸã“ã¨ã«ãªã‚‹ã®ã§ã€terminalã¸ã®åæ˜ ãƒ•ã‚§ãƒ¼ã‚ºã«å…¥ã‚Šã¾ã™ã€‚<li><code>renderer.viewport.height</code>ã¯ä»Šé–‹ã„ã¦ã„ã‚‹Viewã®é«˜ã•ãªã®ã§ã€ãã‚Œä»¥é™ã¯rederingã—ã¦ã‚‚è¡¨ç¤ºã§ããªã„ã®ã§ã€å‡¦ç†ã‚’çµ‚ãˆã¾ã™ã€‚<li><code>StyleIter</code>ã¯<code>type Item = (Style, usize)</code>ã®<code>Iterator</code>ã‚’å®Ÿè£…ã—ã¦ã„ã¾ã™ã€‚ usizeã¯é©ç”¨ã™ã¹ãstyleã®æœ‰åŠ¹ç¯„å›²ã§ã™ã€‚ã“ã®å€¤ã¨ç¾åœ¨renderingã—ã¦ã„ã‚‹æ–‡å­—(<code>char_pos</code>)ã‚’æ¯”è¼ƒã—ã¦, æœ‰åŠ¹ç¯„å›²å¤–ã«ã§ãŸã‚‰æ¬¡ã«é©ç”¨ã™ã¹ãstyleã‚’å–å¾—ã—ã¾ã™ã€‚<li>ã„ã‚ã‚†ã‚‹1æ–‡å­—ã¨charã¯1:1ã«å¯¾å¿œã—ãªã„ã®ã§ã€ã“ã“ã§èª¿æ•´ã—ã¾ã™ã€‚ã“ã‚Œã‚’è¡Œã‚ãªã„ã¨emojiç­‰ã§ãŠã‹ã—ããªã‚Šã¾ã™ã€‚<li><code>VirtualText</code>ã®è©±ã¯é£›ã°ã—ã¾ã™ã€‚LSPã®å‹hintç­‰ã®ã“ã¨ã§ã™ã€‚<li>rederingã™ã‚‹æ–‡å­—ã‚’å‡¦ç†ã—ã¾ã™ã€‚</ol><h3 id=grapheme-toha><a aria-label="Anchor link for: grapheme-toha" class=zola-anchor href=#grapheme-toha><code>Grapheme</code> ã¨ã¯</a></h3><p>æ¬¡ã®å‡¦ç†ã‚’ã¿ã‚‹å‰ã«graphemeã«ã¤ã„ã¦è¿°ã¹ã¾ã™ã€‚<br> <a href=https://learning.oreilly.com/library/view/unicode-demystified/0201700522/ rel=external>Unicode Demystified</a>ã«ã‚ˆã‚Šã¾ã™ã¨<blockquote><p>A grapheme cluster is a sequence of one or more Unicode code points that should be treated as a single unit by various processes: Text-editing software should generally allow placement of the cursor only at grapheme cluster boundaries. Clicking the mouse on a piece of text should place the insertion point at the nearest grapheme cluster boundary, and the arrow keys should move forward and back one grapheme cluster at a time.</blockquote><p>Unicodeçš„ã«ã¯grapheme clusteræ­£å¼åç§°ã‚‰ã—ãã€textã‚’æ‰±ã†softwareã«ãŠã‘ã‚‹boundaryã‚’æä¾›ã™ã‚‹ã¨ã„ã†ç†è§£ã§ã™ã€‚<br> Helixã‚’æ©Ÿã«unicodeã«ã¤ã„ã¦ã‚‚çŸ¥ã‚ŠãŸã„ã®ã§ã™ãŒã€ã‚ªãƒ©ã‚¤ãƒªãƒ¼ã§æ¤œç´¢ã—ã¦ã‚‚2002ã‚„2006å¹´ã”ã‚ã®æœ¬ã—ã‹ãƒ’ãƒƒãƒˆã›ãšã§ã—ãŸã€‚(ãŠã™ã™ã‚ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç­‰ã”å­˜çŸ¥ã®æ–¹ãŠã‚‰ã‚Œã¾ã—ãŸã‚‰æ•™ãˆã¦ä¸‹ã•ã„)<h3 id=textrenderer-draw-grapheme><a aria-label="Anchor link for: textrenderer-draw-grapheme" class=zola-anchor href=#textrenderer-draw-grapheme><code>TextRenderer::draw_grapheme()</code></a></h3><p>ã‚³ãƒ¡ãƒ³ãƒˆã«ã‚ã‚‹é€šã‚Šã€<code>grapheme</code>ã‚’bufferã«æ›¸ãè¾¼ã‚€å‡¦ç†ã§ã™ã€‚<br> æœ€åˆã¯1æ–‡å­—æ›¸ãè¾¼ã‚€ã”ã¨ã«é–¢æ•°å‘¼ã¶ã®ã‹ã¨æ€ã£ãŸã‚Šã—ã¾ã—ãŸã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>impl</span><span style=color:#eceff4>&lt;'</span><span style=color:#8fbcbb>a</span><span style=color:#eceff4>></span><span style=color:#8fbcbb> TextRenderer</span><span style=color:#eceff4>&lt;'</span><span style=color:#8fbcbb>a</span><span style=color:#eceff4>> {</span></span>
<span class=giallo-l><span style=color:#616e88>    /// Draws a single `grapheme` at the current render position with a specified `style`.</span></span>
<span class=giallo-l><span style=color:#81a1c1>    pub fn</span><span style=color:#88c0d0> draw_grapheme</span><span style=color:#eceff4>(</span></span>
<span class=giallo-l><span style=color:#81a1c1>        &mut self</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>        grapheme</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Grapheme</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#81a1c1>        mut</span><span> style</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Style</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>        is_virtual</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> bool</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>        last_indent_level</span><span style=color:#81a1c1>: &mut</span><span style=color:#8fbcbb> usize</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>        is_in_indent_area</span><span style=color:#81a1c1>: &mut</span><span style=color:#8fbcbb> bool</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>        position</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Position</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#eceff4>    ) {</span></span>
<span class=giallo-l><span style=color:#616e88>        // ...</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>        let</span><span> width</span><span style=color:#81a1c1> =</span><span> grapheme</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>width</span><span style=color:#eceff4>();</span></span>
<span class=giallo-l><span style=color:#81a1c1>        let</span><span> space</span><span style=color:#81a1c1> = if</span><span> is_virtual</span><span style=color:#eceff4> { " " }</span><span style=color:#81a1c1> else</span><span style=color:#eceff4> {</span><span style=color:#81a1c1> &self.</span><span>space </span><span style=color:#eceff4>};</span></span>
<span class=giallo-l><span style=color:#81a1c1>        let</span><span> nbsp</span><span style=color:#81a1c1> = if</span><span> is_virtual</span><span style=color:#eceff4> { " " }</span><span style=color:#81a1c1> else</span><span style=color:#eceff4> {</span><span style=color:#81a1c1> &self.</span><span>nbsp </span><span style=color:#eceff4>};</span></span>
<span class=giallo-l><span style=color:#81a1c1>        let</span><span> tab</span><span style=color:#81a1c1> = if</span><span> is_virtual</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>            &self.</span><span>virtual_tab</span></span>
<span class=giallo-l><span style=color:#eceff4>        }</span><span style=color:#81a1c1> else</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>            &self.</span><span>tab</span></span>
<span class=giallo-l><span style=color:#eceff4>        };</span></span>
<span class=giallo-l><span style=color:#81a1c1>        let</span><span> grapheme</span><span style=color:#81a1c1> = match</span><span> grapheme</span><span style=color:#eceff4> {</span><span style=color:#616e88> // 1</span></span>
<span class=giallo-l><span style=color:#8fbcbb>            Grapheme</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Tab</span><span style=color:#eceff4> {</span><span> width</span><span style=color:#eceff4> }</span><span style=color:#81a1c1> =></span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>                let</span><span> grapheme_tab_width</span><span style=color:#81a1c1> =</span><span style=color:#88c0d0> char_to_byte_idx</span><span style=color:#eceff4>(</span><span>tab</span><span style=color:#eceff4>,</span><span> width</span><span style=color:#eceff4>);</span></span>
<span class=giallo-l><span style=color:#81a1c1>                &</span><span>tab</span><span style=color:#eceff4>[</span><span style=color:#81a1c1>..</span><span>grapheme_tab_width</span><span style=color:#eceff4>]</span></span>
<span class=giallo-l><span style=color:#eceff4>            }</span></span>
<span class=giallo-l><span style=color:#616e88>            // TODO special rendering for other whitespaces?</span></span>
<span class=giallo-l><span style=color:#8fbcbb>            Grapheme</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Other</span><span style=color:#eceff4> {</span><span style=color:#81a1c1> ref</span><span> g</span><span style=color:#eceff4> }</span><span style=color:#81a1c1> if</span><span> g</span><span style=color:#81a1c1> ==</span><span style=color:#eceff4> " "</span><span style=color:#81a1c1> =></span><span> space</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#8fbcbb>            Grapheme</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Other</span><span style=color:#eceff4> {</span><span style=color:#81a1c1> ref</span><span> g</span><span style=color:#eceff4> }</span><span style=color:#81a1c1> if</span><span> g</span><span style=color:#81a1c1> ==</span><span style=color:#eceff4> "</span><span style=color:#ebcb8b>\u{00A0}</span><span style=color:#eceff4>"</span><span style=color:#81a1c1> =></span><span> nbsp</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#8fbcbb>            Grapheme</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Other</span><span style=color:#eceff4> {</span><span style=color:#81a1c1> ref</span><span> g</span><span style=color:#eceff4> }</span><span style=color:#81a1c1> =></span><span> g</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#8fbcbb>            Grapheme</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Newline</span><span style=color:#81a1c1> => &self.</span><span>newline</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#eceff4>        };</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>        let</span><span> in_bounds</span><span style=color:#81a1c1> = self.</span><span>col_offset </span><span style=color:#81a1c1>&lt;=</span><span> position</span><span style=color:#81a1c1>.</span><span>col  </span><span style=color:#616e88>// 2</span></span>
<span class=giallo-l><span style=color:#81a1c1>            &&</span><span> position</span><span style=color:#81a1c1>.</span><span>col</span><span style=color:#81a1c1> &lt; self.</span><span>viewport</span><span style=color:#81a1c1>.</span><span>width </span><span style=color:#81a1c1>as</span><span style=color:#8fbcbb> usize</span><span style=color:#81a1c1> + self.</span><span>col_offset</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>        if</span><span> in_bounds</span><span style=color:#eceff4> {</span><span style=color:#616e88> // 3</span></span>
<span class=giallo-l><span style=color:#81a1c1>            self.</span><span>surface</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>set_string</span><span style=color:#eceff4>(</span></span>
<span class=giallo-l><span style=color:#81a1c1>                self.</span><span>viewport</span><span style=color:#81a1c1>.</span><span>x </span><span style=color:#81a1c1>+</span><span style=color:#eceff4> (</span><span>position</span><span style=color:#81a1c1>.</span><span>col </span><span style=color:#81a1c1>- self.</span><span>col_offset</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> as</span><span style=color:#8fbcbb> u16</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#81a1c1>                self.</span><span>viewport</span><span style=color:#81a1c1>.</span><span>y </span><span style=color:#81a1c1>+</span><span> position</span><span style=color:#81a1c1>.</span><span>row </span><span style=color:#81a1c1>as</span><span style=color:#8fbcbb> u16</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>                grapheme</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>                style</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#eceff4>            );</span></span>
<span class=giallo-l><span style=color:#eceff4>        }</span><span style=color:#81a1c1> else if</span><span> cut_off_start</span><span style=color:#81a1c1> !=</span><span style=color:#b48ead> 0</span><span style=color:#81a1c1> &&</span><span> cut_off_start</span><span style=color:#81a1c1> &lt;</span><span> width</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#616e88>            // ...</span></span>
<span class=giallo-l><span style=color:#eceff4>        }</span></span>
<span class=giallo-l><span style=color:#616e88>        // ...</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p><a href=https://github.com/helix-editor/helix/blob/0097e191bb9f9f144043c2afcf04bc8632021281/helix-term/src/ui/document.rs#L395 rel=external>https://github.com/helix-editor/helix/blob/0097e191bb9f9f144043c2afcf04bc8632021281/helix-term/src/ui/document.rs#L395</a><p>tabã‚’spaceã«å¤‰æ›ã—ãŸã‚Šã™ã‚‹å‡¦ç†ã¯ã“ã“ã§è¡Œã£ã¦ã„ã‚‹æ§˜ã§ã™ã€‚<ol><li>ã“ã“ã§æœ€çµ‚çš„ã«renderingã™ã‚‹æ–‡å­—ãŒæ±ºã¾ã‚Šã¾ã™ã€‚<code>let grapheme</code>ã®å‹ã¯<code>&str</code>ã§ã™ã€‚<li>columnã®offsetã«å¿œã˜ãŸåˆ¤å®šã§ã™ã€‚ã“ã®å‡¦ç†ã§æ¨ªã«é•·ã„è¡Œã§æ¨ªã«scrollã—ãŸéš›ã®æŒ™å‹•ãŒå®Ÿç¾ã•ã‚Œã¦ã„ã¾ã™ã€‚<li>ã“ã“ã§ã¤ã„ã«bufferã«æ–‡å­—ã‚’æ›¸ãè¾¼ã¿ã¾ã™ã€‚<code>self.surface</code>(buffer)ã«ã¯çµ¶å¯¾ä½ç½®ã‚’æŒ‡ç¤ºã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã®ã§ã€ç¾åœ¨ã®<code>View</code>ã®ä½ç½®(<code>self.viewport</code>)ã‚’åŸºæº–ã«ã—ã¾ã™ã€‚</ol><p><code>self.surface</code>ã¯<code>&'a mut Surface</code>ã§<code>use tui::buffer::Buffer as Surface;</code> ã•ã‚Œã¦ã„ã‚‹ã®ã§ã€å®Ÿæ…‹ã¯bufferã§ã™ã€‚<br> ã©ã“ã‹ã‚‰æ¥ã¦ã„ã‚‹ã‹ã¨ã„ã†ã¨ã€<code>Application::render()</code>ã®ä¸­ã§ã€<code>let surface = self.terminal.current_buffer_mut();</code>ã—ã¦ãŠã‚Šã€å‡¦ç†ã®æœ€åˆã‹ã‚‰ãšã£ã¨å¼•ãå›ã•ã‚Œã¤ã„ã«ã“ã“ã§ä½¿ã‚ã‚Œã¾ã™ã€‚<h2 id=terminalbackendtobuffer><a aria-label="Anchor link for: terminalbackendtobuffer" class=zola-anchor href=#terminalbackendtobuffer><code>TerminalBackend</code>ã¨<code>Buffer</code></a></h2><p>ã“ã“ã§ã€helixãŒterminalã©ã®ã‚ˆã†ã«åˆ¶å¾¡ã—ã¦ã„ã‚‹ã‹ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚<br> ã¾ãš<code>Application</code>ãŒä¿æŒã—ã¦ã„ã‚‹<code>Terminal</code>ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«å®šç¾©ã•ã‚Œã¦ã„ã¾ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#5e81ac>#[derive(</span><span style=color:#8fbcbb>Debug</span><span style=color:#5e81ac>)]</span></span>
<span class=giallo-l><span style=color:#81a1c1>pub struct</span><span style=color:#8fbcbb> Terminal</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>B</span><span style=color:#eceff4>></span></span>
<span class=giallo-l><span style=color:#81a1c1>where</span></span>
<span class=giallo-l><span style=color:#8fbcbb>    B</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Backend</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#eceff4>{</span></span>
<span class=giallo-l><span>    backend</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> B</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#616e88>    /// Holds the results of the current and previous draw calls. The two are compared at the end</span></span>
<span class=giallo-l><span style=color:#616e88>    /// of each draw pass to output the necessary updates to the terminal</span></span>
<span class=giallo-l><span>    buffers</span><span style=color:#81a1c1>:</span><span style=color:#eceff4> [</span><span style=color:#8fbcbb>Buffer</span><span style=color:#eceff4>;</span><span style=color:#b48ead> 2</span><span style=color:#eceff4>],</span></span>
<span class=giallo-l><span style=color:#616e88>    /// Index of the current buffer in the previous array</span></span>
<span class=giallo-l><span>    current</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> usize</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#616e88>    /// Kind of cursor (hidden or others)</span></span>
<span class=giallo-l><span>    cursor_kind</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> CursorKind</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#616e88>    /// Viewport</span></span>
<span class=giallo-l><span>    viewport</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Viewport</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p><a href=https://github.com/helix-editor/helix/blob/0097e191bb9f9f144043c2afcf04bc8632021281/helix-tui/src/terminal.rs#L52 rel=external>https://github.com/helix-editor/helix/blob/0097e191bb9f9f144043c2afcf04bc8632021281/helix-tui/src/terminal.rs#L52</a><p><code>Terminal</code>ã¯terminalã‚’æ“ä½œã™ã‚‹ãŸã‚ã®å‹ã§ã™ã€‚trait boundã®<code>Backend</code>ã«terminalã¸ã®å¿…è¦ãªæ“ä½œãŒå®šç¾©ã•ã‚Œã¦ã„ã¾ã™ã€‚ å®Ÿè¡Œæ™‚ã«ã¯<code>CrosstermBackend</code>ãŒ<code>Backend</code>ã¨ã—ã¦åˆ©ç”¨ã•ã‚Œã¾ã™ã€‚integration testæ™‚ã«ã¯mockã«å·®ã—æ›¿ãˆã‚‰ã‚Œã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚<p><code>Buffer</code>ã¯helixãŒç®¡ç†ã™ã‚‹<code>Backend</code>ã«renderingã™ã‚‹bufferã§ã™ã€‚ãªãœã€Arrayã§2ã¤ä¿æŒã—ã¦ã„ã‚‹ã‹ã¯ã“ã®ã‚ã¨ã®å‡¦ç†ã‚’ã¿ã¦ã„ãã¨ã‚ã‹ã‚Šã¾ã™ã€‚ <code>Viewport</code>ã¯terminalã®width/heightã‚’ä¿æŒã—ã¦ã„ã¾ã™ã€‚å®Ÿè³ªçš„ã«helixå…¨ä½“ã®æç”»é ˜åŸŸã§ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#5e81ac>#[derive(</span><span style=color:#8fbcbb>Debug</span><span style=color:#5e81ac>,</span><span style=color:#8fbcbb> Default</span><span style=color:#5e81ac>,</span><span style=color:#8fbcbb> Clone</span><span style=color:#5e81ac>,</span><span style=color:#8fbcbb> PartialEq</span><span style=color:#5e81ac>,</span><span style=color:#8fbcbb> Eq</span><span style=color:#5e81ac>)]</span></span>
<span class=giallo-l><span style=color:#81a1c1>pub struct</span><span style=color:#8fbcbb> Buffer</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#616e88>    /// The area represented by this buffer</span></span>
<span class=giallo-l><span style=color:#81a1c1>    pub</span><span> area</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Rect</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#616e88>    /// The content of the buffer. The length of this Vec should always be equal to area.width *</span></span>
<span class=giallo-l><span style=color:#616e88>    /// area.height</span></span>
<span class=giallo-l><span style=color:#81a1c1>    pub</span><span> content</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Vec</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Cell</span><span style=color:#eceff4>>,</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p><a href=https://github.com/helix-editor/helix/blob/0097e191bb9f9f144043c2afcf04bc8632021281/helix-tui/src/buffer.rs#L123 rel=external>https://github.com/helix-editor/helix/blob/0097e191bb9f9f144043c2afcf04bc8632021281/helix-tui/src/buffer.rs#L123</a><p>bufferã®renderingé ˜åŸŸã®æƒ…å ±ã¨å®Ÿéš›ã«rederingã™ã‚‹<code>Cell</code>ã‚’ä¿æŒã—ã¦ã„ã¾ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#5e81ac>#[derive(</span><span style=color:#8fbcbb>Debug</span><span style=color:#5e81ac>,</span><span style=color:#8fbcbb> Default</span><span style=color:#5e81ac>,</span><span style=color:#8fbcbb> Clone</span><span style=color:#5e81ac>,</span><span style=color:#8fbcbb> Copy</span><span style=color:#5e81ac>,</span><span style=color:#8fbcbb> Hash</span><span style=color:#5e81ac>,</span><span style=color:#8fbcbb> PartialEq</span><span style=color:#5e81ac>,</span><span style=color:#8fbcbb> Eq</span><span style=color:#5e81ac>)]</span></span>
<span class=giallo-l><span style=color:#81a1c1>pub struct</span><span style=color:#8fbcbb> Rect</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    pub</span><span> x</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> u16</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#81a1c1>    pub</span><span> y</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> u16</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#81a1c1>    pub</span><span> width</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> u16</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#81a1c1>    pub</span><span> height</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> u16</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p><a href=https://github.com/helix-editor/helix/blob/0097e191bb9f9f144043c2afcf04bc8632021281/helix-view/src/graphics.rs#L90 rel=external>https://github.com/helix-editor/helix/blob/0097e191bb9f9f144043c2afcf04bc8632021281/helix-view/src/graphics.rs#L90</a><pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#616e88>/// A buffer cell</span></span>
<span class=giallo-l><span style=color:#5e81ac>#[derive(</span><span style=color:#8fbcbb>Debug</span><span style=color:#5e81ac>,</span><span style=color:#8fbcbb> Clone</span><span style=color:#5e81ac>,</span><span style=color:#8fbcbb> PartialEq</span><span style=color:#5e81ac>,</span><span style=color:#8fbcbb> Eq</span><span style=color:#5e81ac>)]</span></span>
<span class=giallo-l><span style=color:#81a1c1>pub struct</span><span style=color:#8fbcbb> Cell</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    pub</span><span> symbol</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> String</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#81a1c1>    pub</span><span> fg</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Color</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#81a1c1>    pub</span><span> bg</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Color</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#81a1c1>    pub</span><span> underline_color</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Color</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#81a1c1>    pub</span><span> underline_style</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> UnderlineStyle</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#81a1c1>    pub</span><span> modifier</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Modifier</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p><a href=https://github.com/helix-editor/helix/blob/0097e191bb9f9f144043c2afcf04bc8632021281/helix-tui/src/buffer.rs#L10 rel=external>https://github.com/helix-editor/helix/blob/0097e191bb9f9f144043c2afcf04bc8632021281/helix-tui/src/buffer.rs#L10</a><p><code>Cell</code>ã¯terminalã®1æç”»é ˜åŸŸã‚’è¡¨ã—ã¦ãŠã‚Šã€<code>symbol</code>ãŒãã®æ–‡å­—ã§ã™ã€‚defaultã®themeã ã¨<code>modofier</code>ã«<code>REVERSED</code>ãŒè¨­å®šã•ã‚Œã¦ã„ã¦ã€èƒŒæ™¯ã¨textã®è‰²ã‚’åˆ¤å®šã•ã›ã¦ã„ãŸã‚Šã—ã¾ã™ã€‚<p>HelixãŒterminalã«æ±‚ã‚ã‚‹æ“ä½œã¨ã—ã¦ã®<code>Backend</code> traitã¯ä»¥ä¸‹ã®ã‚ˆã†ã«å®šç¾©ã•ã‚Œã¦ã„ã¾ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>pub trait</span><span style=color:#8fbcbb;font-weight:700> Backend</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    fn</span><span style=color:#88c0d0> claim</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&mut self</span><span style=color:#eceff4>,</span><span> config</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Config</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> Result</span><span style=color:#eceff4>&lt;(),</span><span> io</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Error</span><span style=color:#eceff4>>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>    fn</span><span style=color:#88c0d0> reconfigure</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&mut self</span><span style=color:#eceff4>,</span><span> config</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Config</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> Result</span><span style=color:#eceff4>&lt;(),</span><span> io</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Error</span><span style=color:#eceff4>>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>    fn</span><span style=color:#88c0d0> restore</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&mut self</span><span style=color:#eceff4>,</span><span> config</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Config</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> Result</span><span style=color:#eceff4>&lt;(),</span><span> io</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Error</span><span style=color:#eceff4>>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>    fn</span><span style=color:#88c0d0> force_restore</span><span style=color:#eceff4>()</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> Result</span><span style=color:#eceff4>&lt;(),</span><span> io</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Error</span><span style=color:#eceff4>>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>    fn</span><span style=color:#88c0d0> draw</span><span style=color:#eceff4>&lt;'</span><span style=color:#8fbcbb>a</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> I</span><span style=color:#eceff4>>(</span><span style=color:#81a1c1>&mut self</span><span style=color:#eceff4>,</span><span> content</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> I</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> Result</span><span style=color:#eceff4>&lt;(),</span><span> io</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Error</span><span style=color:#eceff4>></span></span>
<span class=giallo-l><span style=color:#81a1c1>    where</span></span>
<span class=giallo-l><span style=color:#8fbcbb>        I</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Iterator</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Item</span><span style=color:#81a1c1> =</span><span style=color:#eceff4> (</span><span style=color:#8fbcbb>u16</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> u16</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> &</span><span style=color:#eceff4>'</span><span style=color:#8fbcbb>a Cell</span><span style=color:#eceff4>)>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>    fn</span><span style=color:#88c0d0> hide_cursor</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&mut self</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> Result</span><span style=color:#eceff4>&lt;(),</span><span> io</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Error</span><span style=color:#eceff4>>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>    fn</span><span style=color:#88c0d0> show_cursor</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&mut self</span><span style=color:#eceff4>,</span><span> kind</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> CursorKind</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> Result</span><span style=color:#eceff4>&lt;(),</span><span> io</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Error</span><span style=color:#eceff4>>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>    fn</span><span style=color:#88c0d0> get_cursor</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&mut self</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> Result</span><span style=color:#eceff4>&lt;(</span><span style=color:#8fbcbb>u16</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> u16</span><span style=color:#eceff4>),</span><span> io</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Error</span><span style=color:#eceff4>>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>    fn</span><span style=color:#88c0d0> set_cursor</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&mut self</span><span style=color:#eceff4>,</span><span> x</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> u16</span><span style=color:#eceff4>,</span><span> y</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> u16</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> Result</span><span style=color:#eceff4>&lt;(),</span><span> io</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Error</span><span style=color:#eceff4>>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>    fn</span><span style=color:#88c0d0> clear</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&mut self</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> Result</span><span style=color:#eceff4>&lt;(),</span><span> io</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Error</span><span style=color:#eceff4>>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>    fn</span><span style=color:#88c0d0> size</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&self</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> Result</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Rect</span><span style=color:#eceff4>,</span><span> io</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Error</span><span style=color:#eceff4>>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>    fn</span><span style=color:#88c0d0> flush</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&mut self</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> Result</span><span style=color:#eceff4>&lt;(),</span><span> io</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Error</span><span style=color:#eceff4>>;</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p>ã„ãã¤ã‹ã‚ã‚Šã¾ã™ãŒã€ç€ç›®ã—ã¦ã‚‚ã‚‰ã„ãŸã„ã®ãŒ<code>draw()</code>ã§ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>pub trait</span><span style=color:#8fbcbb;font-weight:700> Backend</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    fn</span><span style=color:#88c0d0> draw</span><span style=color:#eceff4>&lt;'</span><span style=color:#8fbcbb>a</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> I</span><span style=color:#eceff4>>(</span><span style=color:#81a1c1>&mut self</span><span style=color:#eceff4>,</span><span> content</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> I</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> Result</span><span style=color:#eceff4>&lt;(),</span><span> io</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Error</span><span style=color:#eceff4>></span></span>
<span class=giallo-l><span style=color:#81a1c1>where</span></span>
<span class=giallo-l><span style=color:#8fbcbb>    I</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Iterator</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Item</span><span style=color:#81a1c1> =</span><span style=color:#eceff4> (</span><span style=color:#8fbcbb>u16</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> u16</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> &</span><span style=color:#eceff4>'</span><span style=color:#8fbcbb>a Cell</span><span style=color:#eceff4>)>;</span></span>
<span class=giallo-l><span style=color:#616e88>    // ...</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p>u16ã¯XYåº§æ¨™ã§ã€æŒ‡å®šã®ä½ç½®ã«<code>Cell</code>ã‚’æç”»ã™ã‚‹ã¨ã„ã†apiã«ãªã£ã¦ã„ã¾ã™ã€‚<code>Component::render()</code>ã«ã‚ˆã£ã¦ã€<code>Buffer</code>ã®<code>Cell</code>ã‚’æç”»å†…å®¹ã§ã†ã‚ãŸã®ã¡ã€ã“ã®<code>draw()</code>ã‚’å‘¼ã³å‡ºã—ã¦terminalã«åæ˜ ã•ã›ã¾ã™ã€‚<h2 id=terminal-draw><a aria-label="Anchor link for: terminal-draw" class=zola-anchor href=#terminal-draw><code>Terminal::draw()</code></a></h2><p>ã‚‚ã†ä¸€åº¦ã€<code>Application::render()</code>ã‚’æ€ã„å‡ºã—ã¾ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>impl</span><span style=color:#8fbcbb> Application</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    async fn</span><span style=color:#88c0d0> render</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&mut self</span><span style=color:#eceff4>) {</span></span>
<span class=giallo-l><span style=color:#81a1c1>        let mut</span><span> cx</span><span style=color:#81a1c1> = crate::</span><span>compositor</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Context</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span>            editor</span><span style=color:#81a1c1>: &mut self.</span><span>editor</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#616e88>            // ...</span></span>
<span class=giallo-l><span style=color:#eceff4>        };</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>        let</span><span> area</span><span style=color:#81a1c1> = self</span></span>
<span class=giallo-l><span style=color:#81a1c1>            .</span><span>terminal</span></span>
<span class=giallo-l><span style=color:#81a1c1>            .</span><span style=color:#88c0d0>autoresize</span><span style=color:#eceff4>()</span></span>
<span class=giallo-l><span style=color:#81a1c1>            .</span><span style=color:#88c0d0>expect</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>Unable to determine terminal size</span><span style=color:#eceff4>");</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>        let</span><span> surface</span><span style=color:#81a1c1> = self.</span><span>terminal</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>current_buffer_mut</span><span style=color:#eceff4>();</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>        self.</span><span>compositor</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>render</span><span style=color:#eceff4>(</span><span>area</span><span style=color:#eceff4>,</span><span> surface</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> &mut</span><span> cx</span><span style=color:#eceff4>);</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#616e88>        // ...</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>        self.</span><span>terminal</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>draw</span><span style=color:#eceff4>(</span><span>pos</span><span style=color:#eceff4>,</span><span> kind</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>unwrap</span><span style=color:#eceff4>();</span><span style=color:#616e88> // ğŸ‘ˆ</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p><code>self.terminal.current_buffer_mut()</code>ã§bufferã‚’å–å¾—ã—ãŸã®ã¡ã€<code>compositor.render()</code>ã§bufferã®å†…å®¹ã‚’åŸ‹ã‚ã¾ã™ã€‚<br> ãã—ã¦ã€æœ€å¾Œã«ã€self.terminal.draw()`ã§bufferã®å†…å®¹ã‚’åæ˜ ã—ã¾ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>impl</span></span>
<span class=giallo-l><span style=color:#81a1c1>impl</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>B</span><span style=color:#eceff4>></span><span style=color:#8fbcbb> Terminal</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>B</span><span style=color:#eceff4>></span></span>
<span class=giallo-l><span style=color:#81a1c1>where</span></span>
<span class=giallo-l><span style=color:#8fbcbb>    B</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Backend</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#eceff4>{</span></span>
<span class=giallo-l><span style=color:#81a1c1>    pub fn</span><span style=color:#88c0d0> current_buffer_mut</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&mut self</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -> &mut</span><span style=color:#8fbcbb> Buffer</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>        &mut self.</span><span>buffers</span><span style=color:#eceff4>[</span><span style=color:#81a1c1>self.</span><span>current</span><span style=color:#eceff4>]</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p><code>Terminal::current_buffer_mut()</code>ã¯ï¼’ã¤ä¿æŒã—ã¦ã„ã‚‹<code>Buffer</code>ã®ç‰‡æ–¹ã‚’è¿”ã—ã¾ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>impl</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>B</span><span style=color:#eceff4>></span><span style=color:#8fbcbb> Terminal</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>B</span><span style=color:#eceff4>></span></span>
<span class=giallo-l><span style=color:#81a1c1>where</span></span>
<span class=giallo-l><span style=color:#8fbcbb>    B</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Backend</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#eceff4>{</span></span>
<span class=giallo-l><span style=color:#616e88>    /// Synchronizes terminal size, calls the rendering closure, flushes the current internal state</span></span>
<span class=giallo-l><span style=color:#616e88>    /// and prepares for the next draw call.</span></span>
<span class=giallo-l><span style=color:#81a1c1>    pub fn</span><span style=color:#88c0d0> draw</span><span style=color:#eceff4>(</span></span>
<span class=giallo-l><span style=color:#81a1c1>        &mut self</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>        cursor_position</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Option</span><span style=color:#eceff4>&lt;(</span><span style=color:#8fbcbb>u16</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> u16</span><span style=color:#eceff4>)>,</span></span>
<span class=giallo-l><span>        cursor_kind</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> CursorKind</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#eceff4>    )</span><span style=color:#81a1c1> -></span><span> io</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Result</span><span style=color:#eceff4>&lt;()> {</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#616e88>        // Draw to stdout</span></span>
<span class=giallo-l><span style=color:#81a1c1>        self.</span><span style=color:#88c0d0>flush</span><span style=color:#eceff4>()</span><span style=color:#81a1c1>?</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#616e88>        // ...</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#616e88>        // Swap buffers</span></span>
<span class=giallo-l><span style=color:#81a1c1>        self.</span><span>buffers</span><span style=color:#eceff4>[</span><span style=color:#b48ead>1</span><span style=color:#81a1c1> - self.</span><span>current</span><span style=color:#eceff4>]</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>reset</span><span style=color:#eceff4>();</span></span>
<span class=giallo-l><span style=color:#81a1c1>        self.</span><span>current </span><span style=color:#81a1c1>=</span><span style=color:#b48ead> 1</span><span style=color:#81a1c1> - self.</span><span>current</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#616e88>        // Flush</span></span>
<span class=giallo-l><span style=color:#81a1c1>        self.</span><span>backend</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>flush</span><span style=color:#eceff4>()</span><span style=color:#81a1c1>?</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#8fbcbb>        Ok</span><span style=color:#eceff4>(())</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p><a href=https://github.com/helix-editor/helix/blob/0097e191bb9f9f144043c2afcf04bc8632021281/helix-tui/src/terminal.rs#L177 rel=external>https://github.com/helix-editor/helix/blob/0097e191bb9f9f144043c2afcf04bc8632021281/helix-tui/src/terminal.rs#L177</a><p>å¼•æ•°ã®cursorã¯ã“ã“ã§ã¯æ°—ã«ã—ã¾ã›ã‚“ã€‚<br> å‡¦ç†ã®æ¦‚è¦ã¨ã—ã¦ã¯<code>Terminal::flush()</code>ã‚’å‘¼ã‚“ã å¾Œã€æ¬¡ã«åˆ©ç”¨ã™ã‚‹<code>Buffer</code>ã‚’resetã—ã¦åˆ‡ã‚Šæ›¿ãˆã¦ã„ã¾ã™ã€‚<code>self.current</code>ã®åˆæœŸå€¤ã¯0ã§ã™ã€‚<br> æœ€å¾Œã«terminal backend(crossterm)ã®flushã‚’å‘¼ã‚“ã§rederingå‡¦ç†ã¯å®Œäº†ã§ã™ã€‚<h3 id=terminal-flush><a aria-label="Anchor link for: terminal-flush" class=zola-anchor href=#terminal-flush><code>Terminal::flush()</code></a></h3><pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>impl</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>B</span><span style=color:#eceff4>></span><span style=color:#8fbcbb> Terminal</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>B</span><span style=color:#eceff4>></span></span>
<span class=giallo-l><span style=color:#81a1c1>where</span></span>
<span class=giallo-l><span style=color:#8fbcbb>    B</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Backend</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#eceff4>{</span></span>
<span class=giallo-l><span style=color:#616e88>    /// Obtains a difference between the previous and the current buffer and passes it to the</span></span>
<span class=giallo-l><span style=color:#616e88>    /// current backend for drawing.</span></span>
<span class=giallo-l><span style=color:#81a1c1>    pub fn</span><span style=color:#88c0d0> flush</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&mut self</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span> io</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Result</span><span style=color:#eceff4>&lt;()> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>        let</span><span> previous_buffer</span><span style=color:#81a1c1> = &self.</span><span>buffers</span><span style=color:#eceff4>[</span><span style=color:#b48ead>1</span><span style=color:#81a1c1> - self.</span><span>current</span><span style=color:#eceff4>];</span></span>
<span class=giallo-l><span style=color:#81a1c1>        let</span><span> current_buffer</span><span style=color:#81a1c1> = &self.</span><span>buffers</span><span style=color:#eceff4>[</span><span style=color:#81a1c1>self.</span><span>current</span><span style=color:#eceff4>];</span></span>
<span class=giallo-l><span style=color:#81a1c1>        let</span><span> updates</span><span style=color:#81a1c1> =</span><span> previous_buffer</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>diff</span><span style=color:#eceff4>(</span><span>current_buffer</span><span style=color:#eceff4>);</span></span>
<span class=giallo-l><span style=color:#81a1c1>        self.</span><span>backend</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>draw</span><span style=color:#eceff4>(</span><span>updates</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>into_iter</span><span style=color:#eceff4>())</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p><a href=https://github.com/helix-editor/helix/blob/0097e191bb9f9f144043c2afcf04bc8632021281/helix-tui/src/terminal.rs#L149 rel=external>https://github.com/helix-editor/helix/blob/0097e191bb9f9f144043c2afcf04bc8632021281/helix-tui/src/terminal.rs#L149</a><p>ã“ã“ã§åˆã‚ã¦<code>Terminal</code>ãŒ<code>Buffer</code>ã‚’ï¼’ã¤ä¿æŒã—ã¦ã„ãŸç†ç”±ãŒã‚ã‹ã‚Šã¾ã—ãŸã€‚<br> <code>Buffer</code>ã‚’ã™ã¹ã¦backendã«æ¸¡ã™ã®ã§ã¯ãªãã€å‰å›ã®bufferã¨ã®å·®åˆ†ã‚’<code>Buffer.diff()</code>ã§å–å¾—ã—ãŸã®ã¡ã«ã€<code>self.backend.draw()</code>ã‚’å‘¼ã³å‡ºã—ã¦ã„ã¾ã™ã€‚<h3 id=buffer-diff><a aria-label="Anchor link for: buffer-diff" class=zola-anchor href=#buffer-diff><code>Buffer::diff()</code></a></h3><pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>impl</span><span style=color:#8fbcbb> Buffer</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    pub fn</span><span style=color:#88c0d0> diff</span><span style=color:#eceff4>&lt;'</span><span style=color:#8fbcbb>a</span><span style=color:#eceff4>>(</span><span style=color:#81a1c1>&self</span><span style=color:#eceff4>,</span><span> other</span><span style=color:#81a1c1>: &</span><span style=color:#eceff4>'</span><span style=color:#8fbcbb>a Buffer</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> Vec</span><span style=color:#eceff4>&lt;(</span><span style=color:#8fbcbb>u16</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> u16</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> &</span><span style=color:#eceff4>'</span><span style=color:#8fbcbb>a Cell</span><span style=color:#eceff4>)> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>        let</span><span> previous_buffer</span><span style=color:#81a1c1> = &self.</span><span>content</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>        let</span><span> next_buffer</span><span style=color:#81a1c1> = &</span><span>other</span><span style=color:#81a1c1>.</span><span>content</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>        let</span><span> width</span><span style=color:#81a1c1> = self.</span><span>area</span><span style=color:#81a1c1>.</span><span>width</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>        let mut</span><span> updates</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Vec</span><span style=color:#eceff4>&lt;(</span><span style=color:#8fbcbb>u16</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> u16</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> &</span><span style=color:#8fbcbb>Cell</span><span style=color:#eceff4>)></span><span style=color:#81a1c1> =</span><span style=color:#88c0d0;font-weight:700> vec!</span><span style=color:#eceff4>[];</span></span>
<span class=giallo-l><span style=color:#616e88>        // Cells invalidated by drawing/replacing preceding multi-width characters:</span></span>
<span class=giallo-l><span style=color:#81a1c1>        let mut</span><span> invalidated</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> usize</span><span style=color:#81a1c1> =</span><span style=color:#b48ead> 0</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#616e88>        // Cells from the current buffer to skip due to preceding multi-width characters taking their</span></span>
<span class=giallo-l><span style=color:#616e88>        // place (the skipped cells should be blank anyway):</span></span>
<span class=giallo-l><span style=color:#81a1c1>        let mut</span><span> to_skip</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> usize</span><span style=color:#81a1c1> =</span><span style=color:#b48ead> 0</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>        for</span><span style=color:#eceff4> (</span><span>i</span><span style=color:#eceff4>, (</span><span>current</span><span style=color:#eceff4>,</span><span> previous</span><span style=color:#eceff4>))</span><span style=color:#81a1c1> in</span><span> next_buffer</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>iter</span><span style=color:#eceff4>()</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>zip</span><span style=color:#eceff4>(</span><span>previous_buffer</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>iter</span><span style=color:#eceff4>())</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>enumerate</span><span style=color:#eceff4>() {</span></span>
<span class=giallo-l><span style=color:#81a1c1>            if</span><span style=color:#eceff4> (</span><span>current</span><span style=color:#81a1c1> !=</span><span> previous</span><span style=color:#81a1c1> ||</span><span> invalidated</span><span style=color:#81a1c1> ></span><span style=color:#b48ead> 0</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> &&</span><span> to_skip</span><span style=color:#81a1c1> ==</span><span style=color:#b48ead> 0</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>                let</span><span> x</span><span style=color:#81a1c1> =</span><span style=color:#eceff4> (</span><span>i</span><span style=color:#81a1c1> %</span><span> width</span><span style=color:#81a1c1> as</span><span style=color:#8fbcbb> usize</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> as</span><span style=color:#8fbcbb> u16</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>                let</span><span> y</span><span style=color:#81a1c1> =</span><span style=color:#eceff4> (</span><span>i</span><span style=color:#81a1c1> /</span><span> width</span><span style=color:#81a1c1> as</span><span style=color:#8fbcbb> usize</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> as</span><span style=color:#8fbcbb> u16</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span>                updates</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>push</span><span style=color:#eceff4>((</span><span>x</span><span style=color:#eceff4>,</span><span> y</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> &</span><span>next_buffer</span><span style=color:#eceff4>[</span><span>i</span><span style=color:#eceff4>]));</span></span>
<span class=giallo-l><span style=color:#eceff4>            }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>            let</span><span> current_width</span><span style=color:#81a1c1> =</span><span> current</span><span style=color:#81a1c1>.</span><span>symbol</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>width</span><span style=color:#eceff4>();</span></span>
<span class=giallo-l><span>            to_skip</span><span style=color:#81a1c1> =</span><span> current_width</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>saturating_sub</span><span style=color:#eceff4>(</span><span style=color:#b48ead>1</span><span style=color:#eceff4>);</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>            let</span><span> affected_width</span><span style=color:#81a1c1> =</span><span> std</span><span style=color:#81a1c1>::</span><span>cmp</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>max</span><span style=color:#eceff4>(</span><span>current_width</span><span style=color:#eceff4>,</span><span> previous</span><span style=color:#81a1c1>.</span><span>symbol</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>width</span><span style=color:#eceff4>());</span></span>
<span class=giallo-l><span>            invalidated</span><span style=color:#81a1c1> =</span><span> std</span><span style=color:#81a1c1>::</span><span>cmp</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>max</span><span style=color:#eceff4>(</span><span>affected_width</span><span style=color:#eceff4>,</span><span> invalidated</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>saturating_sub</span><span style=color:#eceff4>(</span><span style=color:#b48ead>1</span><span style=color:#eceff4>);</span></span>
<span class=giallo-l><span style=color:#eceff4>        }</span></span>
<span class=giallo-l><span>        updates</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p><a href=https://github.com/helix-editor/helix/blob/0097e191bb9f9f144043c2afcf04bc8632021281/helix-tui/src/buffer.rs#L619 rel=external>https://github.com/helix-editor/helix/blob/0097e191bb9f9f144043c2afcf04bc8632021281/helix-tui/src/buffer.rs#L619</a><p><code>Buffer::diff()</code>ã¯bufferã®å·®åˆ†ã‚’è¨ˆç®—ã—ã¦ã€æ›´æ–°ã®ã‚ã‚‹å¿…è¦ãª<code>Cell</code>ã‚’è¿”ã™å‡¦ç†ã§ã™ã€‚<br> åˆå›ã¯èƒŒæ™¯è‰²ã‚’å¡—ã£ã¦ã„ã‚‹ã®ã§<code>Buffer</code>ã®å…¨<code>Cell</code>ãŒæ›´æ–°ã•ã‚Œã¾ã™ã€‚<br> ãã®å¾Œã¯ä¾‹ãˆã°ã€cursorã‚’ä¸€ã¤å‹•ã‹ã™å ´åˆã€å‰å›cursorãŒã‚ã£ãŸæ–‡å­—ã¨ç¾åœ¨cursorãŒã‚ã‚‹ä½ç½®, status lineã®cursorä½ç½®ã®è¡¨ç¤ºã§3 <code>Cell</code>ã®ã¿ã®æ›´æ–°ã¨ãªã‚Šã¾ã™ã€‚<br> åŸºæœ¬çš„ã«ã¯previousã¨nextã‚’zipã—ã¦ã€æ¯”è¼ƒã—ã¦å·®åˆ†ã‚’æ¤œå‡ºã—ã¦ã„ã¾ã™ã€‚(<code>invalidated</code>ãŒã©ã‚“ãªå ´åˆã‚’å¿µé ­ã«ç½®ã„ã¦ã„ã‚‹ã‹ã‚¤ãƒã‚¤ãƒã¾ã ç†è§£ã§ãã¦ã„ãªã„ã§ã™)<h3 id=crosstermbackend-draw><a aria-label="Anchor link for: crosstermbackend-draw" class=zola-anchor href=#crosstermbackend-draw><code>CrosstermBackend::draw()</code></a></h3><pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>impl</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>W</span><span style=color:#eceff4>></span><span style=color:#8fbcbb> Backend</span><span style=color:#81a1c1> for</span><span style=color:#8fbcbb> CrosstermBackend</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>W</span><span style=color:#eceff4>></span></span>
<span class=giallo-l><span style=color:#81a1c1>where</span></span>
<span class=giallo-l><span style=color:#8fbcbb>    W</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Write</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#eceff4>{</span></span>
<span class=giallo-l><span style=color:#81a1c1>    fn</span><span style=color:#88c0d0> draw</span><span style=color:#eceff4>&lt;'</span><span style=color:#8fbcbb>a</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> I</span><span style=color:#eceff4>>(</span><span style=color:#81a1c1>&mut self</span><span style=color:#eceff4>,</span><span> content</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> I</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span> io</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Result</span><span style=color:#eceff4>&lt;()></span></span>
<span class=giallo-l><span style=color:#81a1c1>    where</span></span>
<span class=giallo-l><span style=color:#8fbcbb>        I</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Iterator</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Item</span><span style=color:#81a1c1> =</span><span style=color:#eceff4> (</span><span style=color:#8fbcbb>u16</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> u16</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> &</span><span style=color:#eceff4>'</span><span style=color:#8fbcbb>a Cell</span><span style=color:#eceff4>)>,</span></span>
<span class=giallo-l><span style=color:#eceff4>    {</span></span>
<span class=giallo-l><span style=color:#81a1c1>        let mut</span><span> fg</span><span style=color:#81a1c1> =</span><span style=color:#8fbcbb> Color</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Reset</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>        let mut</span><span> bg</span><span style=color:#81a1c1> =</span><span style=color:#8fbcbb> Color</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Reset</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>        let mut</span><span> underline_color</span><span style=color:#81a1c1> =</span><span style=color:#8fbcbb> Color</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Reset</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>        let mut</span><span> underline_style</span><span style=color:#81a1c1> =</span><span style=color:#8fbcbb> UnderlineStyle</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Reset</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>        let mut</span><span> modifier</span><span style=color:#81a1c1> =</span><span style=color:#8fbcbb> Modifier</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>empty</span><span style=color:#eceff4>();</span></span>
<span class=giallo-l><span style=color:#81a1c1>        let mut</span><span> last_pos</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Option</span><span style=color:#eceff4>&lt;(</span><span style=color:#8fbcbb>u16</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> u16</span><span style=color:#eceff4>)></span><span style=color:#81a1c1> =</span><span style=color:#8fbcbb> None</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>        for</span><span style=color:#eceff4> (</span><span>x</span><span style=color:#eceff4>,</span><span> y</span><span style=color:#eceff4>,</span><span> cell</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> in</span><span> content</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#616e88>            // Move the cursor if the previous location was not (x - 1, y)</span></span>
<span class=giallo-l><span style=color:#81a1c1>            if !</span><span style=color:#88c0d0;font-weight:700>matches!</span><span style=color:#eceff4>(</span><span>last_pos</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> Some</span><span style=color:#eceff4>(</span><span>p</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> if</span><span> x</span><span style=color:#81a1c1> ==</span><span> p</span><span style=color:#81a1c1>.</span><span style=color:#b48ead>0</span><span style=color:#81a1c1> +</span><span style=color:#b48ead> 1</span><span style=color:#81a1c1> &&</span><span> y</span><span style=color:#81a1c1> ==</span><span> p</span><span style=color:#81a1c1>.</span><span style=color:#b48ead>1</span><span style=color:#eceff4>) {</span></span>
<span class=giallo-l><span style=color:#88c0d0>                map_error</span><span style=color:#eceff4>(</span><span style=color:#88c0d0;font-weight:700>queue!</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>self.</span><span>buffer</span><span style=color:#eceff4>,</span><span style=color:#88c0d0> MoveTo</span><span style=color:#eceff4>(</span><span>x</span><span style=color:#eceff4>,</span><span> y</span><span style=color:#eceff4>)))</span><span style=color:#81a1c1>?</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#eceff4>            }</span></span>
<span class=giallo-l><span>            last_pos</span><span style=color:#81a1c1> =</span><span style=color:#8fbcbb> Some</span><span style=color:#eceff4>((</span><span>x</span><span style=color:#eceff4>,</span><span> y</span><span style=color:#eceff4>));</span></span>
<span class=giallo-l><span style=color:#81a1c1>            if</span><span> cell</span><span style=color:#81a1c1>.</span><span>modifier </span><span style=color:#81a1c1>!=</span><span> modifier</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>                let</span><span> diff</span><span style=color:#81a1c1> =</span><span style=color:#8fbcbb> ModifierDiff</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span>                    from</span><span style=color:#81a1c1>:</span><span> modifier</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>                    to</span><span style=color:#81a1c1>:</span><span> cell</span><span style=color:#81a1c1>.</span><span>modifier</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#eceff4>                };</span></span>
<span class=giallo-l><span>                diff</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>queue</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&mut self.</span><span>buffer</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>?</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span>                modifier</span><span style=color:#81a1c1> =</span><span> cell</span><span style=color:#81a1c1>.</span><span>modifier</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#eceff4>            }</span></span>
<span class=giallo-l><span style=color:#81a1c1>            if</span><span> cell</span><span style=color:#81a1c1>.</span><span>fg </span><span style=color:#81a1c1>!=</span><span> fg</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>                let</span><span> color</span><span style=color:#81a1c1> =</span><span style=color:#8fbcbb> CColor</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>from</span><span style=color:#eceff4>(</span><span>cell</span><span style=color:#81a1c1>.</span><span>fg</span><span style=color:#eceff4>);</span></span>
<span class=giallo-l><span style=color:#88c0d0>                map_error</span><span style=color:#eceff4>(</span><span style=color:#88c0d0;font-weight:700>queue!</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>self.</span><span>buffer</span><span style=color:#eceff4>,</span><span style=color:#88c0d0> SetForegroundColor</span><span style=color:#eceff4>(</span><span>color</span><span style=color:#eceff4>)))</span><span style=color:#81a1c1>?</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span>                fg</span><span style=color:#81a1c1> =</span><span> cell</span><span style=color:#81a1c1>.</span><span>fg</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#eceff4>            }</span></span>
<span class=giallo-l><span style=color:#81a1c1>            if</span><span> cell</span><span style=color:#81a1c1>.</span><span>bg </span><span style=color:#81a1c1>!=</span><span> bg</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>                let</span><span> color</span><span style=color:#81a1c1> =</span><span style=color:#8fbcbb> CColor</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>from</span><span style=color:#eceff4>(</span><span>cell</span><span style=color:#81a1c1>.</span><span>bg</span><span style=color:#eceff4>);</span></span>
<span class=giallo-l><span style=color:#88c0d0>                map_error</span><span style=color:#eceff4>(</span><span style=color:#88c0d0;font-weight:700>queue!</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>self.</span><span>buffer</span><span style=color:#eceff4>,</span><span style=color:#88c0d0> SetBackgroundColor</span><span style=color:#eceff4>(</span><span>color</span><span style=color:#eceff4>)))</span><span style=color:#81a1c1>?</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span>                bg</span><span style=color:#81a1c1> =</span><span> cell</span><span style=color:#81a1c1>.</span><span>bg</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#eceff4>            }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>            let mut</span><span> new_underline_style</span><span style=color:#81a1c1> =</span><span> cell</span><span style=color:#81a1c1>.</span><span>underline_style</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>            if self.</span><span>capabilities</span><span style=color:#81a1c1>.</span><span>has_extended_underlines </span><span style=color:#eceff4>{</span></span>
<span class=giallo-l><span style=color:#81a1c1>                if</span><span> cell</span><span style=color:#81a1c1>.</span><span>underline_color </span><span style=color:#81a1c1>!=</span><span> underline_color</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>                    let</span><span> color</span><span style=color:#81a1c1> =</span><span style=color:#8fbcbb> CColor</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>from</span><span style=color:#eceff4>(</span><span>cell</span><span style=color:#81a1c1>.</span><span>underline_color</span><span style=color:#eceff4>);</span></span>
<span class=giallo-l><span style=color:#88c0d0>                    map_error</span><span style=color:#eceff4>(</span><span style=color:#88c0d0;font-weight:700>queue!</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>self.</span><span>buffer</span><span style=color:#eceff4>,</span><span style=color:#88c0d0> SetUnderlineColor</span><span style=color:#eceff4>(</span><span>color</span><span style=color:#eceff4>)))</span><span style=color:#81a1c1>?</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span>                    underline_color</span><span style=color:#81a1c1> =</span><span> cell</span><span style=color:#81a1c1>.</span><span>underline_color</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#eceff4>                }</span></span>
<span class=giallo-l><span style=color:#eceff4>            }</span><span style=color:#81a1c1> else</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>                match</span><span> new_underline_style</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#8fbcbb>                    UnderlineStyle</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Reset</span><span style=color:#81a1c1> |</span><span style=color:#8fbcbb> UnderlineStyle</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Line</span><span style=color:#81a1c1> =></span><span style=color:#eceff4> (),</span></span>
<span class=giallo-l><span>                    _</span><span style=color:#81a1c1> =></span><span> new_underline_style</span><span style=color:#81a1c1> =</span><span style=color:#8fbcbb> UnderlineStyle</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Line</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#eceff4>                }</span></span>
<span class=giallo-l><span style=color:#eceff4>            }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>            if</span><span> new_underline_style</span><span style=color:#81a1c1> !=</span><span> underline_style</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>                let</span><span> attr</span><span style=color:#81a1c1> =</span><span style=color:#8fbcbb> CAttribute</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>from</span><span style=color:#eceff4>(</span><span>new_underline_style</span><span style=color:#eceff4>);</span></span>
<span class=giallo-l><span style=color:#88c0d0>                map_error</span><span style=color:#eceff4>(</span><span style=color:#88c0d0;font-weight:700>queue!</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>self.</span><span>buffer</span><span style=color:#eceff4>,</span><span style=color:#88c0d0> SetAttribute</span><span style=color:#eceff4>(</span><span>attr</span><span style=color:#eceff4>)))</span><span style=color:#81a1c1>?</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span>                underline_style</span><span style=color:#81a1c1> =</span><span> new_underline_style</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#eceff4>            }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#88c0d0>            map_error</span><span style=color:#eceff4>(</span><span style=color:#88c0d0;font-weight:700>queue!</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>self.</span><span>buffer</span><span style=color:#eceff4>,</span><span style=color:#88c0d0> Print</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&</span><span>cell</span><span style=color:#81a1c1>.</span><span>symbol</span><span style=color:#eceff4>)))</span><span style=color:#81a1c1>?</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#eceff4>        }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#88c0d0>        map_error</span><span style=color:#eceff4>(</span><span style=color:#88c0d0;font-weight:700>queue!</span><span style=color:#eceff4>(</span></span>
<span class=giallo-l><span style=color:#81a1c1>            self.</span><span>buffer</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#88c0d0>            SetUnderlineColor</span><span style=color:#eceff4>(</span><span>CColor</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Reset</span><span style=color:#eceff4>),</span></span>
<span class=giallo-l><span style=color:#88c0d0>            SetForegroundColor</span><span style=color:#eceff4>(</span><span>CColor</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Reset</span><span style=color:#eceff4>),</span></span>
<span class=giallo-l><span style=color:#88c0d0>            SetBackgroundColor</span><span style=color:#eceff4>(</span><span>CColor</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Reset</span><span style=color:#eceff4>),</span></span>
<span class=giallo-l><span style=color:#88c0d0>            SetAttribute</span><span style=color:#eceff4>(</span><span>CAttribute</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Reset</span><span style=color:#eceff4>)</span></span>
<span class=giallo-l><span style=color:#eceff4>        ))</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p><a href=https://github.com/helix-editor/helix/blob/0097e191bb9f9f144043c2afcf04bc8632021281/helix-tui/src/backend/crossterm.rs#L191 rel=external>https://github.com/helix-editor/helix/blob/0097e191bb9f9f144043c2afcf04bc8632021281/helix-tui/src/backend/crossterm.rs#L191</a><p>ã“ã“ã¯å®Œå…¨ã«<a href=https://docs.rs/crossterm/latest/crossterm/ rel=external>crossterm</a>å´ã®å‡¦ç†ã«ãªã‚Šã¾ã™ã€‚<br> æ¦‚è¦ã¨ã—ã¦ã¯<code>Cell</code>ã®æƒ…å ±ã‚’crosstermç”¨ã®æƒ…å ±ã«å¤‰æ›ã—ãŸã®ã¡ã«ã€crosstermã®å‡¦ç†ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚<br> <code>queue!</code>ã§std::io::Writeã¨crosstermã®ã‚³ãƒãƒ³ãƒ‰ã‚’æ¸¡ã™ã¨å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚<br> è‡ªåˆ†ãŒã¯ã¾ã£ãŸã®ã¯å†™çµŒã—ã¦ã„ã‚‹éš›ã«ã€<code>MoveTo(x,y)</code>ã‚’æ›¸ã„ã¦ãŠã‚‰ãšã€helixã¨crosstermã§cursorã®å‡¦ç†ãŒã‚ºãƒ¬ã¦ã—ã¾ã„ã€cursorãŒï¼’ã¤å‡ºç¾ã™ã‚‹ã¨ã„ã†ãƒã‚°ã‚’ç™ºç”Ÿã•ã›ã¦ã—ã¾ã£ãŸã“ã¨ã§ã™ã€‚<h2 id=matome><a aria-label="Anchor link for: matome" class=zola-anchor href=#matome>ã¾ã¨ã‚</a></h2><p>ã¨ã„ã†ã“ã¨ã§helixã®renderingå‡¦ç†ã‚’è¿½ã£ã¦ã„ãã¾ã—ãŸã€‚ å®Ÿéš›ã®å‡¦ç†ã¯ã“ã“ã«è¼‰ã›ãŸå‡¦ç†ã‚ˆã‚Šé¥ã‹ã«å¤šãã®ã“ã¨ã‚’ã—ã¦ã„ã¾ã™ãŒã€æ²è¼‰ã—ãŸã‚³ãƒ¼ãƒ‰pathã‚’é€šã‚‹ã¨ã€å®Ÿéš›ã«fileãŒrenderingã•ã‚Œã‚‹ã“ã¨ã¯å†™çµŒã—ãªãŒã‚‰ç¢ºã‹ã‚ã¾ã—ãŸã€‚<br> ã‚³ãƒ¼ãƒ‰ã‚’èª­ã‚“ã§ã„ã‚‹éš›ã«ã€ã“ã“early returnã®ã—å¿˜ã‚Œã˜ã‚ƒãªã„ã‹ãªã¨æ€ã†ã¨ã“ã‚ãŒã‚ã‚Šã€<a href=https://github.com/helix-editor/helix/pull/6856 rel=external>PR</a>ã‚’é€ã£ã¦ã¿ã‚‹ã¨mergeã—ã¦ã‚‚ã‚‰ãˆã¦ã†ã‚Œã—ã‹ã£ãŸã§ã™ã€‚<br> æœ€å¾Œã«renderingå‡¦ç†ã®sequence diagramã‚’è¼‰ã›ã¦ãŠãã¾ã™ã€‚<figure><div class=fig-images-row><img , alt src=images/helix_render_sequence.svg></div><figcaption>Render sequence</figcaption></figure><p>(HighlightEvent iteratorã¨StyleIterã®é–¢ä¿‚ã¯åŠ›å°½ãã¦ã—ã¾ã£ãŸã®ã§ãã®ã†ã¡æ›¸ãã¾ã™)</div></article></main><footer class=blog-footer><p>Â© 2026 <a href=https://blog.ymgyt.io> ymgyt </a> | Made with <a href=https://www.getzola.org rel=noopener target=_blank>Zola</a> | <a href=https://github.com/ymgyt/blog>Repository</a> | <a href=https://blog.ymgyt.io/atom.xml target=_blank title=rss> <svg viewbox="0 0 24 24" class=icon fill=none height=24 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx=5 cy=19 r=1></circle></svg> </a></footer></div></div>