<!doctype html><html lang=ja><head><meta charset=UTF-8><meta content="width=device-width,initial-scale=1" name=viewport><link href=https://blog.ymgyt.io/favicon.ico rel=icon sizes=any><link href=https://blog.ymgyt.io/icon.svg rel=icon type=image/svg+xml><link href=https://blog.ymgyt.io/apple-touch-icon.png rel=apple-touch-icon><link href=https://blog.ymgyt.io/manifest.webmanifest rel=manifest><link href=https://blog.ymgyt.io/style.css rel=stylesheet><link href=https://blog.ymgyt.io/atom.xml rel=alternate title=Atom type=application/atom+xml><script src="https://www.googletagmanager.com/gtag/js?id=G-GTB0KMLN90" async></script><script>window.dataLayer = window.dataLayer || [];
	function gtag() {dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-GTB0KMLN90');</script><title>ğŸ¦€ GATsã«å…¥é–€ã™ã‚‹ | Happy developing</title><meta content="Generic associated typesã«å…¥é–€ã—ã‚ˆã†" name=description><meta content=summary name=twitter:card><meta content="@YAmaguchixt " name=twitter:site><meta content="ğŸ¦€ GATsã«å…¥é–€ã™ã‚‹" name=twitter:title><meta content="Generic associated typesã«å…¥é–€ã—ã‚ˆã†" name=twitter:description><meta content=https://blog.ymgyt.io/images/emoji/crab.png name=twitter:image><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><body><div class=world><div class=content-container><header class=blog-header-container><div class=blog-logo><a href=https://blog.ymgyt.io>Happy developing</a></div><div class=blog-nav><nav><ul><li><a href=https://blog.ymgyt.io/entry/>Entries</a><li><a href=https://blog.ymgyt.io/tags/>Tags</a><li><a href=https://blog.ymgyt.io/about/>About</a><li><a href=https://github.com/ymgyt> <img alt=Github class=icon src=https://blog.ymgyt.io/images/icon/github.svg> </a><li><a href="https://twitter.com/YAmaguchixt "> <img alt=Twitter class=icon src=https://blog.ymgyt.io/images/icon/twitter.svg> </a></ul></nav></div></header><main class=blog-main><article><header class=entry-header><h1 class=entry-title>ğŸ¦€ GATsã«å…¥é–€ã™ã‚‹</h1><div class=entry-meta><p class=entry-meta-item>ğŸ—“ 2023-05-27<p class=entry-meta-item>ğŸ· <span class=tag><a href=https://blog.ymgyt.io/tags/rust/>rust</a></span></div></header><aside class=entry-toc><nav><ul class=entry-toc-toplevel-list><li><a href=https://blog.ymgyt.io/entry/getting-started-with-gats/#the-push-for-gats-stabilization>The push for GATs stabilization</a><li><a href=https://blog.ymgyt.io/entry/getting-started-with-gats/#generic-associated-types-initiative>Generic Associated Types Initiative</a> <ul><li><a href=https://blog.ymgyt.io/entry/getting-started-with-gats/#iterable-trait>Iterable trait</a></ul><li><a href=https://blog.ymgyt.io/entry/getting-started-with-gats/#matome>ã¾ã¨ã‚</a><li><a href=https://blog.ymgyt.io/entry/getting-started-with-gats/#can-kao>å‚è€ƒ</a></ul></nav></aside><div class=entry-content><p>Rustã®Generic associated types(GATs)ãŒ<a href=https://releases.rs/docs/1.65.0/ rel=external>1.65.0</a>ã§stabilizeã¨ãªã‚Šã¾ã—ãŸã€‚<br> ã¨ã„ã†ã“ã¨ã§æœ¬è¨˜äº‹ã§ã¯ã€GATsã«ã¤ã„ã¦ã®å„ç¨®è§£èª¬ç­‰ã‚’èª­ã¿ãªãŒã‚‰ã€GATsã®ç†è§£ã‚’å°‘ã—ã§ã‚‚é€²ã‚ã‚‹ã“ã¨ã‚’ç›®æŒ‡ã—ã¾ã™ã€‚<br> Rustã®versionã¯<code>1.69.0</code>ã‚’åˆ©ç”¨ã—ã¾ã—ãŸã€‚<h2 id=the-push-for-gats-stabilization><a aria-label="Anchor link for: the-push-for-gats-stabilization" class=zola-anchor href=#the-push-for-gats-stabilization>The push for GATs stabilization</a></h2><p>ã¾ãšã¯ã€2021å¹´8æœˆRust blogã®è¨˜äº‹<a href=https://blog.rust-lang.org/2021/08/03/GATs-stabilization-push.html rel=external>The push for GATs stabilization</a>ã‹ã‚‰èª­ã‚“ã§ã„ãã¾ã™ã€‚<br> ãã“ã§ã¯ã€GATsã®å…·ä½“ä¾‹ã¨ã—ã¦ä»¥ä¸‹ã®codeãŒæŒ™ã’ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>trait</span><span style=color:#8fbcbb;font-weight:700> Foo</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    type</span><span style=color:#8fbcbb> Bar</span><span style=color:#eceff4>&lt;'</span><span style=color:#8fbcbb>a</span><span style=color:#eceff4>>;</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p>ä»Šã¾ã§ã¯ã€traitã®associated typeã«ã¯genericsã‚„lifetimeã¯æ›¸ã‘ãªã‹ã£ãŸã®ã§ã™ãŒã€GATsã«ã‚ˆã£ã¦æ›¸ã‘ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚<br> ä»¥å‰ã€<a href=https://blog.ymgyt.io/entry/lifetime-and-variance/ rel=external>Rustã®lifetimeã¨variance</a>ã§ã‚‚æ›¸ã„ãŸã®ã§ã™ãŒã€<code>Vec&lt;T></code>ãŒã€<code>Vec&lt;usize></code>ã®ã‚ˆã†ã«å…·ä½“çš„ãªå‹ã‚’ä¸ãˆã‚‰ã‚Œã¦typeã«ãªã‚‹ã‚ˆã†ã«ã€<code>Bar&lt;'a></code>ã‚‚å…·ä½“çš„ãªlifetimeãŒã‚ãŸãˆã‚‰ã‚Œã¦typeã«ãªã‚‹ã¨ç†è§£ã—ã¦ã„ã¾ã™ã€‚<br> Associated typeã®ã¨ã“ã‚ã«lifetimeãŒæ›¸ã‘ã‚‹ã¨ãªã«ãŒã†ã‚Œã—ã„ã‹ã¨ã„ã†ã¨<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>impl</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>T</span><span style=color:#eceff4>></span><span style=color:#8fbcbb> Foo</span><span style=color:#81a1c1> for</span><span style=color:#8fbcbb> Vec</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>T</span><span style=color:#eceff4>> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    type</span><span style=color:#8fbcbb> Bar</span><span style=color:#eceff4>&lt;'</span><span style=color:#8fbcbb>a</span><span style=color:#eceff4>></span><span style=color:#81a1c1> = &</span><span style=color:#eceff4>'</span><span style=color:#8fbcbb>a T</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p>ã“ã‚“ãªcodeãŒæ›¸ã‘ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚ä»¥å‰ã§ã™ã¨ã€<code>&'a T;</code>ã®<code>'a</code>ã¯å®Ÿè£…ã™ã‚‹structã«å®šç¾©ã•ã‚Œã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã—ãŸã€‚<br> ã¡ãªã¿ã«ä¸Šè¨˜ã®codeã¯compileãŒé€šã‚Šã¾ã›ã‚“ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=plain><span class=giallo-l><span>   |</span></span>
<span class=giallo-l><span>82 |     type Bar&lt;'a> = &'a T;</span></span>
<span class=giallo-l><span>   |                    ^^^^^- help: consider adding a where clause: `where T: 'a`</span></span>
<span class=giallo-l><span>   |                    |</span></span>
<span class=giallo-l><span>   |                    ...so that the reference type `&'a T` does not outlive the data it points at</span></span></code></pre><p>compileé€šã™ã«ã¯çµæœçš„ã«ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>trait</span><span style=color:#8fbcbb;font-weight:700> Foo</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    type</span><span style=color:#8fbcbb> Bar</span><span style=color:#eceff4>&lt;'</span><span style=color:#8fbcbb>a</span><span style=color:#eceff4>></span></span>
<span class=giallo-l><span style=color:#81a1c1>    where</span></span>
<span class=giallo-l><span style=color:#81a1c1>        Self:</span><span style=color:#eceff4> '</span><span style=color:#8fbcbb>a</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>impl</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>T</span><span style=color:#eceff4>></span><span style=color:#8fbcbb> Foo</span><span style=color:#81a1c1> for</span><span style=color:#8fbcbb> Vec</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>T</span><span style=color:#eceff4>> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    type</span><span style=color:#8fbcbb> Bar</span><span style=color:#eceff4>&lt;'</span><span style=color:#8fbcbb>a</span><span style=color:#eceff4>></span><span style=color:#81a1c1> = &</span><span style=color:#eceff4>'</span><span style=color:#8fbcbb>a T</span></span>
<span class=giallo-l><span style=color:#81a1c1>    where</span><span style=color:#8fbcbb> T</span><span style=color:#81a1c1>:</span><span style=color:#eceff4> '</span><span style=color:#8fbcbb>a</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p><code>T</code>ã¯å®Ÿéš›ã«ã¯<code>&str</code>ã‹ã‚‚ã—ã‚Œãªã„ã®ã§ã€<code>&str: 'a</code>ã®åˆ¶ç´„ãŒå¿…è¦ã¨ã„ã‚ã‚Œã‚‹ã®ã¯ãªã‚“ã¨ãªãã‚ã‹ã‚Šã¾ã™ã€‚<p>æ¬¡ã«ã‚‚ã†å°‘ã—å…·ä½“çš„ãªåˆ©ç”¨ä¾‹ãŒç´¹ä»‹ã•ã‚Œã¾ã™ã€‚<br> ã“ã“ã§ã¯mut sliceã®window(sub slice)ã‚’è¿”ã™iteratorã‚’å®Ÿè£…ã—ãŸã„ã¨ã„ã†ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã§ã™ã€‚<br> å…·ä½“çš„ã«ã¯<code>[1,2,3,4,5]</code>ãŒã‚ã£ãŸã¨ãã«<code>[1,2,3], [2,3,4], [3,4,5]</code>ã‚’è¿”ã™ã‚ˆã†ãªiteratorã§ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>struct</span><span style=color:#8fbcbb> WindowsMut</span><span style=color:#eceff4>&lt;'</span><span style=color:#8fbcbb>t</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> T</span><span style=color:#eceff4>> {</span></span>
<span class=giallo-l><span>    slice</span><span style=color:#81a1c1>: &</span><span style=color:#eceff4>'</span><span style=color:#8fbcbb>t</span><span style=color:#81a1c1> mut</span><span style=color:#eceff4> [</span><span style=color:#8fbcbb>T</span><span style=color:#eceff4>],</span></span>
<span class=giallo-l><span>    start</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> usize</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>    window_size</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> usize</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p>ã“ã®<code>WindowsMut</code>ã«<code>Iterator</code>ã‚’å®Ÿè£…ã—ã‚ˆã†ã¨ã™ã‚‹ã¨<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>impl</span><span style=color:#eceff4>&lt;'</span><span style=color:#8fbcbb>t</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> T</span><span style=color:#eceff4>></span><span style=color:#8fbcbb> Iterator</span><span style=color:#81a1c1> for</span><span style=color:#8fbcbb> WindowsMut</span><span style=color:#eceff4>&lt;'</span><span style=color:#8fbcbb>t</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> T</span><span style=color:#eceff4>> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    type</span><span style=color:#8fbcbb> Item</span><span style=color:#81a1c1> = &</span><span style=color:#eceff4>'</span><span style=color:#8fbcbb>t</span><span style=color:#81a1c1> mut</span><span style=color:#eceff4> [</span><span style=color:#8fbcbb>T</span><span style=color:#eceff4>];</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>    fn</span><span style=color:#88c0d0> next</span><span style=color:#eceff4>&lt;'</span><span style=color:#8fbcbb>a</span><span style=color:#eceff4>>(</span><span style=color:#81a1c1>&</span><span style=color:#eceff4>'</span><span style=color:#8fbcbb>a</span><span style=color:#81a1c1> mut self</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> Option</span><span style=color:#eceff4>&lt;</span><span style=color:#81a1c1>Self::</span><span style=color:#8fbcbb>Item</span><span style=color:#eceff4>> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>        let</span><span> retval</span><span style=color:#81a1c1> = self.</span><span>slice</span><span style=color:#eceff4>[</span><span style=color:#81a1c1>self.</span><span>start</span><span style=color:#81a1c1>..</span><span style=color:#eceff4>]</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>get_mut</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>..self.</span><span>window_size</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>?</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>        self.</span><span>start </span><span style=color:#81a1c1>+=</span><span style=color:#b48ead> 1</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#8fbcbb>        Some</span><span style=color:#eceff4>(</span><span>retval</span><span style=color:#eceff4>)</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=plain><span class=giallo-l><span>error: lifetime may not live long enough</span></span>
<span class=giallo-l><span>  --> src/lending.rs:21:9</span></span>
<span class=giallo-l><span>   |</span></span>
<span class=giallo-l><span>15 | impl&lt;'t, T> Iterator for WindowsMut&lt;'t, T> {</span></span>
<span class=giallo-l><span>   |      -- lifetime `'t` defined here</span></span>
<span class=giallo-l><span>...</span></span>
<span class=giallo-l><span>18 |     fn next&lt;'a>(&'a mut self) -> Option&lt;Self::Item> {</span></span>
<span class=giallo-l><span>   |             -- lifetime `'a` defined here</span></span>
<span class=giallo-l><span>...</span></span>
<span class=giallo-l><span>21 |         Some(retval)</span></span>
<span class=giallo-l><span>   |         ^^^^^^^^^^^^ method was supposed to return data with lifetime `'t` but it is returning data with lifetime `'a`</span></span>
<span class=giallo-l><span>   |</span></span>
<span class=giallo-l><span>   = help: consider adding the following bound: `'a: 't`</span></span></code></pre><p><code>self.slice</code>ã®å‚ç…§ã‚’è¿”ã—ã¦ã„ã‚‹ã®ã§ã€<code>'a: 't</code>ã®åˆ¶ç´„ãŒå¿…è¦ã¨ãªã‚Šã€compile errorã¨ãªã‚Šã¾ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>fn</span><span style=color:#88c0d0> next</span><span style=color:#eceff4>&lt;'</span><span style=color:#8fbcbb>a</span><span style=color:#eceff4>>(</span><span style=color:#81a1c1>&</span><span style=color:#eceff4>'</span><span style=color:#8fbcbb>a</span><span style=color:#81a1c1> mut self</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> Option</span><span style=color:#eceff4>&lt;</span><span style=color:#81a1c1>Self::</span><span style=color:#8fbcbb>Item</span><span style=color:#eceff4>></span></span>
<span class=giallo-l><span style=color:#81a1c1>where</span></span>
<span class=giallo-l><span style=color:#eceff4>    '</span><span style=color:#8fbcbb>a</span><span style=color:#81a1c1>:</span><span style=color:#eceff4> '</span><span style=color:#8fbcbb>t</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#eceff4>{</span><span style=color:#616e88> /* ... */</span><span style=color:#eceff4> }</span></span></code></pre><p>ã®ã‚ˆã†ã«<code>where 'a: 't'</code>ã‚’ã¤ã‘ã‚‹ã¨ä»Šåº¦ã¯<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=plain><span class=giallo-l><span>error[E0195]: lifetime parameters or bounds on method `next` do not match the trait declaration</span></span>
<span class=giallo-l><span>  --> src/lending.rs:18:12</span></span>
<span class=giallo-l><span>   |</span></span>
<span class=giallo-l><span>18 |     fn next&lt;'a>(&'a mut self) -> Option&lt;Self::Item></span></span>
<span class=giallo-l><span>   |            ^^^^ lifetimes do not match method in trait</span></span></code></pre><p><code>Iteraotr</code> traitã«ãã‚“ãªåˆ¶ç´„ã¯ãªã„ã®ã§ã“ã‚Œã‚‚compile errorã¨ãªã£ã¦ã—ã¾ã„ã¾ã™ã€‚<p>ãã“ã§ã€GATsã‚’åˆ©ç”¨ã—ãŸã€<code>LendingIterator</code>ã‚’å®šç¾©ã—ã¾ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>trait</span><span style=color:#8fbcbb;font-weight:700> LendingIterator</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    type</span><span style=color:#8fbcbb> Item</span><span style=color:#eceff4>&lt;'</span><span style=color:#8fbcbb>a</span><span style=color:#eceff4>></span></span>
<span class=giallo-l><span style=color:#81a1c1>    where</span></span>
<span class=giallo-l><span style=color:#81a1c1>        Self:</span><span style=color:#eceff4> '</span><span style=color:#8fbcbb>a</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>    fn</span><span style=color:#88c0d0> next</span><span style=color:#eceff4>&lt;'</span><span style=color:#8fbcbb>a</span><span style=color:#eceff4>>(</span><span style=color:#81a1c1>&</span><span style=color:#eceff4>'</span><span style=color:#8fbcbb>a</span><span style=color:#81a1c1> mut self</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> Option</span><span style=color:#eceff4>&lt;</span><span style=color:#81a1c1>Self::</span><span style=color:#8fbcbb>Item</span><span style=color:#eceff4>&lt;'</span><span style=color:#8fbcbb>a</span><span style=color:#eceff4>>>;</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p>ã“ã‚Œã¯<code>self.next()</code>ã®æˆ»ã‚Šå€¤ã‚’åˆ©ç”¨ã—ã¦ã„ã‚‹é–“ã ã‘æœ‰åŠ¹ãª<code>Item</code>ã‚’è¿”ã™<code>Iterator</code>ã¨èª­ã‚ã¾ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>impl</span><span style=color:#eceff4>&lt;'</span><span style=color:#8fbcbb>t</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> T</span><span style=color:#eceff4>></span><span style=color:#8fbcbb> LendingIterator</span><span style=color:#81a1c1> for</span><span style=color:#8fbcbb> WindowsMut</span><span style=color:#eceff4>&lt;'</span><span style=color:#8fbcbb>t</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> T</span><span style=color:#eceff4>> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    type</span><span style=color:#8fbcbb> Item</span><span style=color:#eceff4>&lt;'</span><span style=color:#8fbcbb>a</span><span style=color:#eceff4>></span></span>
<span class=giallo-l><span style=color:#81a1c1>    where</span></span>
<span class=giallo-l><span style=color:#81a1c1>        Self:</span><span style=color:#eceff4> '</span><span style=color:#8fbcbb>a</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#81a1c1>    = &</span><span style=color:#eceff4>'</span><span style=color:#8fbcbb>a</span><span style=color:#81a1c1> mut</span><span style=color:#eceff4> [</span><span style=color:#8fbcbb>T</span><span style=color:#eceff4>];</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>    fn</span><span style=color:#88c0d0> next</span><span style=color:#eceff4>&lt;'</span><span style=color:#8fbcbb>a</span><span style=color:#eceff4>>(</span><span style=color:#81a1c1>&</span><span style=color:#eceff4>'</span><span style=color:#8fbcbb>a</span><span style=color:#81a1c1> mut self</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> Option</span><span style=color:#eceff4>&lt;</span><span style=color:#81a1c1>Self::</span><span style=color:#8fbcbb>Item</span><span style=color:#eceff4>&lt;'</span><span style=color:#8fbcbb>a</span><span style=color:#eceff4>>> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>        let</span><span> retval</span><span style=color:#81a1c1> = self.</span><span>slice</span><span style=color:#eceff4>[</span><span style=color:#81a1c1>self.</span><span>start</span><span style=color:#81a1c1>..</span><span style=color:#eceff4>]</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>get_mut</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>..self.</span><span>window_size</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>?</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>        self.</span><span>start </span><span style=color:#81a1c1>+=</span><span style=color:#b48ead> 1</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#8fbcbb>        Some</span><span style=color:#eceff4>(</span><span>retval</span><span style=color:#eceff4>)</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p>å®Ÿè£…ã¯<code>Iterator</code>ã¨åŒã˜ã§ã™ãŒã€<code>Item</code>ã®lifetimeã«å‘¼ã³å‡ºã—æ™‚ã®lifetimeã‚’æ¸¡ã›ã¦ã„ã¾ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>fn</span><span style=color:#88c0d0> main</span><span style=color:#eceff4>() {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    let mut</span><span> v</span><span style=color:#81a1c1> =</span><span style=color:#eceff4> [</span><span style=color:#b48ead>1</span><span style=color:#eceff4>,</span><span style=color:#b48ead> 2</span><span style=color:#eceff4>,</span><span style=color:#b48ead> 3</span><span style=color:#eceff4>,</span><span style=color:#b48ead> 4</span><span style=color:#eceff4>,</span><span style=color:#b48ead> 5</span><span style=color:#eceff4>];</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>    let mut</span><span> w</span><span style=color:#81a1c1> =</span><span style=color:#8fbcbb> WindowsMut</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span>        slice</span><span style=color:#81a1c1>: &mut</span><span> v</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>        start</span><span style=color:#81a1c1>:</span><span style=color:#b48ead> 0</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>        window_size</span><span style=color:#81a1c1>:</span><span style=color:#b48ead> 3</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#eceff4>    };</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>    while let</span><span style=color:#8fbcbb> Some</span><span style=color:#eceff4>(</span><span>window</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> =</span><span> w</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>next</span><span style=color:#eceff4>() {</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>        println!</span><span style=color:#eceff4>("</span><span style=color:#ebcb8b>{</span><span style=color:#a3be8c>window:?</span><span style=color:#ebcb8b>}</span><span style=color:#eceff4>");</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#616e88>// => [1, 2, 3]</span></span>
<span class=giallo-l><span style=color:#616e88>// => [2, 3, 4]</span></span>
<span class=giallo-l><span style=color:#616e88>// => [3, 4, 5]</span></span></code></pre><p>ç„¡äº‹ã€windowã‚’è¿”ã™ã“ã¨ãŒã§ãã¾ã—ãŸã€‚<br> è¨˜äº‹ã§ã‚‚è§¦ã‚Œã‚‰ã‚Œã¦ã„ã¾ã™ãŒã€<code>type Item&lt;'a> where Self: 'a</code>ãŒãªãœå¿…è¦ã‹ã¨ã„ã†ã¨<br> <code>fn next&lt;'static>(&'static mut self) -> Option&lt;Self::Item&lt;'static>></code> ã®ã‚ˆã†ãªcodeã‚’æ›¸ã‘ãªãã™ã‚‹ãŸã‚ã¿ãŸã„ã§ã™ã€‚<br> ã“ã®ç‚¹ã¯<a href=https://github.com/rust-lang/rust/issues/87479 rel=external>issue</a>ã«ãªã£ã¦ãŠã‚Šå°†æ¥çš„ã«ã¯æš—é»™çš„ã«ä»®å®šã•ã‚Œã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚<h2 id=generic-associated-types-initiative><a aria-label="Anchor link for: generic-associated-types-initiative" class=zola-anchor href=#generic-associated-types-initiative>Generic Associated Types Initiative</a></h2><p>æ¬¡ã¯<a href=https://github.com/rust-lang/generic-associated-types-initiative rel=external>Generic Associated Types Initiative</a>ãŒæä¾›ã—ã¦ãã‚Œã¦ã„ã‚‹bookã‚’ã¿ã¦ã„ãã¾ã™ã€‚ GATsã«é–¢ã™ã‚‹éå»ã‚ã£ãŸè­°è«–ã‚‚æ•´ç†ã•ã‚Œã¦ãŠã‚Šã€RFCã‚„issueã®ã‚³ãƒ¡ãƒ³ãƒˆã¯é•·ãå…¨éƒ¨èª­ã‚€ã®ã¯å¤§å¤‰ãªã®ã§åŠ©ã‹ã‚Šã¾ã—ãŸã€‚<br> ä¾‹ãˆã°ã€GATsã¯Rustã®<a href=https://rust-lang.github.io/generic-associated-types-initiative/mvp/concern-too-complex.html rel=external>è¤‡é›‘åº¦ã‚’ä¸Šã’ã™ãã¦ã—ã¾ã†æ‡¸å¿µ</a>ã®è©±ã¯é ·ã‘ã‚‹ã¨ã“ã‚å¤šã‹ã£ãŸã§ã™ã€‚<h3 id=iterable-trait><a aria-label="Anchor link for: iterable-trait" class=zola-anchor href=#iterable-trait><code>Iterable</code> trait</a></h3><p>æ¬¡ã¯<code>Iterable</code> traitã‚’é€šã—ã¦GATsã®ä½¿ã„æ‰€ã‚’ã¿ã¦ã„ãã¾ã™ã€‚<p>ã¾ãšä»¥ä¸‹ã®ã‚ˆã†ã«ä»Šã¾ã§é€šã‚Š<code>Iterator</code>ã‚’å®Ÿè£…ã—ã¦ã¿ã¾ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>struct</span><span style=color:#8fbcbb> Iter</span><span style=color:#eceff4>&lt;'</span><span style=color:#8fbcbb>c</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> T</span><span style=color:#eceff4>> {</span></span>
<span class=giallo-l><span>    data</span><span style=color:#81a1c1>: &</span><span style=color:#eceff4>'</span><span style=color:#8fbcbb>c</span><span style=color:#eceff4> [</span><span style=color:#8fbcbb>T</span><span style=color:#eceff4>],</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>impl</span><span style=color:#eceff4>&lt;'</span><span style=color:#8fbcbb>c</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> T</span><span style=color:#eceff4>></span><span style=color:#8fbcbb> Iterator</span><span style=color:#81a1c1> for</span><span style=color:#8fbcbb> Iter</span><span style=color:#eceff4>&lt;'</span><span style=color:#8fbcbb>c</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> T</span><span style=color:#eceff4>> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    type</span><span style=color:#8fbcbb> Item</span><span style=color:#81a1c1> = &</span><span style=color:#eceff4>'</span><span style=color:#8fbcbb>c T</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>    fn</span><span style=color:#88c0d0> next</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&mut self</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> Option</span><span style=color:#eceff4>&lt;</span><span style=color:#81a1c1>Self::</span><span style=color:#8fbcbb>Item</span><span style=color:#eceff4>> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>        if let</span><span style=color:#8fbcbb> Some</span><span style=color:#eceff4>((</span><span>head</span><span style=color:#eceff4>,</span><span> remain</span><span style=color:#eceff4>))</span><span style=color:#81a1c1> = self.</span><span>data</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>split_first</span><span style=color:#eceff4>() {</span></span>
<span class=giallo-l><span style=color:#81a1c1>            self.</span><span>data </span><span style=color:#81a1c1>=</span><span> remain</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#8fbcbb>            Some</span><span style=color:#eceff4>(</span><span>head</span><span style=color:#eceff4>)</span></span>
<span class=giallo-l><span style=color:#eceff4>        }</span><span style=color:#81a1c1> else</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#8fbcbb>            None</span></span>
<span class=giallo-l><span style=color:#eceff4>        }</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p>ã“ã“ã§æ¬¡ã®ã‚ˆã†ã«ã€ã‚ã‚‹å‡¦ç†ã®ä¸­ã§è¤‡æ•°å›iterateã—ãŸã„ã®ã§ã€iteratorã‚’è¿”ã›ã‚‹collectionã‚’å¼•æ•°ã«ã—ãŸå‡¦ç†ã‚’æ›¸ããŸã„ã¨ã—ã¾ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>fn</span><span style=color:#88c0d0> count_twice</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>I</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Iterator</span><span style=color:#eceff4>>(</span><span>collection</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> I</span><span style=color:#eceff4>) {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    let mut</span><span> count</span><span style=color:#81a1c1> =</span><span style=color:#b48ead> 0</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>    for</span><span> _</span><span style=color:#81a1c1> in</span><span> collection</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span>        count</span><span style=color:#81a1c1> +=</span><span style=color:#b48ead> 1</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>    for</span><span> elem</span><span style=color:#81a1c1> in</span><span> collection</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#88c0d0>        process</span><span style=color:#eceff4>(</span><span>elem</span><span style=color:#eceff4>,</span><span> count</span><span style=color:#eceff4>)</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>fn</span><span style=color:#88c0d0> process</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>T</span><span style=color:#eceff4>>(</span><span>_elem</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> T</span><span style=color:#eceff4>,</span><span> _count</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> usize</span><span style=color:#eceff4>) {}</span></span></code></pre><p>ã“ã‚Œã¯ä»¥ä¸‹ã®ã‚ˆã†ã«2å›ç›®ã®for loopã§moveã—ãŸå€¤ã‚’åˆ©ç”¨ã—ã¦ã„ã‚‹ã®ã§compileãŒé€šã‚Šã¾ã›ã‚“ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=plain><span class=giallo-l><span>28  |     for elem in collection {</span></span>
<span class=giallo-l><span>    |                 ^^^^^^^^^^ value used here after move</span></span>
<span class=giallo-l><span>    |</span></span></code></pre><p>ã¨ã„ã†ã“ã¨ã§ã€<code>Iterator</code>ã‚’è¿”ã›ã‚‹ã“ã¨ã‚’æŠ½è±¡åŒ–ã—ãŸ<code>Iterable</code> traitã‚’ä½œã‚‹ã“ã¨ã«ã—ã¾ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>trait</span><span style=color:#8fbcbb;font-weight:700> Iterable</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    type</span><span style=color:#8fbcbb> Item</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>    type</span><span style=color:#8fbcbb> Iter</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Iterator</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Item</span><span style=color:#81a1c1> = Self::</span><span style=color:#8fbcbb>Item</span><span style=color:#eceff4>>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>    fn</span><span style=color:#88c0d0> iter</span><span style=color:#eceff4>&lt;'</span><span style=color:#8fbcbb>c</span><span style=color:#eceff4>>(</span><span style=color:#81a1c1>&</span><span style=color:#eceff4>'</span><span style=color:#8fbcbb>c</span><span style=color:#81a1c1> self</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -> Self::</span><span style=color:#8fbcbb>Iter</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p><code>Iter</code>ãŒ<code>Iterator</code>ã§<code>Item</code>ã‚’è¿”ã—ã¾ã™ã€‚<a href=https://doc.rust-lang.org/std/iter/trait.IntoIterator.html rel=external><code>IntoIterator</code></a>ã®<code>&self</code>ç‰ˆã¨ã„ã£ãŸæ„Ÿã˜ã§ã™ã€‚<br> <code>&[T]</code>ã¯è¤‡æ•°å›<code>Iterator</code>ã‚’è¿”ã›ã‚‹ã®ã§<code>Iterable</code>ã‚’å®Ÿè£…ã—ãŸã„ã¨ã“ã‚ã§ã™ãŒ..<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>impl</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>T</span><span style=color:#eceff4>></span><span style=color:#8fbcbb> Iterable</span><span style=color:#81a1c1> for</span><span style=color:#eceff4> [</span><span style=color:#8fbcbb>T</span><span style=color:#eceff4>] {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    type</span><span style=color:#8fbcbb> Item</span><span style=color:#81a1c1> = &</span><span style=color:#eceff4>'</span><span style=color:#8fbcbb>what T</span><span style=color:#eceff4>;</span><span style=color:#616e88> // ğŸ‘ˆ</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>    type</span><span style=color:#8fbcbb> Iter</span><span style=color:#81a1c1> =</span><span style=color:#8fbcbb> Iter</span><span style=color:#eceff4>&lt;'</span><span style=color:#8fbcbb>what</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> T</span><span style=color:#eceff4>>;</span><span style=color:#616e88> // ğŸ‘ˆ</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>    fn</span><span style=color:#88c0d0> iter</span><span style=color:#eceff4>&lt;'</span><span style=color:#8fbcbb>c</span><span style=color:#eceff4>>(</span><span style=color:#81a1c1>&</span><span style=color:#eceff4>'</span><span style=color:#8fbcbb>c</span><span style=color:#81a1c1> self</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -> Self::</span><span style=color:#8fbcbb>Iter</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#616e88>        //        ^^ ã“ã®lifetimeã‚’'whatã§ä½¿ã„ãŸã„</span></span>
<span class=giallo-l><span style=color:#8fbcbb>        Iter</span><span style=color:#eceff4> {</span><span> data</span><span style=color:#81a1c1>: self</span><span style=color:#eceff4> }</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p>ã“ã“ã§<code>&'what</code> lifetimeã‚’ã©ã“ã‹ã‚‰ã‚‚ã£ã¦ãã‚‹ã‹ã§å•é¡ŒãŒç”Ÿã˜ã¾ã™ã€‚GATsãŒãªã„ã¨ä»Šã¾ã§ã¯ã€<code>impl&lt;'a> Iterable for A&lt;'a></code>ã®ã‚ˆã†ã«implã«lifetimeæ›¸ãå¿…è¦ãŒã‚ã‚Šã¾ã—ãŸãŒã€ä»Šå›ã®<code>[T]</code>ã«ã¯lifetimeãŒã§ã¦ãã¾ã›ã‚“ã€‚<br> ã¨ã„ã†ã‚ã‘ã§ã€<code>Iterable</code> traitã‚’GATsã‚’ä½¿ã£ã¦æ›¸ãç›´ã—ã¾ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>trait</span><span style=color:#8fbcbb;font-weight:700> Iterable</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    type</span><span style=color:#8fbcbb> Item</span><span style=color:#eceff4>&lt;'</span><span style=color:#8fbcbb>collection</span><span style=color:#eceff4>></span></span>
<span class=giallo-l><span style=color:#81a1c1>    where</span></span>
<span class=giallo-l><span style=color:#81a1c1>        Self:</span><span style=color:#eceff4> '</span><span style=color:#8fbcbb>collection</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>    type</span><span style=color:#8fbcbb> Iterator</span><span style=color:#eceff4>&lt;'</span><span style=color:#8fbcbb>collection</span><span style=color:#eceff4>></span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Iterator</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Item</span><span style=color:#81a1c1> = Self::</span><span style=color:#8fbcbb>Item</span><span style=color:#eceff4>&lt;'</span><span style=color:#8fbcbb>collection</span><span style=color:#eceff4>>></span></span>
<span class=giallo-l><span style=color:#81a1c1>    where</span></span>
<span class=giallo-l><span style=color:#81a1c1>        Self:</span><span style=color:#eceff4> '</span><span style=color:#8fbcbb>collection</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>    fn</span><span style=color:#88c0d0> iter</span><span style=color:#eceff4>&lt;'</span><span style=color:#8fbcbb>c</span><span style=color:#eceff4>>(</span><span style=color:#81a1c1>&</span><span style=color:#eceff4>'</span><span style=color:#8fbcbb>c</span><span style=color:#81a1c1> self</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -> Self::</span><span style=color:#8fbcbb>Iterator</span><span style=color:#eceff4>&lt;'</span><span style=color:#8fbcbb>c</span><span style=color:#eceff4>>;</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p><code>Item</code>ã¨<code>Iter</code>ã«lifetimeã‚’æ¸¡ã—ãŸã„ã®ã§ã€traitå´ã§å®šç¾©ã—ã¾ã™ã€‚<br> å®Ÿè£…ã¯traitå´ã®lifetimeã‚’ä½¿ã†ã ã‘ã§ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>impl</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>T</span><span style=color:#eceff4>></span><span style=color:#8fbcbb> Iterable</span><span style=color:#81a1c1> for</span><span style=color:#eceff4> [</span><span style=color:#8fbcbb>T</span><span style=color:#eceff4>] {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    type</span><span style=color:#8fbcbb> Item</span><span style=color:#eceff4>&lt;'</span><span style=color:#8fbcbb>c</span><span style=color:#eceff4>></span><span style=color:#81a1c1> = &</span><span style=color:#eceff4>'</span><span style=color:#8fbcbb>c T</span><span style=color:#81a1c1> where</span><span style=color:#8fbcbb> T</span><span style=color:#81a1c1>:</span><span style=color:#eceff4> '</span><span style=color:#8fbcbb>c</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>    type</span><span style=color:#8fbcbb> Iterator</span><span style=color:#eceff4>&lt;'</span><span style=color:#8fbcbb>c</span><span style=color:#eceff4>></span><span style=color:#81a1c1> =</span><span style=color:#8fbcbb> Iter</span><span style=color:#eceff4>&lt;'</span><span style=color:#8fbcbb>c</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb>T</span><span style=color:#eceff4>></span><span style=color:#81a1c1> where</span><span style=color:#8fbcbb> T</span><span style=color:#81a1c1>:</span><span style=color:#eceff4> '</span><span style=color:#8fbcbb>c</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>    fn</span><span style=color:#88c0d0> iter</span><span style=color:#eceff4>&lt;'</span><span style=color:#8fbcbb>c</span><span style=color:#eceff4>>(</span><span style=color:#81a1c1>&</span><span style=color:#eceff4>'</span><span style=color:#8fbcbb>c</span><span style=color:#81a1c1> self</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -> Self::</span><span style=color:#8fbcbb>Iterator</span><span style=color:#eceff4>&lt;'</span><span style=color:#8fbcbb>c</span><span style=color:#eceff4>> {</span></span>
<span class=giallo-l><span style=color:#8fbcbb>        Iter</span><span style=color:#eceff4> {</span><span> data</span><span style=color:#81a1c1>: self</span><span style=color:#eceff4> }</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p><code>fn count_twice&lt;I: Iterable + ?Sized>(collection: &I) { /* ... */}</code> Sizedåˆ¶ç´„ã‚’opt outã™ã‚‹ã¨ç„¡äº‹compileãŒé€šã‚Šã¾ã—ãŸã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>fn</span><span style=color:#88c0d0> main</span><span style=color:#eceff4>() {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    let</span><span> array</span><span style=color:#81a1c1> =</span><span style=color:#eceff4> [</span><span style=color:#b48ead>1</span><span style=color:#eceff4>,</span><span style=color:#b48ead> 2</span><span style=color:#eceff4>,</span><span style=color:#b48ead> 3</span><span style=color:#eceff4>];</span></span>
<span class=giallo-l><span style=color:#88c0d0>    count_twice</span><span style=color:#eceff4>(</span><span>array</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>as_slice</span><span style=color:#eceff4>());</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p>è¦ã¯GATsã«ã‚ˆã£ã¦ã€å‘¼ã³å‡ºã—å´ãŒä½¿ã£ã¦ã„ã‚‹é–“ã ã‘æœ‰åŠ¹ãª<code>self</code>ã®dataã®å‚ç…§ã‚’è¿”ã›ã‚‹ã‚ˆã†ã«ãªã£ãŸã¨ç†è§£ã—ã¦ã„ã¾ã™ã€‚<p>bookã«ã¯GATsã‚’å®Ÿéš›ã«åˆ©ç”¨ã—ã¦ã„ã‚‹<a href=https://rust-lang.github.io/generic-associated-types-initiative/design_patterns.html rel=external>crateã®list</a>ã‚‚è¼‰ã£ã¦ã„ãŸã‚Šã—ã¾ã—ãŸã€‚<br> ã¾ãŸã€<code>Iterable</code>ã‚„<code>LendingIterator</code>ä»¥å¤–ã«ã‚‚ã€GATsã®design patternã¨ã—ã¦ã€Many modeã‚„generics scopesã‚‚å–ã‚Šä¸Šã’ã‚‰ã‚Œã¦ã„ã¾ã—ãŸã€‚<br> Many modeã«ã¤ã„ã¦ã¯ã‚ã‹ã‚‰ãªã„ã“ã¨ãŒå¤šãã€ä»Šå¾Œã®èª²é¡Œã§ã™ã€‚<h2 id=matome><a aria-label="Anchor link for: matome" class=zola-anchor href=#matome>ã¾ã¨ã‚</a></h2><p>GATsã®ä¸€åˆ©ç”¨ä¾‹ã‚’ã¿ã¦ãã¾ã—ãŸã€‚ä»Šå¾Œã¯libraryç­‰ã§ã‚‚ä½¿ã‚ã‚Œã¦ãã‚‹ã“ã¨ãŒå¢—ãˆã¦ãã‚‹ã®ã§ã¯ã¨æ€ã£ã¦ã„ã‚‹ã®ã§ã†ã¾ã„ä½¿ã„æ‰€ã‚’è¦‹ã¤ã‘ã¦ã„ããŸã„ã§ã™ã€‚<h2 id=can-kao><a aria-label="Anchor link for: can-kao" class=zola-anchor href=#can-kao>å‚è€ƒ</a></h2><ul><li><a href=https://github.com/rust-lang/rust/pull/96709/ rel=external>PR</a><li><a href=https://github.com/rust-lang/rfcs/pull/1598 rel=external>RFC PR</a><li><a href=https://github.com/rust-lang/rfcs/blob/master/text/1598-generic_associated_types.md rel=external>RFC</a><li><a href=https://jackh726.github.io/rust/2022/05/04/a-shiny-future-with-gats.html rel=external>A shiny future with GATs</a><li><a href=http://smallcultfollowing.com/babysteps/blog/2016/11/02/associated-type-constructors-part-1-basic-concepts-and-introduction/ rel=external>Associated type constructors, part 1</a><li><a href=https://doc.rust-lang.org/nightly/reference/items/associated-items.html rel=external>Associated items rust nightly reference</a><li><a href=https://github.com/rust-lang/rust/pull/96709#issuecomment-1173170243 rel=external>GATsã‚’å¿…è¦ã¨ã—ã¦ã„ãŸcrates</a><li><a href=https://github.com/rust-lang/rust/pull/96709#issuecomment-1129311660 rel=external>Strong concerns about GAT stabilization</a><li><a href=https://rust-lang.github.io/generic-associated-types-initiative/index.html rel=external>Generic Associated Types initiative</a></ul></div></article></main><footer class=blog-footer><p>Â© 2026 <a href=https://blog.ymgyt.io> ymgyt </a> | Made with <a href=https://www.getzola.org rel=noopener target=_blank>Zola</a> | <a href=https://github.com/ymgyt/blog>Repository</a> | <a href=https://blog.ymgyt.io/atom.xml target=_blank title=rss> <svg viewbox="0 0 24 24" class=icon fill=none height=24 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx=5 cy=19 r=1></circle></svg> </a></footer></div></div>