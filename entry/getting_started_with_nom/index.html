<!doctype html><html lang=ja><head><meta charset=UTF-8><meta content="width=device-width,initial-scale=1" name=viewport><link href=https://blog.ymgyt.io/favicon.ico rel=icon sizes=any><link href=https://blog.ymgyt.io/icon.svg rel=icon type=image/svg+xml><link href=https://blog.ymgyt.io/apple-touch-icon.png rel=apple-touch-icon><link href=https://blog.ymgyt.io/manifest.webmanifest rel=manifest><link href=https://blog.ymgyt.io/style.css rel=stylesheet><link href=https://blog.ymgyt.io/atom.xml rel=alternate title=Atom type=application/atom+xml><script src="https://www.googletagmanager.com/gtag/js?id=G-GTB0KMLN90" async></script><script>window.dataLayer = window.dataLayer || [];
	function gtag() {dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-GTB0KMLN90');</script><title>ğŸª Parser combinator nom å…¥é–€ | Happy developing</title><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><body><div class=world><div class=content-container><header class=blog-header-container><div class=blog-logo><a href=https://blog.ymgyt.io>Happy developing</a></div><div class=blog-nav><nav><ul><li><a href=https://blog.ymgyt.io/entry/>Entries</a><li><a href=https://blog.ymgyt.io/tags/>Tags</a><li><a href=https://blog.ymgyt.io/about/>About</a><li><a href=https://github.com/ymgyt> <img alt=Github class=icon src=https://blog.ymgyt.io/images/icon/github.svg> </a><li><a href="https://twitter.com/YAmaguchixt "> <img alt=Twitter class=icon src=https://blog.ymgyt.io/images/icon/twitter.svg> </a></ul></nav></div></header><main class=blog-main><article><header class=entry-header><h1 class=entry-title>ğŸª Parser combinator nom å…¥é–€</h1><div class=entry-meta><p class=entry-meta-item>ğŸ—“ 2021-05-01<p class=entry-meta-item>ğŸ· <span class=tag><a href=https://blog.ymgyt.io/tags/rust/>rust</a></span></div></header><aside class=entry-toc><nav><ul class=entry-toc-toplevel-list><li><a href=https://blog.ymgyt.io/entry/getting_started_with_nom/#nom-iresult-i-o-e>nom::IResult&lt;I,O,E></a><li><a href=https://blog.ymgyt.io/entry/getting_started_with_nom/#nom-error>nom::error</a> <ul><li><a href=https://blog.ymgyt.io/entry/getting_started_with_nom/#error-i>Error&lt;I></a><li><a href=https://blog.ymgyt.io/entry/getting_started_with_nom/#parseerror-i>ParseError&lt;I></a></ul><li><a href=https://blog.ymgyt.io/entry/getting_started_with_nom/#nomnomodule>nomã®module</a><li><a href=https://blog.ymgyt.io/entry/getting_started_with_nom/#sequence>sequence</a> <ul><li><a href=https://blog.ymgyt.io/entry/getting_started_with_nom/#preceded-terminated-delimited>preceded, terminated, delimited</a></ul><li><a href=https://blog.ymgyt.io/entry/getting_started_with_nom/#branch>branch</a> <ul><li><a href=https://blog.ymgyt.io/entry/getting_started_with_nom/#alt>alt</a><li><a href=https://blog.ymgyt.io/entry/getting_started_with_nom/#combinator>combinator</a><li><a href=https://blog.ymgyt.io/entry/getting_started_with_nom/#multi>multi</a></ul><li><a href=https://blog.ymgyt.io/entry/getting_started_with_nom/#example>example</a> <ul><li><a href=https://blog.ymgyt.io/entry/getting_started_with_nom/#cargo-install-listnoparse>cargo install --listã®parse</a><li><a href=https://blog.ymgyt.io/entry/getting_started_with_nom/#json>json</a></ul><li><a href=https://blog.ymgyt.io/entry/getting_started_with_nom/#can-kao-nisaseteitadaitadokiyumento>å‚è€ƒã«ã•ã›ã¦ã„ãŸã ã„ãŸãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ</a><li><a href=https://blog.ymgyt.io/entry/getting_started_with_nom/#matome>ã¾ã¨ã‚</a></ul></nav></aside><div class=entry-content><figure><div class=fig-images-row><img , alt src=images/getting_started_nom.png></div><figcaption>nom nom nom</figcaption></figure><p>ã“ã®è¨˜äº‹ã§ã¯parser combinator nom<sup class=footnote-reference><a href=#nom>1</a></sup>ã«ã¤ã„ã¦æ›¸ãã¾ã™ã€‚versionã¯ <code>v6.1</code>ã‚’å‰æã«ã—ã¦ã„ã¾ã™ã€‚<br> nomã¯å°ã•ã„parserã‚’çµ„ã¿åˆã‚ã›ã¦ã€ç›®çš„ã¨ã™ã‚‹ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã‚’å…¥åŠ›ã‹ã‚‰èª­ã¿å–ã‚‹ãŸã‚ã®packageã§ã™ã€‚<br> <a href=https://github.com/nushell/nushell rel=external>nushell</a> ã®ã‚³ãƒ¼ãƒ‰ã‚’èª­ã‚“ã§ã„ã¦ã¿ã‹ã‘ãŸã®ãŒåˆã‚ã¦ã§ã—ãŸãŒä»–ã®packageã§ã‚‚æ™‚ã€…åˆ©ç”¨ã•ã‚Œã¦ã„ã‚‹ã®ã‚’ã¿ã‚‹ã®ã§ã€èª­ã‚ã‚‹ã‚ˆã†ã«ãªã‚‹ã®ãŒç›®æ¨™ã§ã™ã€‚<p>ãã‚‚ãã‚‚parser combinatorã¨ã„ã‚ã‚Œã¦ã‚‚ãƒ”ãƒ³ã¨ãã¦ã„ãªã‹ã£ãŸã®ã§ã€è‡ªåˆ†ã¨åŒã˜æ§˜ãªæ–¹ã¯<a href=https://bodil.lol/parser-combinators/ rel=external>Learning Parser Combinators With Rust</a> ãŒãŠã™ã™ã‚ã§ã™ã€‚ã“ã®è¨˜äº‹ã‚’èª­ã‚“ã§parserã‚’çµ„ã¿åˆã‚ã›ã‚‹ã¨ã„ã†æ„å‘³ãŒã‚ã‹ã‚Šã¾ã—ãŸã€‚<p>nomã§çµ„ã¿åˆã‚ã›ã‚‹parserã¯æ¦‚ã­ä»¥ä¸‹ã®ã‚ˆã†ãªé–¢æ•°signatureã‚’ã—ã¦ã„ã¾ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>fn</span><span style=color:#88c0d0> parse_unicode</span><span style=color:#eceff4>&lt;'</span><span style=color:#8fbcbb>a</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> E</span><span style=color:#eceff4>>(</span><span>input</span><span style=color:#81a1c1>: &</span><span style=color:#eceff4>'</span><span style=color:#8fbcbb>a str</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> IResult</span><span style=color:#eceff4>&lt;</span><span style=color:#81a1c1>&</span><span style=color:#eceff4>'</span><span style=color:#8fbcbb>a str</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> char</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> E</span><span style=color:#eceff4>></span></span>
<span class=giallo-l><span style=color:#81a1c1>where</span></span>
<span class=giallo-l><span style=color:#8fbcbb>  E</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> ParseError</span><span style=color:#eceff4>&lt;</span><span style=color:#81a1c1>&</span><span style=color:#eceff4>'</span><span style=color:#8fbcbb>a str</span><span style=color:#eceff4>></span><span style=color:#81a1c1> +</span><span style=color:#8fbcbb> FromExternalError</span><span style=color:#eceff4>&lt;</span><span style=color:#81a1c1>&</span><span style=color:#eceff4>'</span><span style=color:#8fbcbb>a str</span><span style=color:#eceff4>,</span><span> std</span><span style=color:#81a1c1>::</span><span>num</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>ParseIntError</span><span style=color:#eceff4>>,</span></span>
<span class=giallo-l><span style=color:#eceff4>{</span></span>
<span class=giallo-l><span style=color:#81a1c1>  let</span><span> parse_hex</span><span style=color:#81a1c1> =</span><span style=color:#88c0d0> take_while_m_n</span><span style=color:#eceff4>(</span><span style=color:#b48ead>1</span><span style=color:#eceff4>,</span><span style=color:#b48ead> 6</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> |</span><span>c</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> char</span><span style=color:#81a1c1>|</span><span> c</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>is_ascii_hexdigit</span><span style=color:#eceff4>());</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>  let</span><span> parse_delimited_hex</span><span style=color:#81a1c1> =</span><span style=color:#88c0d0> preceded</span><span style=color:#eceff4>(</span></span>
<span class=giallo-l><span style=color:#88c0d0>    char</span><span style=color:#eceff4>('</span><span style=color:#a3be8c>u</span><span style=color:#eceff4>'),</span></span>
<span class=giallo-l><span style=color:#88c0d0>    delimited</span><span style=color:#eceff4>(</span><span style=color:#88c0d0>char</span><span style=color:#eceff4>('</span><span style=color:#a3be8c>{</span><span style=color:#eceff4>'),</span><span> parse_hex</span><span style=color:#eceff4>,</span><span style=color:#88c0d0> char</span><span style=color:#eceff4>('</span><span style=color:#a3be8c>}</span><span style=color:#eceff4>')),</span></span>
<span class=giallo-l><span style=color:#eceff4>  );</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>  let</span><span> parse_u32</span><span style=color:#81a1c1> =</span><span style=color:#88c0d0> map_res</span><span style=color:#eceff4>(</span><span>parse_delimited_hex</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> move |</span><span>hex</span><span style=color:#81a1c1>|</span><span> u32</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>from_str_radix</span><span style=color:#eceff4>(</span><span>hex</span><span style=color:#eceff4>,</span><span style=color:#b48ead> 16</span><span style=color:#eceff4>));</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#88c0d0>  map_opt</span><span style=color:#eceff4>(</span><span>parse_u32</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> |</span><span>value</span><span style=color:#81a1c1>|</span><span> std</span><span style=color:#81a1c1>::</span><span>char</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>from_u32</span><span style=color:#eceff4>(</span><span>value</span><span style=color:#eceff4>))(</span><span>input</span><span style=color:#eceff4>)</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p><a href=https://github.com/Geal/nom/blob/38bb94e7bc45c2b4ef0c473e0e5c03ab134cdff3/examples/string.rs#L36 rel=external>https://github.com/Geal/nom/blob/38bb94e7bc45c2b4ef0c473e0e5c03ab134cdff3/examples/string.rs#L36</a><p>ã“ã®é–¢æ•°ã¯ã€æ–‡å­—åˆ—ä¸­ã®unicodeã®codepointè¡¨ç¾(<code>\u{0041}</code>)ã‚’parseã™ã‚‹ãŸã‚ã®é–¢æ•°ã§ã™ã€‚<br> ã‚¨ãƒ©ãƒ¼ãŒgenericã«ãªã£ã¦ã„ãŸã‚Šã€<code>IResult</code>å‹ãªã‚‹ã‚‚ã®ãŒã§ã¦ãã¦åˆè¦‹ã§ã¯ã‚ˆãã‚ã‹ã‚‰ãªã„ã¨æ€ã†ã®ã§ã“ã®ã‚ãŸã‚Šã‹ã‚‰ã¿ã¦ã„ãã¾ã™ã€‚<h2 id=nom-iresult-i-o-e><a aria-label="Anchor link for: nom-iresult-i-o-e" class=zola-anchor href=#nom-iresult-i-o-e><code>nom::IResult&lt;I,O,E></code></a></h2><p>nom parserã®parseçµæœã‚’è¡¨ã™å‹<code>IResult</code><sup class=footnote-reference><a href=#IResult>2</a></sup>ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«å®šç¾©ã•ã‚Œã¦ã„ã¾ã™ã€‚<br> <code>type IResult&lt;I, O, E = Error&lt;I>> = Result&lt;(I, O), Err&lt;E>>;</code><br> <code>I</code>ã¯Input, <code>O</code>ã¯parserã®æˆåŠŸæ™‚ã®parseçµæœã®å‹ã‚’è¡¨ã—ã¦ã„ã¾ã™ã€‚<br> parserã¯parseã«æˆåŠŸã™ã‚‹ã¨è‡ªèº«ãŒparseã§æ¶ˆè²»ã—ãŸinputã‚’å–ã‚Šé™¤ãã€æ®‹ã‚Šã®<code>I</code>(input)ã¨parseçµæœã®ã‚¿ãƒ—ãƒ«ã‚’è¿”ã—ã¾ã™ã€‚ <code>E</code>ã¯ã•ã‚‰ã«<code>Err&lt;E></code>ã¨wrapã•ã‚Œã¦ã„ã‚‹ã®ã§<code>Err</code><sup class=footnote-reference><a href=#Err>3</a></sup> ã‚’ã¿ã¦ã¿ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ã«å®šç¾©ã•ã‚Œã¦ã„ã¾ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>pub enum</span><span style=color:#8fbcbb> Err</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>E</span><span style=color:#eceff4>> {</span></span>
<span class=giallo-l><span style=color:#88c0d0>    Incomplete</span><span style=color:#eceff4>(</span><span style=color:#8fbcbb>Needed</span><span style=color:#eceff4>),</span></span>
<span class=giallo-l><span style=color:#88c0d0>    Error</span><span style=color:#eceff4>(</span><span style=color:#8fbcbb>E</span><span style=color:#eceff4>),</span></span>
<span class=giallo-l><span style=color:#88c0d0>    Failure</span><span style=color:#eceff4>(</span><span style=color:#8fbcbb>E</span><span style=color:#eceff4>),</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>pub enum</span><span style=color:#8fbcbb> Needed</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#8fbcbb>    Unknown</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#88c0d0>    Size</span><span style=color:#eceff4>(</span><span style=color:#8fbcbb>NonZeroUsize</span><span style=color:#eceff4>),</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p>ã“ã®ã‚ˆã†ã«<code>E</code>(parse error)ã‚’wrapã™ã‚‹ã“ã¨ã§ã€parseã®å¤±æ•—ãŒï¼“ã¤ã®ã‚«ãƒ†ã‚´ãƒªã«åˆ†é¡ã•ã‚Œã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚<br> <code>Incomplte</code>ã¯<code>streaming</code> moduleã®parserãŒè¿”ã™ã‚¨ãƒ©ãƒ¼ã§ã€inputãŒååˆ†ã§ãªã„ã“ã¨ã‚’è¡¨ã™ãŸã‚ã«ã‚ã‚Šã¾ã™ã€‚<br> network(tcp)ã”ã—ã«é€ã‚‰ã‚Œã¦ããŸãƒ‡ãƒ¼ã‚¿ã‚’parseã—ã¦ã„ã‚‹å ´åˆã€connectionã‚’readã—ãŸæ®µéšã§protocolçš„ã«ååˆ†ãªãƒ‡ãƒ¼ã‚¿ãŒãƒ¡ãƒ¢ãƒªã«ã®ã£ã¦ã„ã‚‹ã‹ã¯ã‚ã‹ã‚‰ãªã„ã®ã§ãã‚“ãªã¨ãã«è¿”ã™ã®ã ã¨æ€ã„ã¾ã™ã€‚<br> ä»¥å‰ã€KeyValueStoreã®tcp serverã‚’æ›¸ã„ãŸã¨ãã«ã€<a href=https://github.com/ymgyt/kvsd/blob/897f60de4de5763a26d43c9c4a60756604dbfcd3/src/protocol/connection/mod.rs#L120 rel=external>ä¼¼ãŸã‚ˆã†ãªã‚¨ãƒ©ãƒ¼ã‚’å®šç¾©</a>ã—ãŸã“ã¨ãŒã‚ã‚Šã¾ã—ãŸã€‚<br> <code>complete</code> moduleã®parserã¯ã“ã®ã‚¨ãƒ©ãƒ¼ã‚’è¿”ã•ãªã„ã®ã§<code>streaming</code>ã‚’åˆ©ç”¨ã—ã¦ã„ãªã‘ã‚Œã°æ°—ã«ã—ãªãã¦è‰¯ã•ãã†ã§ã™ã€‚<p><code>Error(E)</code>ã¯parserã”ã¨ã®parseå¤±æ•—ã‚’è¡¨ã™ã‚¨ãƒ©ãƒ¼ã€‚(æ•°å€¤ã‚’æœŸå¾…ã—ãŸã®ã«ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆãŒã‚ã£ãŸã¨ã‹)<br> <code>Failure</code>ã¯unrecoverableãªã‚¨ãƒ©ãƒ¼ã‚’è¡¨ã—ã¾ã™ã€‚ãŸã ã“ã“ã§ã„ã†unrecoverableã¯rustãŒpanicã—ãŸã¨ã‹ã§ã¯ãªãã‚ãã¾ã§parseã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã§ã®unrecoverableãªã®ã§ä»–ã®é¸æŠè‚¢ã‚’è©¦ã™å¿…è¦ãŒãªã„ãã‚‰ã„ã®æ„å‘³ã§ã™ã€‚<p><code>E</code>ã‚’æŒ‡å®šã—ã¦ã„ãªã„å ´åˆã¯ã€<code>Error&lt;I></code><sup class=footnote-reference><a href=#Error>4</a></sup>ãŒ<code>Err</code>ã«wrapã•ã‚Œã¦ä½¿ã‚ã‚Œã¾ã™ã€‚<br> <code>Error</code>ã¯<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>pub struct</span><span style=color:#8fbcbb> Error</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>I</span><span style=color:#eceff4>> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    pub</span><span> input</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> I</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#81a1c1>    pub</span><span> code</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> ErrorKind</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p>ã¨å®šç¾©ã•ã‚Œã¦ãŠã‚Šã€parseå¤±æ•—æ™‚ã®inputã¨ã‚¨ãƒ©ãƒ¼ã®è­˜åˆ¥å­<code>ErrorKind</code><sup class=footnote-reference><a href=#ErrorKind>5</a></sup>ã‚’ä¿æŒã—ã¾ã™ã€‚<br> <code>ErrorKind</code>ã¯nomãŒæä¾›ã—ã¦ã„ã‚‹parseré–¢æ•°ã‚’è­˜åˆ¥ã™ã‚‹ãŸã‚ã®enumã§ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>pub enum</span><span style=color:#8fbcbb> ErrorKind</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#8fbcbb>    Tag</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#8fbcbb>    MapRes</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#8fbcbb>    MapOpt</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#8fbcbb>    Alt</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#8fbcbb>    IsNot</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#616e88>    // ...</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p>ãã®ãŸã‚ã€ã¨ãã«è‡ªå‰ã§ã‚¨ãƒ©ãƒ¼ã‚’å®šç¾©ã—ãªãã¦ã‚‚ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ†ã‚¹ãƒˆãŒæ›¸ã‘ã¾ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#5e81ac>#[test]</span></span>
<span class=giallo-l><span style=color:#81a1c1>fn</span><span style=color:#88c0d0> test</span><span style=color:#eceff4>() {</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>    assert_eq!</span><span style=color:#eceff4>(</span></span>
<span class=giallo-l><span>        nom</span><span style=color:#81a1c1>::</span><span>character</span><span style=color:#81a1c1>::</span><span>complete</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>alpha1</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>1</span><span style=color:#eceff4>"),</span></span>
<span class=giallo-l><span style=color:#8fbcbb>        Err</span><span style=color:#eceff4>(</span><span>nom</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Err</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>Error</span><span style=color:#eceff4>(</span><span>nom</span><span style=color:#81a1c1>::</span><span>error</span><span style=color:#81a1c1>::</span><span>Error</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>new</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>1</span><span style=color:#eceff4>",</span><span> nom</span><span style=color:#81a1c1>::</span><span>error</span><span style=color:#81a1c1>::</span><span>ErrorKind</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Alpha</span><span style=color:#eceff4>))),</span></span>
<span class=giallo-l><span style=color:#eceff4>    );</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span>
<span class=giallo-l></span></code></pre><p>ã¾ãŸã€<code>IResult</code>ã¯<code>Finish::finish()</code>ã‚’å®Ÿè£…ã—ã¦ãŠã‚Šã€é€šå¸¸ã®<code>Result</code>å‹ã«ã‚‚å¤‰æ›ã§ãã¾ã™ã€‚(ãŸã ã—ã€<code>Err::Incomplete</code>ã®å ´åˆpanicã™ã‚‹ã®ã§æ³¨æ„)<h2 id=nom-error><a aria-label="Anchor link for: nom-error" class=zola-anchor href=#nom-error><code>nom::error</code></a></h2><h3 id=error-i><a aria-label="Anchor link for: error-i" class=zola-anchor href=#error-i><code>Error&lt;I></code></a></h3><pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>pub struct</span><span style=color:#8fbcbb> Error</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>I</span><span style=color:#eceff4>> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    pub</span><span> input</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> I</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#81a1c1>    pub</span><span> code</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> ErrorKind</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p>ãƒ¦ãƒ¼ã‚¶ãŒã¨ãã«ã‚¨ãƒ©ãƒ¼å‹ã‚’æŒ‡å®šã—ãªã„å ´åˆã«åˆ©ç”¨ã•ã‚Œã‚‹å‹ã§ã™ã€‚<br> ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ™‚ã®inputã¨parseré–¢æ•°ã®è­˜åˆ¥å­ã ã‘ã‚’ä¿æŒã—ã¦ã„ã¾ã™ã€‚<br> ãŸã ã—ã€nomã®parserã¯<code>Error</code>ã«ç›´æ¥ä¾å­˜ã¯ã—ã¦ãŠã‚‰ãšã€<code>ParseError</code>ç­‰ã®traitã‚’å®Ÿè£…ã™ã‚Œã°ä»–ã®ã‚¨ãƒ©ãƒ¼ã‚‚ä½¿ãˆã¾ã™ã€‚<h3 id=parseerror-i><a aria-label="Anchor link for: parseerror-i" class=zola-anchor href=#parseerror-i><code>ParseError&lt;I></code></a></h3><pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>pub trait</span><span style=color:#8fbcbb;font-weight:700> ParseError</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>I</span><span style=color:#eceff4>></span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Sized</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    fn</span><span style=color:#88c0d0> from_error_kind</span><span style=color:#eceff4>(</span><span>input</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> I</span><span style=color:#eceff4>,</span><span> kind</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> ErrorKind</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -> Self</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>    fn</span><span style=color:#88c0d0> append</span><span style=color:#eceff4>(</span><span>input</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> I</span><span style=color:#eceff4>,</span><span> kind</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> ErrorKind</span><span style=color:#eceff4>,</span><span> other</span><span style=color:#81a1c1>: Self</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -> Self</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#616e88>    // ...</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p>nomã®parserã§æˆ»ã‚Šå€¤ã®ã‚¨ãƒ©ãƒ¼ã®trait boundã¨ã—ã¦åˆ©ç”¨ã•ã‚Œã¾ã™ã€‚<br> <code>Error</code>, <code>VerboseError</code>ã«ã¯å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ã®ã§ã€nomãŒæä¾›ã™ã‚‹ã‚¨ãƒ©ãƒ¼å‹ã‚’åˆ©ç”¨ã™ã‚‹å ´åˆã¯ç‰¹ã«æ„è­˜ã™ã‚‹å¿…è¦ã¯ãªã„ã§ã™ãŒ<br> nomã®parserã‚’wrapã—ã¤ã¤ã‚‚ã€ã‚¨ãƒ©ãƒ¼ã‚’genericã«ã—ã¦ãŠããŸã„å ´åˆã¯trait boundã«ã§ã¦ãã¾ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>use</span><span> nom</span><span style=color:#81a1c1>::</span><span>error</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>ParseError</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>use</span><span> nom</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>IResult</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>fn</span><span style=color:#88c0d0> alpha</span><span style=color:#eceff4>&lt;'</span><span style=color:#8fbcbb>a</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> E</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> ParseError</span><span style=color:#eceff4>&lt;</span><span style=color:#81a1c1>&</span><span style=color:#eceff4>'</span><span style=color:#8fbcbb>a str</span><span style=color:#eceff4>>>(</span><span>i</span><span style=color:#81a1c1>: &</span><span style=color:#eceff4>'</span><span style=color:#8fbcbb>a str</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> IResult</span><span style=color:#eceff4>&lt;</span><span style=color:#81a1c1>&</span><span style=color:#eceff4>'</span><span style=color:#8fbcbb>a str</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> &</span><span style=color:#eceff4>'</span><span style=color:#8fbcbb>a str</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> E</span><span style=color:#eceff4>> {</span></span>
<span class=giallo-l><span>    nom</span><span style=color:#81a1c1>::</span><span>character</span><span style=color:#81a1c1>::</span><span>complete</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>alpha1</span><span style=color:#eceff4>(</span><span>i</span><span style=color:#eceff4>)</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#5e81ac>#[cfg(test)]</span></span>
<span class=giallo-l><span style=color:#81a1c1>mod</span><span> tests</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    use super::*</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#5e81ac>    #[test]</span></span>
<span class=giallo-l><span style=color:#81a1c1>    fn</span><span style=color:#88c0d0> test_alpha</span><span style=color:#eceff4>() {</span></span>
<span class=giallo-l><span style=color:#81a1c1>        use</span><span> nom</span><span style=color:#81a1c1>::</span><span>error</span><span style=color:#81a1c1>::</span><span style=color:#eceff4>{</span><span style=color:#8fbcbb>Error</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> ErrorKind</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> VerboseError</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> VerboseErrorKind</span><span style=color:#eceff4>};</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>        assert_eq!</span><span style=color:#eceff4>(</span></span>
<span class=giallo-l><span style=color:#88c0d0>            alpha</span><span style=color:#81a1c1>::</span><span style=color:#eceff4>&lt;()>("</span><span style=color:#a3be8c>123</span><span style=color:#eceff4>"),</span></span>
<span class=giallo-l><span style=color:#8fbcbb>            Err</span><span style=color:#eceff4>(</span><span>nom</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Err</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>Error</span><span style=color:#eceff4>(())),</span></span>
<span class=giallo-l><span style=color:#eceff4>        );</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>        assert_eq!</span><span style=color:#eceff4>(</span></span>
<span class=giallo-l><span style=color:#88c0d0>            alpha</span><span style=color:#81a1c1>::</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Error</span><span style=color:#eceff4>&lt;</span><span style=color:#81a1c1>&</span><span style=color:#eceff4>'</span><span style=color:#8fbcbb>_ str</span><span style=color:#eceff4>>>("</span><span style=color:#a3be8c>123</span><span style=color:#eceff4>"),</span></span>
<span class=giallo-l><span style=color:#8fbcbb>            Err</span><span style=color:#eceff4>(</span><span>nom</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Err</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>Error</span><span style=color:#eceff4>(</span><span>Error</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>new</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>123</span><span style=color:#eceff4>",</span><span> ErrorKind</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Alpha</span><span style=color:#eceff4>))),</span></span>
<span class=giallo-l><span style=color:#eceff4>        );</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>        assert_eq!</span><span style=color:#eceff4>(</span></span>
<span class=giallo-l><span style=color:#88c0d0>            alpha</span><span style=color:#81a1c1>::</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>VerboseError</span><span style=color:#eceff4>&lt;</span><span style=color:#81a1c1>&</span><span style=color:#eceff4>'</span><span style=color:#8fbcbb>_ str</span><span style=color:#eceff4>>>("</span><span style=color:#a3be8c>123</span><span style=color:#eceff4>"),</span></span>
<span class=giallo-l><span style=color:#8fbcbb>            Err</span><span style=color:#eceff4>(</span><span>nom</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Err</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>Error</span><span style=color:#eceff4>(</span><span style=color:#8fbcbb>VerboseError</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span>                errors</span><span style=color:#81a1c1>:</span><span style=color:#88c0d0;font-weight:700> vec!</span><span style=color:#eceff4>[(</span></span>
<span class=giallo-l><span style=color:#eceff4>                    "</span><span style=color:#a3be8c>123</span><span style=color:#eceff4>",</span><span> VerboseErrorKind</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>Nom</span><span style=color:#eceff4>(</span><span>ErrorKind</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Alpha</span><span style=color:#eceff4>),</span></span>
<span class=giallo-l><span style=color:#eceff4>                )]</span></span>
<span class=giallo-l><span style=color:#eceff4>            }))</span></span>
<span class=giallo-l><span style=color:#eceff4>        )</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p>ã“ã®ã‚ˆã†ã«å‘¼ã³å‡ºã—å´ã§ã‚¨ãƒ©ãƒ¼å‹ã‚’æ¸¡ã™ã“ã¨ã§ã€ã‚¨ãƒ©ãƒ¼ã®è©³ç´°åº¦ã‚’åˆ¶å¾¡ã§ãã¾ã™ã€‚<h2 id=nomnomodule><a aria-label="Anchor link for: nomnomodule" class=zola-anchor href=#nomnomodule>nomã®module</a></h2><p>nomãŒæä¾›ã—ã¦ã„ã‚‹æ©Ÿèƒ½ã¯å½¹å‰²ã”ã¨ã«sub moduleã«åˆ†å‰²ã•ã‚Œã¦ã„ã¾ã™ã€‚æ¦‚ã­å„moduleã¯ä»¥ä¸‹ã®ã‚ˆã†ãªå½¹å‰²ãŒã‚ã‚Šã¾ã™ã€‚<ul><li><p><code>nom::branch</code> è¤‡æ•°ã®parserã®åˆ†å²ã‚’æ‰±ã†ã€‚ <code>nom::branch::alt</code>ã¯ã©ã‚Œã‹ã²ã¨ã¤ã§ã‚‚æˆåŠŸã—ãŸã‚‰æˆåŠŸã€‚</p><li><p><code>nom::{character,bytes}::{streaming,complete}</code>: <code>alpha1</code>, <code>space0</code>, <code>digit1</code>ç­‰ã®åŸºæœ¬ã¨ãªã‚‹ãƒ‡ãƒ¼ã‚¿æ§‹é€ ç”¨ã®parserã€‚</p><li><p><code>nom::combinator</code> <code>map</code>,<code>map_res</code>, <code>opt</code>, <code>verify</code>ã¨ã„ã£ãŸã€parser + Closureã§parserã‚’ä½œã‚‹ãŸã‚ã®å‡¦ç†ã€‚</p><li><p><code>nom::multi</code> parserã‚’è¤‡æ•°å›é©ç”¨ã™ã‚‹ã€‚loopã®æŠ½è±¡åŒ–ã€‚</p><li><p><code>nom::number::complete</code> æ•°å€¤ç”¨</p><li><p><code>nom::sequence</code> finite sequences of inputã‚’parseã™ã‚‹ã€‚tupleã¯parserã®tupleã‚’ã†ã‘ã¨ã£ã¦ã€outputã®tupleã‚’è¿”ã™ã€‚</p><li><p><code>many{0,1,_m_n}</code>ãŒã‚ã£ã¦ã€ãã‚Œãã‚Œã€0å›ã‚’è¨±å®¹, 1å›ä»¥ä¸Šã€må›ä»¥ä¸Šnå›ä»¥ä¸‹ã§matchã™ã‚‹ã€‚</p></ul><h2 id=sequence><a aria-label="Anchor link for: sequence" class=zola-anchor href=#sequence><code>sequence</code></a></h2><p>parserã‚’é †ç•ªã«é©ç”¨ã—ã¦ã„ããƒ‘ã‚¿ãƒ¼ãƒ³ã‚’è¡¨ç¾ã™ã‚‹ãŸã‚ã®æ©Ÿèƒ½ã‚’æä¾›ã™ã‚‹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã€‚<h3 id=preceded-terminated-delimited><a aria-label="Anchor link for: preceded-terminated-delimited" class=zola-anchor href=#preceded-terminated-delimited><code>preceded</code>, <code>terminated</code>, <code>delimited</code></a></h3><p>parseã—ãŸã„ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã®å‰å¾Œã«ç‰¹å®šã®è¨˜å·ãŒã‚ã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ãŸã‚ã®æ©Ÿèƒ½ãŒç”¨æ„ã•ã‚Œã¦ã„ã¾ã™ã€‚<br> å…ˆé ­ã ã‘ã«matchã•ã›ã‚‹å ´åˆã¯ã€<code>preceded</code>, æœ«å°¾ã«matchã•ã›ã‚‹å ´åˆã¯<code>delimited</code>, å‰å¾Œã«matchã•ã›ã‚‹å ´åˆã¯<code>delimited</code>ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚<br> ã„ãšã‚Œã‚‚ã€matchã—ãŸå ´åˆã¯parseçµæœã‹ã‚‰ã¯æ¨ã¦ã‚‰ã‚Œã¦å€¤ãŒè¿”ã£ã¦ãã¾ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#88c0d0>preceded</span><span style=color:#eceff4>(</span><span style=color:#88c0d0>tag</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>@</span><span style=color:#eceff4>"),</span><span> parse_str</span><span style=color:#eceff4>);</span></span>
<span class=giallo-l><span style=color:#88c0d0>terminated</span><span style=color:#eceff4>(</span><span>parse_str</span><span style=color:#eceff4>,</span><span style=color:#88c0d0> tag</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>;</span><span style=color:#eceff4>"));</span></span>
<span class=giallo-l><span style=color:#88c0d0>delimited</span><span style=color:#eceff4>(</span><span style=color:#88c0d0>tag</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>{</span><span style=color:#eceff4>"),</span><span> parse_key_values</span><span style=color:#eceff4>,</span><span style=color:#88c0d0> tag</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>}</span><span style=color:#eceff4>"))</span></span></code></pre><h2 id=branch><a aria-label="Anchor link for: branch" class=zola-anchor href=#branch><code>branch</code></a></h2><h3 id=alt><a aria-label="Anchor link for: alt" class=zola-anchor href=#alt><code>alt</code></a></h3><p>è¤‡æ•°ã®parserã‚’ç¬¬1å¼•æ•°ã‹ã‚‰é †ç•ªã«é©ç”¨ã—ã¦ã€æœ€åˆã«matchã—ãŸçµæœã‚’è¿”ã™parserã‚’ç”Ÿæˆã—ã¾ã™ã€‚<br> æ¬¡ã®parserã‚’tryã™ã‚‹ã‹ã¯ã€parserãŒ<code>nom::Err::Error(_)</code>ã‚’è¿”ã—ãŸå ´åˆãªã®ã§ã€å¾Œç¶šã®parserã‚’å‘¼ã³å‡ºã—ãŸããªã„å ´åˆã¯ã€<code>combinator::cut()</code>ã§wrapã™ã‚‹ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>pub trait</span><span style=color:#8fbcbb;font-weight:700> Alt</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>I</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> O</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> E</span><span style=color:#eceff4>> {</span></span>
<span class=giallo-l><span style=color:#616e88>  /// Tests each parser in the tuple and returns the result of the first one that succeeds</span></span>
<span class=giallo-l><span style=color:#81a1c1>  fn</span><span style=color:#88c0d0> choice</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&mut self</span><span style=color:#eceff4>,</span><span> input</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> I</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> IResult</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>I</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> O</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> E</span><span style=color:#eceff4>>;</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>pub fn</span><span style=color:#88c0d0> alt</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>I</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Clone</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> O</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> E</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> ParseError</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>I</span><span style=color:#eceff4>>,</span><span style=color:#8fbcbb> List</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Alt</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>I</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> O</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> E</span><span style=color:#eceff4>>>(</span></span>
<span class=giallo-l><span style=color:#81a1c1>  mut</span><span> l</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> List</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#eceff4>)</span><span style=color:#81a1c1> -> impl</span><span style=color:#88c0d0> FnMut</span><span style=color:#eceff4>(</span><span style=color:#8fbcbb>I</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> IResult</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>I</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> O</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> E</span><span style=color:#eceff4>> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>  move |</span><span>i</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> I</span><span style=color:#81a1c1>|</span><span> l</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>choice</span><span style=color:#eceff4>(</span><span>i</span><span style=color:#eceff4>)</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p>ã®ã‚ˆã†ã«å®šç¾©ã•ã‚Œã¦ãŠã‚Šã€å„tupleã«<code>Alt::choice()</code>ã‚’å®Ÿè£…ã™ã‚‹ã“ã¨ã§å®Ÿç¾ã•ã‚Œã¦ã„ã‚‹ã€‚<br> ç¾åœ¨ã®å®Ÿè£…ã§ã¯21å€‹ã®parserã‚’æŒ‡å®šã§ãã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã‚‹ã€‚ãã‚Œä»¥é™ã¯altã‚’nestã•ã›ã‚‹ã€‚<br> <code>(A,B)</code>, <code>(A,B,C)</code>, <code>(A,B,C,D)</code>, <code>(A,B,C,..., U)</code>ã¸ã®implã¯macroã§ãªã•ã‚Œã¦ãŠã‚Šã€æ¦‚è¦ã¨ã—ã¦ã¯ä»¥ä¸‹ã®ã«ã‚ˆã†ã«ãªã£ã¦ã„ãŸã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>mod</span><span> alt_handson</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    use</span><span> nom</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>IResult</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>    use</span><span> nom</span><span style=color:#81a1c1>::</span><span>error</span><span style=color:#81a1c1>::</span><span style=color:#eceff4>{</span><span style=color:#8fbcbb>ParseError</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> Error</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> ErrorKind</span><span style=color:#eceff4>};</span></span>
<span class=giallo-l><span style=color:#81a1c1>    use</span><span> nom</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Parser</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>    pub trait</span><span style=color:#8fbcbb;font-weight:700> MyAlt</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>I</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> O</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> E</span><span style=color:#eceff4>> {</span></span>
<span class=giallo-l><span style=color:#616e88>        /// Tests each parser in the tuple and returns the result of the first one that succeeds</span></span>
<span class=giallo-l><span style=color:#81a1c1>        fn</span><span style=color:#88c0d0> choice</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&mut self</span><span style=color:#eceff4>,</span><span> input</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> I</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> IResult</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>I</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> O</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> E</span><span style=color:#eceff4>>;</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>    macro_rules!</span><span style=color:#88c0d0> alt_trait</span><span style=color:#eceff4>(</span></span>
<span class=giallo-l><span style=color:#eceff4>        (</span><span style=color:#81a1c1>$</span><span>first</span><span style=color:#81a1c1>:</span><span>ident</span><span style=color:#81a1c1> $</span><span>second</span><span style=color:#81a1c1>:</span><span>ident</span><span style=color:#81a1c1> $</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>id</span><span style=color:#81a1c1>:</span><span> ident</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>+</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> =></span><span style=color:#eceff4> (</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>            alt_trait!</span><span style=color:#eceff4>(</span><span>__impl</span><span style=color:#81a1c1> $</span><span>first</span><span style=color:#81a1c1> $</span><span>second</span><span style=color:#eceff4>;</span><span style=color:#81a1c1> $</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>id</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>+</span><span style=color:#eceff4>);</span></span>
<span class=giallo-l><span style=color:#eceff4>        );</span></span>
<span class=giallo-l><span style=color:#eceff4>        (</span><span>__impl</span><span style=color:#81a1c1> $</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>current</span><span style=color:#81a1c1>:</span><span>ident</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>*</span><span style=color:#eceff4>;</span><span style=color:#81a1c1> $</span><span>head</span><span style=color:#81a1c1>:</span><span>ident</span><span style=color:#81a1c1> $</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>id</span><span style=color:#81a1c1>:</span><span> ident</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>+</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> =></span><span style=color:#eceff4> (</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>            alt_trait_impl!</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>current</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>*</span><span style=color:#eceff4>);</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>            alt_trait!</span><span style=color:#eceff4>(</span><span>__impl</span><span style=color:#81a1c1> $</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>current</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>* $</span><span>head</span><span style=color:#eceff4>;</span><span style=color:#81a1c1> $</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>id</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>+</span><span style=color:#eceff4>);</span></span>
<span class=giallo-l><span style=color:#eceff4>        );</span></span>
<span class=giallo-l><span style=color:#eceff4>        (</span><span>__impl</span><span style=color:#81a1c1> $</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>current</span><span style=color:#81a1c1>:</span><span>ident</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>*</span><span style=color:#eceff4>;</span><span style=color:#81a1c1> $</span><span>head</span><span style=color:#81a1c1>:</span><span>ident</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> =></span><span style=color:#eceff4> (</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>            alt_trait_impl!</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>current</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>*</span><span style=color:#eceff4>);</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>            alt_trait_impl!</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>current</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>* $</span><span>head</span><span style=color:#eceff4>);</span></span>
<span class=giallo-l><span style=color:#eceff4>        );</span></span>
<span class=giallo-l><span style=color:#eceff4>    );</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>    macro_rules!</span><span style=color:#88c0d0> alt_trait_impl</span><span style=color:#eceff4>(</span></span>
<span class=giallo-l><span style=color:#eceff4>        (</span><span style=color:#81a1c1>$</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>id</span><span style=color:#81a1c1>:</span><span>ident</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>+</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> =></span><span style=color:#eceff4> (</span></span>
<span class=giallo-l><span style=color:#81a1c1>            impl</span><span style=color:#eceff4>&lt;</span></span>
<span class=giallo-l><span style=color:#8fbcbb>                Input</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Clone</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> Output</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> Error</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> ParseError</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Input</span><span style=color:#eceff4>>,</span></span>
<span class=giallo-l><span style=color:#81a1c1>                $</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>id</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Parser</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Input</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> Output</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> Error</span><span style=color:#eceff4>>),</span><span style=color:#81a1c1>+</span></span>
<span class=giallo-l><span style=color:#eceff4>            ></span><span style=color:#8fbcbb> MyAlt</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Input</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> Output</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> Error</span><span style=color:#eceff4>></span><span style=color:#81a1c1> for</span><span style=color:#eceff4> (</span><span style=color:#81a1c1> $</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>id</span><span style=color:#eceff4>),</span><span style=color:#81a1c1>+</span><span style=color:#eceff4> ) {</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>                fn</span><span style=color:#88c0d0> choice</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&mut self</span><span style=color:#eceff4>,</span><span> input</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Input</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> IResult</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Input</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> Output</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> Error</span><span style=color:#eceff4>> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>                    match self.</span><span style=color:#b48ead>0</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>parse</span><span style=color:#eceff4>(</span><span>input</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>clone</span><span style=color:#eceff4>()) {</span></span>
<span class=giallo-l><span style=color:#8fbcbb>                        Err</span><span style=color:#eceff4>(</span><span>nom</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Err</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>Error</span><span style=color:#eceff4>(</span><span>e</span><span style=color:#eceff4>))</span><span style=color:#81a1c1> =></span><span style=color:#88c0d0;font-weight:700> alt_trait_inner!</span><span style=color:#eceff4>(</span><span style=color:#b48ead>1</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> self</span><span style=color:#eceff4>,</span><span> input</span><span style=color:#eceff4>,</span><span> e</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> $</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>id</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>+</span><span style=color:#eceff4>),</span></span>
<span class=giallo-l><span>                        res</span><span style=color:#81a1c1> =></span><span> res</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#eceff4>                    }</span></span>
<span class=giallo-l><span style=color:#eceff4>                }</span></span>
<span class=giallo-l><span style=color:#eceff4>            }</span></span>
<span class=giallo-l><span style=color:#eceff4>        );</span></span>
<span class=giallo-l><span style=color:#eceff4>    );</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>    macro_rules!</span><span style=color:#88c0d0> alt_trait_inner</span><span style=color:#eceff4>(</span></span>
<span class=giallo-l><span style=color:#eceff4>        (</span><span style=color:#81a1c1>$</span><span>it</span><span style=color:#81a1c1>:</span><span>tt</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> $self:</span><span>expr</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> $</span><span>input</span><span style=color:#81a1c1>:</span><span>expr</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> $</span><span>err</span><span style=color:#81a1c1>:</span><span>expr</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> $</span><span>head</span><span style=color:#81a1c1>:</span><span>ident</span><span style=color:#81a1c1> $</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>id</span><span style=color:#81a1c1>:</span><span>ident</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>+</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> =></span><span style=color:#eceff4> (</span></span>
<span class=giallo-l><span style=color:#81a1c1>            match $</span><span>self</span><span style=color:#81a1c1>.$</span><span>it</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>parse</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>input</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>clone</span><span style=color:#eceff4>()) {</span></span>
<span class=giallo-l><span style=color:#8fbcbb>                Err</span><span style=color:#eceff4>(</span><span>nom</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Err</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>Error</span><span style=color:#eceff4>(</span><span>e</span><span style=color:#eceff4>))</span><span style=color:#81a1c1> =></span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>                    let</span><span> err</span><span style=color:#81a1c1> = $</span><span>err</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>or</span><span style=color:#eceff4>(</span><span>e</span><span style=color:#eceff4>);</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>                    succ!</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>it</span><span style=color:#eceff4>,</span><span style=color:#88c0d0;font-weight:700> alt_trait_inner!</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>self</span><span style=color:#eceff4>,</span><span style=color:#81a1c1>$</span><span>input</span><span style=color:#eceff4>,</span><span> err</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> $</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>id</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>+</span><span style=color:#eceff4>))</span></span>
<span class=giallo-l><span style=color:#eceff4>                }</span></span>
<span class=giallo-l><span>                res</span><span style=color:#81a1c1> =></span><span> res</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#eceff4>            }</span></span>
<span class=giallo-l><span style=color:#eceff4>        );</span></span>
<span class=giallo-l><span style=color:#eceff4>        (</span><span style=color:#81a1c1>$</span><span>it</span><span style=color:#81a1c1>:</span><span>tt</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> $</span><span>self</span><span style=color:#81a1c1>:</span><span>expr</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> $</span><span>input</span><span style=color:#81a1c1>:</span><span>expr</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> $</span><span>err</span><span style=color:#81a1c1>:</span><span>expr</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> $</span><span>head</span><span style=color:#81a1c1>:</span><span>ident</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> =></span><span style=color:#eceff4> (</span></span>
<span class=giallo-l><span style=color:#8fbcbb>            Err</span><span style=color:#eceff4>(</span><span>nom</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Err</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>Error</span><span style=color:#eceff4>(</span><span>Error</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>append</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>input</span><span style=color:#eceff4>,</span><span> ErrorKind</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Alt</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> $</span><span>err</span><span style=color:#eceff4>)))</span></span>
<span class=giallo-l><span style=color:#eceff4>        );</span></span>
<span class=giallo-l><span style=color:#eceff4>    );</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>    macro_rules!</span><span> succ</span><span style=color:#eceff4> (</span></span>
<span class=giallo-l><span style=color:#eceff4>  (</span><span style=color:#b48ead>0</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> $</span><span>submac</span><span style=color:#81a1c1>:</span><span>ident</span><span style=color:#81a1c1> !</span><span style=color:#eceff4> (</span><span style=color:#81a1c1>$</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>rest</span><span style=color:#81a1c1>:</span><span>tt</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>*</span><span style=color:#eceff4>))</span><span style=color:#81a1c1> =></span><span style=color:#eceff4> (</span><span style=color:#81a1c1>$</span><span>submac</span><span style=color:#81a1c1>!</span><span style=color:#eceff4>(</span><span style=color:#b48ead>1</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> $</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>rest</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>*</span><span style=color:#eceff4>));</span></span>
<span class=giallo-l><span style=color:#eceff4>  (</span><span style=color:#b48ead>1</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> $</span><span>submac</span><span style=color:#81a1c1>:</span><span>ident</span><span style=color:#81a1c1> !</span><span style=color:#eceff4> (</span><span style=color:#81a1c1>$</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>rest</span><span style=color:#81a1c1>:</span><span>tt</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>*</span><span style=color:#eceff4>))</span><span style=color:#81a1c1> =></span><span style=color:#eceff4> (</span><span style=color:#81a1c1>$</span><span>submac</span><span style=color:#81a1c1>!</span><span style=color:#eceff4>(</span><span style=color:#b48ead>2</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> $</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>rest</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>*</span><span style=color:#eceff4>));</span></span>
<span class=giallo-l><span style=color:#eceff4>  (</span><span style=color:#b48ead>2</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> $</span><span>submac</span><span style=color:#81a1c1>:</span><span>ident</span><span style=color:#81a1c1> !</span><span style=color:#eceff4> (</span><span style=color:#81a1c1>$</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>rest</span><span style=color:#81a1c1>:</span><span>tt</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>*</span><span style=color:#eceff4>))</span><span style=color:#81a1c1> =></span><span style=color:#eceff4> (</span><span style=color:#81a1c1>$</span><span>submac</span><span style=color:#81a1c1>!</span><span style=color:#eceff4>(</span><span style=color:#b48ead>3</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> $</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>rest</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>*</span><span style=color:#eceff4>));</span></span>
<span class=giallo-l><span style=color:#eceff4>);</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>alt_trait!</span><span style=color:#eceff4>(</span><span style=color:#8fbcbb>A B C</span><span style=color:#eceff4>);</span></span></code></pre><p>ã“ã‚Œã‚’<code>cargo expand</code>ã—ã¦ã¿ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ãŒç”Ÿæˆã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒã‚ã‹ã‚‹ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>mod</span><span> alt_handson</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    use</span><span> nom</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>IResult</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>    use</span><span> nom</span><span style=color:#81a1c1>::</span><span>error</span><span style=color:#81a1c1>::</span><span style=color:#eceff4>{</span><span style=color:#8fbcbb>ParseError</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> Error</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> ErrorKind</span><span style=color:#eceff4>};</span></span>
<span class=giallo-l><span style=color:#81a1c1>    use</span><span> nom</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Parser</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>    pub trait</span><span style=color:#8fbcbb;font-weight:700> MyAlt</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>I</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> O</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> E</span><span style=color:#eceff4>> {</span></span>
<span class=giallo-l><span style=color:#616e88>        /// Tests each parser in the tuple and returns the result of the first one that succeeds</span></span>
<span class=giallo-l><span style=color:#81a1c1>        fn</span><span style=color:#88c0d0> choice</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&mut self</span><span style=color:#eceff4>,</span><span> input</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> I</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> IResult</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>I</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> O</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> E</span><span style=color:#eceff4>>;</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l><span style=color:#81a1c1>    impl</span><span style=color:#eceff4>&lt;</span></span>
<span class=giallo-l><span style=color:#8fbcbb>            Input</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Clone</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#8fbcbb>            Output</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#8fbcbb>            Error</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> ParseError</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Input</span><span style=color:#eceff4>>,</span></span>
<span class=giallo-l><span style=color:#8fbcbb>            A</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Parser</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Input</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> Output</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> Error</span><span style=color:#eceff4>>,</span></span>
<span class=giallo-l><span style=color:#8fbcbb>            B</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Parser</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Input</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> Output</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> Error</span><span style=color:#eceff4>>,</span></span>
<span class=giallo-l><span style=color:#eceff4>        ></span><span style=color:#8fbcbb> MyAlt</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Input</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> Output</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> Error</span><span style=color:#eceff4>></span><span style=color:#81a1c1> for</span><span style=color:#eceff4> (</span><span style=color:#8fbcbb>A</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> B</span><span style=color:#eceff4>)</span></span>
<span class=giallo-l><span style=color:#eceff4>    {</span></span>
<span class=giallo-l><span style=color:#81a1c1>        fn</span><span style=color:#88c0d0> choice</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&mut self</span><span style=color:#eceff4>,</span><span> input</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Input</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> IResult</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Input</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> Output</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> Error</span><span style=color:#eceff4>> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>            match self.</span><span style=color:#b48ead>0</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>parse</span><span style=color:#eceff4>(</span><span>input</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>clone</span><span style=color:#eceff4>()) {</span></span>
<span class=giallo-l><span style=color:#8fbcbb>                Err</span><span style=color:#eceff4>(</span><span>nom</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Err</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>Error</span><span style=color:#eceff4>(</span><span>e</span><span style=color:#eceff4>))</span><span style=color:#81a1c1> => match self.</span><span style=color:#b48ead>1</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>parse</span><span style=color:#eceff4>(</span><span>input</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>clone</span><span style=color:#eceff4>()) {</span></span>
<span class=giallo-l><span style=color:#8fbcbb>                    Err</span><span style=color:#eceff4>(</span><span>nom</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Err</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>Error</span><span style=color:#eceff4>(</span><span>e</span><span style=color:#eceff4>))</span><span style=color:#81a1c1> =></span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>                        let</span><span> err</span><span style=color:#81a1c1> =</span><span> e</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>or</span><span style=color:#eceff4>(</span><span>e</span><span style=color:#eceff4>);</span></span>
<span class=giallo-l><span style=color:#8fbcbb>                        Err</span><span style=color:#eceff4>(</span><span>nom</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Err</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>Error</span><span style=color:#eceff4>(</span><span>Error</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>append</span><span style=color:#eceff4>(</span><span>input</span><span style=color:#eceff4>,</span><span> ErrorKind</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Alt</span><span style=color:#eceff4>,</span><span> err</span><span style=color:#eceff4>)))</span></span>
<span class=giallo-l><span style=color:#eceff4>                    }</span></span>
<span class=giallo-l><span>                    res</span><span style=color:#81a1c1> =></span><span> res</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#eceff4>                },</span></span>
<span class=giallo-l><span>                res</span><span style=color:#81a1c1> =></span><span> res</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#eceff4>            }</span></span>
<span class=giallo-l><span style=color:#eceff4>        }</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l><span style=color:#81a1c1>    impl</span><span style=color:#eceff4>&lt;</span></span>
<span class=giallo-l><span style=color:#8fbcbb>            Input</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Clone</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#8fbcbb>            Output</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#8fbcbb>            Error</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> ParseError</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Input</span><span style=color:#eceff4>>,</span></span>
<span class=giallo-l><span style=color:#8fbcbb>            A</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Parser</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Input</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> Output</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> Error</span><span style=color:#eceff4>>,</span></span>
<span class=giallo-l><span style=color:#8fbcbb>            B</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Parser</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Input</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> Output</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> Error</span><span style=color:#eceff4>>,</span></span>
<span class=giallo-l><span style=color:#8fbcbb>            C</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Parser</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Input</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> Output</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> Error</span><span style=color:#eceff4>>,</span></span>
<span class=giallo-l><span style=color:#eceff4>        ></span><span style=color:#8fbcbb> MyAlt</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Input</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> Output</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> Error</span><span style=color:#eceff4>></span><span style=color:#81a1c1> for</span><span style=color:#eceff4> (</span><span style=color:#8fbcbb>A</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> B</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> C</span><span style=color:#eceff4>)</span></span>
<span class=giallo-l><span style=color:#eceff4>    {</span></span>
<span class=giallo-l><span style=color:#81a1c1>        fn</span><span style=color:#88c0d0> choice</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&mut self</span><span style=color:#eceff4>,</span><span> input</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Input</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> IResult</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Input</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> Output</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> Error</span><span style=color:#eceff4>> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>            match self.</span><span style=color:#b48ead>0</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>parse</span><span style=color:#eceff4>(</span><span>input</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>clone</span><span style=color:#eceff4>()) {</span></span>
<span class=giallo-l><span style=color:#8fbcbb>                Err</span><span style=color:#eceff4>(</span><span>nom</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Err</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>Error</span><span style=color:#eceff4>(</span><span>e</span><span style=color:#eceff4>))</span><span style=color:#81a1c1> => match self.</span><span style=color:#b48ead>1</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>parse</span><span style=color:#eceff4>(</span><span>input</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>clone</span><span style=color:#eceff4>()) {</span></span>
<span class=giallo-l><span style=color:#8fbcbb>                    Err</span><span style=color:#eceff4>(</span><span>nom</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Err</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>Error</span><span style=color:#eceff4>(</span><span>e</span><span style=color:#eceff4>))</span><span style=color:#81a1c1> =></span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>                        let</span><span> err</span><span style=color:#81a1c1> =</span><span> e</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>or</span><span style=color:#eceff4>(</span><span>e</span><span style=color:#eceff4>);</span></span>
<span class=giallo-l><span style=color:#81a1c1>                        match self.</span><span style=color:#b48ead>2</span><span style=color:#eceff4>.</span><span style=color:#88c0d0>parse</span><span style=color:#eceff4>(</span><span>input</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>clone</span><span style=color:#eceff4>()) {</span></span>
<span class=giallo-l><span style=color:#8fbcbb>                            Err</span><span style=color:#eceff4>(</span><span>nom</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Err</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>Error</span><span style=color:#eceff4>(</span><span>e</span><span style=color:#eceff4>))</span><span style=color:#81a1c1> =></span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>                                let</span><span> err</span><span style=color:#81a1c1> =</span><span> err</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>or</span><span style=color:#eceff4>(</span><span>e</span><span style=color:#eceff4>);</span></span>
<span class=giallo-l><span style=color:#8fbcbb>                                Err</span><span style=color:#eceff4>(</span><span>nom</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Err</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>Error</span><span style=color:#eceff4>(</span><span>Error</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>append</span><span style=color:#eceff4>(</span><span>input</span><span style=color:#eceff4>,</span><span> ErrorKind</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Alt</span><span style=color:#eceff4>,</span><span> err</span><span style=color:#eceff4>)))</span></span>
<span class=giallo-l><span style=color:#eceff4>                            }</span></span>
<span class=giallo-l><span>                            res</span><span style=color:#81a1c1> =></span><span> res</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#eceff4>                        }</span></span>
<span class=giallo-l><span style=color:#eceff4>                    }</span></span>
<span class=giallo-l><span>                    res</span><span style=color:#81a1c1> =></span><span> res</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#eceff4>                },</span></span>
<span class=giallo-l><span>                res</span><span style=color:#81a1c1> =></span><span> res</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#eceff4>            }</span></span>
<span class=giallo-l><span style=color:#eceff4>        }</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p>å¾¹åº•ã—ã¦runtimeã®ã‚³ã‚¹ãƒˆã‚’é¿ã‘ã‚‹ã‚ˆã†ãªå·¥å¤«ãŒã•ã‚Œã¦ã„ã‚‹ã¨æ€ã„ã¾ã—ãŸã€‚<h3 id=combinator><a aria-label="Anchor link for: combinator" class=zola-anchor href=#combinator><code>combinator</code></a></h3><h4 id=map-opt><a aria-label="Anchor link for: map-opt" class=zola-anchor href=#map-opt><code>map_opt</code></a></h4><p>parseçµæœã‚’<code>Option</code>ã‚’è¿”ã™é–¢æ•°ã«æ¸¡ã—ã¦æ–°ã—ã„parserã‚’ä½œã‚Œã¾ã™ã€‚(<code>map_opt::&lt;></code>ã®å‹ã¯æ™®é€šã¯æ¨æ¸¬ã•ã‚Œã‚‹)<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>    fn</span><span style=color:#88c0d0> test_map_opt</span><span style=color:#eceff4>() {</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>        assert_eq!</span><span style=color:#eceff4>(</span></span>
<span class=giallo-l><span>            nom</span><span style=color:#81a1c1>::</span><span>combinator</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>map_opt</span><span style=color:#81a1c1>::</span><span style=color:#eceff4>&lt;</span><span>_</span><span style=color:#eceff4>,</span><span> _</span><span style=color:#eceff4>,</span><span>_</span><span style=color:#eceff4>,</span><span>nom</span><span style=color:#81a1c1>::</span><span>error</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Error</span><span style=color:#eceff4>&lt;</span><span style=color:#81a1c1>&</span><span style=color:#8fbcbb>str</span><span style=color:#eceff4>>,</span><span>_</span><span style=color:#eceff4>,</span><span> _</span><span style=color:#eceff4>>(</span></span>
<span class=giallo-l><span>                nom</span><span style=color:#81a1c1>::</span><span>character</span><span style=color:#81a1c1>::</span><span>complete</span><span style=color:#81a1c1>::</span><span>digit1</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#81a1c1>                |</span><span>s</span><span style=color:#81a1c1>: &</span><span style=color:#8fbcbb>str</span><span style=color:#81a1c1>|</span><span> s</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>parse</span><span style=color:#81a1c1>::</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>u8</span><span style=color:#eceff4>>()</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>ok</span><span style=color:#eceff4>(),</span></span>
<span class=giallo-l><span style=color:#eceff4>            )("</span><span style=color:#a3be8c>123u</span><span style=color:#eceff4>"),</span></span>
<span class=giallo-l><span style=color:#8fbcbb>            Ok</span><span style=color:#eceff4>(("</span><span style=color:#a3be8c>u</span><span style=color:#eceff4>",</span><span style=color:#b48ead> 123</span><span style=color:#eceff4>)),</span></span>
<span class=giallo-l><span style=color:#eceff4>        )</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span></code></pre><h4 id=verify><a aria-label="Anchor link for: verify" class=zola-anchor href=#verify><code>verify</code></a></h4><pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>pub fn</span><span style=color:#88c0d0> verify</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>I</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Clone</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> O1</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> O2</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> E</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> ParseError</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>I</span><span style=color:#eceff4>>,</span><span style=color:#8fbcbb> F</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> G</span><span style=color:#eceff4>>(</span></span>
<span class=giallo-l><span>    first</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> F</span><span style=color:#eceff4>,</span><span> </span></span>
<span class=giallo-l><span>    second</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> G</span></span>
<span class=giallo-l><span style=color:#eceff4>)</span><span style=color:#81a1c1> -> impl</span><span style=color:#88c0d0> FnMut</span><span style=color:#eceff4>(</span><span style=color:#8fbcbb>I</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> IResult</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>I</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> O1</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> E</span><span style=color:#eceff4>></span><span> </span></span>
<span class=giallo-l><span style=color:#81a1c1>where</span></span>
<span class=giallo-l><span style=color:#8fbcbb>    F</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Parser</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>I</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> O1</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> E</span><span style=color:#eceff4>>,</span></span>
<span class=giallo-l><span style=color:#8fbcbb>    G</span><span style=color:#81a1c1>:</span><span style=color:#88c0d0> Fn</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&</span><span style=color:#8fbcbb>O2</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> bool</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#8fbcbb>    O1</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Borrow</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>O2</span><span style=color:#eceff4>>,</span></span>
<span class=giallo-l><span style=color:#8fbcbb>    O2</span><span style=color:#81a1c1>: ?</span><span style=color:#8fbcbb>Sized</span><span style=color:#eceff4>,</span><span> </span></span></code></pre><p><code>verify</code><sup class=footnote-reference><a href=#verify>6</a></sup>ã¯matchã—ãŸparserã®outputã‚’verifyç”¨ã®é–¢æ•°ã«ã‹ã¾ã›ã¦,trueãŒè¿”ã£ãŸã‚‰matchã™ã‚‹parserã‚’ä½œã‚Šã¾ã™ã€‚ æ—¢å­˜ã®parserã«ç‹¬è‡ªã®åˆ¶ç´„ã‚’ã„ã‚ŒãŸã„ã¨ãã«ä¾¿åˆ©ãã†ã§ã™ã€‚<br> verifyç”¨ã®é–¢æ•°ã®å¼•æ•°ãŒ<code>O1: AsRef&lt;O1></code>ã§ã¯ãªã<code>O1: Borrow&lt;O2></code>ã¨<code>Borrow</code>ã§è¡¨ç¾ã•ã‚Œã¦ã„ã‚‹ã®ã¯ã€verifyé–¢æ•°ã®çµæœã¯<code>String</code>ã¨<code>&str</code>ã§æ•´åˆæ€§ã‚ã‚‹ã“ã¨ã‚’æœŸå¾…ã—ã¦ã„ã‚‹ã“ã¨ã‚’è¡¨ã—ã¦ã„ã‚‹ã‚“ã§ã—ã‚‡ã†ã‹ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>let</span><span> not_quote_slash</span><span style=color:#81a1c1> =</span><span style=color:#88c0d0> is_not</span><span style=color:#eceff4>("</span><span style=color:#ebcb8b>\"\\</span><span style=color:#eceff4>");</span></span>
<span class=giallo-l><span style=color:#88c0d0>verify</span><span style=color:#eceff4>(</span><span>not_quote_slash</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> |</span><span>s</span><span style=color:#81a1c1>: &</span><span style=color:#8fbcbb>str</span><span style=color:#81a1c1>| !</span><span>s</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>is_empty</span><span style=color:#eceff4>())(</span><span>input</span><span style=color:#eceff4>)</span></span></code></pre><h3 id=multi><a aria-label="Anchor link for: multi" class=zola-anchor href=#multi><code>multi</code></a></h3><h4 id=fold-many><a aria-label="Anchor link for: fold-many" class=zola-anchor href=#fold-many><code>fold_many</code></a></h4><p><code>Iterator::fold</code>ã®æ©Ÿèƒ½ã‚’æä¾›ã—ã¦ãã‚Œã¾ã™ã€‚parserã®outputã§ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°ã—ãŸã„ã¨ãã«åˆ©ç”¨ã§ãã¾ã™ã€‚<br> <a href=https://github.com/Geal/nom/blob/38bb94e7bc45c2b4ef0c473e0e5c03ab134cdff3/examples/string.rs#L141 rel=external>å…¬å¼ã®example</a> ãŒã‚ã‹ã‚Šã‚„ã™ã‹ã£ãŸã§ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#5e81ac>#[derive(</span><span style=color:#8fbcbb>Debug</span><span style=color:#5e81ac>,</span><span style=color:#8fbcbb> Clone</span><span style=color:#5e81ac>,</span><span style=color:#8fbcbb> Copy</span><span style=color:#5e81ac>,</span><span style=color:#8fbcbb> PartialEq</span><span style=color:#5e81ac>,</span><span style=color:#8fbcbb> Eq</span><span style=color:#5e81ac>)]</span></span>
<span class=giallo-l><span style=color:#81a1c1>enum</span><span style=color:#8fbcbb> StringFragment</span><span style=color:#eceff4>&lt;'</span><span style=color:#8fbcbb>a</span><span style=color:#eceff4>> {</span></span>
<span class=giallo-l><span style=color:#88c0d0>  Literal</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&</span><span style=color:#eceff4>'</span><span style=color:#8fbcbb>a str</span><span style=color:#eceff4>),</span></span>
<span class=giallo-l><span style=color:#88c0d0>  EscapedChar</span><span style=color:#eceff4>(</span><span style=color:#8fbcbb>char</span><span style=color:#eceff4>),</span></span>
<span class=giallo-l><span style=color:#8fbcbb>  EscapedWS</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>fn</span><span style=color:#88c0d0> parse_fragment</span><span style=color:#eceff4>&lt;'</span><span style=color:#8fbcbb>a</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> E</span><span style=color:#eceff4>>(</span><span>input</span><span style=color:#81a1c1>: &</span><span style=color:#eceff4>'</span><span style=color:#8fbcbb>a str</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> IResult</span><span style=color:#eceff4>&lt;</span><span style=color:#81a1c1>&</span><span style=color:#eceff4>'</span><span style=color:#8fbcbb>a str</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> StringFragment</span><span style=color:#eceff4>&lt;'</span><span style=color:#8fbcbb>a</span><span style=color:#eceff4>>,</span><span style=color:#8fbcbb> E</span><span style=color:#eceff4>></span></span>
<span class=giallo-l><span style=color:#81a1c1>    where</span></span>
<span class=giallo-l><span style=color:#8fbcbb>        E</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> ParseError</span><span style=color:#eceff4>&lt;</span><span style=color:#81a1c1>&</span><span style=color:#eceff4>'</span><span style=color:#8fbcbb>a str</span><span style=color:#eceff4>></span><span style=color:#81a1c1> +</span><span style=color:#8fbcbb> FromExternalError</span><span style=color:#eceff4>&lt;</span><span style=color:#81a1c1>&</span><span style=color:#eceff4>'</span><span style=color:#8fbcbb>a str</span><span style=color:#eceff4>,</span><span> std</span><span style=color:#81a1c1>::</span><span>num</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>ParseIntError</span><span style=color:#eceff4>>,</span></span>
<span class=giallo-l><span style=color:#eceff4>{</span></span>
<span class=giallo-l><span style=color:#88c0d0>    alt</span><span style=color:#eceff4>((</span></span>
<span class=giallo-l><span style=color:#88c0d0>        map</span><span style=color:#eceff4>(</span><span>parse_literal</span><span style=color:#eceff4>,</span><span> StringFragment</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Literal</span><span style=color:#eceff4>),</span></span>
<span class=giallo-l><span style=color:#88c0d0>        map</span><span style=color:#eceff4>(</span><span>parse_escaped_char</span><span style=color:#eceff4>,</span><span> StringFragment</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>EscapedChar</span><span style=color:#eceff4>),</span></span>
<span class=giallo-l><span style=color:#88c0d0>        value</span><span style=color:#eceff4>(</span><span>StringFragment</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>EscapedWS</span><span style=color:#eceff4>,</span><span> parse_escaped_whitespace</span><span style=color:#eceff4>),</span></span>
<span class=giallo-l><span style=color:#eceff4>    ))(</span><span>input</span><span style=color:#eceff4>)</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>fn</span><span style=color:#88c0d0> parse_string</span><span style=color:#eceff4>&lt;'</span><span style=color:#8fbcbb>a</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> E</span><span style=color:#eceff4>>(</span><span>input</span><span style=color:#81a1c1>: &</span><span style=color:#eceff4>'</span><span style=color:#8fbcbb>a str</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> IResult</span><span style=color:#eceff4>&lt;</span><span style=color:#81a1c1>&</span><span style=color:#eceff4>'</span><span style=color:#8fbcbb>a str</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> String</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> E</span><span style=color:#eceff4>></span></span>
<span class=giallo-l><span style=color:#81a1c1>    where</span></span>
<span class=giallo-l><span style=color:#8fbcbb>        E</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> ParseError</span><span style=color:#eceff4>&lt;</span><span style=color:#81a1c1>&</span><span style=color:#eceff4>'</span><span style=color:#8fbcbb>a str</span><span style=color:#eceff4>></span><span style=color:#81a1c1> +</span><span style=color:#8fbcbb> FromExternalError</span><span style=color:#eceff4>&lt;</span><span style=color:#81a1c1>&</span><span style=color:#eceff4>'</span><span style=color:#8fbcbb>a str</span><span style=color:#eceff4>,</span><span> std</span><span style=color:#81a1c1>::</span><span>num</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>ParseIntError</span><span style=color:#eceff4>>,</span></span>
<span class=giallo-l><span style=color:#eceff4>{</span></span>
<span class=giallo-l><span style=color:#81a1c1>    let</span><span> build_string</span><span style=color:#81a1c1> =</span><span style=color:#88c0d0> fold_many0</span><span style=color:#eceff4>(</span></span>
<span class=giallo-l><span>        parse_fragment</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>        String</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>new</span><span style=color:#eceff4>(),</span></span>
<span class=giallo-l><span style=color:#81a1c1>        |mut</span><span> string</span><span style=color:#eceff4>,</span><span> fragment</span><span style=color:#81a1c1>|</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>            match</span><span> fragment</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span>                StringFragment</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>Literal</span><span style=color:#eceff4>(</span><span>s</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> =></span><span> string</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>push_str</span><span style=color:#eceff4>(</span><span>s</span><span style=color:#eceff4>),</span></span>
<span class=giallo-l><span>                StringFragment</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>EscapedChar</span><span style=color:#eceff4>(</span><span>c</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> =></span><span> string</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>push</span><span style=color:#eceff4>(</span><span>c</span><span style=color:#eceff4>),</span></span>
<span class=giallo-l><span>                StringFragment</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>EscapedWS</span><span style=color:#81a1c1> =></span><span style=color:#eceff4> {}</span></span>
<span class=giallo-l><span style=color:#eceff4>            }</span></span>
<span class=giallo-l><span>            string</span></span>
<span class=giallo-l><span style=color:#eceff4>        },</span></span>
<span class=giallo-l><span style=color:#eceff4>    );</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#88c0d0>    delimited</span><span style=color:#eceff4>(</span><span style=color:#88c0d0>char</span><span style=color:#eceff4>('</span><span style=color:#a3be8c>"</span><span style=color:#eceff4>'),</span><span> build_string</span><span style=color:#eceff4>,</span><span style=color:#88c0d0> char</span><span style=color:#eceff4>('</span><span style=color:#a3be8c>"</span><span style=color:#eceff4>'))(</span><span>input</span><span style=color:#eceff4>)</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span>
<span class=giallo-l></span></code></pre><h2 id=example><a aria-label="Anchor link for: example" class=zola-anchor href=#example>example</a></h2><p>ã“ã“ã‹ã‚‰ã¯ã„ãã¤ã‹å…·ä½“ä¾‹ã‚’ã¿ã¦ã„ãã¾ã™ã€‚<h3 id=cargo-install-listnoparse><a aria-label="Anchor link for: cargo-install-listnoparse" class=zola-anchor href=#cargo-install-listnoparse><code>cargo install --list</code>ã®parse</a></h3><p><code>cargo install --list</code>ã‚’å®Ÿè¡Œã™ã‚‹ã¨ãˆã‚‰ã‚Œã‚‹å‡ºåŠ›ã‚’parseã—ã¦ã¿ã¾ã™ã€‚<br> <a href=https://github.com/ymgyt/localenv/blob/74847c0789dd91d86798b7ba5b16192bceb55ac8/src/operation/installer/cargo.rs#L66 rel=external>https://github.com/ymgyt/localenv/blob/74847c0789dd91d86798b7ba5b16192bceb55ac8/src/operation/installer/cargo.rs#L66</a> å®Ÿè¡Œã™ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ãªå‡ºåŠ›ã‚’ãˆã¾ã—ãŸã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=plain><span class=giallo-l><span>alacritty v0.7.2 (/Users/ymgyt/rs/alacritty/alacritty):</span></span>
<span class=giallo-l><span>    alacritty</span></span>
<span class=giallo-l><span>bat v0.17.1:</span></span>
<span class=giallo-l><span>    bat</span></span>
<span class=giallo-l><span>cargo-add v0.2.0:</span></span>
<span class=giallo-l><span>    cargo-add</span></span>
<span class=giallo-l><span>cargo-expand v1.0.6:</span></span>
<span class=giallo-l><span>    cargo-expand</span></span>
<span class=giallo-l><span>cargo-generate v0.6.1:</span></span>
<span class=giallo-l><span>    cargo-generate</span></span>
<span class=giallo-l><span>cargo-hf2 v0.3.1:</span></span>
<span class=giallo-l><span>    cargo-hf2</span></span>
<span class=giallo-l><span>cargo-make v0.32.12:</span></span>
<span class=giallo-l><span>    cargo-make</span></span>
<span class=giallo-l><span>    makers</span></span>
<span class=giallo-l><span>// ... </span></span></code></pre><p>packageåã€version, optionalãªlocalã®path, binaryã¨ã„ã£ãŸæƒ…å ±ãŒã‚ã‚‹ã‚ˆã†ã§ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>use</span><span> nom</span><span style=color:#81a1c1>::</span><span>bytes</span><span style=color:#81a1c1>::</span><span>complete</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>use</span><span> nom</span><span style=color:#81a1c1>::</span><span>character</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>use</span><span> nom</span><span style=color:#81a1c1>::</span><span>combinator</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>use</span><span> nom</span><span style=color:#81a1c1>::</span><span>multi</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>use</span><span> nom</span><span style=color:#81a1c1>::</span><span>sequence</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>use</span><span> nom</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>IResult</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>use</span><span> std</span><span style=color:#81a1c1>::</span><span>path</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>PathBuf</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#5e81ac>#[derive(</span><span style=color:#8fbcbb>Debug</span><span style=color:#5e81ac>,</span><span style=color:#8fbcbb> PartialEq</span><span style=color:#5e81ac>,</span><span style=color:#8fbcbb> Clone</span><span style=color:#5e81ac>)]</span></span>
<span class=giallo-l><span style=color:#81a1c1>pub struct</span><span style=color:#8fbcbb> Package</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span>    name</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> String</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>    bin</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> String</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>    version</span><span style=color:#81a1c1>:</span><span> semver</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Version</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>    local_path</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Option</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>PathBuf</span><span style=color:#eceff4>>,</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p><code>cargo install --list</code>ã®å‡ºåŠ›ã‹ã‚‰<code>Vec&lt;Package></code>ã‚’parseã™ã‚‹ã“ã¨ã‚’ã‚’ç›®æŒ‡ã—ã¾ã™ã€‚<br> ã¾ãšã¯ã€<code>alacritty v0.7.2 (/Users/ymgyt/rs/alacritty/alacritty)</code>ã‚’parseã—ã¦ã¿ã¾ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#616e88>/// consume separator spaces.</span></span>
<span class=giallo-l><span style=color:#81a1c1>fn</span><span style=color:#88c0d0> space</span><span style=color:#eceff4>(</span><span>i</span><span style=color:#81a1c1>: &</span><span style=color:#8fbcbb>str</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> IResult</span><span style=color:#eceff4>&lt;</span><span style=color:#81a1c1>&</span><span style=color:#8fbcbb>str</span><span style=color:#eceff4>, ()> {</span></span>
<span class=giallo-l><span>    complete</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>take_while</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>|</span><span>c</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> char</span><span style=color:#81a1c1>|</span><span> c</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>is_whitespace</span><span style=color:#eceff4>())(</span><span>i</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>map</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>|</span><span style=color:#eceff4>(</span><span>remain</span><span style=color:#eceff4>,</span><span> _</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>|</span><span style=color:#eceff4> (</span><span>remain</span><span style=color:#eceff4>, ()))</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#616e88>/// parse cargo package name.</span></span>
<span class=giallo-l><span style=color:#81a1c1>fn</span><span style=color:#88c0d0> package_name</span><span style=color:#eceff4>(</span><span>i</span><span style=color:#81a1c1>: &</span><span style=color:#8fbcbb>str</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> IResult</span><span style=color:#eceff4>&lt;</span><span style=color:#81a1c1>&</span><span style=color:#8fbcbb>str</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> &</span><span style=color:#8fbcbb>str</span><span style=color:#eceff4>> {</span></span>
<span class=giallo-l><span>    complete</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>take_while</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>|</span><span>c</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> char</span><span style=color:#81a1c1>|</span><span> c</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>is_alphanumeric</span><span style=color:#eceff4>()</span><span style=color:#81a1c1> ||</span><span> c</span><span style=color:#81a1c1> ==</span><span style=color:#eceff4> '</span><span style=color:#a3be8c>-</span><span style=color:#eceff4>'</span><span style=color:#81a1c1> ||</span><span> c</span><span style=color:#81a1c1> ==</span><span style=color:#eceff4> '</span><span style=color:#a3be8c>_</span><span style=color:#eceff4>')(</span><span>i</span><span style=color:#eceff4>)</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#616e88>/// parse cargo package semantic version.</span></span>
<span class=giallo-l><span style=color:#81a1c1>fn</span><span style=color:#88c0d0> version</span><span style=color:#eceff4>(</span><span>i</span><span style=color:#81a1c1>: &</span><span style=color:#8fbcbb>str</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> IResult</span><span style=color:#eceff4>&lt;</span><span style=color:#81a1c1>&</span><span style=color:#8fbcbb>str</span><span style=color:#eceff4>,</span><span> semver</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Version</span><span style=color:#eceff4>> {</span></span>
<span class=giallo-l><span>    combinator</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>map_res</span><span style=color:#eceff4>(</span></span>
<span class=giallo-l><span>        sequence</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>preceded</span><span style=color:#eceff4>(</span></span>
<span class=giallo-l><span>            complete</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>tag</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>v</span><span style=color:#eceff4>"),</span></span>
<span class=giallo-l><span>            complete</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>take_while</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>|</span><span>c</span><span style=color:#81a1c1>|</span><span style=color:#eceff4> ('</span><span style=color:#a3be8c>0</span><span style=color:#eceff4>'</span><span style=color:#81a1c1>..=</span><span style=color:#eceff4>'</span><span style=color:#a3be8c>9</span><span style=color:#eceff4>')</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>contains</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&</span><span>c</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> ||</span><span> c</span><span style=color:#81a1c1> ==</span><span style=color:#eceff4> '</span><span style=color:#a3be8c>.</span><span style=color:#eceff4>'),</span></span>
<span class=giallo-l><span style=color:#eceff4>        ),</span></span>
<span class=giallo-l><span>        semver</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Version</span><span style=color:#81a1c1>::</span><span>parse</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#eceff4>    )(</span><span>i</span><span style=color:#eceff4>)</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#616e88>/// parse local path enclosed in parentheses.</span></span>
<span class=giallo-l><span style=color:#81a1c1>fn</span><span style=color:#88c0d0> local_path</span><span style=color:#eceff4>(</span><span>i</span><span style=color:#81a1c1>: &</span><span style=color:#8fbcbb>str</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> IResult</span><span style=color:#eceff4>&lt;</span><span style=color:#81a1c1>&</span><span style=color:#8fbcbb>str</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> PathBuf</span><span style=color:#eceff4>> {</span></span>
<span class=giallo-l><span>    combinator</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>map</span><span style=color:#eceff4>(</span></span>
<span class=giallo-l><span>        sequence</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>delimited</span><span style=color:#eceff4>(</span></span>
<span class=giallo-l><span>            character</span><span style=color:#81a1c1>::</span><span>complete</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>char</span><span style=color:#eceff4>('</span><span style=color:#a3be8c>(</span><span style=color:#eceff4>'),</span></span>
<span class=giallo-l><span>            complete</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>take_until</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>)</span><span style=color:#eceff4>"),</span></span>
<span class=giallo-l><span>            character</span><span style=color:#81a1c1>::</span><span>complete</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>char</span><span style=color:#eceff4>('</span><span style=color:#a3be8c>)</span><span style=color:#eceff4>'),</span></span>
<span class=giallo-l><span style=color:#eceff4>        ),</span></span>
<span class=giallo-l><span style=color:#81a1c1>        |</span><span>path</span><span style=color:#81a1c1>|</span><span> PathBuf</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>from</span><span style=color:#eceff4>(</span><span>path</span><span style=color:#eceff4>),</span></span>
<span class=giallo-l><span style=color:#eceff4>    )(</span><span>i</span><span style=color:#eceff4>)</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span>
<span class=giallo-l></span></code></pre><pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#5e81ac>#[test]</span></span>
<span class=giallo-l><span style=color:#81a1c1>fn</span><span style=color:#88c0d0> test_package_name</span><span style=color:#eceff4>() {</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>    assert_eq!</span><span style=color:#eceff4>(</span><span style=color:#88c0d0>package_name</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>alacritty</span><span style=color:#eceff4>"),</span><span style=color:#8fbcbb> Ok</span><span style=color:#eceff4>(("", "</span><span style=color:#a3be8c>alacritty</span><span style=color:#eceff4>")));</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span>
<span class=giallo-l><span style=color:#5e81ac>#[test]</span></span>
<span class=giallo-l><span style=color:#81a1c1>fn</span><span style=color:#88c0d0> test_version</span><span style=color:#eceff4>() {</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>    assert_eq!</span><span style=color:#eceff4>(</span><span style=color:#88c0d0>version</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>v0.1.2</span><span style=color:#eceff4>"),</span><span style=color:#8fbcbb> Ok</span><span style=color:#eceff4>(("",</span><span> semver</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Version</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>new</span><span style=color:#eceff4>(</span><span style=color:#b48ead>0</span><span style=color:#eceff4>,</span><span style=color:#b48ead> 1</span><span style=color:#eceff4>,</span><span style=color:#b48ead> 2</span><span style=color:#eceff4>))));</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>    assert_eq!</span><span style=color:#eceff4>(</span></span>
<span class=giallo-l><span style=color:#88c0d0>        version</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>xxx</span><span style=color:#eceff4>"),</span></span>
<span class=giallo-l><span style=color:#8fbcbb>        Err</span><span style=color:#eceff4>(</span><span style=color:#8fbcbb>NomErr</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>Error</span><span style=color:#eceff4>(</span><span>nom</span><span style=color:#81a1c1>::</span><span>error</span><span style=color:#81a1c1>::</span><span>Error</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>new</span><span style=color:#eceff4>(</span></span>
<span class=giallo-l><span style=color:#eceff4>            "</span><span style=color:#a3be8c>xxx</span><span style=color:#eceff4>",</span></span>
<span class=giallo-l><span>            nom</span><span style=color:#81a1c1>::</span><span>error</span><span style=color:#81a1c1>::</span><span>ErrorKind</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Tag</span></span>
<span class=giallo-l><span style=color:#eceff4>        )))</span></span>
<span class=giallo-l><span style=color:#eceff4>    );</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span>
<span class=giallo-l><span style=color:#5e81ac>#[test]</span></span>
<span class=giallo-l><span style=color:#81a1c1>fn</span><span style=color:#88c0d0> test_local_path</span><span style=color:#eceff4>() {</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>    assert_eq!</span><span style=color:#eceff4>(</span></span>
<span class=giallo-l><span style=color:#88c0d0>        local_path</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>(/Users/ymgyt/hello/rust)</span><span style=color:#eceff4>"),</span></span>
<span class=giallo-l><span style=color:#8fbcbb>        Ok</span><span style=color:#eceff4>(("",</span><span style=color:#8fbcbb> PathBuf</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>from</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>/Users/ymgyt/hello/rust</span><span style=color:#eceff4>")))</span></span>
<span class=giallo-l><span style=color:#eceff4>    );</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>    assert_eq!</span><span style=color:#eceff4>(</span></span>
<span class=giallo-l><span style=color:#88c0d0>        local_path</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>(/Users/ymgyt/hello/rust</span><span style=color:#eceff4>"),</span></span>
<span class=giallo-l><span style=color:#8fbcbb>        Err</span><span style=color:#eceff4>(</span><span style=color:#8fbcbb>NomErr</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>Error</span><span style=color:#eceff4>(</span><span>nom</span><span style=color:#81a1c1>::</span><span>error</span><span style=color:#81a1c1>::</span><span>Error</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>new</span><span style=color:#eceff4>(</span></span>
<span class=giallo-l><span style=color:#eceff4>            "</span><span style=color:#a3be8c>/Users/ymgyt/hello/rust</span><span style=color:#eceff4>",</span></span>
<span class=giallo-l><span>            nom</span><span style=color:#81a1c1>::</span><span>error</span><span style=color:#81a1c1>::</span><span>ErrorKind</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>TakeUntil</span></span>
<span class=giallo-l><span style=color:#eceff4>        )))</span></span>
<span class=giallo-l><span style=color:#eceff4>    );</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p>packageåã€version, local pathç”¨ã®parserã‚’å®šç¾©ã—ãŸã®ã§ã“ã‚Œã‚’çµ„ã¿åˆã‚ã›ã¾ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#616e88>/// parse first line in packages list entry.</span></span>
<span class=giallo-l><span style=color:#81a1c1>fn</span><span style=color:#88c0d0> package_line</span><span style=color:#eceff4>(</span><span>i</span><span style=color:#81a1c1>: &</span><span style=color:#8fbcbb>str</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> IResult</span><span style=color:#eceff4>&lt;</span><span style=color:#81a1c1>&</span><span style=color:#8fbcbb>str</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> Package</span><span style=color:#eceff4>> {</span></span>
<span class=giallo-l><span>    combinator</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>map</span><span style=color:#eceff4>(</span></span>
<span class=giallo-l><span>        sequence</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>terminated</span><span style=color:#eceff4>(</span></span>
<span class=giallo-l><span>            sequence</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>tuple</span><span style=color:#eceff4>((</span></span>
<span class=giallo-l><span>                package_name</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>                space</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>                version</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>                combinator</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>opt</span><span style=color:#eceff4>(</span><span>sequence</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>preceded</span><span style=color:#eceff4>(</span><span>space</span><span style=color:#eceff4>,</span><span> local_path</span><span style=color:#eceff4>)),</span></span>
<span class=giallo-l><span style=color:#eceff4>            )),</span></span>
<span class=giallo-l><span>            complete</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>tag</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>:</span><span style=color:#eceff4>"),</span></span>
<span class=giallo-l><span style=color:#eceff4>        ),</span></span>
<span class=giallo-l><span style=color:#81a1c1>        |</span><span style=color:#eceff4>(</span><span>name</span><span style=color:#eceff4>,</span><span> _</span><span style=color:#eceff4>,</span><span> v</span><span style=color:#eceff4>,</span><span> local_path</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>|</span><span style=color:#8fbcbb> Package</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span>            name</span><span style=color:#81a1c1>:</span><span> name</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>to_owned</span><span style=color:#eceff4>(),</span></span>
<span class=giallo-l><span>            version</span><span style=color:#81a1c1>:</span><span> v</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>            local_path</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>            bin</span><span style=color:#81a1c1>:</span><span style=color:#eceff4> ""</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>to_owned</span><span style=color:#eceff4>(),</span></span>
<span class=giallo-l><span style=color:#eceff4>        },</span></span>
<span class=giallo-l><span style=color:#eceff4>    )(</span><span>i</span><span style=color:#eceff4>)</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#5e81ac>#[test]</span></span>
<span class=giallo-l><span style=color:#81a1c1>fn</span><span style=color:#88c0d0> test_package_line</span><span style=color:#eceff4>() {</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>    assert_eq!</span><span style=color:#eceff4>(</span><span style=color:#88c0d0>package_line</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>bat v0.17.1:</span><span style=color:#eceff4>"),</span><span style=color:#8fbcbb> Ok</span><span style=color:#eceff4>(("",</span><span style=color:#88c0d0> pkg_bat</span><span style=color:#eceff4>())));</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>    assert_eq!</span><span style=color:#eceff4>(</span></span>
<span class=giallo-l><span style=color:#88c0d0>        package_line</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>bat v0.17.1 (/Users/ymgyt/hello/rust):</span><span style=color:#eceff4>"),</span></span>
<span class=giallo-l><span style=color:#8fbcbb>        Ok</span><span style=color:#eceff4>(("",</span><span style=color:#88c0d0> pkg_bat</span><span style=color:#eceff4>()</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>with_local_path</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>/Users/ymgyt/hello/rust</span><span style=color:#eceff4>"))),</span></span>
<span class=giallo-l><span style=color:#eceff4>    );</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>fn</span><span style=color:#88c0d0> pkg_bat</span><span style=color:#eceff4>()</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> Package</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#8fbcbb>    Package</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span>        name</span><span style=color:#81a1c1>:</span><span style=color:#eceff4> "</span><span style=color:#a3be8c>bat</span><span style=color:#eceff4>"</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>to_owned</span><span style=color:#eceff4>(),</span></span>
<span class=giallo-l><span>        version</span><span style=color:#81a1c1>:</span><span> semver</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Version</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>new</span><span style=color:#eceff4>(</span><span style=color:#b48ead>0</span><span style=color:#eceff4>,</span><span style=color:#b48ead> 17</span><span style=color:#eceff4>,</span><span style=color:#b48ead> 1</span><span style=color:#eceff4>),</span></span>
<span class=giallo-l><span>        local_path</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> None</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>        bin</span><span style=color:#81a1c1>:</span><span style=color:#eceff4> ""</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>to_owned</span><span style=color:#eceff4>(),</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p>æ¬¡ã«installã•ã‚Œã¦ã„ã‚‹binaryãŒ1ä»¥ä¸Šç¶šãã®ã§parseã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#616e88>/// parse package binary line.</span></span>
<span class=giallo-l><span style=color:#81a1c1>fn</span><span style=color:#88c0d0> bin_line</span><span style=color:#eceff4>(</span><span>i</span><span style=color:#81a1c1>: &</span><span style=color:#8fbcbb>str</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> IResult</span><span style=color:#eceff4>&lt;</span><span style=color:#81a1c1>&</span><span style=color:#8fbcbb>str</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> String</span><span style=color:#eceff4>> {</span></span>
<span class=giallo-l><span>    combinator</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>map</span><span style=color:#eceff4>(</span></span>
<span class=giallo-l><span>        sequence</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>tuple</span><span style=color:#eceff4>((</span></span>
<span class=giallo-l><span>            complete</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>take_while1</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>|</span><span>c</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> char</span><span style=color:#81a1c1>|</span><span> c</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>is_whitespace</span><span style=color:#eceff4>()),</span></span>
<span class=giallo-l><span>            package_name</span><span style=color:#eceff4>,</span><span style=color:#616e88> // define bin_name if needed.</span></span>
<span class=giallo-l><span style=color:#eceff4>        )),</span></span>
<span class=giallo-l><span style=color:#81a1c1>        |</span><span style=color:#eceff4>(</span><span>_</span><span style=color:#eceff4>,</span><span> bin</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>|</span><span style=color:#8fbcbb> String</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>from</span><span style=color:#eceff4>(</span><span>bin</span><span style=color:#eceff4>),</span></span>
<span class=giallo-l><span style=color:#eceff4>    )(</span><span>i</span><span style=color:#eceff4>)</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#616e88>/// parse package binary lines.</span></span>
<span class=giallo-l><span style=color:#81a1c1>fn</span><span style=color:#88c0d0> bin_lines</span><span style=color:#eceff4>(</span><span>i</span><span style=color:#81a1c1>: &</span><span style=color:#8fbcbb>str</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> IResult</span><span style=color:#eceff4>&lt;</span><span style=color:#81a1c1>&</span><span style=color:#8fbcbb>str</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> Vec</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>String</span><span style=color:#eceff4>>> {</span></span>
<span class=giallo-l><span>    multi</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>separated_list1</span><span style=color:#eceff4>(</span><span>character</span><span style=color:#81a1c1>::</span><span>complete</span><span style=color:#81a1c1>::</span><span>line_ending</span><span style=color:#eceff4>,</span><span> bin_line</span><span style=color:#eceff4>)(</span><span>i</span><span style=color:#eceff4>)</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#5e81ac>#[test]</span></span>
<span class=giallo-l><span style=color:#81a1c1>fn</span><span style=color:#88c0d0> test_bin_line</span><span style=color:#eceff4>() {</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>    assert_eq!</span><span style=color:#eceff4>(</span><span style=color:#88c0d0>bin_line</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>    nu</span><span style=color:#eceff4>"),</span><span style=color:#8fbcbb> Ok</span><span style=color:#eceff4>(("", "</span><span style=color:#a3be8c>nu</span><span style=color:#eceff4>"</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>to_owned</span><span style=color:#eceff4>())));</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>    assert_eq!</span><span style=color:#eceff4>(</span></span>
<span class=giallo-l><span style=color:#88c0d0>        bin_line</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>nu</span><span style=color:#eceff4>"),</span></span>
<span class=giallo-l><span style=color:#8fbcbb>        Err</span><span style=color:#eceff4>(</span><span style=color:#8fbcbb>NomErr</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>Error</span><span style=color:#eceff4>(</span><span>nom</span><span style=color:#81a1c1>::</span><span>error</span><span style=color:#81a1c1>::</span><span>Error</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>new</span><span style=color:#eceff4>(</span></span>
<span class=giallo-l><span style=color:#eceff4>            "</span><span style=color:#a3be8c>nu</span><span style=color:#eceff4>",</span></span>
<span class=giallo-l><span>            nom</span><span style=color:#81a1c1>::</span><span>error</span><span style=color:#81a1c1>::</span><span>ErrorKind</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>TakeWhile1</span></span>
<span class=giallo-l><span style=color:#eceff4>        )))</span></span>
<span class=giallo-l><span style=color:#eceff4>    );</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span>
<span class=giallo-l><span style=color:#5e81ac>#[test]</span></span>
<span class=giallo-l><span style=color:#81a1c1>fn</span><span style=color:#88c0d0> test_bin_lines</span><span style=color:#eceff4>() {</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>    assert_eq!</span><span style=color:#eceff4>(</span></span>
<span class=giallo-l><span style=color:#88c0d0>        bin_lines</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>    nu_1</span><span style=color:#ebcb8b>\n</span><span style=color:#a3be8c>    nu_2</span><span style=color:#ebcb8b>\n</span><span style=color:#a3be8c>ripgrep</span><span style=color:#eceff4>"),</span></span>
<span class=giallo-l><span style=color:#8fbcbb>        Ok</span><span style=color:#eceff4>(("</span><span style=color:#ebcb8b>\n</span><span style=color:#a3be8c>ripgrep</span><span style=color:#eceff4>",</span><span style=color:#88c0d0;font-weight:700> vec!</span><span style=color:#eceff4>["</span><span style=color:#a3be8c>nu_1</span><span style=color:#eceff4>"</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>into</span><span style=color:#eceff4>(), "</span><span style=color:#a3be8c>nu_2</span><span style=color:#eceff4>"</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>into</span><span style=color:#eceff4>()]))</span></span>
<span class=giallo-l><span style=color:#eceff4>    );</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p>å…ˆé ­ã«spaceãŒãªã„å ´åˆã¯æ¬¡ã®packageã®é–‹å§‹ãªã®ã§ã€<code>bin_line</code>ã§ã¯<code>take_while1</code>ã‚’åˆ©ç”¨ã—ã¦å¿…ãšwhitespaceãŒã‚ã‚‹ã“ã¨ã‚’è¦æ±‚ã—ã¦ã„ã¾ã™ã€‚<br> æ”¹è¡Œã‚³ãƒ¼ãƒ‰ã¯nomã«å®šç¾©ã•ã‚Œã¦ã„ã‚‹<code>character::complete::line_endoing</code>ã‚’åˆ©ç”¨ã™ã‚‹ã¨<code>\n</code>ã¨<code>\r\n</code>ã«ä¸¡å¯¾å¿œã§ãã¾ã™ã€‚<br> 1packageã‚’parseã§ãã‚‹ã‚ˆã†ã«ãªã£ãŸã®ã§ã“ã‚Œã‚’çµ„ã¿åˆã‚ã›ã¦æœ€çµ‚çš„ãªparserã«ã—ã¾ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>impl</span><span style=color:#8fbcbb> Package</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    fn</span><span style=color:#88c0d0> with_bin</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>T</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Into</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>String</span><span style=color:#eceff4>>>(</span><span style=color:#81a1c1>mut self</span><span style=color:#eceff4>,</span><span> bin</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> T</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -> Self</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>        self.</span><span>bin </span><span style=color:#81a1c1>=</span><span> bin</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>into</span><span style=color:#eceff4>();</span></span>
<span class=giallo-l><span style=color:#81a1c1>        self</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#616e88>/// parse package entry.</span></span>
<span class=giallo-l><span style=color:#81a1c1>fn</span><span style=color:#88c0d0> package_entry</span><span style=color:#eceff4>(</span><span>i</span><span style=color:#81a1c1>: &</span><span style=color:#8fbcbb>str</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> IResult</span><span style=color:#eceff4>&lt;</span><span style=color:#81a1c1>&</span><span style=color:#8fbcbb>str</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> Package</span><span style=color:#eceff4>> {</span></span>
<span class=giallo-l><span>    combinator</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>map</span><span style=color:#eceff4>(</span><span>sequence</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>tuple</span><span style=color:#eceff4>((</span><span>package_line</span><span style=color:#eceff4>,</span><span> bin_lines</span><span style=color:#eceff4>)),</span><span style=color:#81a1c1> |</span><span style=color:#eceff4>(</span><span>pkg</span><span style=color:#eceff4>,</span><span> bins</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>|</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span>        pkg</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>with_bin</span><span style=color:#eceff4>(</span><span>bins</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>first</span><span style=color:#eceff4>()</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>expect</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>at least one binary</span><span style=color:#eceff4>"))</span></span>
<span class=giallo-l><span style=color:#eceff4>    })(</span><span>i</span><span style=color:#eceff4>)</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#616e88>/// parse cargo install --list output.</span></span>
<span class=giallo-l><span style=color:#81a1c1>pub</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>super</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> fn</span><span style=color:#88c0d0> package_list</span><span style=color:#eceff4>(</span><span>i</span><span style=color:#81a1c1>: &</span><span style=color:#8fbcbb>str</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> IResult</span><span style=color:#eceff4>&lt;</span><span style=color:#81a1c1>&</span><span style=color:#8fbcbb>str</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> Vec</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Package</span><span style=color:#eceff4>>> {</span></span>
<span class=giallo-l><span>    multi</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>many1</span><span style=color:#eceff4>(</span><span>sequence</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>preceded</span><span style=color:#eceff4>(</span></span>
<span class=giallo-l><span>        combinator</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>opt</span><span style=color:#eceff4>(</span><span>character</span><span style=color:#81a1c1>::</span><span>complete</span><span style=color:#81a1c1>::</span><span>newline</span><span style=color:#eceff4>),</span></span>
<span class=giallo-l><span>        package_entry</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#eceff4>    ))(</span><span>i</span><span style=color:#eceff4>)</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#5e81ac>#[test]</span></span>
<span class=giallo-l><span style=color:#81a1c1>fn</span><span style=color:#88c0d0> parse_install_list</span><span style=color:#eceff4>() {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    let</span><span> s</span><span style=color:#81a1c1> =</span><span style=color:#a3be8c> r</span><span style=color:#eceff4>"</span><span style=color:#a3be8c>alacritty v0.7.2 (/Users/ymgyt/rs/alacritty/alacritty):</span></span>
<span class=giallo-l><span style=color:#a3be8c>    alacritty</span></span>
<span class=giallo-l><span style=color:#a3be8c>bat v0.17.1:</span></span>
<span class=giallo-l><span style=color:#a3be8c>    bat</span></span>
<span class=giallo-l><span style=color:#a3be8c>cargo-make v0.32.12:</span></span>
<span class=giallo-l><span style=color:#a3be8c>    cargo-make</span></span>
<span class=giallo-l><span style=color:#a3be8c>    makers</span></span>
<span class=giallo-l><span style=color:#a3be8c>nu v0.29.1 (/Users/ymgyt/rs/nushell):</span></span>
<span class=giallo-l><span style=color:#a3be8c>    nu</span></span>
<span class=giallo-l><span style=color:#a3be8c>    nu_plugin_core_fetch</span></span>
<span class=giallo-l><span style=color:#a3be8c>    nu_plugin_core_inc</span></span>
<span class=giallo-l><span style=color:#a3be8c>    nu_plugin_core_match</span></span>
<span class=giallo-l><span style=color:#a3be8c>    nu_plugin_core_post</span></span>
<span class=giallo-l><span style=color:#a3be8c>    nu_plugin_core_ps</span></span>
<span class=giallo-l><span style=color:#a3be8c>    nu_plugin_core_sys</span></span>
<span class=giallo-l><span style=color:#a3be8c>    nu_plugin_core_textview</span></span>
<span class=giallo-l><span style=color:#a3be8c>    nu_plugin_extra_binaryview</span></span>
<span class=giallo-l><span style=color:#a3be8c>    nu_plugin_extra_chart_bar</span></span>
<span class=giallo-l><span style=color:#a3be8c>    nu_plugin_extra_chart_line</span></span>
<span class=giallo-l><span style=color:#a3be8c>    nu_plugin_extra_from_bson</span></span>
<span class=giallo-l><span style=color:#a3be8c>    nu_plugin_extra_from_sqlite</span></span>
<span class=giallo-l><span style=color:#a3be8c>    nu_plugin_extra_s3</span></span>
<span class=giallo-l><span style=color:#a3be8c>    nu_plugin_extra_selector</span></span>
<span class=giallo-l><span style=color:#a3be8c>    nu_plugin_extra_start</span></span>
<span class=giallo-l><span style=color:#a3be8c>    nu_plugin_extra_to_bson</span></span>
<span class=giallo-l><span style=color:#a3be8c>    nu_plugin_extra_to_sqlite</span></span>
<span class=giallo-l><span style=color:#a3be8c>    nu_plugin_extra_tree</span></span>
<span class=giallo-l><span style=color:#a3be8c>    nu_plugin_extra_xpath</span></span>
<span class=giallo-l><span style=color:#a3be8c>ripgrep v12.1.1:</span></span>
<span class=giallo-l><span style=color:#a3be8c>    rg</span></span>
<span class=giallo-l><span style=color:#eceff4>";</span></span>
<span class=giallo-l><span style=color:#81a1c1>    let</span><span> want</span><span style=color:#81a1c1> =</span><span style=color:#88c0d0;font-weight:700> vec!</span><span style=color:#eceff4>[</span></span>
<span class=giallo-l><span style=color:#8fbcbb>        Package</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span>            name</span><span style=color:#81a1c1>:</span><span style=color:#eceff4> "</span><span style=color:#a3be8c>alacritty</span><span style=color:#eceff4>"</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>to_owned</span><span style=color:#eceff4>(),</span></span>
<span class=giallo-l><span>            bin</span><span style=color:#81a1c1>:</span><span style=color:#eceff4> "</span><span style=color:#a3be8c>alacritty</span><span style=color:#eceff4>"</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>to_owned</span><span style=color:#eceff4>(),</span></span>
<span class=giallo-l><span>            version</span><span style=color:#81a1c1>:</span><span> semver</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Version</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>new</span><span style=color:#eceff4>(</span><span style=color:#b48ead>0</span><span style=color:#eceff4>,</span><span style=color:#b48ead> 7</span><span style=color:#eceff4>,</span><span style=color:#b48ead> 2</span><span style=color:#eceff4>),</span></span>
<span class=giallo-l><span>            local_path</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Some</span><span style=color:#eceff4>(</span><span style=color:#8fbcbb>PathBuf</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>from</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>/Users/ymgyt/rs/alacritty/alacritty</span><span style=color:#eceff4>")),</span></span>
<span class=giallo-l><span style=color:#eceff4>        },</span></span>
<span class=giallo-l><span style=color:#8fbcbb>        Package</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span>            name</span><span style=color:#81a1c1>:</span><span style=color:#eceff4> "</span><span style=color:#a3be8c>bat</span><span style=color:#eceff4>"</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>to_owned</span><span style=color:#eceff4>(),</span></span>
<span class=giallo-l><span>            bin</span><span style=color:#81a1c1>:</span><span style=color:#eceff4> "</span><span style=color:#a3be8c>bat</span><span style=color:#eceff4>"</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>to_owned</span><span style=color:#eceff4>(),</span></span>
<span class=giallo-l><span>            version</span><span style=color:#81a1c1>:</span><span> semver</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Version</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>new</span><span style=color:#eceff4>(</span><span style=color:#b48ead>0</span><span style=color:#eceff4>,</span><span style=color:#b48ead> 17</span><span style=color:#eceff4>,</span><span style=color:#b48ead> 1</span><span style=color:#eceff4>),</span></span>
<span class=giallo-l><span>            local_path</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> None</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#eceff4>        },</span></span>
<span class=giallo-l><span style=color:#8fbcbb>        Package</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span>            name</span><span style=color:#81a1c1>:</span><span style=color:#eceff4> "</span><span style=color:#a3be8c>cargo-make</span><span style=color:#eceff4>"</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>to_owned</span><span style=color:#eceff4>(),</span></span>
<span class=giallo-l><span>            bin</span><span style=color:#81a1c1>:</span><span style=color:#eceff4> "</span><span style=color:#a3be8c>cargo-make</span><span style=color:#eceff4>"</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>to_owned</span><span style=color:#eceff4>(),</span></span>
<span class=giallo-l><span>            version</span><span style=color:#81a1c1>:</span><span> semver</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Version</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>new</span><span style=color:#eceff4>(</span><span style=color:#b48ead>0</span><span style=color:#eceff4>,</span><span style=color:#b48ead> 32</span><span style=color:#eceff4>,</span><span style=color:#b48ead> 12</span><span style=color:#eceff4>),</span></span>
<span class=giallo-l><span>            local_path</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> None</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#eceff4>        },</span></span>
<span class=giallo-l><span style=color:#8fbcbb>        Package</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span>            name</span><span style=color:#81a1c1>:</span><span style=color:#eceff4> "</span><span style=color:#a3be8c>nu</span><span style=color:#eceff4>"</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>to_owned</span><span style=color:#eceff4>(),</span></span>
<span class=giallo-l><span>            bin</span><span style=color:#81a1c1>:</span><span style=color:#eceff4> "</span><span style=color:#a3be8c>nu</span><span style=color:#eceff4>"</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>to_owned</span><span style=color:#eceff4>(),</span></span>
<span class=giallo-l><span>            version</span><span style=color:#81a1c1>:</span><span> semver</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Version</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>new</span><span style=color:#eceff4>(</span><span style=color:#b48ead>0</span><span style=color:#eceff4>,</span><span style=color:#b48ead> 29</span><span style=color:#eceff4>,</span><span style=color:#b48ead> 1</span><span style=color:#eceff4>),</span></span>
<span class=giallo-l><span>            local_path</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Some</span><span style=color:#eceff4>(</span><span style=color:#8fbcbb>PathBuf</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>from</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>/Users/ymgyt/rs/nushell</span><span style=color:#eceff4>")),</span></span>
<span class=giallo-l><span style=color:#eceff4>        },</span></span>
<span class=giallo-l><span style=color:#8fbcbb>        Package</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span>            name</span><span style=color:#81a1c1>:</span><span style=color:#eceff4> "</span><span style=color:#a3be8c>ripgrep</span><span style=color:#eceff4>"</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>to_owned</span><span style=color:#eceff4>(),</span></span>
<span class=giallo-l><span>            bin</span><span style=color:#81a1c1>:</span><span style=color:#eceff4> "</span><span style=color:#a3be8c>rg</span><span style=color:#eceff4>"</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>to_owned</span><span style=color:#eceff4>(),</span></span>
<span class=giallo-l><span>            version</span><span style=color:#81a1c1>:</span><span> semver</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Version</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>new</span><span style=color:#eceff4>(</span><span style=color:#b48ead>12</span><span style=color:#eceff4>,</span><span style=color:#b48ead> 1</span><span style=color:#eceff4>,</span><span style=color:#b48ead> 1</span><span style=color:#eceff4>),</span></span>
<span class=giallo-l><span>            local_path</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> None</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#eceff4>        },</span></span>
<span class=giallo-l><span style=color:#eceff4>    ];</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>    assert_eq!</span><span style=color:#eceff4>(</span><span style=color:#88c0d0>package_list</span><span style=color:#eceff4>(</span><span>s</span><span style=color:#eceff4>),</span><span style=color:#8fbcbb> Ok</span><span style=color:#eceff4>(("</span><span style=color:#ebcb8b>\n</span><span style=color:#eceff4>",</span><span> want</span><span style=color:#eceff4>)));</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p>ç„¡äº‹parseã§ãã¾ã—ãŸã€‚å°ã•ã„parserã‹ã‚‰ä½œã£ã¦ã„ããã‚Œã‚’ã ã‚“ã ã‚“ã¨çµ„ã¿åˆã‚ã›ã¦ã„ãã“ã¨ã§æœ€çµ‚çš„ãªparserã‚’ã¤ãã‚Œã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã—ãŸã€‚ å„å‡¦ç†ãŒé–¢æ•°ã«åˆ‡ã‚Šå‡ºã•ã‚Œã¦ã„ã‚‹ã®ã§testã‚’æ›¸ãã‚„ã™ã„ã®ã‚‚ã†ã‚Œã—ã„ã§ã™ã­ã€‚<h3 id=json><a aria-label="Anchor link for: json" class=zola-anchor href=#json>json</a></h3><p>jsonã®parseå‡¦ç†ã‚’è¦‹ã¦ã„ãã¾ã™ã€‚<a href=https://github.com/Geal/nom/blob/master/examples/json.rs rel=external>å…¬å¼ã®example</a> ã‚’å‚è€ƒã«ã—ã¦ãŠã‚Šã¾ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>use</span><span> nom</span><span style=color:#81a1c1>::</span><span style=color:#eceff4>{</span></span>
<span class=giallo-l><span>    branch</span><span style=color:#81a1c1>::</span><span>alt</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>    bytes</span><span style=color:#81a1c1>::</span><span>complete</span><span style=color:#81a1c1>::</span><span style=color:#eceff4>{</span><span>escaped</span><span style=color:#eceff4>,</span><span> tag</span><span style=color:#eceff4>,</span><span> take_while</span><span style=color:#eceff4>},</span></span>
<span class=giallo-l><span>    character</span><span style=color:#81a1c1>::</span><span>complete</span><span style=color:#81a1c1>::</span><span style=color:#eceff4>{</span><span>alphanumeric1</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> char</span><span style=color:#eceff4>,</span><span> one_of</span><span style=color:#eceff4>},</span></span>
<span class=giallo-l><span>    combinator</span><span style=color:#81a1c1>::</span><span style=color:#eceff4>{</span><span>cut</span><span style=color:#eceff4>,</span><span> map</span><span style=color:#eceff4>,</span><span> opt</span><span style=color:#eceff4>,</span><span> value</span><span style=color:#eceff4>},</span></span>
<span class=giallo-l><span>    error</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>ParseError</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>    multi</span><span style=color:#81a1c1>::</span><span>separated_list0</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>    number</span><span style=color:#81a1c1>::</span><span>complete</span><span style=color:#81a1c1>::</span><span>double</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>    sequence</span><span style=color:#81a1c1>::</span><span style=color:#eceff4>{</span><span>delimited</span><span style=color:#eceff4>,</span><span> preceded</span><span style=color:#eceff4>,</span><span> separated_pair</span><span style=color:#eceff4>,</span><span> terminated</span><span style=color:#eceff4>},</span></span>
<span class=giallo-l><span style=color:#8fbcbb>    IResult</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#eceff4>};</span></span>
<span class=giallo-l><span style=color:#81a1c1>use</span><span> std</span><span style=color:#81a1c1>::</span><span style=color:#eceff4>{</span><span>array</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>IntoIter</span><span style=color:#eceff4>,</span><span> collections</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>HashMap</span><span style=color:#eceff4>,</span><span> iter</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>FromIterator</span><span style=color:#eceff4>};</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#5e81ac>#[derive(</span><span style=color:#8fbcbb>Debug</span><span style=color:#5e81ac>,</span><span style=color:#8fbcbb> PartialEq</span><span style=color:#5e81ac>)]</span></span>
<span class=giallo-l><span style=color:#81a1c1>pub enum</span><span style=color:#8fbcbb> JsonValue</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#88c0d0>    Str</span><span style=color:#eceff4>(</span><span style=color:#8fbcbb>String</span><span style=color:#eceff4>),</span></span>
<span class=giallo-l><span style=color:#88c0d0>    Boolean</span><span style=color:#eceff4>(</span><span style=color:#8fbcbb>bool</span><span style=color:#eceff4>),</span></span>
<span class=giallo-l><span style=color:#88c0d0>    Num</span><span style=color:#eceff4>(</span><span style=color:#8fbcbb>f64</span><span style=color:#eceff4>),</span></span>
<span class=giallo-l><span style=color:#88c0d0>    Array</span><span style=color:#eceff4>(</span><span style=color:#8fbcbb>Vec</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>JsonValue</span><span style=color:#eceff4>>),</span></span>
<span class=giallo-l><span style=color:#88c0d0>    Object</span><span style=color:#eceff4>(</span><span style=color:#8fbcbb>HashMap</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>String</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> JsonValue</span><span style=color:#eceff4>>),</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>fn</span><span style=color:#88c0d0> sp</span><span style=color:#eceff4>&lt;'</span><span style=color:#8fbcbb>a</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> E</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> ParseError</span><span style=color:#eceff4>&lt;</span><span style=color:#81a1c1>&</span><span style=color:#eceff4>'</span><span style=color:#8fbcbb>a str</span><span style=color:#eceff4>>>(</span><span>i</span><span style=color:#81a1c1>: &</span><span style=color:#eceff4>'</span><span style=color:#8fbcbb>a str</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> IResult</span><span style=color:#eceff4>&lt;</span><span style=color:#81a1c1>&</span><span style=color:#eceff4>'</span><span style=color:#8fbcbb>a str</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> &</span><span style=color:#eceff4>'</span><span style=color:#8fbcbb>a str</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> E</span><span style=color:#eceff4>> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    let</span><span> chars</span><span style=color:#81a1c1> =</span><span style=color:#eceff4> "</span><span style=color:#ebcb8b> \t\r\n</span><span style=color:#eceff4>";</span></span>
<span class=giallo-l><span style=color:#88c0d0>    take_while</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>move |</span><span>c</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> char</span><span style=color:#81a1c1>|</span><span> chars</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>contains</span><span style=color:#eceff4>(</span><span>c</span><span style=color:#eceff4>))(</span><span>i</span><span style=color:#eceff4>)</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>fn</span><span style=color:#88c0d0> parse_str</span><span style=color:#eceff4>&lt;'</span><span style=color:#8fbcbb>a</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> E</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> ParseError</span><span style=color:#eceff4>&lt;</span><span style=color:#81a1c1>&</span><span style=color:#eceff4>'</span><span style=color:#8fbcbb>a str</span><span style=color:#eceff4>>>(</span><span>i</span><span style=color:#81a1c1>: &</span><span style=color:#eceff4>'</span><span style=color:#8fbcbb>a str</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> IResult</span><span style=color:#eceff4>&lt;</span><span style=color:#81a1c1>&</span><span style=color:#eceff4>'</span><span style=color:#8fbcbb>a str</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> &</span><span style=color:#eceff4>'</span><span style=color:#8fbcbb>a str</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> E</span><span style=color:#eceff4>> {</span></span>
<span class=giallo-l><span style=color:#88c0d0>    escaped</span><span style=color:#eceff4>(</span><span>alphanumeric1</span><span style=color:#eceff4>, '</span><span style=color:#ebcb8b>\\</span><span style=color:#eceff4>',</span><span style=color:#88c0d0> one_of</span><span style=color:#eceff4>("</span><span style=color:#ebcb8b>\"</span><span style=color:#a3be8c>n</span><span style=color:#ebcb8b>\\</span><span style=color:#eceff4>"))(</span><span>i</span><span style=color:#eceff4>)</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>fn</span><span style=color:#88c0d0> boolean</span><span style=color:#eceff4>&lt;'</span><span style=color:#8fbcbb>a</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> E</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> ParseError</span><span style=color:#eceff4>&lt;</span><span style=color:#81a1c1>&</span><span style=color:#eceff4>'</span><span style=color:#8fbcbb>a str</span><span style=color:#eceff4>>>(</span><span>i</span><span style=color:#81a1c1>: &</span><span style=color:#eceff4>'</span><span style=color:#8fbcbb>a str</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> IResult</span><span style=color:#eceff4>&lt;</span><span style=color:#81a1c1>&</span><span style=color:#eceff4>'</span><span style=color:#8fbcbb>a str</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> bool</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> E</span><span style=color:#eceff4>> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    let</span><span> parse_true</span><span style=color:#81a1c1> =</span><span style=color:#88c0d0> value</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>true</span><span style=color:#eceff4>,</span><span style=color:#88c0d0> tag</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>true</span><span style=color:#eceff4>"));</span></span>
<span class=giallo-l><span style=color:#81a1c1>    let</span><span> parse_false</span><span style=color:#81a1c1> =</span><span style=color:#88c0d0> value</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>false</span><span style=color:#eceff4>,</span><span style=color:#88c0d0> tag</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>false</span><span style=color:#eceff4>"));</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#88c0d0>    alt</span><span style=color:#eceff4>((</span><span>parse_true</span><span style=color:#eceff4>,</span><span> parse_false</span><span style=color:#eceff4>))(</span><span>i</span><span style=color:#eceff4>)</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>fn</span><span style=color:#88c0d0> string</span><span style=color:#eceff4>&lt;'</span><span style=color:#8fbcbb>a</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> E</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> ParseError</span><span style=color:#eceff4>&lt;</span><span style=color:#81a1c1>&</span><span style=color:#eceff4>'</span><span style=color:#8fbcbb>a str</span><span style=color:#eceff4>>>(</span><span>i</span><span style=color:#81a1c1>: &</span><span style=color:#eceff4>'</span><span style=color:#8fbcbb>a str</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> IResult</span><span style=color:#eceff4>&lt;</span><span style=color:#81a1c1>&</span><span style=color:#eceff4>'</span><span style=color:#8fbcbb>a str</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> &</span><span style=color:#eceff4>'</span><span style=color:#8fbcbb>a str</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> E</span><span style=color:#eceff4>> {</span></span>
<span class=giallo-l><span style=color:#88c0d0>    preceded</span><span style=color:#eceff4>(</span><span style=color:#88c0d0>char</span><span style=color:#eceff4>('</span><span style=color:#ebcb8b>\"</span><span style=color:#eceff4>'),</span><span style=color:#88c0d0> cut</span><span style=color:#eceff4>(</span><span style=color:#88c0d0>terminated</span><span style=color:#eceff4>(</span><span>parse_str</span><span style=color:#eceff4>,</span><span style=color:#88c0d0> char</span><span style=color:#eceff4>('</span><span style=color:#ebcb8b>\"</span><span style=color:#eceff4>'))))(</span><span>i</span><span style=color:#eceff4>)</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>fn</span><span style=color:#88c0d0> array</span><span style=color:#eceff4>&lt;'</span><span style=color:#8fbcbb>a</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> E</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> ParseError</span><span style=color:#eceff4>&lt;</span><span style=color:#81a1c1>&</span><span style=color:#eceff4>'</span><span style=color:#8fbcbb>a str</span><span style=color:#eceff4>>>(</span><span>i</span><span style=color:#81a1c1>: &</span><span style=color:#eceff4>'</span><span style=color:#8fbcbb>a str</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> IResult</span><span style=color:#eceff4>&lt;</span><span style=color:#81a1c1>&</span><span style=color:#eceff4>'</span><span style=color:#8fbcbb>a str</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> Vec</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>JsonValue</span><span style=color:#eceff4>>,</span><span style=color:#8fbcbb> E</span><span style=color:#eceff4>> {</span></span>
<span class=giallo-l><span style=color:#88c0d0>    preceded</span><span style=color:#eceff4>(</span></span>
<span class=giallo-l><span style=color:#88c0d0>        char</span><span style=color:#eceff4>('</span><span style=color:#a3be8c>[</span><span style=color:#eceff4>'),</span></span>
<span class=giallo-l><span style=color:#88c0d0>        cut</span><span style=color:#eceff4>(</span><span style=color:#88c0d0>terminated</span><span style=color:#eceff4>(</span></span>
<span class=giallo-l><span style=color:#88c0d0>            separated_list0</span><span style=color:#eceff4>(</span><span style=color:#88c0d0>preceded</span><span style=color:#eceff4>(</span><span>sp</span><span style=color:#eceff4>,</span><span style=color:#88c0d0> char</span><span style=color:#eceff4>('</span><span style=color:#a3be8c>,</span><span style=color:#eceff4>')),</span><span> json_value</span><span style=color:#eceff4>),</span></span>
<span class=giallo-l><span style=color:#88c0d0>            preceded</span><span style=color:#eceff4>(</span><span>sp</span><span style=color:#eceff4>,</span><span style=color:#88c0d0> char</span><span style=color:#eceff4>('</span><span style=color:#a3be8c>]</span><span style=color:#eceff4>')),</span></span>
<span class=giallo-l><span style=color:#eceff4>        )),</span></span>
<span class=giallo-l><span style=color:#eceff4>    )(</span><span>i</span><span style=color:#eceff4>)</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>fn</span><span style=color:#88c0d0> key_value</span><span style=color:#eceff4>&lt;'</span><span style=color:#8fbcbb>a</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> E</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> ParseError</span><span style=color:#eceff4>&lt;</span><span style=color:#81a1c1>&</span><span style=color:#eceff4>'</span><span style=color:#8fbcbb>a str</span><span style=color:#eceff4>>>(</span><span>i</span><span style=color:#81a1c1>: &</span><span style=color:#eceff4>'</span><span style=color:#8fbcbb>a str</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> IResult</span><span style=color:#eceff4>&lt;</span><span style=color:#81a1c1>&</span><span style=color:#eceff4>'</span><span style=color:#8fbcbb>a str</span><span style=color:#eceff4>, (</span><span style=color:#81a1c1>&</span><span style=color:#eceff4>'</span><span style=color:#8fbcbb>a str</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> JsonValue</span><span style=color:#eceff4>),</span><span style=color:#8fbcbb> E</span><span style=color:#eceff4>> {</span></span>
<span class=giallo-l><span style=color:#88c0d0>    separated_pair</span><span style=color:#eceff4>(</span></span>
<span class=giallo-l><span style=color:#88c0d0>        preceded</span><span style=color:#eceff4>(</span><span>sp</span><span style=color:#eceff4>,</span><span> string</span><span style=color:#eceff4>),</span></span>
<span class=giallo-l><span style=color:#88c0d0>        cut</span><span style=color:#eceff4>(</span><span style=color:#88c0d0>preceded</span><span style=color:#eceff4>(</span><span>sp</span><span style=color:#eceff4>,</span><span style=color:#88c0d0> char</span><span style=color:#eceff4>('</span><span style=color:#a3be8c>:</span><span style=color:#eceff4>'))),</span></span>
<span class=giallo-l><span>        json_value</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#eceff4>    )(</span><span>i</span><span style=color:#eceff4>)</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>fn</span><span style=color:#88c0d0> hash</span><span style=color:#eceff4>&lt;'</span><span style=color:#8fbcbb>a</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> E</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> ParseError</span><span style=color:#eceff4>&lt;</span><span style=color:#81a1c1>&</span><span style=color:#eceff4>'</span><span style=color:#8fbcbb>a str</span><span style=color:#eceff4>>>(</span><span>i</span><span style=color:#81a1c1>: &</span><span style=color:#eceff4>'</span><span style=color:#8fbcbb>a str</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> IResult</span><span style=color:#eceff4>&lt;</span><span style=color:#81a1c1>&</span><span style=color:#eceff4>'</span><span style=color:#8fbcbb>a str</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> HashMap</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>String</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> JsonValue</span><span style=color:#eceff4>>,</span><span style=color:#8fbcbb> E</span><span style=color:#eceff4>> {</span></span>
<span class=giallo-l><span style=color:#88c0d0>    preceded</span><span style=color:#eceff4>(</span></span>
<span class=giallo-l><span style=color:#88c0d0>        char</span><span style=color:#eceff4>('</span><span style=color:#a3be8c>{</span><span style=color:#eceff4>'),</span></span>
<span class=giallo-l><span style=color:#88c0d0>        cut</span><span style=color:#eceff4>(</span><span style=color:#88c0d0>terminated</span><span style=color:#eceff4>(</span></span>
<span class=giallo-l><span style=color:#88c0d0>            map</span><span style=color:#eceff4>(</span></span>
<span class=giallo-l><span style=color:#88c0d0>                separated_list0</span><span style=color:#eceff4>(</span><span style=color:#88c0d0>preceded</span><span style=color:#eceff4>(</span><span>sp</span><span style=color:#eceff4>,</span><span style=color:#88c0d0> char</span><span style=color:#eceff4>('</span><span style=color:#a3be8c>,</span><span style=color:#eceff4>')),</span><span> key_value</span><span style=color:#eceff4>),</span></span>
<span class=giallo-l><span style=color:#81a1c1>                |</span><span>tuple_vec</span><span style=color:#81a1c1>|</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span>                    tuple_vec</span></span>
<span class=giallo-l><span style=color:#81a1c1>                        .</span><span style=color:#88c0d0>into_iter</span><span style=color:#eceff4>()</span></span>
<span class=giallo-l><span style=color:#81a1c1>                        .</span><span style=color:#88c0d0>map</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>|</span><span style=color:#eceff4>(</span><span>k</span><span style=color:#eceff4>,</span><span> v</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>|</span><span style=color:#eceff4> (</span><span>String</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>from</span><span style=color:#eceff4>(</span><span>k</span><span style=color:#eceff4>),</span><span> v</span><span style=color:#eceff4>))</span></span>
<span class=giallo-l><span style=color:#81a1c1>                        .</span><span style=color:#88c0d0>collect</span><span style=color:#eceff4>()</span></span>
<span class=giallo-l><span style=color:#eceff4>                },</span></span>
<span class=giallo-l><span style=color:#eceff4>            ),</span></span>
<span class=giallo-l><span style=color:#88c0d0>            preceded</span><span style=color:#eceff4>(</span><span>sp</span><span style=color:#eceff4>,</span><span style=color:#88c0d0> char</span><span style=color:#eceff4>('</span><span style=color:#a3be8c>}</span><span style=color:#eceff4>')),</span></span>
<span class=giallo-l><span style=color:#eceff4>        )),</span></span>
<span class=giallo-l><span style=color:#eceff4>    )(</span><span>i</span><span style=color:#eceff4>)</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>fn</span><span style=color:#88c0d0> json_value</span><span style=color:#eceff4>&lt;'</span><span style=color:#8fbcbb>a</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> E</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> ParseError</span><span style=color:#eceff4>&lt;</span><span style=color:#81a1c1>&</span><span style=color:#eceff4>'</span><span style=color:#8fbcbb>a str</span><span style=color:#eceff4>>>(</span><span>i</span><span style=color:#81a1c1>: &</span><span style=color:#eceff4>'</span><span style=color:#8fbcbb>a str</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> IResult</span><span style=color:#eceff4>&lt;</span><span style=color:#81a1c1>&</span><span style=color:#eceff4>'</span><span style=color:#8fbcbb>a str</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> JsonValue</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> E</span><span style=color:#eceff4>> {</span></span>
<span class=giallo-l><span style=color:#88c0d0>    preceded</span><span style=color:#eceff4>(</span></span>
<span class=giallo-l><span>        sp</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#88c0d0>        alt</span><span style=color:#eceff4>((</span></span>
<span class=giallo-l><span style=color:#88c0d0>            map</span><span style=color:#eceff4>(</span><span>hash</span><span style=color:#eceff4>,</span><span> JsonValue</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Object</span><span style=color:#eceff4>),</span></span>
<span class=giallo-l><span style=color:#88c0d0>            map</span><span style=color:#eceff4>(</span><span>array</span><span style=color:#eceff4>,</span><span> JsonValue</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Array</span><span style=color:#eceff4>),</span></span>
<span class=giallo-l><span style=color:#88c0d0>            map</span><span style=color:#eceff4>(</span><span>string</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> |</span><span>s</span><span style=color:#81a1c1>|</span><span> JsonValue</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>Str</span><span style=color:#eceff4>(</span><span>String</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>from</span><span style=color:#eceff4>(</span><span>s</span><span style=color:#eceff4>))),</span></span>
<span class=giallo-l><span style=color:#88c0d0>            map</span><span style=color:#eceff4>(</span><span>double</span><span style=color:#eceff4>,</span><span> JsonValue</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Num</span><span style=color:#eceff4>),</span></span>
<span class=giallo-l><span style=color:#88c0d0>            map</span><span style=color:#eceff4>(</span><span>boolean</span><span style=color:#eceff4>,</span><span> JsonValue</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Boolean</span><span style=color:#eceff4>),</span></span>
<span class=giallo-l><span style=color:#eceff4>        )),</span></span>
<span class=giallo-l><span style=color:#eceff4>    )(</span><span>i</span><span style=color:#eceff4>)</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>fn</span><span style=color:#88c0d0> root</span><span style=color:#eceff4>&lt;'</span><span style=color:#8fbcbb>a</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> E</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> ParseError</span><span style=color:#eceff4>&lt;</span><span style=color:#81a1c1>&</span><span style=color:#eceff4>'</span><span style=color:#8fbcbb>a str</span><span style=color:#eceff4>>>(</span><span>i</span><span style=color:#81a1c1>: &</span><span style=color:#eceff4>'</span><span style=color:#8fbcbb>a str</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> IResult</span><span style=color:#eceff4>&lt;</span><span style=color:#81a1c1>&</span><span style=color:#eceff4>'</span><span style=color:#8fbcbb>a str</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> JsonValue</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> E</span><span style=color:#eceff4>> {</span></span>
<span class=giallo-l><span style=color:#88c0d0>    delimited</span><span style=color:#eceff4>(</span></span>
<span class=giallo-l><span>        sp</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#88c0d0>        alt</span><span style=color:#eceff4>((</span><span style=color:#88c0d0>map</span><span style=color:#eceff4>(</span><span>hash</span><span style=color:#eceff4>,</span><span> JsonValue</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Object</span><span style=color:#eceff4>),</span><span style=color:#88c0d0> map</span><span style=color:#eceff4>(</span><span>array</span><span style=color:#eceff4>,</span><span> JsonValue</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Array</span><span style=color:#eceff4>))),</span></span>
<span class=giallo-l><span style=color:#88c0d0>        opt</span><span style=color:#eceff4>(</span><span>sp</span><span style=color:#eceff4>),</span></span>
<span class=giallo-l><span style=color:#eceff4>    )(</span><span>i</span><span style=color:#eceff4>)</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#5e81ac>#[cfg(test)]</span></span>
<span class=giallo-l><span style=color:#5e81ac>#[macro_use]</span></span>
<span class=giallo-l><span style=color:#81a1c1>mod</span><span> tests</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    use super::*</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#616e88>    // https://stackoverflow.com/questions/27582739/how-do-i-create-a-hashmap-literal</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>    macro_rules! hashmap</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#eceff4>        (</span><span style=color:#81a1c1>$</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>$</span><span>k</span><span style=color:#81a1c1>:</span><span>expr</span><span style=color:#81a1c1> => $</span><span>v</span><span style=color:#81a1c1>:</span><span>expr</span><span style=color:#eceff4>),</span><span style=color:#81a1c1>* $</span><span style=color:#eceff4>(,)</span><span style=color:#81a1c1>?</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> =></span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span>            std</span><span style=color:#81a1c1>::</span><span>iter</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Iterator</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>collect</span><span style=color:#eceff4>(</span><span>std</span><span style=color:#81a1c1>::</span><span>array</span><span style=color:#81a1c1>::</span><span>IntoIter</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>new</span><span style=color:#eceff4>([</span><span style=color:#81a1c1>$</span><span style=color:#eceff4>((</span><span style=color:#81a1c1>$</span><span>k</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> $</span><span>v</span><span style=color:#eceff4>),)</span><span style=color:#81a1c1>*</span><span style=color:#eceff4>]))</span></span>
<span class=giallo-l><span style=color:#eceff4>        };</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#5e81ac>    #[test]</span></span>
<span class=giallo-l><span style=color:#81a1c1>    fn</span><span style=color:#88c0d0> parse_json</span><span style=color:#eceff4>() {</span></span>
<span class=giallo-l><span style=color:#81a1c1>        let</span><span> data</span><span style=color:#81a1c1> =</span><span style=color:#88c0d0;font-weight:700> vec!</span><span style=color:#eceff4>[</span></span>
<span class=giallo-l><span style=color:#eceff4>            (</span></span>
<span class=giallo-l><span style=color:#a3be8c>                r</span><span style=color:#eceff4>#"</span><span style=color:#a3be8c>{"name": "ymgyt"}</span><span style=color:#eceff4>"#,</span></span>
<span class=giallo-l><span style=color:#eceff4>                "",</span></span>
<span class=giallo-l><span style=color:#8fbcbb>                JsonValue</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>Object</span><span style=color:#eceff4>(</span><span style=color:#88c0d0;font-weight:700>hashmap!</span><span style=color:#eceff4>(</span></span>
<span class=giallo-l><span>                    String</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>from</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>name</span><span style=color:#eceff4>")</span><span style=color:#81a1c1> =></span><span> JsonValue</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>Str</span><span style=color:#eceff4>(</span><span>String</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>from</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>ymgyt</span><span style=color:#eceff4>")),</span></span>
<span class=giallo-l><span style=color:#eceff4>                )),</span></span>
<span class=giallo-l><span style=color:#eceff4>            ),</span></span>
<span class=giallo-l><span style=color:#eceff4>            (</span></span>
<span class=giallo-l><span style=color:#a3be8c>                r</span><span style=color:#eceff4>#"</span><span style=color:#a3be8c> {  "name"   : "ymgyt"   }  </span><span style=color:#eceff4>"#,</span></span>
<span class=giallo-l><span style=color:#eceff4>                "",</span></span>
<span class=giallo-l><span style=color:#8fbcbb>                JsonValue</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>Object</span><span style=color:#eceff4>(</span><span style=color:#88c0d0;font-weight:700>hashmap!</span><span style=color:#eceff4>(</span></span>
<span class=giallo-l><span>                    String</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>from</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>name</span><span style=color:#eceff4>")</span><span style=color:#81a1c1> =></span><span> JsonValue</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>Str</span><span style=color:#eceff4>(</span><span>String</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>from</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>ymgyt</span><span style=color:#eceff4>")),</span></span>
<span class=giallo-l><span style=color:#eceff4>                )),</span></span>
<span class=giallo-l><span style=color:#eceff4>            ),</span></span>
<span class=giallo-l><span style=color:#eceff4>            (</span><span style=color:#a3be8c>r</span><span style=color:#eceff4>#"</span><span style=color:#a3be8c>{"package" : {"name": "nom", "features": ["alloc", "std"]}, "release": true, "version": 1.2 }</span><span style=color:#eceff4>"#,</span></span>
<span class=giallo-l><span style=color:#eceff4>             "",</span></span>
<span class=giallo-l><span style=color:#8fbcbb>             JsonValue</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>Object</span><span style=color:#eceff4>(</span><span style=color:#88c0d0;font-weight:700>hashmap!</span><span style=color:#eceff4>(</span></span>
<span class=giallo-l><span>                    String</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>from</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>package</span><span style=color:#eceff4>")</span><span style=color:#81a1c1> =></span><span> JsonValue</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>Object</span><span style=color:#eceff4>(</span><span style=color:#88c0d0;font-weight:700>hashmap!</span><span style=color:#eceff4>(</span></span>
<span class=giallo-l><span>                        String</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>from</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>name</span><span style=color:#eceff4>")</span><span style=color:#81a1c1> =></span><span> JsonValue</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>Str</span><span style=color:#eceff4>(</span><span>String</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>from</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>nom</span><span style=color:#eceff4>")),</span></span>
<span class=giallo-l><span>                        String</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>from</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>features</span><span style=color:#eceff4>")</span><span style=color:#81a1c1> =></span><span> JsonValue</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>Array</span><span style=color:#eceff4>(</span><span style=color:#88c0d0;font-weight:700>vec!</span><span style=color:#eceff4>[</span><span>JsonValue</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>Str</span><span style=color:#eceff4>(</span><span>String</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>from</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>alloc</span><span style=color:#eceff4>")),</span><span> JsonValue</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>Str</span><span style=color:#eceff4>(</span><span>String</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>from</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>std</span><span style=color:#eceff4>"))]),</span></span>
<span class=giallo-l><span style=color:#eceff4>                    )),</span></span>
<span class=giallo-l><span style=color:#8fbcbb>                    String</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>from</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>release</span><span style=color:#eceff4>")</span><span style=color:#81a1c1> =></span><span style=color:#8fbcbb> JsonValue</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>Boolean</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>true</span><span style=color:#eceff4>),</span></span>
<span class=giallo-l><span style=color:#8fbcbb>                    String</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>from</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>version</span><span style=color:#eceff4>")</span><span style=color:#81a1c1> =></span><span style=color:#8fbcbb> JsonValue</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>Num</span><span style=color:#eceff4>(</span><span style=color:#b48ead>1</span><span style=color:#eceff4>.</span><span style=color:#b48ead>2</span><span style=color:#eceff4>),</span></span>
<span class=giallo-l><span style=color:#eceff4>                )),</span></span>
<span class=giallo-l><span style=color:#eceff4>            )</span></span>
<span class=giallo-l><span style=color:#eceff4>        ];</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>        for</span><span> tc</span><span style=color:#81a1c1> in</span><span> data</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>into_iter</span><span style=color:#eceff4>() {</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>            assert_eq!</span><span style=color:#eceff4>(</span><span style=color:#88c0d0>root</span><span style=color:#81a1c1>::</span><span style=color:#eceff4>&lt;()>(</span><span>tc</span><span style=color:#81a1c1>.</span><span style=color:#b48ead>0</span><span style=color:#eceff4>),</span><span style=color:#8fbcbb> Ok</span><span style=color:#eceff4>((</span><span>tc</span><span style=color:#81a1c1>.</span><span style=color:#b48ead>1</span><span style=color:#eceff4>,</span><span> tc</span><span style=color:#81a1c1>.</span><span style=color:#b48ead>2</span><span style=color:#eceff4>)), );</span></span>
<span class=giallo-l><span style=color:#eceff4>        }</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span></code></pre><p>primitiveã®parseå‡¦ç†ã‹ã‚‰æ›¸ã„ã¦ã„ã£ã¦ã€key_value -> json objectã¨ãƒœãƒˆãƒ ã‚¢ãƒƒãƒ—ã§æ›¸ã‹ã‚Œã¦ã„ã¦éå¸¸ã«èª­ã¿ã‚„ã™ã„ã¨æ€ã„ã¾ã—ãŸã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#88c0d0>alt</span><span style=color:#eceff4>((</span></span>
<span class=giallo-l><span style=color:#88c0d0>    map</span><span style=color:#eceff4>(</span><span>hash</span><span style=color:#eceff4>,</span><span> JsonValue</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Object</span><span style=color:#eceff4>),</span></span>
<span class=giallo-l><span style=color:#88c0d0>    map</span><span style=color:#eceff4>(</span><span>array</span><span style=color:#eceff4>,</span><span> JsonValue</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Array</span><span style=color:#eceff4>),</span></span>
<span class=giallo-l><span style=color:#88c0d0>    map</span><span style=color:#eceff4>(</span><span>string</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> |</span><span>s</span><span style=color:#81a1c1>|</span><span> JsonValue</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>Str</span><span style=color:#eceff4>(</span><span>String</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>from</span><span style=color:#eceff4>(</span><span>s</span><span style=color:#eceff4>))),</span></span>
<span class=giallo-l><span style=color:#88c0d0>    map</span><span style=color:#eceff4>(</span><span>double</span><span style=color:#eceff4>,</span><span> JsonValue</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Num</span><span style=color:#eceff4>),</span></span>
<span class=giallo-l><span style=color:#88c0d0>    map</span><span style=color:#eceff4>(</span><span>boolean</span><span style=color:#eceff4>,</span><span> JsonValue</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Boolean</span><span style=color:#eceff4>),</span></span>
<span class=giallo-l><span style=color:#eceff4>)),</span></span></code></pre><p><code>alt</code>ã¯branchã®å„parserãŒåŒã˜å‹ã‚’è¿”ã™ã“ã¨ã‚’è¦æ±‚ã™ã‚‹ã®ã§ã€<code>JsonValue</code>ã®enumã‚’å®šç¾©ã—ã¦ã€mapã™ã‚‹ã‚„ã‚Šæ–¹ã¯éå¸¸ã«å‚è€ƒã«ãªã‚Šã¾ã™ã€‚<h2 id=can-kao-nisaseteitadaitadokiyumento><a aria-label="Anchor link for: can-kao-nisaseteitadaitadokiyumento" class=zola-anchor href=#can-kao-nisaseteitadaitadokiyumento>å‚è€ƒã«ã•ã›ã¦ã„ãŸã ã„ãŸãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ</a></h2><ul><li><a href=https://github.com/benkay86/nom-tutorial rel=external>nom tutorial</a><br> <code>mount</code>ã‚³ãƒãƒ³ãƒ‰ã®å‡ºåŠ›ã‚’parseã™ã‚‹nomã®tutorialã€‚<li><a href=https://blog.logrocket.com/parsing-in-rust-with-nom/ rel=external>Parsing in Rust with nom</a><br> uriã‚’parseã™ã‚‹å‡¦ç†ã‚’å®Ÿè£…ã—ãªãŒã‚‰nomã®è§£èª¬ã‚’ã—ã¦ãã‚Œã¦ã„ã¾ã™ã€‚contextã®ä½¿ã„æ–¹ã‚‚å‚è€ƒã«ãªã‚Šã¾ã—ãŸã€‚<li><a href=https://bodil.lol/parser-combinators/ rel=external>Learning Parser Combinators With Rust</a><br> ã“ã¡ã‚‰ã¯nomã«ã¤ã„ã¦ã§ã¯ãªããã‚‚ãã‚‚parser combinatorã¨ã¯ãªã«ã‹ã«ã¤ã„ã¦è§£èª¬ã—ã¦ãã‚Œã¦ã„ã¾ã™ã€‚ç°¡æ˜“çš„ãªxml parserã‚’ä½œã‚Šã¾ã™ã€‚<li><a href=https://github.com/Geal/nom/tree/master/doc rel=external>å…¬å¼</a> <ul><li><a href=https://github.com/Geal/nom/blob/master/doc/choosing_a_combinator.md rel=external>parserä¸€è¦§</a><br> parserä¸€è¦§ãŒmoduleã”ã¨ã«æ•´ç†ã•ã‚Œã¦ã„ã‚‹ã®ã§ã»ã—ã„ã‚‚ã®ãŒã‚ã‚‹ã‹ã‚’æ¢ã™ã®ã«ä¾¿åˆ©ã§ã™ã€‚<li><a href=https://github.com/Geal/nom/blob/master/doc/error_management.md rel=external>error management</a><br> nomã®Errorã«ã¤ã„ã¦ã€‚userå®šç¾©å‹ã®Errorã®ä½¿ã„æ–¹ã«ã¤ã„ã¦ã‚‚ã€‚<li><a href=https://github.com/Geal/nom/blob/master/doc/nom_recipes.md rel=external>recipe</a> nomã®recipeã€‚docã®exampleã‚ˆã‚Šè¤‡é›‘ãªã®ã§å‚è€ƒã«ãªã‚Šã¾ã—ãŸã€‚<li><a href=https://github.com/Geal/nom/tree/master/examples rel=external>examples</a><br> json, S expression, escaped stringsç­‰ã®exampleãŒã‚³ãƒ¡ãƒ³ãƒˆã¤ãã§ã®ã£ã¦ã„ã¾ã™ã€‚</ul><li><a href=https://hazm.at/mox/lang/rust/nom/index.html rel=external>Rust: nom ã«ã‚ˆã‚‹ãƒ‘ãƒ¼ã‚µãƒ¼å®Ÿè£…</a><br> <code>v5</code>ã«ã¤ã„ã¦ã®è§£èª¬ã€‚<code>v6</code>ã«ãªã£ã¦ã€è¨€åŠã•ã‚Œã¦ã„ã‚‹ã‚¨ãƒ©ãƒ¼ã®å ±å‘Šæ‰‹æ®µãŒæ”¹å–„ã•ã‚ŒãŸã‚“ã ãªã¨æ€ã„ã¾ã—ãŸã€‚</ul><h2 id=matome><a aria-label="Anchor link for: matome" class=zola-anchor href=#matome>ã¾ã¨ã‚</a></h2><ul><li>nomã‚’åˆ©ç”¨ã™ã‚‹ã¨ãƒœãƒˆãƒ ã‚¢ãƒƒãƒ—ã§parseå‡¦ç†ãŒã‹ã‘ã‚‹ã€‚<li>parseæ™‚ã«ã©ã“ã¾ã§ã‚¨ãƒ©ãƒ¼ã®è©³ç´°ãŒæ¬²ã—ã„ã‹ã¯genericsã§ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã§ãã‚‹ã€‚<li>allocationã‚‚featureã§åˆ¶å¾¡ã§ãã‚‹ã®ã§ã€<code>no_std</code>ç’°å¢ƒã§ã‚‚ã¤ã‹ãˆãã†ã€‚<li><code>complete</code>ã¨<code>streming</code>ãŒç”¨æ„ã•ã‚Œã¦ã„ã‚‹ã®ã§ã€networkã‹ã‚‰ã®ãƒ‡ãƒ¼ã‚¿ã®parseã«ã‚‚åˆ©ç”¨ã§ãã‚‹ã€‚</ul><div class=footnote-definition id=nom><sup class=footnote-definition-label>1</sup><p>https://github.com/Geal/nom</div><div class=footnote-definition id=IResult><sup class=footnote-definition-label>2</sup><p>https://docs.rs/nom/6.1.2/nom/type.IResult.html</div><div class=footnote-definition id=Err><sup class=footnote-definition-label>3</sup><p>https://docs.rs/nom/6.1.2/nom/enum.Err.html</div><div class=footnote-definition id=Error><sup class=footnote-definition-label>4</sup><p>https://docs.rs/nom/6.1.2/nom/error/struct.Error.html</div><div class=footnote-definition id=ErrorKind><sup class=footnote-definition-label>5</sup><p>https://docs.rs/nom/6.1.2/nom/error/enum.ErrorKind.html</div><div class=footnote-definition id=verify><sup class=footnote-definition-label>6</sup><p>https://docs.rs/nom/6.1.2/nom/combinator/fn.verify.html</div></div></article></main><footer class=blog-footer><p>Â© 2026 <a href=https://blog.ymgyt.io> ymgyt </a> | Made with <a href=https://www.getzola.org rel=noopener target=_blank>Zola</a> | <a href=https://github.com/ymgyt/blog>Repository</a> | <a href=https://blog.ymgyt.io/atom.xml target=_blank title=rss> <svg viewbox="0 0 24 24" class=icon fill=none height=24 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx=5 cy=19 r=1></circle></svg> </a></footer></div></div>