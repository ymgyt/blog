<!doctype html><html lang=ja><head><meta charset=UTF-8><meta content="width=device-width,initial-scale=1" name=viewport><link href=https://blog.ymgyt.io/favicon.ico rel=icon sizes=any><link href=https://blog.ymgyt.io/icon.svg rel=icon type=image/svg+xml><link href=https://blog.ymgyt.io/apple-touch-icon.png rel=apple-touch-icon><link href=https://blog.ymgyt.io/manifest.webmanifest rel=manifest><link href=https://blog.ymgyt.io/style.css rel=stylesheet><link href=https://blog.ymgyt.io/atom.xml rel=alternate title=Atom type=application/atom+xml><script src="https://www.googletagmanager.com/gtag/js?id=G-GTB0KMLN90" async></script><script>window.dataLayer = window.dataLayer || [];
	function gtag() {dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-GTB0KMLN90');</script><title>ğŸ”– Rustã§gitã®tagã‚’bumpã™ã‚‹ | Happy developing</title><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><body><div class=world><div class=content-container><header class=blog-header-container><div class=blog-logo><a href=https://blog.ymgyt.io>Happy developing</a></div><div class=blog-nav><nav><ul><li><a href=https://blog.ymgyt.io/entry/>Entries</a><li><a href=https://blog.ymgyt.io/tags/>Tags</a><li><a href=https://blog.ymgyt.io/about/>About</a><li><a href=https://github.com/ymgyt> <img alt=Github class=icon src=https://blog.ymgyt.io/images/icon/github.svg> </a><li><a href="https://twitter.com/YAmaguchixt "> <img alt=Twitter class=icon src=https://blog.ymgyt.io/images/icon/twitter.svg> </a></ul></nav></div></header><main class=blog-main><article><header class=entry-header><h1 class=entry-title>ğŸ”– Rustã§gitã®tagã‚’bumpã™ã‚‹</h1><div class=entry-meta><p class=entry-meta-item>ğŸ—“ 2020-04-05<p class=entry-meta-item>ğŸ· <span class=tag><a href=https://blog.ymgyt.io/tags/rust/>rust</a></span></div></header><aside class=entry-toc><nav><ul class=entry-toc-toplevel-list><li><a href=https://blog.ymgyt.io/entry/bump-git-tags-with-rust/#zuo-tutacli>ä½œã£ãŸcli</a><li><a href=https://blog.ymgyt.io/entry/bump-git-tags-with-rust/#bumpchu-li>Bumpå‡¦ç†</a> <ul><li><a href=https://blog.ymgyt.io/entry/bump-git-tags-with-rust/#ren-zheng-gayatukai>èªè¨¼ãŒã‚„ã£ã‹ã„</a></ul><li><a href=https://blog.ymgyt.io/entry/bump-git-tags-with-rust/#matome>ã¾ã¨ã‚</a></ul></nav></aside><div class=entry-content><p>åŒã˜ãƒãƒ¼ãƒ ã®ãƒ¡ãƒ³ãƒãƒ¼ãŒ<a href=https://github.com/nodegit/nodegit rel=external>nodegit</a>ã¨ã„ã†nodeã®<a href=https://libgit2.org/ rel=external>libgit2</a>ã®bindingã‚’åˆ©ç”¨ã—ã¦ã€ä¾¿åˆ©ãªãƒ„ãƒ¼ãƒ«ã‚’ä½œã£ã¦ã„ã‚‹ã®ã‚’ã¿ã¦å„è¨€èªã«gitã‚’æ“ä½œã™ã‚‹ãŸã‚ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ¼ã¸ã®bindingãŒã‚ã‚‹ã“ã¨ã‚’çŸ¥ã‚Šã¾ã—ãŸã€‚ ãã“ã§ã€ä»Šå›ã¯Rustã®libgit2 bindingã§ã‚ã‚‹<a href=https://github.com/rust-lang/git2-rs rel=external>git2-rs</a>ã‚’åˆ©ç”¨ã—ã¦ã€gitã®tagã‚’bumpã—ã¦ã€remoteã«pushã™ã‚‹cliã‚’ä½œã£ã¦ã¿ã‚ˆã†ã¨æ€ã„ã¾ã™ã€‚ <a href=https://github.com/ymgyt/git-bump rel=external>sourceã¯ã“ã¡ã‚‰</a><h2 id=zuo-tutacli><a aria-label="Anchor link for: zuo-tutacli" class=zola-anchor href=#zuo-tutacli>ä½œã£ãŸcli</a></h2><figure><div class=fig-images-row><img , alt src=images/git_bump.gif></div><figcaption>git-bump</figcaption></figure><p>å®Ÿè¡Œã™ã‚‹ã¨localã®tagä¸€è¦§ã‚’å–å¾—ã—ã¦ã€semantic versionã§sortã—ã€bumpã™ã‚‹versionã‚’é¸æŠã—ã¾ã™ã€‚ versionã‚’é¸æŠã—ã¦ã‚‚ã‚‰ã£ãŸã‚‰ã€ç¾åœ¨ã®HEADã‚’å¯¾è±¡ã«tagã‚’ä½œæˆã—ã€remoteã«pushã—ã¾ã™ã€‚<h2 id=bumpchu-li><a aria-label="Anchor link for: bumpchu-li" class=zola-anchor href=#bumpchu-li>Bumpå‡¦ç†</a></h2><pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=toml><span class=giallo-l><span style=color:#eceff4>[</span><span>dependencies</span><span style=color:#eceff4>]</span></span>
<span class=giallo-l><span>clap</span><span style=color:#eceff4> = "</span><span style=color:#a3be8c>2.33.0</span><span style=color:#eceff4>"</span></span>
<span class=giallo-l><span>git2</span><span style=color:#eceff4> = "</span><span style=color:#a3be8c>0.13.0</span><span style=color:#eceff4>"</span></span>
<span class=giallo-l><span>tracing</span><span style=color:#eceff4> = "</span><span style=color:#a3be8c>0.1.13</span><span style=color:#eceff4>"</span></span>
<span class=giallo-l><span>tracing-subscriber</span><span style=color:#eceff4> = "</span><span style=color:#a3be8c>0.2.3</span><span style=color:#eceff4>"</span></span>
<span class=giallo-l><span>log</span><span style=color:#eceff4> = "</span><span style=color:#a3be8c>0.4.8</span><span style=color:#eceff4>"</span></span>
<span class=giallo-l><span>semver</span><span style=color:#eceff4> = "</span><span style=color:#a3be8c>0.9.0</span><span style=color:#eceff4>"</span></span>
<span class=giallo-l><span>anyhow</span><span style=color:#eceff4> = "</span><span style=color:#a3be8c>1.0.27</span><span style=color:#eceff4>"</span></span>
<span class=giallo-l><span>colored</span><span style=color:#eceff4> = "</span><span style=color:#a3be8c>1.9.3</span><span style=color:#eceff4>"</span></span>
<span class=giallo-l><span>dialoguer</span><span style=color:#eceff4> = "</span><span style=color:#a3be8c>0.5.0</span><span style=color:#eceff4>"</span></span></code></pre><pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>pub mod</span><span> cli</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>use</span><span> anyhow</span><span style=color:#81a1c1>::</span><span>anyhow</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>use</span><span> colored</span><span style=color:#81a1c1>::*</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>use</span><span> dialoguer</span><span style=color:#81a1c1>::</span><span>theme</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>ColorfulTheme</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>use</span><span> semver</span><span style=color:#81a1c1>::</span><span style=color:#eceff4>{</span><span style=color:#8fbcbb>SemVerError</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> Version</span><span style=color:#eceff4>};</span></span>
<span class=giallo-l><span style=color:#81a1c1>use</span><span> std</span><span style=color:#81a1c1>::</span><span>io</span><span style=color:#81a1c1>::</span><span style=color:#eceff4>{</span><span style=color:#81a1c1>self</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> Write</span><span style=color:#eceff4>};</span></span>
<span class=giallo-l><span style=color:#81a1c1>use</span><span> std</span><span style=color:#81a1c1>::</span><span>result</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Result</span><span style=color:#81a1c1> as</span><span style=color:#8fbcbb> StdResult</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>use</span><span> std</span><span style=color:#81a1c1>::</span><span>borrow</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Cow</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>use</span><span> tracing</span><span style=color:#81a1c1>::</span><span style=color:#eceff4>{</span><span>debug</span><span style=color:#eceff4>,</span><span> warn</span><span style=color:#eceff4>};</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#5e81ac>#[derive(</span><span style=color:#8fbcbb>Debug</span><span style=color:#5e81ac>,</span><span style=color:#8fbcbb> PartialEq</span><span style=color:#5e81ac>,</span><span style=color:#8fbcbb> Eq</span><span style=color:#5e81ac>)]</span></span>
<span class=giallo-l><span style=color:#81a1c1>pub enum</span><span style=color:#8fbcbb> Bump</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#8fbcbb>    Major</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#8fbcbb>    Minor</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#8fbcbb>    Patch</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>type</span><span style=color:#8fbcbb> Result</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>T</span><span style=color:#eceff4>></span><span style=color:#81a1c1> =</span><span> std</span><span style=color:#81a1c1>::</span><span>result</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Result</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>T</span><span style=color:#eceff4>,</span><span> anyhow</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Error</span><span style=color:#eceff4>>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>pub struct</span><span style=color:#8fbcbb> Config</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    pub</span><span> prefix</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Option</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>String</span><span style=color:#eceff4>>,</span></span>
<span class=giallo-l><span style=color:#81a1c1>    pub</span><span> repository_path</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Option</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>String</span><span style=color:#eceff4>>,</span></span>
<span class=giallo-l><span style=color:#5e81ac>    #[doc(hidden)]</span></span>
<span class=giallo-l><span style=color:#81a1c1>    pub</span><span> __non_exhaustive</span><span style=color:#81a1c1>:</span><span style=color:#eceff4> (),</span><span style=color:#616e88> // https://xaeroxe.github.io/init-struct-pattern/</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>impl</span><span style=color:#8fbcbb> Default</span><span style=color:#81a1c1> for</span><span style=color:#8fbcbb> Config</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    fn</span><span style=color:#88c0d0> default</span><span style=color:#eceff4>()</span><span style=color:#81a1c1> -> Self</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>        Self</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span>            prefix</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Some</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>v</span><span style=color:#eceff4>"</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>to_owned</span><span style=color:#eceff4>()),</span></span>
<span class=giallo-l><span>            repository_path</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> None</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>            __non_exhaustive</span><span style=color:#81a1c1>:</span><span style=color:#eceff4> (),</span></span>
<span class=giallo-l><span style=color:#eceff4>        }</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>impl</span><span style=color:#8fbcbb> Config</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    pub fn</span><span style=color:#88c0d0> bump</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>self</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> Result</span><span style=color:#eceff4>&lt;()> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>        self.</span><span style=color:#88c0d0>build</span><span style=color:#eceff4>()</span><span style=color:#81a1c1>?.</span><span style=color:#88c0d0>bump</span><span style=color:#eceff4>()</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>    fn</span><span style=color:#88c0d0> build</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>self</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> Result</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Bumper</span><span style=color:#eceff4>> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>        let</span><span> repo</span><span style=color:#81a1c1> = match self.</span><span>repository_path </span><span style=color:#eceff4>{</span></span>
<span class=giallo-l><span style=color:#8fbcbb>            Some</span><span style=color:#eceff4>(</span><span>path</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> =></span><span> git2</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Repository</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>open</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&</span><span>path</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>?</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#8fbcbb>            None</span><span style=color:#81a1c1> =></span><span> git2</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Repository</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>open_from_env</span><span style=color:#eceff4>()</span><span style=color:#81a1c1>?</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#eceff4>        };</span></span>
<span class=giallo-l><span style=color:#8fbcbb>        Ok</span><span style=color:#eceff4>(</span><span style=color:#8fbcbb>Bumper</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span>            prefix</span><span style=color:#81a1c1>: self.</span><span>prefix</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>            repo</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>            cfg</span><span style=color:#81a1c1>:</span><span> git2</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Config</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>open_default</span><span style=color:#eceff4>()</span><span style=color:#81a1c1>?</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>            w</span><span style=color:#81a1c1>:</span><span> io</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>stdout</span><span style=color:#eceff4>(),</span></span>
<span class=giallo-l><span style=color:#eceff4>        })</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>struct</span><span style=color:#8fbcbb> Bumper</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span>    prefix</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Option</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>String</span><span style=color:#eceff4>>,</span></span>
<span class=giallo-l><span>    repo</span><span style=color:#81a1c1>:</span><span> git2</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Repository</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>    cfg</span><span style=color:#81a1c1>:</span><span> git2</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Config</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>    w</span><span style=color:#81a1c1>:</span><span> io</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Stdout</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>impl</span><span style=color:#8fbcbb> Bumper</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    fn</span><span style=color:#88c0d0> bump</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>mut self</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> Result</span><span style=color:#eceff4>&lt;()> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>        let</span><span> pattern</span><span style=color:#81a1c1> = self.</span><span>prefix</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>as_deref</span><span style=color:#eceff4>()</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>map</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>|</span><span>p</span><span style=color:#81a1c1>|</span><span style=color:#88c0d0;font-weight:700> format!</span><span style=color:#eceff4>("</span><span style=color:#ebcb8b>{}</span><span style=color:#a3be8c>*</span><span style=color:#eceff4>",</span><span> p</span><span style=color:#eceff4>));</span></span>
<span class=giallo-l><span style=color:#81a1c1>        let</span><span> tags</span><span style=color:#81a1c1> = self.</span><span>repo</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>tag_names</span><span style=color:#eceff4>(</span><span>pattern</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>as_deref</span><span style=color:#eceff4>())</span><span style=color:#81a1c1>?</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>        debug!</span><span style=color:#eceff4>(</span></span>
<span class=giallo-l><span style=color:#eceff4>            "</span><span style=color:#a3be8c>found </span><span style=color:#ebcb8b>{}</span><span style=color:#a3be8c> tags (pattern: </span><span style=color:#ebcb8b>{}</span><span style=color:#a3be8c>)</span><span style=color:#eceff4>",</span></span>
<span class=giallo-l><span>            tags</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>len</span><span style=color:#eceff4>(),</span></span>
<span class=giallo-l><span>            pattern</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>unwrap_or</span><span style=color:#eceff4>(""</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>to_owned</span><span style=color:#eceff4>())</span></span>
<span class=giallo-l><span style=color:#eceff4>        );</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>        let</span><span style=color:#eceff4> (</span><span style=color:#81a1c1>mut</span><span> versions</span><span style=color:#eceff4>,</span><span> errs</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> = self.</span><span style=color:#88c0d0>parse_tags</span><span style=color:#eceff4>(</span><span>tags</span><span style=color:#eceff4>);</span></span>
<span class=giallo-l><span>        errs</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>into_iter</span><span style=color:#eceff4>()</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>for_each</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>|</span><span>e</span><span style=color:#81a1c1>| match</span><span> e</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#eceff4>            (</span><span>tag</span><span style=color:#eceff4>,</span><span> semver</span><span style=color:#81a1c1>::</span><span>SemVerError</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>ParseError</span><span style=color:#eceff4>(</span><span>e</span><span style=color:#eceff4>))</span><span style=color:#81a1c1> =></span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>                warn!</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>malformed semantic version: </span><span style=color:#ebcb8b>{} {}</span><span style=color:#eceff4>",</span><span> tag</span><span style=color:#eceff4>,</span><span> e</span><span style=color:#eceff4>)</span></span>
<span class=giallo-l><span style=color:#eceff4>            }</span></span>
<span class=giallo-l><span style=color:#eceff4>        });</span></span>
<span class=giallo-l><span>        versions</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>sort</span><span style=color:#eceff4>();</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>        let</span><span> current</span><span style=color:#81a1c1> = match</span><span> versions</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>last</span><span style=color:#eceff4>() {</span></span>
<span class=giallo-l><span style=color:#8fbcbb>            None</span><span style=color:#81a1c1> =></span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>                writeln!</span><span style=color:#eceff4>(</span></span>
<span class=giallo-l><span style=color:#81a1c1>                    self.</span><span>w</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>by_ref</span><span style=color:#eceff4>(),</span></span>
<span class=giallo-l><span style=color:#eceff4>                    "</span><span style=color:#ebcb8b>{}</span><span style=color:#a3be8c> (pattern: </span><span style=color:#ebcb8b>{}</span><span style=color:#a3be8c>)</span><span style=color:#eceff4>",</span></span>
<span class=giallo-l><span style=color:#eceff4>                    "</span><span style=color:#a3be8c>version tag not found</span><span style=color:#eceff4>"</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>red</span><span style=color:#eceff4>(),</span></span>
<span class=giallo-l><span style=color:#81a1c1>                    self.</span><span>prefix</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>as_deref</span><span style=color:#eceff4>()</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>unwrap_or</span><span style=color:#eceff4>("")</span></span>
<span class=giallo-l><span style=color:#eceff4>                )</span><span style=color:#81a1c1>?</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>                return</span><span style=color:#8fbcbb> Ok</span><span style=color:#eceff4>(());</span></span>
<span class=giallo-l><span style=color:#eceff4>            }</span></span>
<span class=giallo-l><span style=color:#8fbcbb>            Some</span><span style=color:#eceff4>(</span><span>v</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> =></span><span> v</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#eceff4>        };</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>        let mut</span><span> bumped</span><span style=color:#81a1c1> =</span><span> current</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>clone</span><span style=color:#eceff4>();</span></span>
<span class=giallo-l><span style=color:#81a1c1>        match self.</span><span style=color:#88c0d0>prompt_bump</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&</span><span>current</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>?</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#8fbcbb>            Bump</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Major</span><span style=color:#81a1c1> =></span><span> bumped</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>increment_major</span><span style=color:#eceff4>(),</span></span>
<span class=giallo-l><span style=color:#8fbcbb>            Bump</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Minor</span><span style=color:#81a1c1> =></span><span> bumped</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>increment_minor</span><span style=color:#eceff4>(),</span></span>
<span class=giallo-l><span style=color:#8fbcbb>            Bump</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Patch</span><span style=color:#81a1c1> =></span><span> bumped</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>increment_patch</span><span style=color:#eceff4>(),</span></span>
<span class=giallo-l><span style=color:#eceff4>        }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>        if !self.</span><span style=color:#88c0d0>confirm_bump</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&</span><span>current</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> &</span><span>bumped</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>?</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>            writeln!</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>self.</span><span>w</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>by_ref</span><span style=color:#eceff4>(), "</span><span style=color:#a3be8c>canceled</span><span style=color:#eceff4>")</span><span style=color:#81a1c1>?</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>            return</span><span style=color:#8fbcbb> Ok</span><span style=color:#eceff4>(());</span></span>
<span class=giallo-l><span style=color:#eceff4>        }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>        let</span><span> tag_oid</span><span style=color:#81a1c1> = self.</span><span style=color:#88c0d0>create_tag</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&</span><span>bumped</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>?</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>        debug!</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>create tag(object_id: </span><span style=color:#ebcb8b>{}</span><span style=color:#a3be8c>)</span><span style=color:#eceff4>",</span><span> tag_oid</span><span style=color:#eceff4>);</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>        self.</span><span style=color:#88c0d0>push_tag</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&</span><span>bumped</span><span style=color:#eceff4>)</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>    fn</span><span style=color:#88c0d0> parse_tags</span><span style=color:#eceff4>(</span></span>
<span class=giallo-l><span style=color:#81a1c1>        &mut self</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>        tags</span><span style=color:#81a1c1>:</span><span> git2</span><span style=color:#81a1c1>::</span><span>string_array</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>StringArray</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#eceff4>    )</span><span style=color:#81a1c1> -></span><span style=color:#eceff4> (</span><span style=color:#8fbcbb>Vec</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Version</span><span style=color:#eceff4>>,</span><span style=color:#8fbcbb> Vec</span><span style=color:#eceff4>&lt;(</span><span style=color:#8fbcbb>String</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> SemVerError</span><span style=color:#eceff4>)>) {</span></span>
<span class=giallo-l><span style=color:#81a1c1>        let</span><span style=color:#eceff4> (</span><span>versions</span><span style=color:#eceff4>,</span><span> errs</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>:</span><span style=color:#eceff4> (</span><span style=color:#8fbcbb>Vec</span><span style=color:#eceff4>&lt;</span><span>_</span><span style=color:#eceff4>>,</span><span style=color:#8fbcbb> Vec</span><span style=color:#eceff4>&lt;</span><span>_</span><span style=color:#eceff4>>)</span><span style=color:#81a1c1> =</span><span> tags</span></span>
<span class=giallo-l><span style=color:#81a1c1>            .</span><span style=color:#88c0d0>iter</span><span style=color:#eceff4>()</span></span>
<span class=giallo-l><span style=color:#81a1c1>            .</span><span style=color:#88c0d0>flatten</span><span style=color:#eceff4>()</span></span>
<span class=giallo-l><span style=color:#81a1c1>            .</span><span style=color:#88c0d0>map</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>|</span><span>tag</span><span style=color:#81a1c1>|</span><span> tag</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>trim_start_matches</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>self.</span><span>prefix</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>as_deref</span><span style=color:#eceff4>()</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>unwrap_or</span><span style=color:#eceff4>("")))</span></span>
<span class=giallo-l><span style=color:#81a1c1>            .</span><span style=color:#88c0d0>map</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>|</span><span>tag</span><span style=color:#81a1c1>|</span><span> Version</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>parse</span><span style=color:#eceff4>(</span><span>tag</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>map_err</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>|</span><span>err</span><span style=color:#81a1c1>|</span><span style=color:#eceff4> (</span><span>tag</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>to_owned</span><span style=color:#eceff4>(),</span><span> err</span><span style=color:#eceff4>)))</span></span>
<span class=giallo-l><span style=color:#81a1c1>            .</span><span style=color:#88c0d0>partition</span><span style=color:#eceff4>(</span><span>StdResult</span><span style=color:#81a1c1>::</span><span>is_ok</span><span style=color:#eceff4>);</span></span>
<span class=giallo-l><span style=color:#eceff4>        (</span></span>
<span class=giallo-l><span>            versions</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>into_iter</span><span style=color:#eceff4>()</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>map</span><span style=color:#eceff4>(</span><span>StdResult</span><span style=color:#81a1c1>::</span><span>unwrap</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>collect</span><span style=color:#eceff4>(),</span></span>
<span class=giallo-l><span>            errs</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>into_iter</span><span style=color:#eceff4>()</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>map</span><span style=color:#eceff4>(</span><span>StdResult</span><span style=color:#81a1c1>::</span><span>unwrap_err</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>collect</span><span style=color:#eceff4>(),</span></span>
<span class=giallo-l><span style=color:#eceff4>        )</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>    fn</span><span style=color:#88c0d0> prompt_bump</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&mut self</span><span style=color:#eceff4>,</span><span> current</span><span style=color:#81a1c1>: &</span><span style=color:#8fbcbb>Version</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> Result</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Bump</span><span style=color:#eceff4>> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>        let</span><span> selections</span><span style=color:#81a1c1> = &</span><span style=color:#eceff4>["</span><span style=color:#a3be8c>major</span><span style=color:#eceff4>", "</span><span style=color:#a3be8c>minor</span><span style=color:#eceff4>", "</span><span style=color:#a3be8c>patch</span><span style=color:#eceff4>"];</span></span>
<span class=giallo-l><span style=color:#81a1c1>        let</span><span> select</span><span style=color:#81a1c1> =</span><span> dialoguer</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Select</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>with_theme</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&</span><span>ColorfulTheme</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>default</span><span style=color:#eceff4>())</span></span>
<span class=giallo-l><span style=color:#81a1c1>            .</span><span style=color:#88c0d0>with_prompt</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&</span><span style=color:#88c0d0;font-weight:700>format!</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>select bump version (current: </span><span style=color:#ebcb8b>{}</span><span style=color:#a3be8c>)</span><span style=color:#eceff4>",</span><span> current</span><span style=color:#eceff4>))</span></span>
<span class=giallo-l><span style=color:#81a1c1>            .</span><span style=color:#88c0d0>default</span><span style=color:#eceff4>(</span><span style=color:#b48ead>0</span><span style=color:#eceff4>)</span></span>
<span class=giallo-l><span style=color:#81a1c1>            .</span><span style=color:#88c0d0>items</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&</span><span>selections</span><span style=color:#eceff4>[</span><span style=color:#81a1c1>..</span><span style=color:#eceff4>])</span></span>
<span class=giallo-l><span style=color:#81a1c1>            .</span><span style=color:#88c0d0>interact</span><span style=color:#eceff4>()</span></span>
<span class=giallo-l><span style=color:#81a1c1>            .</span><span style=color:#88c0d0>unwrap</span><span style=color:#eceff4>();</span></span>
<span class=giallo-l><span style=color:#81a1c1>        let</span><span> bump</span><span style=color:#81a1c1> = match</span><span> select</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#b48ead>            0</span><span style=color:#81a1c1> =></span><span style=color:#8fbcbb> Bump</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Major</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#b48ead>            1</span><span style=color:#81a1c1> =></span><span style=color:#8fbcbb> Bump</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Minor</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#b48ead>            2</span><span style=color:#81a1c1> =></span><span style=color:#8fbcbb> Bump</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Patch</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>            _</span><span style=color:#81a1c1> =></span><span style=color:#88c0d0;font-weight:700> unreachable!</span><span style=color:#eceff4>(),</span></span>
<span class=giallo-l><span style=color:#eceff4>        };</span></span>
<span class=giallo-l><span style=color:#8fbcbb>        Ok</span><span style=color:#eceff4>(</span><span>bump</span><span style=color:#eceff4>)</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>    fn</span><span style=color:#88c0d0> confirm_bump</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&mut self</span><span style=color:#eceff4>,</span><span> current</span><span style=color:#81a1c1>: &</span><span style=color:#8fbcbb>Version</span><span style=color:#eceff4>,</span><span> bumped</span><span style=color:#81a1c1>: &</span><span style=color:#8fbcbb>Version</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> Result</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>bool</span><span style=color:#eceff4>> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>        let</span><span> branch_name</span><span style=color:#81a1c1> =</span><span> git2</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Branch</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>wrap</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>self.</span><span>repo</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>head</span><span style=color:#eceff4>()</span><span style=color:#81a1c1>?</span><span style=color:#eceff4>)</span></span>
<span class=giallo-l><span style=color:#81a1c1>            .</span><span style=color:#88c0d0>name</span><span style=color:#eceff4>()</span><span style=color:#81a1c1>?</span></span>
<span class=giallo-l><span style=color:#81a1c1>            .</span><span style=color:#88c0d0>unwrap_or</span><span style=color:#eceff4>("")</span></span>
<span class=giallo-l><span style=color:#81a1c1>            .</span><span style=color:#88c0d0>to_owned</span><span style=color:#eceff4>();</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>        let</span><span> head</span><span style=color:#81a1c1> = self.</span><span>repo</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>head</span><span style=color:#eceff4>()</span><span style=color:#81a1c1>?.</span><span style=color:#88c0d0>peel_to_commit</span><span style=color:#eceff4>()</span><span style=color:#81a1c1>?</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>        let</span><span> w</span><span style=color:#81a1c1> = self.</span><span>w</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>by_ref</span><span style=color:#eceff4>();</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>        writeln!</span><span style=color:#eceff4>(</span><span>w</span><span style=color:#eceff4>, "</span><span style=color:#a3be8c>current HEAD</span><span style=color:#eceff4>")</span><span style=color:#81a1c1>?</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>        writeln!</span><span style=color:#eceff4>(</span><span>w</span><span style=color:#eceff4>, "</span><span style=color:#a3be8c>  branch : </span><span style=color:#ebcb8b>{}</span><span style=color:#eceff4>",</span><span> branch_name</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>?</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>        writeln!</span><span style=color:#eceff4>(</span><span>w</span><span style=color:#eceff4>, "</span><span style=color:#a3be8c>  id     : </span><span style=color:#ebcb8b>{}</span><span style=color:#eceff4>",</span><span> head</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>id</span><span style=color:#eceff4>())</span><span style=color:#81a1c1>?</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>        writeln!</span><span style=color:#eceff4>(</span><span>w</span><span style=color:#eceff4>, "</span><span style=color:#a3be8c>  summary: </span><span style=color:#ebcb8b>{}</span><span style=color:#eceff4>",</span><span> head</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>summary</span><span style=color:#eceff4>()</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>unwrap_or</span><span style=color:#eceff4>(""))</span><span style=color:#81a1c1>?</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>        writeln!</span><span style=color:#eceff4>(</span><span>w</span><span style=color:#eceff4>, "")</span><span style=color:#81a1c1>?</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span>        dialoguer</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Confirmation</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>new</span><span style=color:#eceff4>()</span></span>
<span class=giallo-l><span style=color:#81a1c1>            .</span><span style=color:#88c0d0>with_text</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&</span><span style=color:#88c0d0;font-weight:700>format!</span><span style=color:#eceff4>(</span></span>
<span class=giallo-l><span style=color:#eceff4>                "</span><span style=color:#a3be8c>bump version </span><span style=color:#ebcb8b>{</span><span style=color:#a3be8c>prefix</span><span style=color:#ebcb8b>}{</span><span style=color:#a3be8c>current</span><span style=color:#ebcb8b>}</span><span style=color:#a3be8c> -> </span><span style=color:#ebcb8b>{</span><span style=color:#a3be8c>prefix</span><span style=color:#ebcb8b>}{</span><span style=color:#a3be8c>bumped</span><span style=color:#ebcb8b>}</span><span style=color:#eceff4>",</span></span>
<span class=giallo-l><span>                prefix</span><span style=color:#81a1c1> =</span><span style=color:#88c0d0;font-weight:700> format!</span><span style=color:#eceff4>("</span><span style=color:#ebcb8b>{}</span><span style=color:#eceff4>",</span><span style=color:#81a1c1> self.</span><span>prefix</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>as_deref</span><span style=color:#eceff4>()</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>unwrap_or</span><span style=color:#eceff4>(""))</span></span>
<span class=giallo-l><span style=color:#81a1c1>                    .</span><span style=color:#88c0d0>red</span><span style=color:#eceff4>()</span></span>
<span class=giallo-l><span style=color:#81a1c1>                    .</span><span style=color:#88c0d0>bold</span><span style=color:#eceff4>(),</span></span>
<span class=giallo-l><span>                current</span><span style=color:#81a1c1> =</span><span style=color:#88c0d0;font-weight:700> format!</span><span style=color:#eceff4>("</span><span style=color:#ebcb8b>{}</span><span style=color:#eceff4>",</span><span> current</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>red</span><span style=color:#eceff4>()</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>bold</span><span style=color:#eceff4>(),</span></span>
<span class=giallo-l><span>                bumped</span><span style=color:#81a1c1> =</span><span style=color:#88c0d0;font-weight:700> format!</span><span style=color:#eceff4>("</span><span style=color:#ebcb8b>{}</span><span style=color:#eceff4>",</span><span> bumped</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>red</span><span style=color:#eceff4>()</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>bold</span><span style=color:#eceff4>(),</span></span>
<span class=giallo-l><span style=color:#eceff4>            ))</span></span>
<span class=giallo-l><span style=color:#81a1c1>            .</span><span style=color:#88c0d0>default</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>false</span><span style=color:#eceff4>)</span></span>
<span class=giallo-l><span style=color:#81a1c1>            .</span><span style=color:#88c0d0>interact</span><span style=color:#eceff4>()</span></span>
<span class=giallo-l><span style=color:#81a1c1>            .</span><span style=color:#88c0d0>map_err</span><span style=color:#eceff4>(</span><span>anyhow</span><span style=color:#81a1c1>::</span><span>Error</span><span style=color:#81a1c1>::</span><span>from</span><span style=color:#eceff4>)</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>    fn</span><span style=color:#88c0d0> create_tag</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&mut self</span><span style=color:#eceff4>,</span><span> version</span><span style=color:#81a1c1>: &</span><span style=color:#8fbcbb>Version</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> Result</span><span style=color:#eceff4>&lt;</span><span>git2</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Oid</span><span style=color:#eceff4>> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>        let</span><span> head</span><span style=color:#81a1c1> = self.</span><span>repo</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>head</span><span style=color:#eceff4>()</span><span style=color:#81a1c1>?</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>        if !</span><span>head</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>is_branch</span><span style=color:#eceff4>() {</span></span>
<span class=giallo-l><span style=color:#81a1c1>            return</span><span style=color:#8fbcbb> Err</span><span style=color:#eceff4>(</span><span style=color:#88c0d0;font-weight:700>anyhow!</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>HEAD is not branch</span><span style=color:#eceff4>"));</span></span>
<span class=giallo-l><span style=color:#eceff4>        }</span></span>
<span class=giallo-l><span style=color:#81a1c1>        let</span><span> obj</span><span style=color:#81a1c1> =</span><span> head</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>peel</span><span style=color:#eceff4>(</span><span>git2</span><span style=color:#81a1c1>::</span><span>ObjectType</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Commit</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>?</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>        let</span><span> signature</span><span style=color:#81a1c1> = self.</span><span>repo</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>signature</span><span style=color:#eceff4>()</span><span style=color:#81a1c1>?</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>        self.</span><span>repo</span></span>
<span class=giallo-l><span style=color:#81a1c1>            .</span><span style=color:#88c0d0>tag</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&</span><span style=color:#88c0d0;font-weight:700>format!</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>v</span><span style=color:#ebcb8b>{}</span><span style=color:#eceff4>",</span><span> version</span><span style=color:#eceff4>),</span><span style=color:#81a1c1> &</span><span>obj</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> &</span><span>signature</span><span style=color:#eceff4>, "",</span><span style=color:#81a1c1> false</span><span style=color:#eceff4>)</span></span>
<span class=giallo-l><span style=color:#81a1c1>            .</span><span style=color:#88c0d0>map_err</span><span style=color:#eceff4>(</span><span>anyhow</span><span style=color:#81a1c1>::</span><span>Error</span><span style=color:#81a1c1>::</span><span>from</span><span style=color:#eceff4>)</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>    fn</span><span style=color:#88c0d0> push_tag</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&mut self</span><span style=color:#eceff4>,</span><span> version</span><span style=color:#81a1c1>: &</span><span style=color:#8fbcbb>Version</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> Result</span><span style=color:#eceff4>&lt;()> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>        let mut</span><span> origin</span><span style=color:#81a1c1> = self.</span><span>repo</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>find_remote</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>origin</span><span style=color:#eceff4>")</span><span style=color:#81a1c1>?</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>        let mut</span><span> push_options</span><span style=color:#81a1c1> =</span><span> git2</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>PushOptions</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>new</span><span style=color:#eceff4>();</span></span>
<span class=giallo-l><span style=color:#81a1c1>        let mut</span><span> cb</span><span style=color:#81a1c1> =</span><span> git2</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>RemoteCallbacks</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>new</span><span style=color:#eceff4>();</span></span>
<span class=giallo-l><span>        cb</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>transfer_progress</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>|</span><span>_progress</span><span style=color:#81a1c1>|</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>            debug!</span><span style=color:#eceff4>(</span></span>
<span class=giallo-l><span style=color:#eceff4>                "</span><span style=color:#a3be8c>called progress total_objects: </span><span style=color:#ebcb8b>{}</span><span style=color:#eceff4>",</span></span>
<span class=giallo-l><span>                _progress</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>total_objects</span><span style=color:#eceff4>()</span></span>
<span class=giallo-l><span style=color:#eceff4>            );</span></span>
<span class=giallo-l><span style=color:#81a1c1>            true</span></span>
<span class=giallo-l><span style=color:#eceff4>        })</span></span>
<span class=giallo-l><span style=color:#81a1c1>        .</span><span style=color:#88c0d0>push_update_reference</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>|</span><span>reference</span><span style=color:#eceff4>,</span><span> msg</span><span style=color:#81a1c1>|</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>            match</span><span> msg</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#8fbcbb>                Some</span><span style=color:#eceff4>(</span><span>err_msg</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> =></span><span style=color:#88c0d0;font-weight:700> println!</span><span style=color:#eceff4>("</span><span style=color:#ebcb8b>{}</span><span style=color:#eceff4>",</span><span> err_msg</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>yellow</span><span style=color:#eceff4>()),</span></span>
<span class=giallo-l><span style=color:#8fbcbb>                None</span><span style=color:#81a1c1> =></span><span style=color:#88c0d0;font-weight:700> println!</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>successfully pushed origin/</span><span style=color:#ebcb8b>{}</span><span style=color:#eceff4>",</span><span> reference</span><span style=color:#eceff4>),</span></span>
<span class=giallo-l><span style=color:#eceff4>            }</span></span>
<span class=giallo-l><span style=color:#8fbcbb>            Ok</span><span style=color:#eceff4>(())</span></span>
<span class=giallo-l><span style=color:#eceff4>        })</span></span>
<span class=giallo-l><span style=color:#81a1c1>        .</span><span style=color:#88c0d0>credentials</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>|</span><span>url</span><span style=color:#eceff4>,</span><span> username_from_url</span><span style=color:#eceff4>,</span><span> allowed_types</span><span style=color:#81a1c1>|</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>            debug!</span><span style=color:#eceff4>(</span></span>
<span class=giallo-l><span style=color:#eceff4>                "</span><span style=color:#a3be8c>credential cb url:</span><span style=color:#ebcb8b>{}</span><span style=color:#a3be8c> username_from_url:</span><span style=color:#ebcb8b>{</span><span style=color:#a3be8c>:?</span><span style=color:#ebcb8b>}</span><span style=color:#a3be8c> allowed_type </span><span style=color:#ebcb8b>{</span><span style=color:#a3be8c>:?</span><span style=color:#ebcb8b>}</span><span style=color:#eceff4>",</span></span>
<span class=giallo-l><span>                url</span><span style=color:#eceff4>,</span><span> username_from_url</span><span style=color:#eceff4>,</span><span> allowed_types</span></span>
<span class=giallo-l><span style=color:#eceff4>            );</span></span>
<span class=giallo-l><span style=color:#81a1c1>            if</span><span> allowed_types</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>contains</span><span style=color:#eceff4>(</span><span>git2</span><span style=color:#81a1c1>::</span><span>CredentialType</span><span style=color:#81a1c1>::</span><span>USER_PASS_PLAINTEXT</span><span style=color:#eceff4>) {</span></span>
<span class=giallo-l><span style=color:#81a1c1>                let</span><span> user_name</span><span style=color:#81a1c1> = match</span><span> username_from_url</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#8fbcbb>                    Some</span><span style=color:#eceff4>(</span><span>u</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> =></span><span style=color:#8fbcbb> Some</span><span style=color:#eceff4>(</span><span style=color:#8fbcbb>Cow</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>from</span><span style=color:#eceff4>(</span><span>u</span><span style=color:#eceff4>)),</span></span>
<span class=giallo-l><span style=color:#8fbcbb>                    None</span><span style=color:#81a1c1> => match self.</span><span style=color:#88c0d0>user_name</span><span style=color:#eceff4>() {</span></span>
<span class=giallo-l><span style=color:#8fbcbb>                        Ok</span><span style=color:#eceff4>(</span><span style=color:#8fbcbb>Some</span><span style=color:#eceff4>(</span><span>u</span><span style=color:#eceff4>))</span><span style=color:#81a1c1> =></span><span style=color:#8fbcbb> Some</span><span style=color:#eceff4>(</span><span>u</span><span style=color:#eceff4>),</span></span>
<span class=giallo-l><span>                        _</span><span style=color:#81a1c1> =></span><span style=color:#8fbcbb> None</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span style=color:#eceff4>                    },</span></span>
<span class=giallo-l><span style=color:#eceff4>                };</span></span>
<span class=giallo-l><span style=color:#81a1c1>                return match</span><span> git2</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Cred</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>credential_helper</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&self.</span><span>cfg</span><span style=color:#eceff4>,</span><span> url</span><span style=color:#eceff4>,</span><span> user_name</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>as_deref</span><span style=color:#eceff4>()) {</span></span>
<span class=giallo-l><span style=color:#8fbcbb>                    Ok</span><span style=color:#eceff4>(</span><span>cred</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> =></span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>                        debug!</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>credential helper success</span><span style=color:#eceff4>");</span></span>
<span class=giallo-l><span style=color:#8fbcbb>                        Ok</span><span style=color:#eceff4>(</span><span>cred</span><span style=color:#eceff4>)</span></span>
<span class=giallo-l><span style=color:#eceff4>                    }</span></span>
<span class=giallo-l><span style=color:#8fbcbb>                    Err</span><span style=color:#eceff4>(</span><span>err</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> =></span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>                        debug!</span><span style=color:#eceff4>("</span><span style=color:#ebcb8b>{}</span><span style=color:#eceff4>",</span><span> err</span><span style=color:#eceff4>);</span></span>
<span class=giallo-l><span style=color:#616e88>                        // TODO: cache user credential to avoid prompt every time if user agree.</span></span>
<span class=giallo-l><span style=color:#81a1c1>                        let</span><span> cred</span><span style=color:#81a1c1> =</span><span style=color:#88c0d0> prompt_userpass</span><span style=color:#eceff4>()</span></span>
<span class=giallo-l><span style=color:#81a1c1>                            .</span><span style=color:#88c0d0>map_err</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>|</span><span>_</span><span style=color:#81a1c1>|</span><span> git2</span><span style=color:#81a1c1>::</span><span>Error</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>from_str</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>prompt_userpass</span><span style=color:#eceff4>"))</span><span style=color:#81a1c1>?</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span>                        git2</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Cred</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>userpass_plaintext</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&</span><span>cred</span><span style=color:#81a1c1>.</span><span style=color:#b48ead>0</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> &</span><span>cred</span><span style=color:#81a1c1>.</span><span style=color:#b48ead>1</span><span style=color:#eceff4>)</span></span>
<span class=giallo-l><span style=color:#eceff4>                    }</span></span>
<span class=giallo-l><span style=color:#eceff4>                };</span></span>
<span class=giallo-l><span style=color:#eceff4>            }</span></span>
<span class=giallo-l><span style=color:#616e88>            // TODO: currently only USER_PASS_PLAINTEXT called :(</span></span>
<span class=giallo-l><span>            git2</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Cred</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>ssh_key_from_agent</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>xxx</span><span style=color:#eceff4>")</span></span>
<span class=giallo-l><span style=color:#eceff4>        });</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>        push_options</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>remote_callbacks</span><span style=color:#eceff4>(</span><span>cb</span><span style=color:#eceff4>);</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>        let</span><span> ref_spec</span><span style=color:#81a1c1> =</span><span style=color:#88c0d0;font-weight:700> format!</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>refs/tags/v</span><span style=color:#ebcb8b>{</span><span style=color:#a3be8c>0</span><span style=color:#ebcb8b>}</span><span style=color:#a3be8c>:refs/tags/v</span><span style=color:#ebcb8b>{</span><span style=color:#a3be8c>0</span><span style=color:#ebcb8b>}</span><span style=color:#eceff4>",</span><span> version</span><span style=color:#eceff4>);</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>        debug!</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>refspec: </span><span style=color:#ebcb8b>{}</span><span style=color:#eceff4>",</span><span> ref_spec</span><span style=color:#eceff4>);</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>        origin</span></span>
<span class=giallo-l><span style=color:#81a1c1>            .</span><span style=color:#88c0d0>push</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&</span><span style=color:#eceff4>[</span><span style=color:#81a1c1>&</span><span>ref_spec</span><span style=color:#eceff4>],</span><span style=color:#8fbcbb> Some</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&mut</span><span> push_options</span><span style=color:#eceff4>))</span></span>
<span class=giallo-l><span style=color:#81a1c1>            .</span><span style=color:#88c0d0>map_err</span><span style=color:#eceff4>(</span><span>anyhow</span><span style=color:#81a1c1>::</span><span>Error</span><span style=color:#81a1c1>::</span><span>from</span><span style=color:#eceff4>)</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>    fn</span><span style=color:#88c0d0> user_name</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&self</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> Result</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Option</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Cow</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>str</span><span style=color:#eceff4>>>> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>        for</span><span> entry</span><span style=color:#81a1c1> in &self.</span><span>cfg</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>entries</span><span style=color:#eceff4>(</span><span style=color:#8fbcbb>Some</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>user*</span><span style=color:#eceff4>"))</span><span style=color:#81a1c1>?</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>            if let</span><span style=color:#8fbcbb> Ok</span><span style=color:#eceff4>(</span><span>entry</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> =</span><span> entry</span><span style=color:#eceff4> {</span></span>
<span class=giallo-l><span style=color:#88c0d0;font-weight:700>                debug!</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>found </span><span style=color:#ebcb8b>{</span><span style=color:#a3be8c>:?</span><span style=color:#ebcb8b>}</span><span style=color:#a3be8c> => </span><span style=color:#ebcb8b>{</span><span style=color:#a3be8c>:?</span><span style=color:#ebcb8b>}</span><span style=color:#eceff4>",</span><span> entry</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>name</span><span style=color:#eceff4>(),</span><span> entry</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>value</span><span style=color:#eceff4>());</span></span>
<span class=giallo-l><span style=color:#81a1c1>                return</span><span style=color:#8fbcbb> Ok</span><span style=color:#eceff4>(</span><span>entry</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>value</span><span style=color:#eceff4>()</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>map</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>|</span><span>v</span><span style=color:#81a1c1>|</span><span> Cow</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>Owned</span><span style=color:#eceff4>(</span><span>String</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>from</span><span style=color:#eceff4>(</span><span>v</span><span style=color:#eceff4>))));</span></span>
<span class=giallo-l><span style=color:#eceff4>            }</span></span>
<span class=giallo-l><span style=color:#eceff4>        }</span></span>
<span class=giallo-l><span style=color:#8fbcbb>        Ok</span><span style=color:#eceff4>(</span><span style=color:#8fbcbb>None</span><span style=color:#eceff4>)</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#81a1c1>fn</span><span style=color:#88c0d0> prompt_userpass</span><span style=color:#eceff4>()</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> Result</span><span style=color:#eceff4>&lt;(</span><span style=color:#8fbcbb>String</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> String</span><span style=color:#eceff4>)> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>    let</span><span> username</span><span style=color:#81a1c1> =</span><span> dialoguer</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Input</span><span style=color:#81a1c1>::</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>String</span><span style=color:#eceff4>></span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>new</span><span style=color:#eceff4>()</span></span>
<span class=giallo-l><span style=color:#81a1c1>        .</span><span style=color:#88c0d0>with_prompt</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>username</span><span style=color:#eceff4>")</span></span>
<span class=giallo-l><span style=color:#81a1c1>        .</span><span style=color:#88c0d0>interact</span><span style=color:#eceff4>()</span><span style=color:#81a1c1>?</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>    let</span><span> password</span><span style=color:#81a1c1> =</span><span> dialoguer</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>PasswordInput</span><span style=color:#81a1c1>::</span><span style=color:#88c0d0>new</span><span style=color:#eceff4>()</span></span>
<span class=giallo-l><span style=color:#81a1c1>        .</span><span style=color:#88c0d0>with_prompt</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>password</span><span style=color:#eceff4>")</span></span>
<span class=giallo-l><span style=color:#81a1c1>        .</span><span style=color:#88c0d0>interact</span><span style=color:#eceff4>()</span><span style=color:#81a1c1>?</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#8fbcbb>    Ok</span><span style=color:#eceff4>((</span><span>username</span><span style=color:#eceff4>,</span><span> password</span><span style=color:#eceff4>))</span></span>
<span class=giallo-l><span style=color:#eceff4>}</span></span>
<span class=giallo-l></span></code></pre><p><code>Bumper::bump()</code> ãŒentry pointã§ã™ã€‚<br> æµã‚Œã¨ã—ã¦ã¯ã€ã¾ãš<code>git2::Repository::open_from_env()</code>ã§<a href=https://docs.rs/git2/0.13.1/git2/struct.Repository.html rel=external><code>Repository</code></a>ã‚’å–å¾—ã—ã¾ã™ã€‚<br> ã“ã®<code>Repository</code>ã«å„å‡¦ç†ã®èµ·ç‚¹ã¨ãªã‚‹methodãŒå®šç¾©ã•ã‚Œã¦ã„ã¾ã™ã€‚<br> ä»Šå›ã¯ã€tagã®ä¸€è¦§ãŒã»ã—ã„ã®ã§ã€<code>Repository::tag_names()</code> ã‚’å‘¼ã³å‡ºã—ã€<a href=https://docs.rs/git2/0.13.1/git2/string_array/struct.StringArray.html rel=external><code>StringArray</code></a>ã‚’å–å¾—ã—ã¾ã™ã€‚ <code>&'a StringArray</code> ã¯<code>Iterator</code>ã‚’å®Ÿè£…ã—ã¦ã„ã‚‹ã®ã§ã€perseã—ã¦semantic versionã®ä¸€è¦§ã«å¤‰æ›ã—ã¾ã™ã€‚<br> ãƒ¦ãƒ¼ã‚¶ã«bumpã™ã‚‹versionã‚’é¸æŠã—ã¦ã‚‚ã‚‰ã£ãŸã‚ã¨ã¯ã€bumpã•ã‚ŒãŸversionã§tagã‚’ä½œæˆã—ã¾ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>    fn</span><span style=color:#88c0d0> create_tag</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&mut self</span><span style=color:#eceff4>,</span><span> version</span><span style=color:#81a1c1>: &</span><span style=color:#8fbcbb>Version</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> Result</span><span style=color:#eceff4>&lt;</span><span>git2</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Oid</span><span style=color:#eceff4>> {</span></span>
<span class=giallo-l><span style=color:#81a1c1>        let</span><span> head</span><span style=color:#81a1c1> = self.</span><span>repo</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>head</span><span style=color:#eceff4>()</span><span style=color:#81a1c1>?</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>        if !</span><span>head</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>is_branch</span><span style=color:#eceff4>() {</span></span>
<span class=giallo-l><span style=color:#81a1c1>            return</span><span style=color:#8fbcbb> Err</span><span style=color:#eceff4>(</span><span style=color:#88c0d0;font-weight:700>anyhow!</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>HEAD is not branch</span><span style=color:#eceff4>"));</span></span>
<span class=giallo-l><span style=color:#eceff4>        }</span></span>
<span class=giallo-l><span style=color:#81a1c1>        let</span><span> obj</span><span style=color:#81a1c1> =</span><span> head</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>peel</span><span style=color:#eceff4>(</span><span>git2</span><span style=color:#81a1c1>::</span><span>ObjectType</span><span style=color:#81a1c1>::</span><span style=color:#8fbcbb>Commit</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>?</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>        let</span><span> signature</span><span style=color:#81a1c1> = self.</span><span>repo</span><span style=color:#81a1c1>.</span><span style=color:#88c0d0>signature</span><span style=color:#eceff4>()</span><span style=color:#81a1c1>?</span><span style=color:#eceff4>;</span></span>
<span class=giallo-l><span style=color:#81a1c1>        self.</span><span>repo</span></span>
<span class=giallo-l><span style=color:#81a1c1>            .</span><span style=color:#88c0d0>tag</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&</span><span style=color:#88c0d0;font-weight:700>format!</span><span style=color:#eceff4>("</span><span style=color:#a3be8c>v</span><span style=color:#ebcb8b>{}</span><span style=color:#eceff4>",</span><span> version</span><span style=color:#eceff4>),</span><span style=color:#81a1c1> &</span><span>obj</span><span style=color:#eceff4>,</span><span style=color:#81a1c1> &</span><span>signature</span><span style=color:#eceff4>, "",</span><span style=color:#81a1c1> false</span><span style=color:#eceff4>)</span></span>
<span class=giallo-l><span style=color:#81a1c1>            .</span><span style=color:#88c0d0>map_err</span><span style=color:#eceff4>(</span><span>anyhow</span><span style=color:#81a1c1>::</span><span>Error</span><span style=color:#81a1c1>::</span><span>from</span><span style=color:#eceff4>)</span></span>
<span class=giallo-l><span style=color:#eceff4>    }</span></span></code></pre><p><code>Repository::tag()</code>ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹ã®ã§ã€tagã‚’ä½œã‚‹ã®ã¯ã“ã‚Œã‚’å‘¼ã¶ã®ã‹ãªã¨æ€ã„ã€docã‚’ã¿ã¦ã¿ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ã«å®šç¾©ã•ã‚Œã¦ã„ã¾ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>pub fn</span><span style=color:#88c0d0> tag</span><span style=color:#eceff4>(</span></span>
<span class=giallo-l><span style=color:#81a1c1>    &self</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>    name</span><span style=color:#81a1c1>: &</span><span style=color:#8fbcbb>str</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>    target</span><span style=color:#81a1c1>: &</span><span style=color:#8fbcbb>Object</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>    tagger</span><span style=color:#81a1c1>: &</span><span style=color:#8fbcbb>Signature</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>    message</span><span style=color:#81a1c1>: &</span><span style=color:#8fbcbb>str</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>    force</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> bool</span></span>
<span class=giallo-l><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> Result</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Oid</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> Error</span><span style=color:#eceff4>></span></span></code></pre><p>ã“ã“ã§ã€<code>Object</code>ãªã‚‹èãæ…£ã‚Œãªã„å‹ãŒã§ã¦ãã¾ã—ãŸã€‚ã“ã“ã§ã€<code>git object</code>ã§æ¤œç´¢ã™ã‚‹ã¨å…¬å¼?ã®<a href=https://git-scm.com/book/en/v2/Git-Internals-Git-Objects rel=external>Chapter 10 Git Internal</a>ã®è¨˜äº‹ãŒã§ã¦ãã¾ã—ãŸã€‚ ã©ã†ã‚„ã‚‰ã€Gitã¯å†…éƒ¨çš„ã«ã€key-value storeã‚’å‚™ãˆã¦ãŠã‚Šã€valueã¯blobã¨ã—ã¦ä¿æŒã—ã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚ã“ã®blobã‚’ç‰¹å®šã®å‹(ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«)ã¨ã—ã¦æ‰±ã†ã“ã¨ã‚’peelã¨å‘¼ã‚“ã§ã„ã‚‹ã¿ãŸã„ã§ã™ã€‚ ã¨ã„ã†ã“ã¨ã§ã€cliã‹ã‚‰<code>git tag vX.Y.Z</code>ã¨å®Ÿè¡Œã—ãŸã¨ãã¯HEADãŒå¯¾è±¡ã«ãªã‚‹ã“ã¨ã«ãªã‚‰ã£ã¦ã€<code>Repository::head()</code> ã§HEADã‚’å–å¾—ã™ã‚‹ã‚ˆã†ã«ã—ã¦ã¿ã¾ã—ãŸã€‚<h3 id=ren-zheng-gayatukai><a aria-label="Anchor link for: ren-zheng-gayatukai" class=zola-anchor href=#ren-zheng-gayatukai>èªè¨¼ãŒã‚„ã£ã‹ã„</a></h3><p>localã«tagã‚’ä½œæˆã—ãŸã‚ã¨ã¯remoteã«pushã™ã‚‹ã ã‘ãªã®ã§ã™ãŒã€ã“ã“ãŒã‚„ã£ã‹ã„ã§ã—ãŸã€‚ ã¾ãšã€<code>Repository::find_remote()</code> ã§<a href=https://docs.rs/git2/0.13.1/git2/struct.Remote.html rel=external><code>Remote</code></a>ã‚’å–å¾—ã—ã€<code>Remote:push()</code>ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚<code>push</code>ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«å®šç¾©ã•ã‚Œã¦ã„ã¾ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>pub fn</span><span style=color:#88c0d0> push</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Str</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> AsRef</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>str</span><span style=color:#eceff4>></span><span style=color:#81a1c1> +</span><span style=color:#8fbcbb> IntoCString</span><span style=color:#81a1c1> +</span><span style=color:#8fbcbb> Clone</span><span style=color:#eceff4>>(</span></span>
<span class=giallo-l><span style=color:#81a1c1>    &mut self</span><span style=color:#eceff4>,</span></span>
<span class=giallo-l><span>    refspecs</span><span style=color:#81a1c1>: &</span><span style=color:#eceff4>[</span><span style=color:#8fbcbb>Str</span><span style=color:#eceff4>],</span></span>
<span class=giallo-l><span>    opts</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> Option</span><span style=color:#eceff4>&lt;</span><span style=color:#81a1c1>&mut</span><span style=color:#8fbcbb> PushOptions</span><span style=color:#eceff4>></span></span>
<span class=giallo-l><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> Result</span><span style=color:#eceff4>&lt;(),</span><span style=color:#8fbcbb> Error</span><span style=color:#eceff4>></span></span></code></pre><p>refspecsã«ã¤ã„ã¦ã¯ã€<code>refs/tags/vX.Y.Z:refs/tags/vX.Y.Z</code>ã®ã‚ˆã†ã«ã€refsä»¥ä¸‹ã‚’ãã®ã¾ã¾å¯¾å¿œã•ã›ãŸã‚‰ã†ã¾ãã„ãã¾ã—ãŸã€‚ æ¬¡ã®å¼•æ•°ã€<code>PushOptions</code>ã«callbackã¨ã—ã¦èªè¨¼å‡¦ç†ã‚’ã‚ãŸã›ã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=rust><span class=giallo-l><span style=color:#81a1c1>pub fn</span><span style=color:#88c0d0> credentials</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>F</span><span style=color:#eceff4>>(</span><span style=color:#81a1c1>&mut self</span><span style=color:#eceff4>,</span><span> cb</span><span style=color:#81a1c1>:</span><span style=color:#8fbcbb> F</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -> &mut</span><span style=color:#8fbcbb> RemoteCallbacks</span><span style=color:#eceff4>&lt;'</span><span style=color:#8fbcbb>a</span><span style=color:#eceff4>></span></span>
<span class=giallo-l><span style=color:#81a1c1>where</span></span>
<span class=giallo-l><span style=color:#8fbcbb>    F</span><span style=color:#81a1c1>:</span><span style=color:#88c0d0> FnMut</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&</span><span style=color:#8fbcbb>str</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> Option</span><span style=color:#eceff4>&lt;</span><span style=color:#81a1c1>&</span><span style=color:#8fbcbb>str</span><span style=color:#eceff4>>,</span><span style=color:#8fbcbb> CredentialType</span><span style=color:#eceff4>)</span><span style=color:#81a1c1> -></span><span style=color:#8fbcbb> Result</span><span style=color:#eceff4>&lt;</span><span style=color:#8fbcbb>Cred</span><span style=color:#eceff4>,</span><span style=color:#8fbcbb> Error</span><span style=color:#eceff4>></span><span style=color:#81a1c1> +</span><span style=color:#eceff4> '</span><span style=color:#8fbcbb>a</span><span style=color:#eceff4>,</span><span> </span></span></code></pre><p>ã“ã“ã§documentã«ã‚ã¾ã‚Šæƒ…å ±ãŒãªãã€å›°ã£ãŸã®ã§ã™ãŒã€<a href="https://github.com/rust-lang/git2-rs/issues?q=is%3Aissue+authentication+required+but+no+callback+set" rel=external>issue</a>ã¨<a href=https://github.com/rust-lang/cargo/blob/6a7672ef5344c1bb570610f2574250fbee932355/src/cargo/sources/git/utils.rs#L409 rel=external>cargoã®ã‚³ãƒ¡ãƒ³ãƒˆ</a>ã‹ã‚‰ã€callbackã®ç¬¬3å¼•æ•°(<code>allowed_types</code>)ã«å¿œã˜ã¦ã€<a href=https://docs.rs/git2/0.13.1/git2/struct.Cred.html rel=external><code>git2::Cred</code></a>ã‚’ç”Ÿæˆã—ã¦è¿”ã›ã°ã‚ˆã•ãã†ã ã£ãŸã®ã§ã€<code>git2::Cred::user_pass_plaintext()</code>ã‚’å®Ÿè¡Œã—ãŸã¨ã“ã‚ã€githubã«èªè¨¼ã—ã¦ã‚‚ã‚‰ãˆã¾ã—ãŸã€‚<p>æ¯å›èªè¨¼ã®promptã‚’ã ã™ã®ã¯ã•ã™ãŒã«ç…©ã‚ã—ã„ã®ã§ã€ã“ã®ã‚ãŸã‚Šã¯æ”¹å–„ã—ãŸã„ã§ã™ã€‚ <a href=https://libgit2.org/docs/guides/authentication/ rel=external>libgit2ã«ã‚‚doc</a>ãŒã‚ã‚Šã¾ã™ã€‚<h2 id=matome><a aria-label="Anchor link for: matome" class=zola-anchor href=#matome>ã¾ã¨ã‚</a></h2><p>Rustã‹ã‚‰gitã®å‡¦ç†ã‚’å®‰å…¨ã«(FFIã‚’wrapã—ã¦ã‚‚ã‚‰ã£ãŸå½¢ã§)æ‰±ãˆã‚‹ã€‚</div></article></main><footer class=blog-footer><p>Â© 2026 <a href=https://blog.ymgyt.io> ymgyt </a> | Made with <a href=https://www.getzola.org rel=noopener target=_blank>Zola</a> | <a href=https://github.com/ymgyt/blog>Repository</a> | <a href=https://blog.ymgyt.io/atom.xml target=_blank title=rss> <svg viewbox="0 0 24 24" class=icon fill=none height=24 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx=5 cy=19 r=1></circle></svg> </a></footer></div></div>